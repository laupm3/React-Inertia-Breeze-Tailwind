import{r as i,j as s,a as d,A as L}from"./app-fwyInB3c.js";import{C as O}from"./Calendario-DmDSFQ4u.js";import{B as V}from"./BlockCard-TCX704se.js";import{C as I,V as T}from"./ViewEventDialog-BRxd9plH.js";import{u as B}from"./useNotifications-CSWGH93r.js";import{g as M}from"./eventDateUtils-BP43QzoI.js";import{I as o}from"./LucideIcon-CEqEhMjI.js";import{B as b}from"./Button-CQuYVLGu.js";function K(){const[E,a]=i.useState(!1),[N,y]=i.useState(!1),[_,m]=i.useState(new Date),[h,c]=i.useState(null),[u,n]=i.useState([]),[v,p]=i.useState([]),{calendarEvents:l}=B();i.useEffect(()=>{l&&l.length>0&&n(e=>{const r=[...e];return l.forEach(t=>{const f=r.findIndex(g=>g.id===t.id);if(f!==-1)r[f]={...r[f],...t};else{const g={id:t.id,nombre:t.title,descripcion:t.descripcion,fecha_inicio:t.start,hora_inicio:w(t.start),tipo_evento:{color:t.color||"#FF5733",id:t.tipo||1,nombre:t.tipo||"Evento"},users:t.participantes||[]};r.push(g)}}),r})},[l]);const w=e=>{if(!e)return"";try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(r){return console.error("Error parsing date:",r),""}},x=async()=>{try{const e=await d.get(route("api.v1.user.eventos.index"));if(e.data&&Array.isArray(e.data.eventos)){const r=e.data.eventos.map(t=>({...t}));n(r)}else console.error("La respuesta no contiene un array de eventos:",e.data),n([])}catch(e){console.error("Error al obtener eventos:",e),n([])}};i.useEffect(()=>{x(),(async()=>{try{const r=await d.get(route("api.v1.user.eventos.tipos"));r.data&&r.data.tiposEvento?p(r.data.tiposEvento):p([])}catch(r){console.error("Error al obtener tipos de eventos:",r),p([])}})()},[]);const C=async e=>{try{(await d.post(route("user.eventos.store"),{nombre:e.titulo,descripcion:e.descripcion,fecha_inicio:e.fecha_inicio,hora_inicio:e.hora_inicio,tipo_evento_id:e.tipo_evento_id,users:Array.isArray(e.users)&&e.users.length>0?typeof e.users[0]=="object"?e.users.map(t=>t.id):e.users:[],team_id:e.team_id,empresa_id:e.empresa_id,departamento_id:e.departamento_id})).data&&(x(),a(!1))}catch(r){console.error("Error al crear el evento:",r)}},S=async e=>{try{(await d.put(route("user.eventos.update",{evento:e.id}),{nombre:e.titulo,descripcion:e.descripcion,fecha_inicio:e.fecha_inicio,hora_inicio:e.hora_inicio,tipo_evento_id:e.tipo_evento_id,users:Array.isArray(e.users)&&e.users.length>0?typeof e.users[0]=="object"?e.users.map(t=>t.id):e.users:[],team_id:e.team_id,empresa_id:e.empresa_id,departamento_id:e.departamento_id})).data&&(x(),a(!1),c(null))}catch(r){console.error("Error al actualizar el evento:",r)}},A=e=>{n(u.filter(r=>r.id!==e))},j=e=>{c(e),y(!0)},F=e=>{c(e),m(new Date(e.fecha_inicio)),a(!0)},k=()=>{L.visit(route("user.eventos.index"))};return s.jsxs(V,{className:"border-none bg-custom-gray-default dark:bg-custom-blackSemi p-3 sm:p-4 lg:p-6",children:[s.jsx("div",{className:"w-full",children:s.jsx(O,{onDateSelect:m,onDateDoubleClick:e=>{m(e),c(null),a(!0)},onEventClick:j,events:u||[]})}),s.jsx("div",{className:"border-b-2 border-custom-gray-light dark:border-custom-blackLight rounded-sm my-4"}),s.jsx("div",{className:"space-y-2 sm:space-y-2",children:(()=>{const e=M(u,_),r=e.slice(0,3);return s.jsx(s.Fragment,{children:r.length>0?s.jsxs(s.Fragment,{children:[r.map(t=>s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between w-full p-2 sm:p-3 bg-custom-white dark:bg-custom-blackLight rounded-xl sm:rounded-2xl cursor-pointer transition-all duration-200 hover:bg-custom-gray-light dark:hover:bg-custom-blackSemi hover:shadow-sm",onClick:()=>j(t),children:[s.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[s.jsx("div",{className:"w-3 h-3 sm:w-4 sm:h-4 rounded-full flex-shrink-0",style:{backgroundColor:t.tipo_evento.color}}),s.jsxs("div",{className:"ml-2 sm:ml-3 flex-1 min-w-0",children:[s.jsx("h4",{className:"text-sm sm:text-base font-medium text-custom-blackLight dark:text-custom-white truncate",children:t.nombre}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-0.5 sm:hidden",children:[s.jsxs("div",{className:"flex items-center text-xs text-custom-gray-dark dark:text-custom-gray-light",children:[s.jsx(o,{name:"Calendar",className:"w-3 h-3 mr-1 text-custom-gray-semiDark"}),t.fecha_inicio?t.fecha_inicio.includes("/")?t.fecha_inicio:new Date(t.fecha_inicio).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit"}):"Sin fecha"]}),s.jsxs("div",{className:"flex items-center text-xs text-custom-gray-dark dark:text-custom-gray-light",children:[s.jsx(o,{name:"Clock",className:"w-3 h-3 mr-1 text-custom-gray-semiDark"}),t.hora_inicio||"Sin hora"]})]})]})]}),s.jsxs("div",{className:"hidden sm:flex flex-col items-start text-xs text-custom-gray-dark dark:text-custom-gray-light gap-1",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(o,{name:"Calendar",className:"w-4 h-4 mr-1 text-custom-gray-semiDark"}),t.fecha_inicio?t.fecha_inicio.includes("/")?t.fecha_inicio:new Date(t.fecha_inicio).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"No hay fecha de inicio"]}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(o,{name:"Clock",className:"w-4 h-4 mr-1 text-custom-gray-semiDark"}),t.hora_inicio||"No hay hora de inicio"]})]})]},t.id)),e.length>3&&s.jsx("div",{className:"mt-3 sm:mt-4 flex justify-center",children:s.jsxs(b,{variant:"secondary",onClick:k,size:"sm",children:[s.jsxs("span",{children:["Ver más eventos (",e.length-3," más)"]}),s.jsx(o,{name:"ArrowRight",className:"ml-1 w-4 h-4"})]})})]}):s.jsxs("div",{className:"text-center py-6 sm:py-8",children:[s.jsx("div",{className:"mb-3",children:s.jsx(o,{name:"Calendar",className:"w-10 h-10 sm:w-12 sm:h-12 mx-auto text-custom-gray-light dark:text-custom-gray-dark"})}),s.jsx("p",{className:"text-custom-gray-dark dark:text-custom-gray-light text-sm mb-2",children:"No hay eventos para esta fecha"}),s.jsxs(b,{variant:"secondary",size:"sm",onClick:k,children:[s.jsx("span",{children:"Ver todos los eventos"}),s.jsx(o,{name:"ArrowRight",className:"w-4 h-4"})]})]})})})()}),s.jsx(I,{isOpen:E,onClose:()=>{a(!1),c(null)},onSubmit:h?S:C,selectedDate:_,eventTypes:v,selectedEvent:h}),s.jsx(T,{isOpen:N,onClose:()=>y(!1),eventData:h,onEdit:F,onDelete:A})]})}export{K as E};
