import{r,j as e,G as T}from"./app-fwyInB3c.js";import{D as B,b as I,c as L,d as U,f as F,g as O}from"./dialog-iaZkf6Xy.js";import{I as f}from"./LucideIcon-CEqEhMjI.js";import{B as E}from"./button-Blwr-A5N.js";import{I as S}from"./input-CqlBlYgU.js";import{S as R}from"./separator-BWKairMX.js";import{E as D}from"./EmpleadoSelect-uBQCJxR7.js";import{c as M}from"./utils-CytzSlOG.js";import{C as z,f as A,b as G,c as V,d as H,e as $}from"./command-PoUoScut.js";import{P as q,a as J,b as K}from"./popover-DaRbHQOK.js";import{u as _}from"./useTranslation-BtIkv0Na.js";import{D as Q}from"./DecisionModal-Dl8siGBG.js";import W from"./DefaultValuesForm-D-Rmbg_b.js";import X from"./DepartmentSchema-Cv_kAOdq.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-DloWbRVd.js";import"./index-B7srb2QZ.js";import"./index-BIJodELy.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./index-BwobEAja.js";import"./EmpleadoAvatar-BBWI_HPN.js";import"./avatar-oBOSifLN.js";import"./tooltip-DFfoxvAF.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./index-CeuhGnKJ.js";import"./alert-dialog-kDfn0La3.js";import"./Button-CQuYVLGu.js";import"./types-BZmDMmQb.js";function Y({prevParentDepartamentoId:l,fetchUrl:h,className:d,onSelect:s}){const[n,u]=r.useState(!1),[c,i]=r.useState(null),[m,g]=r.useState([]),[b,p]=r.useState(null),[t,x]=r.useState(!0),{t:C}=_("datatable"),v=o=>{s&&s(o)};return r.useEffect(()=>{if(l){const o=m.find(a=>a.id===l);o&&i(o)}else i(null)},[l,m]),r.useEffect(()=>((async()=>{try{const a=await axios.get(h);a.status===200?g(a.data.departamentos):p(!0)}catch{p(!0)}finally{x(!1)}})(),()=>{}),[h]),e.jsxs(q,{open:n,onOpenChange:u,modal:!0,children:[e.jsx(J,{asChild:!0,children:e.jsxs("button",{role:"combobox","aria-expanded":n,className:`w-full justify-between rounded-full bg-custom-gray-default dark:bg-custom-gray-darker text-gray-600 ${d} text-sm flex p-2.5 items-center cursor-default`,onClick:()=>u(!n),children:[c?e.jsx("div",{className:"flex items-center ml-4 -m-1.5",children:c.nombre}):"Seleccione un departamento padre...",e.jsx(f,{name:"ChevronsUpDown",className:"ml-2 mr-4 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(K,{className:"w-full p-2",children:e.jsxs(z,{children:[e.jsx(A,{className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-gray-darker",placeholder:"Buscar departamento padre..."}),e.jsxs(G,{children:[e.jsx(V,{children:b?"Ningún departamento encontrado":e.jsx("span",{className:"text-red-500",children:"Error al cargar los departamentos."})}),e.jsx(H,{children:t?e.jsx("div",{className:"p-2 text-center",children:"Cargando departamentos..."}):m&&m.length>0?m.map(o=>e.jsxs($,{value:o.id,onSelect:()=>{i(o),u(!1),v(o)},children:[e.jsx(f,{name:"Check",className:M("mr-2 h-4 w-4",(c==null?void 0:c.id)===o.id?"opacity-100":"opacity-0")}),o.nombre]},o.id)):e.jsx("div",{className:"p-2 text-center",children:"No hay departamentos disponibles"})})]})]})})]})}function Ve({dataId:l,open:h,onOpenChange:d}){const{t:s}=_(["datatable"]),[n,u]=r.useState(null),[c,i]=r.useState(!0),[m,g]=r.useState(!1),[b,p]=r.useState(!1),t=T(W),x=r.useCallback(async()=>{try{const a=await axios.get(route("api.v1.admin.departamentos.show",{id:l}));a.status===200&&(u(a.data.departamento),C(a.data.departamento))}catch(a){console.error("Error fetching departamento:",a),g(!0)}finally{i(!1)}},[l]);r.useEffect(()=>{l?x():(t.reset(),i(!1))},[l,x]);const C=r.useCallback(a=>{if(!a)return;const{id:j,nombre:N,manager:k,adjunto:y,descripcion:P,parentDepartment:w}=a;t.setData({id:j,nombre:N,manager_id:k==null?void 0:k.id,adjunto_id:y==null?void 0:y.id,descripcion:P,parent_department_id:w==null?void 0:w.id})},[t]),v=r.useCallback(()=>{const a=X(s).safeParse(t.data);if(!a.success){const j=a.error.flatten().fieldErrors;Object.keys(j).forEach(N=>{t.setError(N,j[N][0])});return}n?t.put(route("admin.departamentos.update",{id:n.id})):t.post(route("admin.departamentos.store"),{onSuccess:()=>{t.reset(),d()},errorBag:"updateOrCreateDepartamento"})},[n,t,d,s]),o=s(l?"tables.editardepartamento":"tables.creaciondepartamento");return e.jsxs(e.Fragment,{children:[e.jsx(B,{open:h,onOpenChange:d,children:e.jsxs(I,{className:"sm:max-w-[1225px] sm:h-[590px] bg-custom-white dark:bg-custom-blackLight",children:[e.jsx(L,{children:e.jsx(U,{className:"",children:o})}),e.jsx("div",{className:"flex flex-col gap-4 h-full overflow-y-auto p-4",children:c?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(f,{name:"Loader",className:"w-8 h-8 animate-spin text-custom-orange"}),e.jsx("span",{className:"text-sm text-custom-blue dark:text-custom-white",children:"Cargando información del departamento..."})]})}):m?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(f,{name:"AlertTriangle",className:"w-8 h-8 text-red-500"}),e.jsx("span",{className:"text-sm text-red-500",children:"Error al cargar el departamento. Por favor, inténtalo de nuevo."}),e.jsx(E,{className:"mt-2 bg-custom-orange hover:bg-custom-blue text-custom-white dark:text-custom-black rounded-full",onClick:()=>{g(!1),i(!0),x()},children:"Reintentar"})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"flex flex-col gap-2 ",children:[e.jsxs("span",{className:"text-sm font-bold  text-custom-blue dark:text-custom-white",children:[s("tables.nombredepartamento"),e.jsx("span",{className:"text-custom-orange",children:" *"})]}),e.jsx(S,{placeholder:s("tables.añadirdepartamento"),className:" rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:t.data.nombre,onChange:a=>t.setData("nombre",a.target.value)}),t.errors.nombre&&e.jsx("span",{className:"text-xs text-red-500",children:t.errors.nombre}),e.jsx("span",{className:"text-xs text-custom-gray-semiDark dark:text-custom-gray-dark pl-1",children:s("tables.RepetirRegistro")})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"flex flex-col gap-2 ",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:[s("tables.manager"),e.jsx("span",{className:"text-custom-orange",children:" *"})]}),e.jsx(D,{fetchUrl:route("api.v1.admin.empleados.searchByType",{typeId:3}),onSelect:a=>t.setData("manager_id",a.id),prevEmpleadoId:t.data.manager_id}),t.errors.manager_id&&e.jsx("span",{className:"text-xs text-red-500",children:t.errors.manager_id})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:[s("tables.adjunto"),e.jsx("span",{className:"text-custom-orange",children:" *"})]}),e.jsx(D,{fetchUrl:route("api.v1.admin.empleados.searchByType",{typeId:2}),onSelect:a=>t.setData("adjunto_id",a.id),prevEmpleadoId:t.data.adjunto_id}),t.errors.adjunto_id&&e.jsx("span",{className:"text-xs text-red-500",children:t.errors.adjunto_id})]})]}),e.jsx("div",{className:"",children:e.jsxs("div",{className:"flex flex-col gap-2 ",children:[e.jsx("span",{className:"text-sm font-bold  text-custom-blue dark:text-custom-white",children:s("tables.descripcion")}),e.jsx(S,{placeholder:"Lorem ipsum dolor...",className:" rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:t.data.descripcion,onChange:a=>t.setData("descripcion",a.target.value)}),t.errors.descripcion&&e.jsx("span",{className:"text-xs text-red-500",children:t.errors.descripcion})]})}),e.jsx(R,{className:"bg-custom-blackSemi dark:bg-custom-white"}),e.jsx("h1",{className:" font-bold text-custom-blue dark:text-custom-white",children:s("tables.InformacionContacto")}),e.jsx("div",{className:"grid grid-cols-1 gap-8",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:s("tables.departamento")}),e.jsx(Y,{fetchUrl:route("api.v1.admin.departamentos.index"),onSelect:a=>t.setData("parent_department_id",a.id),prevParentDepartamentoId:t.data.parent_department_id})]})})]})}),e.jsxs(F,{className:"flex justify-end gap-4 ",children:[e.jsx(O,{className:"inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 bg-hidden hover:bg-custom-gray-default dark:hover:bg-custom-blackSemi text-custom-black dark:text-custom-white rounded-full",children:s("tables.cancelar")}),e.jsx(E,{className:"bg-custom-orange hover:bg-custom-blue text-custom-white dark:text-custom-black dark:hover:bg-custom-white rounded-full",onClick:()=>p(!0),children:n?"Editar":"Crear"})]})]})}),e.jsx(Q,{variant:"confirm",open:b,onOpenChange:()=>p(!b),action:v,title:n?"¿Estas seguro de editar el departamento?":"¿Estas seguro de crear el departamento?",content:n?"Esta acción actualizará el departamento en el sistema. Ejecutando los flujos necesarios para su correcto funcionamiento.":"Esta acción creará un nuevo departamento en el sistema. Ejecutando los flujos necesarios para su correcto funcionamiento.",icon:e.jsx(f,{name:"TriangleAlert",className:"text-custom-orange"})})]})}export{Ve as default};
