import{r as G,j as i}from"./app-fwyInB3c.js";import{useDataHandler as Z}from"./DataHandlerContext-eWg_TTj1.js";import{r as I}from"./RowSelectionColumn-COjZFz9T.js";import{T as ee,a as V,b as W,c as q}from"./tooltip-DFfoxvAF.js";import{B as K}from"./Button-CQuYVLGu.js";import"./endOfWeek-DoVA-Yvp.js";import"./toDate-qOSwr3PX.js";import"./format-Be40hyfq.js";import"./constants-BKFt95HM.js";import"./index-BxSEkZvI.js";import"./index-DloWbRVd.js";import"./index-p2DxCSsL.js";import"./index-DmpKZt4E.js";import"./index-4A9uUPu1.js";import"./index-BZgm3BCW.js";import"./index-BZxTbISK.js";import"./index-BIJodELy.js";import"./utils-CytzSlOG.js";import"./check-5DjPwM22.js";import"./createLucideIcon-DoJ0Kelj.js";import"./index-B7srb2QZ.js";import"./index-DmaU4p-o.js";import"./index-CLai1W86.js";import"./index-CeuhGnKJ.js";import"./index-BwobEAja.js";const O={"Entrada a tiempo":{point:"bg-gray-300",bg:"bg-gray-300/30",text:"text-gray-400",border:"border-gray-400"},"Entrada antes de tiempo":{point:"bg-green-500",bg:"bg-green-500/30",text:"text-green-500",border:"border-green-500"},"Entrada retrasada":{point:"bg-red-500",bg:"bg-red-500/30",text:"text-red-500",border:"border-red-500"},"Jornada en curso":{point:"bg-yellow-500",bg:"bg-yellow-500/30",text:"text-yellow-500",border:"border-yellow-500"},"Jornada justificada":{point:"bg-blue-500",bg:"bg-blue-500/30",text:"text-blue-500",border:"border-blue-500"},"Salida antes de tiempo":{point:"bg-red-500",bg:"bg-red-500/30",text:"text-red-500",border:"border-red-500"},"Salida despues de tiempo":{point:"bg-green-500",bg:"bg-green-500/30",text:"text-green-500",border:"border-green-500"},"Salida a tiempo":{point:"bg-gray-300",bg:"bg-gray-300/30",text:"text-gray-400",border:"border-gray-400"}},te=({fichajeEntrada:b,fichajeSalida:w,horarioInicio:g,horarioFin:j,descansoInicio:S,descansoFin:P,descansos:l=[],mostrarTicks:n=!1,segmentTooltipFormatter:o=d=>{const M=d.label==="Tiempo de trabajo"||d.label==="Tiempo trabajado",v=d.label==="Retraso";return i.jsxs("div",{className:"grid gap-1.5",children:[i.jsx("div",{className:"font-semibold",children:d.label}),d.startTime&&i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:M?"Hora de entrada:":v?"Entrada prevista:":"Inicio:"})," ",d.startTime]}),d.endTime&&i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:M?"Hora de salida:":v?"Entrada real:":"Fin:"})," ",d.endTime]}),d.minutes&&i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:"Duración:"})," ",d.minutes," min"]})]})},tickTooltipFormatter:m=d=>d.time})=>{const[d,M]=G.useState(null),[v,z]=G.useState(0),H=()=>"ontouchstart"in window||navigator.maxTouchPoints>0;G.useEffect(()=>{S&&!P&&z(e=>e+1)},[S,P]);const T=15,C=(()=>{if(g&&j){const[e]=g.split(":").map(Number),[s]=j.split(":").map(Number);if(e>s)return!0;if(e<=2&&b){const[r]=b.split(":").map(Number);if(r>=20)return!0}if(s===0)return!0}return!1})(),R=C?(()=>{const[e]=(g||"00:00").split(":").map(Number),[s]=(j||"00:00").split(":").map(Number);return e>s||s===0?g:b||g})():null,h=(e,s=!1)=>{if(!e)return null;const[r,a]=e.split(":").map(Number);let N=r*60+a;if(C&&R){const[_]=R.split(":").map(Number);if(e===b&&g){const[B]=g.split(":").map(Number);if(r<B)return N}r<_&&(N+=24*60)}else if(!C&&g){const[_,B]=g.split(":").map(Number),Y=_*60+B;N-Y>12*60&&(N-=24*60)}return N},$=e=>{const s=(e%1440+1440)%1440,r=Math.floor(s/60),a=s%60;return`${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},y=(Array.isArray(l)&&l.length?l:S?[{inicio:S,fin:P}]:[]).map(e=>({inicio:e.inicio||e.descanso_inicio||e.descansoInicio,fin:e.fin||e.descanso_fin||e.descansoFin})).filter(e=>e.inicio).map(e=>({inicioStr:e.inicio,finStr:e.fin,inicioMin:h(e.inicio),finMin:h(e.fin,!0)})).sort((e,s)=>e.inicioMin-s.inicioMin),E=[h(b),h(w,!0),h(g),h(j,!0),...y.flatMap(e=>[e.inicioMin,e.finMin])].filter(e=>e!==null),L=E.length?Math.min(...E):0,J=E.length?Math.max(...E):0,t=e=>{if(e===null||J===L)return 0;const s=J-L;return Math.max(0,Math.min(100,(e-L)/s*100))},p=h(g),c=h(j,!0),u=h(b),f=h(w,!0),A=y.length?y[0].inicioMin:null,F=y.length?y[y.length-1].finMin:null,U=y.length?y[y.length-1].finStr:null,Q=()=>{const e=[],s=[];if(b||w?(b&&s.push({time:b,type:"fichaje_entrada"}),w&&s.push({time:w,type:"fichaje_salida"})):(g&&s.push({time:g,type:"horario_inicio"}),j&&s.push({time:j,type:"horario_fin"})),y.length)y.forEach((a,N)=>{if(s.push({time:a.inicioStr,type:`descanso_inicio_${N}`}),a.finStr)s.push({time:a.finStr,type:`descanso_fin_${N}`});else{const _=c||h(a.inicioStr)+60,B=$(_);s.push({time:B,type:`descanso_fin_estimado_${N}`})}});else if(S&&s.push({time:S,type:"descanso_inicio"}),U&&s.push({time:U,type:"descanso_fin"}),S&&!U){const a=h(S),N=c||a+60,_=$(N);s.push({time:_,type:"descanso_fin_estimado"})}return s.forEach(a=>{const N=a.type==="fichaje_salida"||a.type==="horario_fin"||a.type==="descanso_fin",_=h(a.time,N);_!==null&&e.push({time:a.time,minutes:_,type:a.type})}),e.filter((a,N,_)=>_.findIndex(B=>B.minutes===a.minutes)===N).sort((a,N)=>a.minutes-N.minutes)},x=[];if(p!==null&&c!==null&&(!u&&!f?x.push({left:t(p),width:t(c)-t(p),color:"bg-blue-300",label:"Tiempo esperado de trabajo",startTime:g,endTime:j,zIndex:2}):x.push({left:t(p),width:t(c)-t(p),color:"bg-blue-100",label:"Horario planificado",startTime:g,endTime:j,zIndex:1})),u!==null&&f!==null){let e=u,s=b;if(y.forEach(r=>{if(r.inicioMin>e&&r.inicioMin<f&&x.push({left:t(e),width:t(r.inicioMin)-t(e),color:"bg-blue-500",label:"Tiempo trabajado",startTime:s,endTime:r.inicioStr,minutes:r.inicioMin-e,zIndex:3}),r.finMin!==null)x.push({left:t(r.inicioMin),width:t(r.finMin)-t(r.inicioMin),color:"bg-yellow-400",label:"Descanso",startTime:r.inicioStr,endTime:r.finStr,minutes:r.finMin-r.inicioMin,zIndex:2});else{const a=c||r.inicioMin+60;x.push({left:t(r.inicioMin),width:t(a)-t(r.inicioMin),color:"bg-yellow-400",label:"Descanso en curso",startTime:r.inicioStr,endTime:"en curso",zIndex:2})}r.finMin!==null?(e=r.finMin,s=r.finStr):(e=f,s=w)}),f>e&&x.push({left:t(e),width:t(f)-t(e),color:"bg-blue-500",label:"Tiempo trabajado",startTime:s,endTime:w,minutes:f-e,zIndex:3}),p!==null&&u>p+T){const r=u-p;x.push({left:t(p),width:t(u)-t(p),color:"bg-red-500",label:"Retraso",startTime:g,endTime:b,minutes:r,zIndex:4})}if(p!==null&&u<p-T){const r=p-u;x.push({left:t(u),width:t(p)-t(u),color:"bg-green-500",label:"Tiempo extra",startTime:b,endTime:g,minutes:r,zIndex:4})}if(c!==null&&f<c-T&&x.push({left:t(f),width:t(c)-t(f),color:"bg-gray-300",label:"No trabajado",startTime:w,endTime:j,minutes:c-f,zIndex:4}),c!==null&&f>c+T){const r=f-c;x.push({left:t(c),width:t(f)-t(c),color:"bg-green-500",label:"Tiempo extra",startTime:j,endTime:w,minutes:r,zIndex:4})}}else if(u!==null){const e=A||c;if(e&&u<e&&x.push({left:t(u),width:t(e)-t(u),color:"bg-blue-500",label:"Tiempo trabajado",startTime:b,endTime:e===A?S:j,minutes:e-u,zIndex:3}),p!==null&&u>p+T){const s=u-p;x.push({left:t(p),width:t(u)-t(p),color:"bg-red-500",label:"Retraso",startTime:g,endTime:b,minutes:s,zIndex:4})}if(p!==null&&u<p-T){const s=p-u;x.push({left:t(u),width:t(p)-t(u),color:"bg-green-500",label:"Tiempo extra",startTime:b,endTime:g,minutes:s,zIndex:3})}if(F!==null&&c!==null&&F<c&&x.push({left:t(F),width:t(c)-t(F),color:"bg-blue-200",label:"Tiempo esperado restante",startTime:U,endTime:j,minutes:c-F,zIndex:2}),y.length>0){let s=null,r=null;y.forEach((a,N)=>{if(s!==null&&a.inicioMin>s&&x.push({left:t(s),width:t(a.inicioMin)-t(s),color:"bg-blue-500",label:"Tiempo trabajado",startTime:r,endTime:a.inicioStr,minutes:a.inicioMin-s,zIndex:3}),a.finMin!==null)x.push({left:t(a.inicioMin),width:t(a.finMin)-t(a.inicioMin),color:"bg-yellow-400",label:"Descanso",startTime:a.inicioStr,endTime:a.finStr,minutes:a.finMin-a.inicioMin,zIndex:2}),s=a.finMin,r=a.finStr;else{const _=c||a.inicioMin+60;x.push({left:t(a.inicioMin),width:t(_)-t(a.inicioMin),color:"bg-yellow-400",label:"Descanso en curso",startTime:a.inicioStr,endTime:"en curso",zIndex:2}),s=null}})}}else if(f!==null&&(x.push({left:Math.max(0,t(f)-.5),width:1,color:"bg-blue-600",label:"Salida registrada",startTime:w,zIndex:4}),c!==null&&f<c-T&&x.push({left:t(f),width:t(c)-t(f),color:"bg-gray-300",label:"No trabajado",startTime:w,endTime:j,minutes:c-f,zIndex:3}),c!==null&&f>c+T)){const e=f-c;x.push({left:t(c),width:t(f)-t(c),color:"bg-green-500",label:"Tiempo extra",startTime:j,endTime:w,minutes:e,zIndex:3})}if(y.length===0&&A!==null&&(u&&f||u&&!f&&u<=A||!u&&!f&&p))if(F!==null){const s=F-A;x.push({left:t(A),width:t(F)-t(A),color:"bg-yellow-300",label:"Descanso planificado",startTime:S,endTime:U||"en curso",minutes:s,zIndex:3})}else{const s=c||A+60;x.push({left:t(A),width:t(s)-t(A),color:"bg-yellow-400",label:"Descanso en curso",startTime:S,endTime:"en curso",zIndex:3})}const X=Q();return i.jsx(ee,{children:i.jsxs("div",{className:"w-full md:w-[300px] lg:w-full md:overflow-x-auto",children:[n&&i.jsx("div",{className:"relative mb-2 h-4",children:X.map((e,s)=>i.jsxs(V,{delayDuration:H()?0:100,children:[i.jsx(W,{asChild:!0,children:i.jsx("div",{className:"absolute w-0.5 h-full bg-gray-400 cursor-pointer timeline-segment",style:{left:`${t(e.minutes)}%`}})}),i.jsx(q,{className:"z-[120]",children:m(e)})]},s))}),i.jsx("div",{className:"relative h-8 bg-gray-100 rounded-lg overflow-hidden border border-gray-200",children:x.map((e,s)=>i.jsxs(V,{delayDuration:H()?0:100,children:[i.jsx(W,{asChild:!0,children:i.jsx("div",{className:`absolute top-0 h-full ${e.color} transition-all duration-300 cursor-pointer timeline-segment`,style:{left:`${Math.max(0,e.left)}%`,width:`${Math.max(0,e.width)}%`,zIndex:e.zIndex}})}),i.jsx(q,{className:"z-[120]",children:o(e)})]},s))}),i.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-3 text-xs",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-sm"}),i.jsx("span",{className:"text-gray-600",children:"Retraso"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-sm"}),i.jsx("span",{className:"text-gray-600",children:"Tiempo de trabajo"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-sm"}),i.jsx("span",{className:"text-gray-600",children:"Descanso"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-sm"}),i.jsx("span",{className:"text-gray-600",children:"Tiempo extra"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-3 h-3 bg-gray-300 rounded-sm"}),i.jsx("span",{className:"text-gray-600",children:"No trabajado"})]})]})]})})};function He(b){const{selectedRange:w,hasActiveBreaks:g}=Z(),j=l=>{if(!l)return"---";const n=new Date(l),o=new Date,m=n.toDateString()===o.toDateString(),d=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],M=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],v=d[n.getDay()],z=n.getDate().toString().padStart(2,"0"),H=M[n.getMonth()];return{diaSemana:v,fechaCorta:`${z} ${H}`,esHoy:m}},S=(l,n,o,m,d,M,v)=>{if(!l||!n)return null;const H=(()=>{if(m&&d){const[$]=m.split(":").map(Number),[D]=d.split(":").map(Number);if($>D)return!0;if($<=2&&M){const[y]=M.split(":").map(Number);if(y>=20)return!0}if(D===0)return!0}return!1})(),T=H?(()=>{const[$]=(m||"00:00").split(":").map(Number),[D]=(d||"00:00").split(":").map(Number);return $>D||D===0?m:M||m})():null,k=$=>{if(!$)return null;const[D,y]=$.split(":").map(Number);let E=D*60+y;if(H&&T){const[L]=T.split(":").map(Number);if($===M&&m){const[J]=m.split(":").map(Number);if(D<J)return E}D<L&&(E+=24*60)}else if(!H&&m){const[L,J]=m.split(":").map(Number),t=L*60+J;E-t>12*60&&(E-=24*60)}return E},C=k(l),R=k(n),h=C-R;return o==="entrada"?h<=-15?"Entrada antes de tiempo":h>15?"Entrada retrasada":"Entrada a tiempo":o==="salida"?h<-15?"Salida antes de tiempo":h>=15?"Salida despues de tiempo":"Salida a tiempo":null},P=(l,n)=>{if(!l||!n)return null;const[o,m]=l.split(":").map(Number),[d,M]=n.split(":").map(Number);let v=o*60+m,z=d*60+M;z<v&&(z+=24*60);const H=z-v,T=Math.floor(H/60),k=H%60;return k===0?`${T} hora${T!==1?"s":""}`:`${T}h ${k}m`};return G.useMemo(()=>[I,{id:"fecha_inicio",title:"Fecha",enableHiding:!1,enableSorting:!0,enableFiltering:!0,header:()=>i.jsx("span",{className:"text-center",children:"Fecha"}),cell:({row:l})=>{var o;const n=j((o=l.original)==null?void 0:o.fecha_inicio);return n==="---"?i.jsx("span",{children:"---"}):i.jsxs("div",{className:`text-left font-medium ${n.esHoy?"text-orange-500":"text-custom-blackLight dark:text-custom-gray-default"}`,children:[i.jsxs("div",{className:"text-md",children:[n.diaSemana,","]}),i.jsx("div",{className:"text-lg",children:n.fechaCorta})]})},accessorFn:l=>{var n;return(n=l.original)==null?void 0:n.fecha_inicio}},{id:"turnos_fichados",title:"Turnos fichados",enableHiding:!1,enableSorting:!1,enableFiltering:!1,header:()=>i.jsx("span",{className:"text-center",children:"Turnos fichados"}),cell:({row:l})=>{const{fichajeEntrada:n,fichajeSalida:o,horarioInicio:m,horarioFin:d}=l.original,M=n?S(n,m,"entrada",m,d,n):null,v=o?S(o,d,"salida",m,d,n):null,z=(H,T,k)=>{var C,R,h;return i.jsxs("div",{className:"flex flex-col items-center gap-1 w-full",children:[i.jsx("span",{className:"text-xs text-gray-500 font-medium",children:k}),i.jsx("span",{className:`px-2 py-1 rounded-full text-sm font-medium border ${H?`${((C=O[T])==null?void 0:C.bg)||"bg-gray-100"} ${((R=O[T])==null?void 0:R.text)||"text-gray-500"} ${((h=O[T])==null?void 0:h.border)||"border-gray-300"}`:"bg-gray-100 text-gray-400 border-gray-300"}`,children:H||"--:--"})]})};return i.jsxs("div",{className:"flex items-center gap-3",children:[z(n,M,"Entrada"),z(o,v,"Salida")]})},accessorFn:l=>{var n,o;return`${((n=l.original)==null?void 0:n.fichajeEntrada)||""} ${((o=l.original)==null?void 0:o.fichajeSalida)||""}`}},{id:"justificante",title:"Justificante",enableHiding:!0,enableSorting:!1,enableFiltering:!1,header:()=>i.jsx("div",{className:"flex justify-left",children:i.jsx("span",{children:"Justificante"})}),cell:({row:l})=>{var o;const n=((o=l.original)==null?void 0:o.justificante)&&(l.original.justificante.id||l.original.justificante.file_name);return i.jsx("div",{className:"flex justify-left",children:n?i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-green-600 text-sm",children:"✓ Subido"}),i.jsx(K,{variant:"ghost",size:"sm",onClick:()=>{},className:"text-custom-orange hover:text-custom-blue dark:hover:text-custom-gray-default",children:"Ver"})]}):i.jsx(K,{variant:"ghost",size:"sm",onClick:()=>b==null?void 0:b(l.original),className:"flex items-center gap-1 text-custom-orange bg-custom-gray-default hover:bg-white text-sm font-medium",children:i.jsx("span",{children:"+ Añadir"})})})},accessorFn:l=>{var n;return((n=l.original)==null?void 0:n.justificante)||null}},{id:"muestra_horas",title:"Muestra de horas",enableHiding:!0,enableSorting:!1,enableFiltering:!1,header:()=>i.jsx("span",{className:"text-center",children:"Muestra de horas"}),cell:({row:l})=>{const{fichajeEntrada:n,fichajeSalida:o,horarioInicio:m,horarioFin:d,descansoInicio:M,descansoFin:v,descansos:z}=l.original;return!n&&!o?i.jsx("div",{className:"flex items-center justify-center",children:i.jsx("span",{className:"text-gray-500 text-sm italic",children:"No existen datos de fichaje"})}):i.jsx(te,{fichajeEntrada:n,fichajeSalida:o,horarioInicio:m,horarioFin:d,descansoInicio:M,descansoFin:v,descansos:z})},accessorFn:l=>{var n,o;return`${((n=l.original)==null?void 0:n.fichajeEntrada)||""}-${((o=l.original)==null?void 0:o.fichajeSalida)||""}`}},{id:"horario_asociado",title:"Horario asociado",enableHiding:!0,enableSorting:!1,enableFiltering:!1,header:()=>i.jsx("span",{className:"text-center",children:"Horario asociado"}),cell:({row:l})=>{var v;const{horarioInicio:n,horarioFin:o,turno:m}=l.original,d=P(n,o),M=((v=m==null?void 0:m.nombre)==null?void 0:v.replace(/\s*\(\d+\s*horas?\)$/i,""))||"---";return i.jsxs("div",{className:"text-sm md:w-[100px] lg:w-full",children:[i.jsx("div",{className:"font-medium",children:M}),i.jsx("div",{className:"text-gray-500 text-xs",children:n&&o?`${n} - ${o}`:"---"}),d&&i.jsx("div",{className:"text-gray-400 text-xs font-medium mt-1",children:d})]})},accessorFn:l=>{var n,o;return((o=(n=l.original)==null?void 0:n.turno)==null?void 0:o.nombre)||null}}],[w,g])}export{He as useColumns};
