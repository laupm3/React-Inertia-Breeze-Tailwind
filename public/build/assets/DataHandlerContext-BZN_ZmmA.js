import{r as e,j as B}from"./app-fwyInB3c.js";import{s as F,e as I,a as L}from"./endOfWeek-DoVA-Yvp.js";import{s as N}from"./startOfToday-Dakg9Kzc.js";import{a as T,f as y}from"./format-Be40hyfq.js";import"./toDate-qOSwr3PX.js";import"./constants-BKFt95HM.js";const k=e.createContext(null);function K(){const l=e.useContext(k);if(!l)throw new Error("useDataHandler debe usarse dentro de DataHandlerContextProvider");return l}const Q=({children:l})=>{const[c,C]=e.useState([]),[S,g]=e.useState([]),[u,x]=e.useState(!1),[i,a]=e.useState([]),[w,O]=e.useState([]),v=w.length==0,[M,D]=e.useState(!1),b=e.useCallback(async()=>{if(u){a(S),x(!1);return}let t=c;if(c.length===0)try{const o=await axios.get(route("api.v1.admin.empleados.index"));if(o.status===200)t=o.data.empleados,C(t);else{console.warn("No se pudieron cargar los empleados.");return}}catch(o){console.error("Error al cargar empleados:",o);return}const r=new Set(i.map(o=>o.empleado.id)),s=t.filter(o=>!r.has(o.id)).map(o=>({empleado:o,horarios:{}}));a([...i,...s]),x(!0)},[u,i,S,c]),[j,E]=e.useState(F(N())),A={from:T(new Date,{weekStartsOn:1}),to:I(new Date,{weekStartsOn:1})},[d,H]=e.useState(A),[P,m]=e.useState(!0),R=t=>{E(t),H({from:t,to:L(t)})},f=e.useCallback(t=>{const r=[...t];return Object.values(r.reduce((s,o)=>{const{empleado:n,horario_inicio:W}=o,h=y(W,"yyyy-MM-dd");return s[n.id]||(s[n.id]={...o,horarios:{}}),s[n.id].horarios[h]||(s[n.id].horarios[h]=[]),s[n.id].horarios[h].push(o),s},[]))},[]),p=e.useCallback(async()=>{m(!0);try{const t=await axios.get(route("api.v1.admin.horarios.index",{from:y(d.from,"yyyy-MM-dd"),to:y(d.to,"yyyy-MM-dd")}));if(t.status===200){const r=f(t.data.horarios);a(r),g(r)}else a([]),g([])}catch(t){console.error("error :>> ",t),a([])}finally{m(!1)}},[d,f,a,m]);return e.useEffect(()=>{p()},[p]),B.jsx(k.Provider,{value:{horarios:i,setHorarios:a,toggleShowAllEmployees:b,showingAllEmployees:u,monthSelected:j,setMonthSelected:E,manageMonthChange:R,selectedRange:d,setSelectedRange:H,activeSelection:v,blockSelection:M,setBlockSelection:D,transformSchedules:f,fetchHorarios:p,selectedShifts:w,setSelectedShifts:O,loading:P},children:l})};export{Q as DataHandlerContextProvider,K as useDataHandler};
