import{r as y,a as N,j as r,S as C}from"./app-fwyInB3c.js";import{A as O}from"./AuthenticatedLayout-B4CSARVj.js";import{toast as J}from"./index-WlsBA3k2.js";import{f as M}from"./format-Be40hyfq.js";import{e as P}from"./es-DNLwfvrq.js";import{b as U,s as A}from"./calendar-DctTJhwg.js";import B from"./EmpleadosStatus-BYanEyNy.js";import V from"./UsuariosActivos-B18HQ_5L.js";import W from"./EmpleadosDepartamento-BIoJykKD.js";import I from"./Fichajes-DimYIk8X.js";import K from"./Justificantes-Bsa9fcSK.js";import T from"./Vacaciones-psHcEeMH.js";import L from"./Permisos-DiKkTGWg.js";import"./Index-BT_dLDsX.js";import"./charts-D-b4h_4c.js";import $ from"./FinalizacionContratos-DL6tWQrh.js";import z from"./CaducidadDocumentos-CKK95KCX.js";import"./sidebar-CPh6C6LB.js";import"./index-DloWbRVd.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./button-Blwr-A5N.js";import"./input-CqlBlYgU.js";import"./separator-BWKairMX.js";import"./index-BIJodELy.js";import"./sheet-DHc5Hgr8.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-B7srb2QZ.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./skeleton-DSiYFg9q.js";import"./tooltip-DFfoxvAF.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./index-CeuhGnKJ.js";import"./LucideIcon-CEqEhMjI.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./dropdown-menu-bHoOJ61X.js";import"./index-C_F9oucK.js";import"./index-v24TFYKQ.js";import"./popover-DaRbHQOK.js";import"./avatar-oBOSifLN.js";import"./PopUpIncidencias-CaovAEi3.js";import"./card-DYkZYgg5.js";import"./Button-CQuYVLGu.js";import"./textarea-C969rVin.js";import"./useTranslation-BtIkv0Na.js";import"./UserAvatar-cKyxDEhx.js";import"./ApplicationLogo-C2FcO4AY.js";import"./Yoopta-Dj4Guze5.js";import"./throttle-CmSTFqON.js";import"./PrimaryButton-SsXyLm2e.js";import"./DecisionModal-Dl8siGBG.js";import"./alert-dialog-kDfn0La3.js";import"./useNotifications-CSWGH93r.js";import"./ShowNotificactionFromJestream-cKOlvVdg.js";import"./OnboardingModal-D0HRNKzO.js";import"./Modal-BkRna8gK.js";import"./transition-ByAjZSmr.js";import"./StepItem-bNLmZaq8.js";import"./StepProgress-DNpLodXf.js";import"./WelcomeContent-BPJ5E7_N.js";import"./onboardingImages-CoczwfNn.js";import"./AboutContent-DOlAXyok.js";import"./TeamContent-C0DysUYq.js";import"./constants-BKFt95HM.js";import"./toDate-qOSwr3PX.js";import"./endOfWeek-DoVA-Yvp.js";import"./addDays-B9Fzl-_R.js";import"./BlockCard-TCX704se.js";import"./Skeleton-D_T6UGa2.js";import"./IndividualSection-DbVoKiOC.js";import"./EmpleadosDialog-H7VsU60o.js";import"./dialog-iaZkf6Xy.js";import"./CreateUpdateView-B0HDK3PC.js";import"./DataHandlerContext-C9JjD-oX.js";import"./ViewContext-CG1DzGJu.js";import"./CreateUpdateDialog-1qQQjI_x.js";import"./types-BZmDMmQb.js";import"./useApiEndpoints-CHm1F3ft.js";import"./GoogleAddress-DWOptz48.js";import"./Map-D73hm0ip.js";import"./index.modern-WcJlzckG.js";import"./useDebounce-xNcQ83OW.js";import"./FetchSelect-CvqHmH4Y.js";import"./select-B5O0TxCl.js";import"./index-4A9uUPu1.js";import"./DatePicker-YJSItPq7.js";import"./Spinner-DPRe7Z_J.js";import"./DataTablePortal-KyffNF3Q.js";import"./DataTable-D4Fn3B2g.js";import"./table-cS0UKUSm.js";import"./DataTableContext-BYrqyX0i.js";import"./index-Z1g0u-qm.js";import"./TableFilters-ZojjKFl2.js";import"./GlobalFilter-DNA5td8x.js";import"./ImportExportDropdown-COI3HdRN.js";import"./index-C-xs73Vr.js";import"./index-DpIruHMc.js";import"./badge-BgloL8Ae.js";import"./scroll-area-CvQ1XCoU.js";import"./checkbox-BQT_ir1e.js";import"./index-BxSEkZvI.js";import"./TableDebugging-C1u6ii1k.js";import"./useColumns-CyFybzyH.js";import"./AdvancedHeader-CpvwMmYr.js";import"./command-PoUoScut.js";import"./parseISO-Efi0RkWR.js";import"./ColumnFilter-oxYUebdb.js";import"./multi-select-BSyp-qjs.js";import"./ContratosVigentesEmpleadoView-C9ICtsSk.js";import"./ContratosVigentesDialog-SpBmuJuH.js";import"./DataHandlerContext--vx6a3_3.js";import"./WeekDay-C1ZcXS4Y.js";import"./GetModalidadIcon-BUgIPR97.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./SheetTableView-DO6gGcRc.js";import"./SheetTable-CiCNZjvD.js";import"./SheetTable-oFCbTdfY.js";import"./tabs-DtCm3GAf.js";import"./SheetTableHeader-vhJO3F_n.js";import"./Pill-l4GaXyto.js";import"./StatusEmpleadoMapColor-Bp2doaTo.js";import"./Skeleton-SkfuXr9h.js";import"./RadialBarChart-BHNtPY1e.js";import"./PolarAngleAxis-CNFzyAg3.js";import"./Skeleton-Di5zxkGe.js";import"./PieChart-DDiBUCNq.js";import"./Skeleton-D9rrJm0a.js";import"./LineChart-_99a7T8V.js";import"./YAxis-DFODQxCl.js";import"./CartesianGrid-CvU5jLOC.js";import"./Skeleton-BUfQXc5b.js";import"./BarChart-CIV92-fD.js";import"./Skeleton-ml5SdsWy.js";import"./Skeleton-DShaLfET.js";import"./Skeleton-t7l8IODJ.js";import"./Skeleton-DsSwvb1R.js";const S={employeeStatuses:{url:route("api.v1.admin.dashboard.employee-statuses"),name:"employee-statuses"},activeUsers:{url:route("api.v1.admin.dashboard.active-users-count"),name:"active-users-count"},justificationsStats:{url:route("api.v1.admin.dashboard.justification-stats"),name:"justification-stats"},employeesByDepartment:{url:route("api.v1.admin.dashboard.employees-by-department-stats"),name:"employees-by-department-stats"},clockingsStats:{url:route("api.v1.admin.dashboard.clocking-stats"),name:"clocking-stats"},pendingVacations:{url:route("api.v1.admin.dashboard.pending-vacation-stats"),name:"pending-vacation-stats"},pendingPermissions:{url:route("api.v1.admin.dashboard.pending-permission-stats"),name:"pending-permission-stats"},expiringContracts:{url:route("api.v1.admin.dashboard.expiring-contracts-stats"),name:"expiring-contracts-stats"},expiringDocuments:{url:route("api.v1.admin.dashboard.expiring-documents-stats"),name:"expiring-documents-stats"},newEmployees:{url:route("api.v1.admin.dashboard.new-employees-stats"),name:"new-employees-stats"}},F=()=>{const[h,c]=y.useState({employeeStatuses:null,activeUsers:{connected_count:0,total_active:0},justificationsStats:{weekly_stats:[],older_pending_count:0,total_pending_count:0},employeesByDepartment:{stats:[]},clockingsStats:{summary:{},by_hour:{}},pendingVacations:{weekly_stats:[],older_pending_count:0,total_pending_count:0},pendingPermissions:{total_pending:0,older_pending_count:0,breakdown:[]}}),[u,x]=y.useState(""),[k,w]=y.useState(0);return y.useEffect(()=>{x(M(new Date,"EEEE, d 'de' MMMM 'de' yyyy",{locale:P})),Object.entries(S).forEach(([m,{url:_}])=>{N.get(_).then(e=>c(f=>({...f,[m]:e.data}))).catch(e=>console.error(`Error fetching ${m}:`,e))});const v=window.Echo.private("dashboard");return v.listen(".widget.updated",m=>{const{widgetName:_,widgetData:e}=typeof m=="string"?JSON.parse(m):m,f=Object.keys(S).find(g=>S[g].name===_);!f||!e.type||(J.info(`Actualización en vivo para: ${_}`),c(g=>{var j,b,D;const n={...g},p=e.type;if(p==="update"&&f==="employeeStatuses"){if(!n.employeeStatuses)return g;const t={...n.employeeStatuses};for(const s in t)(j=t[s])!=null&&j.employees&&(t[s].employees=t[s].employees.filter(o=>o.id!==e.employee_id),t[s].count=t[s].employees.length);const i=t[e.group];i&&(i.employees.push(e.status),i.count=i.employees.length),n.employeeStatuses=t}else if(p==="expiring_item_delta"){const t=e.widget_name==="expiring-contracts-stats"?"expiringContracts":"expiringDocuments",i=JSON.parse(JSON.stringify(n[t])),s="expiring_soon_list",o="expiring_in_days_counts";e.decrement&&i[o][e.decrement]--,e.increment&&i[o][e.increment]++;let a=i[s]?[...i[s]]:[];if(e.item_id_to_remove&&(a=a.filter(d=>d.id!==e.item_id_to_remove)),e.item_to_add&&a.push(e.item_to_add),e.item_to_update){const d=a.findIndex(l=>l.id===e.item_to_update.id);d!==-1?a[d]=e.item_to_update:a.push(e.item_to_update)}a.sort((d,l)=>(d.dias_restantes??9999)-(l.dias_restantes??9999)),i[s]=a.slice(0,5),n[t]=i}else if(p==="new_employee_add"||p==="new_employee_remove"){const t=JSON.parse(JSON.stringify(n.newEmployees)),i=p==="new_employee_add"?1:-1;t.new_employee_count=Math.max(0,t.new_employee_count+i);let s=t.new_employees_list?[...t.new_employees_list]:[];p==="new_employee_add"?s.unshift(e.details):s=s.filter(o=>o.id!==e.id),t.new_employees_list=s.slice(0,10),n.newEmployees=t}else if(p.startsWith("active_users_")){const t=((b=n.activeUsers)==null?void 0:b.total_active)??0;n.activeUsers.total_active=p==="active_users_increment"?t+1:Math.max(0,t-1)}else if(p==="vacation_delta"){const{date:t,change:i,total_pending_count:s}=e,o=JSON.parse(JSON.stringify(n.pendingVacations)),a=o.weekly_stats.find(d=>d.date===t);a?a.count=Math.max(0,a.count+i):i>0&&(o.weekly_stats.push({date:t,count:1}),o.weekly_stats.sort((d,l)=>new Date(d.date)-new Date(l.date))),s!==void 0&&(n.pendingVacations={...o,total_pending_count:s})}else if(p==="permission_delta"){const{permission_name:t,change:i,total_pending:s}=e,o=JSON.parse(JSON.stringify(n.pendingPermissions)),a=o.breakdown?[...o.breakdown]:[],d=a.find(l=>l.name===t);d?d.count=Math.max(0,d.count+i):i>0&&(a.push({name:t,count:1}),a.sort((l,E)=>l.name.localeCompare(E.name))),o.breakdown=a.filter(l=>l.count>0),s!==void 0&&(o.total_pending=s),n.pendingPermissions=o}else if(p.startsWith("justification_")){const t={...n.justificationsStats},i=p==="justification_add"?1:-1,s=U(new Date(e.date),A(new Date,7));if(t.total_pending_count=Math.max(0,t.total_pending_count+i),s){const o=t.weekly_stats.find(a=>a.date===e.date);o&&(o.count=Math.max(0,o.count+i))}else t.older_pending_count=Math.max(0,t.older_pending_count+i);n.justificationsStats=t}else if(p==="clocking_add"){const t=JSON.parse(JSON.stringify(n.clockingsStats));t.summary.clocked_in_count++;const i=e.hour.toString().padStart(2,"0");t.by_hour[i]&&(t.by_hour[i].total++,t.by_hour[i].devices[e.device]++),n.clockingsStats=t}else if(p==="department_delta"){const t=(D=n.employeesByDepartment)!=null&&D.stats?[...n.employeesByDepartment.stats]:[],{increment:i,decrement:s}=e;if(s){const o=t.find(a=>a.department_name===s);o&&(o.employee_count=Math.max(0,o.employee_count-1))}if(i){const o=t.find(a=>a.department_name===i);o?o.employee_count++:t.push({department_name:i,employee_count:1})}n.employeesByDepartment={stats:t}}return n}))}),window.Echo.join("presence-app").here(m=>w(m.length)).joining(()=>w(m=>m+1)).leaving(()=>w(m=>m-1)).error(m=>console.error("Error en el canal de presencia:",m)),()=>{v.stopListening(".widget.updated"),window.Echo.leave("presence-app")}},[]),{widgetsData:h,currentDate:u,connectedUsersCount:k}};function Bi({auth:h}){const{widgetsData:c,currentDate:u,connectedUsersCount:x}=F();return r.jsxs(O,{user:h.user,header:r.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Panel de Administración"}),children:[r.jsx(C,{title:"Panel de Administración"}),r.jsx("h2",{className:"text-xl sm:text-2xl mt-6 sm:mt-10 ml-4 sm:ml-10 font-bold text-custom-blackLight dark:text-custom-white",children:"Panel de Control"}),r.jsxs("div",{className:"w-full pt-8 pb-4 px-4 sm:px-6 xl:px-10 space-y-8",children:[r.jsx("section",{children:r.jsx(B,{data:c.employeeStatuses})}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6",children:[r.jsx(V,{data:{...c.activeUsers,connected_count:x},date:u}),r.jsx(W,{data:c.employeesByDepartment,date:u}),r.jsx(I,{data:c.clockingsStats,date:u}),r.jsx(K,{data:c.justificationsStats}),r.jsx(T,{data:c.pendingVacations}),r.jsx(L,{data:c.pendingPermissions,date:u})]}),r.jsxs("div",{className:"flex flex-col 2xl:flex-row gap-6",children:[r.jsx($,{data:c.expiringContracts,date:u}),r.jsx(z,{data:c.expiringDocuments,date:u})]})]})]})}export{Bi as default};
