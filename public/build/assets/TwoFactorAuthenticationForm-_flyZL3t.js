import{r,j as e,a as p,X as E,G as R,A as k}from"./app-fwyInB3c.js";import{D as _}from"./DialogModal-BHNZflaY.js";import{I as S}from"./InputError-CrNaC_eR.js";import{I as D}from"./input-CqlBlYgU.js";import{B as n}from"./Button-CQuYVLGu.js";import{I as K}from"./InputLabel-DwHTKIkK.js";import{T as M}from"./TextInput-CZi-2d99.js";import"./Modal-BkRna8gK.js";import"./transition-ByAjZSmr.js";import"./utils-CytzSlOG.js";import"./index-DloWbRVd.js";import"./index-BwobEAja.js";function u({title:y="Confirmar contraseña",content:x="Por tu seguridad, por favor confirma tu contraseña para continuar.",children:i,onConfirmed:f}){const[l,g]=r.useState(!1),[t,o]=r.useState({password:"",error:"",processing:!1}),d=r.useRef(null),j=()=>{p.get(route("password.confirmation")).then(a=>{a.data.confirmed?f():(g(!0),setTimeout(()=>d.current.focus(),250))})},c=()=>{o({...t,processing:!0}),p.post(route("password.confirm"),{password:t.password}).then(()=>{o({...t,processing:!1}),h(),f()}).catch(a=>{o({...t,processing:!1,error:a.response.data.errors.password[0]}),d.current.focus()})},h=()=>{g(!1),o({password:"",error:"",processing:!1})};return e.jsxs("span",{children:[e.jsx("span",{onClick:j,children:i}),e.jsxs(_,{show:l,onClose:h,title:y,footer:e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"secondary",onClick:h,className:"mr-2",children:"Cancel"}),e.jsx(n,{variant:"primary",onClick:c,processing:t.processing?"true":"false",children:"Confirm"})]}),children:[x,e.jsxs("div",{className:"mt-4",children:[e.jsx(D,{ref:d,value:t.password,onChange:a=>o({...t,password:a.target.value}),type:"password",placeholder:"Password",autoComplete:"current-password",onKeyUp:a=>a.key==="Enter"&&c(),className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi"}),e.jsx(S,{message:t.error,className:"mt-2"})]})]})]})}function J({requiresConfirmation:y}){const x=E().props.auth.user,[i,f]=r.useState(!1),[l,g]=r.useState(!1),[t,o]=r.useState(null),[d,j]=r.useState(null),[c,h]=r.useState([]),[a,b]=r.useState(!1),w=R({code:""}),m=!i&&(x==null?void 0:x.two_factor_enabled);r.useEffect(()=>{m||w.reset()},[m]);const F=()=>{f(!0),k.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>Promise.all([T(),P(),v()]),onFinish:()=>{f(!1),b(y)}})},T=async()=>{const s=await p.get(route("two-factor.qr-code"));o(s.data.svg)},P=async()=>{const s=await p.get(route("two-factor.secret-key"));j(s.data.secretKey)},v=async()=>{const s=await p.get(route("two-factor.recovery-codes"));h(s.data)},C=()=>{w.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{b(!1),o(null),j(null)}})},I=()=>{p.post(route("two-factor.recovery-codes")).then(()=>v())},N=()=>{g(!0),k.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{g(!1),b(!1)}})},A=m&&!a?"Has habilitado la autenticación de dos factores.":m&&a?"Termina de habilitar la autenticación de dos factores.":"No has habilitado la autenticación de dos factores.";return e.jsx("div",{className:"md:max-h-[800px] md:overflow-y-auto md:pr-2 md:[scrollbar-width:thin] md:[scrollbar-color:rgba(156,163,175,0.3)_transparent] md:[&::-webkit-scrollbar]:w-[6px] md:[&::-webkit-scrollbar-track]:bg-transparent md:[&::-webkit-scrollbar-thumb]:bg-[rgba(156,163,175,0.3)] md:[&::-webkit-scrollbar-thumb]:rounded-[20px]",children:e.jsx("div",{children:e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-lg font-bold text-custom-blue dark:text-white",children:"Verificación en Dos Pasos"}),e.jsx("div",{className:" max-w-xl text-sm text-gray-600 dark:text-gray-400",children:e.jsx("p",{children:"Agrega seguridad adicional a tu cuenta usando la autenticación de dos factores."})}),m&&e.jsxs(e.Fragment,{children:[t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400",children:a?e.jsx("p",{className:"font-semibold",children:"Para finalizar la activación de la autenticación de dos factores, escanea el siguiente código QR usando tu teléfono o aplicación de autenticación, o ingresa la clave de configuración y proporciona el código OTP generado."}):e.jsx("p",{children:"Escanea este código QR con tu aplicación de autenticación."})}),e.jsx("div",{className:"mt-4 p-2 inline-block bg-white",dangerouslySetInnerHTML:{__html:t}}),d&&e.jsx("div",{className:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400",children:e.jsxs("p",{className:"font-semibold",children:["Clave de configuración: ",e.jsx("span",{dangerouslySetInnerHTML:{__html:d}})]})}),a&&e.jsxs("div",{className:"mt-4",children:[e.jsx(K,{htmlFor:"code",value:"Código"}),e.jsx(M,{id:"code",value:w.code,onChange:s=>w.setData("code",s.target.value),type:"text",name:"code",className:"block mt-1 w-1/2",inputMode:"numeric",autoFocus:!0,autoComplete:"one-time-code",onKeyUp:s=>s.key==="Enter"&&C()}),e.jsx(S,{message:w.errors.code,className:"mt-2"})]})]}),c.length>0&&!a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 max-w-xl text-sm text-gray-600 dark:text-gray-400",children:e.jsx("p",{className:"font-semibold",children:"Códigos de Recuperación"})}),e.jsx("div",{className:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 dark:bg-gray-900 dark:text-gray-100 rounded-lg",children:c.map(s=>e.jsx("div",{children:s},s))})]})]}),e.jsx("div",{className:"mt-5",children:m?e.jsxs(e.Fragment,{children:[a&&e.jsx(u,{onConfirmed:C,children:e.jsx(n,{variant:"primary",className:`me-3 ${i?"opacity-25":""}`,disabled:i,children:"Confirmar"})}),e.jsx(u,{onConfirmed:I,children:c.length===0&&!a&&e.jsx(n,{variant:"secondary",className:"me-3",children:"Regenerar"})}),e.jsx(u,{onConfirmed:v,children:c.length===0&&!a&&e.jsx(n,{variant:"secondary",className:"me-3",children:"Mostrar Códigos"})}),e.jsx(u,{onConfirmed:N,children:a&&e.jsx(n,{variant:"secondary",disabled:l,className:l?"opacity-25":"",children:"Cancelar"})}),e.jsx(u,{onConfirmed:N,children:!a&&e.jsx("div",{className:"py-4",children:e.jsx(n,{variant:"destructive",className:`${l?"opacity-25":""}`,disabled:l,children:"Deshabilitar"})})})]}):e.jsx(u,{onConfirmed:F,children:e.jsx(n,{variant:"primary",className:"w-fit px-6",disabled:i,children:"Habilitar"})})}),e.jsxs("h3",{className:"text-xs font-medium mt-6 text-custom-gray-dark",children:["(",A,")"]})]})})})}export{J as default};
