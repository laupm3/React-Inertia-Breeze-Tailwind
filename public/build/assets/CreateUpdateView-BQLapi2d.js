import{r as h,a as ee,R as T,j as b,G as _e}from"./app-fwyInB3c.js";import{useDataHandler as de}from"./DataHandlerContext-B_AogXyY.js";import{b as Fe,c as ge,d as be,e as Se,f as xe,D as De}from"./dialog-iaZkf6Xy.js";import{B as we}from"./button-Blwr-A5N.js";import{L as ye}from"./label-zCtqi3J5.js";import{A as Ee}from"./AdvanceDropdown-CXptW6sy.js";import{f as Z}from"./dateUtils-B_14HGRQ.js";import{o as ve,a as Ce,e as ae,c as Ie,s as X,f as ce,i as Te,Z as G}from"./types-BZmDMmQb.js";import{toast as O}from"./index-WlsBA3k2.js";import{PermisoSelectionSection as Ae,DateTimeSection as Ve,AdditionalDetailsSection as je}from"./FormSections-BOaE6Vup.js";import{FileUploadSection as ke}from"./FileUploadSection-CYpiNal_.js";import"./ViewContext-CnIG9GpY.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-DloWbRVd.js";import"./index-B7srb2QZ.js";import"./index-BIJodELy.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./utils-CytzSlOG.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./index-BwobEAja.js";import"./AdvanceDropdown-qoEi4BOz.js";import"./Create-tmHr2JLD.js";import"./AuthenticatedLayout-B4CSARVj.js";import"./sidebar-CPh6C6LB.js";import"./input-CqlBlYgU.js";import"./separator-BWKairMX.js";import"./sheet-DHc5Hgr8.js";import"./skeleton-DSiYFg9q.js";import"./tooltip-DFfoxvAF.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./index-CeuhGnKJ.js";import"./LucideIcon-CEqEhMjI.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./dropdown-menu-bHoOJ61X.js";import"./index-C_F9oucK.js";import"./index-v24TFYKQ.js";import"./popover-DaRbHQOK.js";import"./avatar-oBOSifLN.js";import"./PopUpIncidencias-CaovAEi3.js";import"./card-DYkZYgg5.js";import"./Button-CQuYVLGu.js";import"./textarea-C969rVin.js";import"./useTranslation-BtIkv0Na.js";import"./UserAvatar-cKyxDEhx.js";import"./ApplicationLogo-C2FcO4AY.js";import"./Yoopta-Dj4Guze5.js";import"./throttle-CmSTFqON.js";import"./PrimaryButton-SsXyLm2e.js";import"./DecisionModal-Dl8siGBG.js";import"./alert-dialog-kDfn0La3.js";import"./useNotifications-CSWGH93r.js";import"./ShowNotificactionFromJestream-cKOlvVdg.js";import"./OnboardingModal-D0HRNKzO.js";import"./Modal-BkRna8gK.js";import"./transition-ByAjZSmr.js";import"./StepItem-bNLmZaq8.js";import"./StepProgress-DNpLodXf.js";import"./WelcomeContent-BPJ5E7_N.js";import"./onboardingImages-CoczwfNn.js";import"./AboutContent-DOlAXyok.js";import"./TeamContent-C0DysUYq.js";import"./CreateLanguageForm-xwtvYsjX.js";import"./checkbox-BQT_ir1e.js";import"./index-BxSEkZvI.js";import"./index-4A9uUPu1.js";import"./alert-D9izbOQG.js";import"./InputSkeleton-CFMfUb-2.js";import"./table-cS0UKUSm.js";import"./GlobalFilter-DNA5td8x.js";import"./DataTableContext-BYrqyX0i.js";import"./index-Z1g0u-qm.js";import"./TableDebugging-C1u6ii1k.js";import"./AdvancedHeader-CpvwMmYr.js";import"./command-PoUoScut.js";import"./badge-BgloL8Ae.js";import"./select-B5O0TxCl.js";import"./DatePicker-YJSItPq7.js";import"./calendar-DctTJhwg.js";import"./endOfWeek-DoVA-Yvp.js";import"./toDate-qOSwr3PX.js";import"./format-Be40hyfq.js";import"./constants-BKFt95HM.js";import"./addDays-B9Fzl-_R.js";import"./parseISO-Efi0RkWR.js";import"./RowActionsColumn-CM2slffX.js";import"./RowActionsTrigger-DnJzXomR.js";import"./EmpleadoAvatar-BBWI_HPN.js";import"./ColumnFilter-oxYUebdb.js";import"./multi-select-BSyp-qjs.js";import"./Pill-l4GaXyto.js";import"./StatusEmpleadoMapColor-Bp2doaTo.js";import"./RowActionsColumn-C3VJw1Sg.js";import"./RowActionsTrigger-C2PXJFNn.js";import"./RowCheckedColumn-BShQ1j9z.js";import"./CreateUpdateDialog-1qQQjI_x.js";import"./useApiEndpoints-CHm1F3ft.js";import"./GoogleAddress-DWOptz48.js";import"./Map-D73hm0ip.js";import"./index.modern-WcJlzckG.js";import"./useDebounce-xNcQ83OW.js";import"./FetchSelect-CvqHmH4Y.js";import"./Spinner-DPRe7Z_J.js";import"./SheetTable-CiCNZjvD.js";import"./SheetTable-oFCbTdfY.js";import"./tabs-DtCm3GAf.js";import"./SheetTableHeader-vhJO3F_n.js";import"./ContratosVigentesDialog-SpBmuJuH.js";import"./DataHandlerContext--vx6a3_3.js";import"./WeekDay-C1ZcXS4Y.js";import"./GetModalidadIcon-BUgIPR97.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./es-DNLwfvrq.js";import"./PermisoAdvanceDropdown-CMmjCTaL.js";import"./StatusTipoPermisoMapColor-uADlCWR0.js";import"./PermisoStatsInline-Bx30kg1z.js";import"./charts-D-b4h_4c.js";import"./index-DpIruHMc.js";import"./PieChart-DDiBUCNq.js";import"./PolarAngleAxis-CNFzyAg3.js";import"./FileUploadArea-uzmkw7Uv.js";const ne={empleado_id:null,permiso_id:null,fecha_inicio:Z(new Date),fecha_fin:Z(new Date),hora_inicio:"",hora_fin:"",motivo:"",dia_completo:!1,files:[],recuperable:!1,estado_id:1},Re=ve({empleado_id:ce.number({invalid_type_error:"Debe seleccionar un empleado.",required_error:"Debe seleccionar un empleado."}).int("ID de empleado debe ser un entero.").positive("Debe seleccionar un empleado.").nullable().refine(e=>e!==null,"Debe seleccionar un empleado."),permiso_id:ce.number({invalid_type_error:"Debe seleccionar un tipo de permiso.",required_error:"Debe seleccionar un tipo de permiso."}).int("ID de permiso debe ser un entero.").positive("Debe seleccionar un tipo de permiso.").nullable().refine(e=>e!==null,"Debe seleccionar un tipo de permiso."),fecha_inicio:X().min(1,"La fecha de inicio es requerida.").regex(/^\d{4}-\d{2}-\d{2}$/,"Formato de fecha de inicio inv√°lido (YYYY-MM-DD)."),fecha_fin:X().min(1,"La fecha de fin es requerida.").regex(/^\d{4}-\d{2}-\d{2}$/,"Formato de fecha de fin inv√°lido (YYYY-MM-DD)."),hora_inicio:X().optional(),hora_fin:X().optional(),motivo:X().min(1,"El motivo es requerido.").max(1e3,"El motivo no puede exceder los 1000 caracteres."),dia_completo:ae(),files:Ie(Te(File)).optional().default([]),recuperable:ae(),estado_id:Ce().int().positive("El estado es inv√°lido.")}).superRefine((e,p)=>{if(e.fecha_inicio===e.fecha_fin&&!e.dia_completo&&(e.hora_inicio?/^([01]\d|2[0-3]):([0-5]\d)$/.test(e.hora_inicio)||p.addIssue({code:G.custom,path:["hora_inicio"],message:"Formato de hora de inicio inv√°lido (HH:MM)."}):p.addIssue({code:G.custom,path:["hora_inicio"],message:"La hora de inicio es requerida si no es d√≠a completo."}),e.hora_fin?/^([01]\d|2[0-3]):([0-5]\d)$/.test(e.hora_fin)||p.addIssue({code:G.custom,path:["hora_fin"],message:"Formato de hora de fin inv√°lido (HH:MM)."}):p.addIssue({code:G.custom,path:["hora_fin"],message:"La hora de fin es requerida si no es d√≠a completo."}),e.hora_inicio&&e.hora_fin&&/^([01]\d|2[0-3]):([0-5]\d)$/.test(e.hora_inicio)&&/^([01]\d|2[0-3]):([0-5]\d)$/.test(e.hora_fin)&&e.hora_fin<=e.hora_inicio&&p.addIssue({code:G.custom,path:["hora_fin"],message:"La hora de fin debe ser posterior a la hora de inicio."})),e.fecha_inicio&&e.fecha_fin){const u=/^\d{4}-\d{2}-\d{2}$/.test(e.fecha_inicio),n=/^\d{4}-\d{2}-\d{2}$/.test(e.fecha_fin);if(u&&n){const x=new Date(e.fecha_inicio+"T00:00:00");new Date(e.fecha_fin+"T00:00:00")<x&&p.addIssue({code:G.custom,path:["fecha_fin"],message:"La fecha de fin no puede ser anterior a la fecha de inicio."})}}}),le={START:"09:00",END:"17:00"},ie={START:["00:00","02:00"],END:["23:59","01:59"]},Ne=(e=null,p=!1)=>{const[o,u]=h.useState(ne),[n,x]=h.useState(void 0),[S,C]=h.useState(null),[D,a]=h.useState({}),[f,l]=h.useState({hora_inicio:"",hora_fin:""}),[t,F]=h.useState(!1),d=!!e,c=(S==null?void 0:S.duracion)||null,s=c?Math.floor(c/(1e3*60*60*24)):null,r=o.fecha_inicio&&o.fecha_fin&&o.fecha_inicio===o.fecha_fin,g=o.fecha_inicio&&o.fecha_fin&&o.fecha_inicio!==o.fecha_fin,w=r&&!g,y=w&&!o.dia_completo,V=i=>{let m="",_="",E=!!i.dia_completo;return i.fecha_inicio&&(m=new Date(i.fecha_inicio).toTimeString().slice(0,5)),i.fecha_fin&&(_=new Date(i.fecha_fin).toTimeString().slice(0,5)),ie.START.includes(m)&&ie.END.includes(_)&&(E=!0),{horaInicio:m,horaFin:_,esDiaCompleto:E}},R=()=>{u(ne),x(void 0),C(null),a({}),l({hora_inicio:"",hora_fin:""}),F(!1)},K=i=>{var $,M;if(!i||!i.id){console.error("üîç [usePermisoForm] Invalid permiso data for edit:",i);return}F(!0);const{horaInicio:m,horaFin:_,esDiaCompleto:E}=V(i);l({hora_inicio:m,hora_fin:_});const H={empleado_id:(($=i.empleado)==null?void 0:$.id)||i.empleado_id||null,permiso_id:((M=i.permiso)==null?void 0:M.id)||null,fecha_inicio:i.fecha_inicio?Z(new Date(i.fecha_inicio)):"",fecha_fin:i.fecha_fin?Z(new Date(i.fecha_fin)):"",hora_inicio:E?"":m,hora_fin:E?"":_,motivo:i.motivo||"",dia_completo:E,recuperable:!!i.recuperable,estado_id:i.estado_id||ne.estado_id,files:[]};if(u(H),i.fecha_inicio&&i.fecha_fin){const A={from:new Date(i.fecha_inicio),to:new Date(i.fecha_fin)};x(A)}i.permiso&&C(i.permiso),setTimeout(()=>{F(!1)},100)},P=i=>{if(i){const m={hora_inicio:o.hora_inicio||f.hora_inicio,hora_fin:o.hora_fin||f.hora_fin};l(m),u(_=>({..._,dia_completo:!0,hora_inicio:"",hora_fin:""}))}else{let m=f.hora_inicio,_=f.hora_fin;(!m||ie.START.includes(m))&&(m=le.START),(!_||ie.END.includes(_))&&(_=le.END),u(E=>({...E,dia_completo:!1,hora_inicio:m,hora_fin:_})),l({hora_inicio:m,hora_fin:_})}},W=(i,m)=>{i==="dia_completo"?P(m):J(i,m),D[i]&&a(_=>{const E={..._};return delete E[i],E})},J=(i,m)=>{if(i==="files"){const _=Array.isArray(m)?m:m?[m]:[];u(E=>({...E,[i]:_}))}else u(_=>({..._,[i]:m}));(i==="hora_inicio"||i==="hora_fin")&&!o.dia_completo&&!t&&l(_=>({..._,[i]:m}))},N=i=>{(S==null?void 0:S.id)!==(i==null?void 0:i.id)&&(C(i),x(void 0),l({hora_inicio:"",hora_fin:""}),u(m=>({...m,permiso_id:(i==null?void 0:i.id)||null,fecha_inicio:"",fecha_fin:"",dia_completo:!1,hora_inicio:"",hora_fin:""})))},L=i=>{x(i)},z=()=>{const i=Re.safeParse(o);if(!i.success){const m=i.error.flatten().fieldErrors,_={};return Object.entries(m).forEach(([E,H])=>{_[E]=H[0]}),a(_),null}return a({}),i.data};return h.useEffect(()=>{if(!t&&(n!=null&&n.from)&&(n!=null&&n.to)){const i=Z(n.from),m=Z(n.to);(o.fecha_inicio!==i||o.fecha_fin!==m)&&u(_=>({..._,fecha_inicio:i,fecha_fin:m}))}},[n==null?void 0:n.from,n==null?void 0:n.to,t]),h.useEffect(()=>{t||g&&(!o.dia_completo||o.hora_inicio||o.hora_fin)&&u(i=>({...i,dia_completo:!0,hora_inicio:"",hora_fin:""}))},[g,o.dia_completo,o.hora_inicio,o.hora_fin,t]),{formData:o,dateRange:n,selectedPermiso:S,errors:D,isInitializing:t,isEditing:d,maxDurationMs:c,maxDurationDays:s,isSingleDay:r,shouldForceFullDay:g,canShowCheckbox:w,canShowTimeFields:y,resetForm:R,initializeFormForEdit:K,handleInputChange:W,handlePermisoSelect:N,handleDateRangeChange:L,validateForm:z,setErrors:a,setFormData:u}};function Me(){const[e,p]=h.useState(null),[o,u]=h.useState(!1),[n,x]=h.useState(!1),S=async(t,F)=>{var d,c;x(!0);try{const s=`/api/v1/admin/solicitudes/${t}/folder/${F}`;if((await ee.delete(s)).status===200)return O.success("Archivo eliminado correctamente"),!0}catch(s){console.error("Error al eliminar archivo:",s);const r=((c=(d=s.response)==null?void 0:d.data)==null?void 0:c.message)||"Error al eliminar el archivo";return O.error(r),!1}finally{x(!1),u(!1),p(null)}};return{fileToDelete:e,showDeleteFileDialog:o,isDeletingFile:n,initiateFileDelete:(t,F,d=null)=>{p({permisoId:t,file:F,onSuccess:d}),u(!0)},confirmDeleteFile:async()=>{if(!e)return;await S(e.permisoId,e.file.hash)&&e.onSuccess&&e.onSuccess(e.file)},cancelFileDelete:()=>{u(!1),p(null)},addFilesToForm:(t,F,d)=>{const s=(Array.isArray(t)?t:Array.from(t)).filter(r=>!F.some(w=>w.name===r.name&&w.size===r.size&&w.lastModified===r.lastModified));s.length>0&&d(r=>{const g=[...r.files||[],...s];return{...r,files:g}})},removeFileFromForm:(t,F)=>{F(d=>{const c=d.files.filter((s,r)=>r!==t);return{...d,files:c}})},executeFileDelete:S}}function Le(e,p){const[o,u]=h.useState(new Set),[n,x]=h.useState(!1),S=h.useRef(null);h.useEffect(()=>{S.current||(S.current={permiso_id:e.permiso_id,fecha_inicio:e.fecha_inicio,fecha_fin:e.fecha_fin,hora_inicio:e.hora_inicio,hora_fin:e.hora_fin,motivo:e.motivo,dia_completo:e.dia_completo})},[]),h.useEffect(()=>{if(!S.current)return;const r=S.current;(e.permiso_id!==r.permiso_id||e.fecha_inicio!==r.fecha_inicio||e.fecha_fin!==r.fecha_fin||e.hora_inicio!==r.hora_inicio||e.hora_fin!==r.hora_fin||e.motivo!==r.motivo||e.dia_completo!==r.dia_completo)&&x(!0)},[e]);const C=h.useCallback(r=>{u(g=>new Set([...g,r])),x(!0)},[]),D=()=>{u(new Set(["empleado_id","permiso_id","fecha","motivo","hora_inicio","hora_fin"])),x(!0)},a=(r=[])=>{u(g=>{const w=new Set(g);return r.forEach(y=>w.delete(y)),w})},f=()=>{u(new Set),x(!1)};h.useEffect(()=>{var g,w;!e.permiso_id&&!e.motivo&&!e.hora_inicio&&!e.hora_fin&&e.fecha_inicio===((g=S.current)==null?void 0:g.fecha_inicio)&&e.fecha_fin===((w=S.current)==null?void 0:w.fecha_fin)&&(u(new Set),x(!1),S.current=null)},[e]);const l=h.useMemo(()=>!(!["permiso_id","fecha_inicio","fecha_fin","motivo"].every(w=>{const y=e[w];return w==="permiso_id"?y!=null&&y!==""&&y>0:y!=null&&y!==""})||!e.dia_completo&&(!e.hora_inicio||!e.hora_fin||e.hora_inicio>=e.hora_fin)),[e]),t=h.useMemo(()=>{if(!e.fecha_inicio||!e.fecha_fin||!(p!=null&&p.duracion))return{isValid:!0,message:""};const r=new Date(e.fecha_inicio),g=new Date(e.fecha_fin),w=Math.abs(g-r),y=Math.ceil(w/(1e3*60*60*24))+1,V=p.duracion,R=Math.floor(V/(1e3*60*60*24));return y>R?{isValid:!1,message:`La duraci√≥n m√°xima permitida es de ${R} d√≠a(s)`}:{isValid:!0,message:""}},[e.fecha_inicio,e.fecha_fin,p]),F=h.useMemo(()=>{if(!e.fecha_inicio||!e.fecha_fin)return{isValid:!0,message:""};const r=new Date(e.fecha_inicio),g=new Date(e.fecha_fin);return new Date().setHours(0,0,0,0),r.setHours(0,0,0,0),g.setHours(0,0,0,0),r>g?{isValid:!1,message:"La fecha de inicio no puede ser posterior a la fecha de fin"}:{isValid:!0,message:""}},[e.fecha_inicio,e.fecha_fin]),d=h.useMemo(()=>e.dia_completo?{isValid:!0,message:""}:!e.hora_inicio||!e.hora_fin?{isValid:!1,message:"Las horas de inicio y fin son requeridas"}:e.hora_inicio>=e.hora_fin?{isValid:!1,message:"La hora de inicio debe ser anterior a la hora de fin"}:{isValid:!0,message:""},[e.dia_completo,e.hora_inicio,e.hora_fin]),c=h.useMemo(()=>{if(!n)return[];const r=[];return(!e.empleado_id||e.empleado_id<=0)&&r.push("Debe seleccionar un empleado"),(!e.permiso_id||e.permiso_id<=0)&&r.push("Debe seleccionar un tipo de permiso"),(!e.motivo||e.motivo.trim()==="")&&r.push("El motivo es requerido"),!F.isValid&&(o.has("fecha")||n)&&r.push(F.message),!d.isValid&&(o.has("hora_inicio")||o.has("hora_fin")||n&&!e.dia_completo)&&r.push(d.message),console.log("‚úÖ useFormValidation - Errores generados:",{errorsCount:r.length,errors:r}),r},[F,d,t,n,o,e.dia_completo,e.fecha_inicio,e.fecha_fin,e.empleado_id,e.permiso_id,e.motivo]),s=c.length>0;return{isFormValid:l,hasValidationErrors:s,validationErrors:c,dateValidation:F,timeValidation:d,durationValidation:t,hasUserInitiatedAction:n,touchedFields:o,markFieldAsTouched:C,markAllFieldsAsTouched:D,clearTouchedFields:a,resetUserInteraction:f}}function ze(){const[e,p]=h.useState(!1),o=D=>{const f=["empleado_id","permiso_id","fecha_inicio","fecha_fin","motivo"].filter(F=>{const d=D[F];return!d||typeof d=="string"&&d.trim()===""});if(f.length>0)throw new Error(`Campos requeridos faltantes: ${f.join(", ")}`);const l=new FormData,t={};return Object.entries(D).forEach(([F,d])=>{if(F==="files")Array.isArray(d)&&d.length>0&&d.forEach(c=>l.append("files[]",c));else if(typeof d=="boolean"){const c=d?"1":"0";l.append(F,c)}else if(d!=null){const c=d||"";l.append(F,c)}}),{requestData:l,headers:t}},u=async(D,a,f,l)=>l?a instanceof FormData?(a.append("_method","PUT"),await ee.post(D,a,{headers:f})):await ee.put(D,a,{headers:f}):await ee.post(D,a,{headers:f}),n=async D=>{const{requestData:a,headers:f}=o(D);return await u("/api/v1/admin/solicitudes",a,f,!1)},x=async(D,a)=>{const{requestData:f,headers:l}=o(D),t=`/api/v1/admin/solicitudes/${a}`;return await u(t,f,l,!0)};return{isSubmitting:e,createPermiso:n,updatePermiso:x,handleSubmit:async(D,a,f,l=null)=>{var t,F,d,c;p(!0);try{let s;if(a&&f?(s=await x(D,f),O.success("¬°Permiso actualizado!",{description:"Los cambios en la solicitud de permiso han sido guardados correctamente.",duration:5e3})):(s=await n(D),O.success("¬°Permiso creado!",{description:"La nueva solicitud de permiso ha sido creada correctamente."})),l&&typeof l=="function")try{l(s)}catch{}return s}catch(s){if((F=(t=s.response)==null?void 0:t.data)!=null&&F.errors){const r=Object.values(s.response.data.errors).flat();O.error("Errores de validaci√≥n",{description:r.join(", "),duration:8e3})}else{const r=((c=(d=s.response)==null?void 0:d.data)==null?void 0:c.message)||(a?"Error al actualizar el permiso":"Error al crear el permiso");O.error("Error",{description:r,duration:5e3})}throw s}finally{p(!1)}},getSolicitudDetails:async D=>{var a,f;try{const l=`/api/v1/admin/solicitudes/${D}`,t=await ee.get(l);if(t.data&&t.data.solicitud)return t.data.solicitud;throw new Error("No se pudieron obtener los detalles de la solicitud")}catch(l){console.error("Error al obtener detalles de la solicitud:",l);const t=((f=(a=l.response)==null?void 0:a.data)==null?void 0:f.message)||"Error al cargar los detalles de la solicitud";throw O.error(t),l}}}}function He(e=null){const[p,o]=h.useState(e),[u,n]=h.useState(!1);h.useEffect(()=>{o(e)},[e==null?void 0:e.id]);const{formData:x,dateRange:S,selectedPermiso:C,errors:D,isInitializing:a,isEditing:f,maxDurationMs:l,maxDurationDays:t,isSingleDay:F,shouldForceFullDay:d,canShowCheckbox:c,canShowTimeFields:s,resetForm:r,initializeFormForEdit:g,handleInputChange:w,handlePermisoSelect:y,handleDateRangeChange:V,validateForm:R,setErrors:K,setFormData:P}=Ne(e),{fileToDelete:W,showDeleteFileDialog:J,isDeletingFile:N,initiateFileDelete:L,confirmDeleteFile:z,cancelFileDelete:i}=Me(),{isFormValid:m,hasValidationErrors:_,validationErrors:E,dateValidation:H,timeValidation:$,durationValidation:M,hasUserInitiatedAction:A,touchedFields:Y,markFieldAsTouched:Q,markAllFieldsAsTouched:B,clearTouchedFields:oe,resetUserInteraction:re}=Le(x,C),{isSubmitting:te,handleSubmit:j,getSolicitudDetails:q}=ze();return{formData:x,dateRange:S,selectedPermiso:C,errors:D,isInitializing:a,setFormData:P,fullModel:p,isLoadingCompleteData:u,isEditing:f,maxDurationMs:l,maxDurationDays:t,isSingleDay:F,shouldForceFullDay:d,canShowCheckbox:c,canShowTimeFields:s,isFormValid:m,hasValidationErrors:_,validationErrors:E,dateValidation:H,timeValidation:$,durationValidation:M,hasUserInitiatedAction:A,touchedFields:Y,markFieldAsTouched:Q,markAllFieldsAsTouched:B,clearTouchedFields:oe,resetUserInteraction:re,fileToDelete:W,showDeleteFileDialog:J,isDeletingFile:N,initiateFileDelete:L,confirmDeleteFile:z,cancelFileDelete:i,handleFilesAdd:I=>{const v=Array.isArray(I)?I:I?[I]:[];P(k=>({...k,files:v}))},handleFileRemove:I=>{P(v=>{const se=(v.files||[]).filter((me,U)=>U!==I);return{...v,files:se}})},handleExistingFileDelete:I=>{p!=null&&p.id&&L(p.id,I,v=>{o(k=>{if(!k)return k;const se=k.files.filter(U=>{const fe=U.id&&v.id&&U.id===v.id,he=U.hash&&v.hash&&U.hash===v.hash,pe=U.name===v.name&&U.size===v.size;return!(fe||he||pe)});return{...k,files:se}}),!Y.has("fecha")&&!Y.has("fecha_inicio")&&Y.has("fecha_fin")})},isSubmitting:te,handleFormSubmit:async(I=null)=>{B();const v=R();if(!v)return!1;try{return await j(v,f,e==null?void 0:e.id,I)}catch(k){return console.error("Form submission failed:",k),!1}},resetForm:r,initializeForEdit:async I=>{if(!I||!I.id){console.error("initializeForEdit: data is invalid",I);return}try{n(!0);const v=await q(I.id);o(v),g(v)}catch(v){console.error("Error al cargar detalles completos:",v),o(I),g(I)}finally{n(!1)}},handleInputChange:w,handlePermisoSelect:y,handleDateRangeChange:V,validateForm:R,setErrors:K}}const ue=h.forwardRef(({form:e,updateForm:p,model:o,isLoading:u,error:n,onStateChange:x},S)=>{const C=!!o,D=He(o),{formData:a,dateRange:f,selectedPermiso:l,isInitializing:t,maxDurationMs:F,maxDurationDays:d,canShowCheckbox:c,canShowTimeFields:s,shouldForceFullDay:r,isFormValid:g,hasValidationErrors:w,validationErrors:y,markFieldAsTouched:V,fileToDelete:R,showDeleteFileDialog:K,isDeletingFile:P,confirmDeleteFile:W,cancelFileDelete:J,isSubmitting:N,initializeForEdit:L,handleInputChange:z,handlePermisoSelect:i,handleDateRangeChange:m,validateForm:_,handleFilesAdd:E,handleFileRemove:H,handleExistingFileDelete:$,handleFormSubmit:M,fullModel:A,isLoadingCompleteData:Y}=D;h.useImperativeHandle(S,()=>({handleFormSubmit:M,isFormValid:g,isSubmitting:N,formData:a,validateForm:_}),[M,g,N,a,_]);const Q=T.useCallback(x,[]);h.useEffect(()=>{Q&&Q({isFormValid:g,isSubmitting:N,hasValidationErrors:w,validationErrors:y})},[g,N,w,y,Q]);const B=T.useRef(!1);h.useEffect(()=>{C&&(o!=null&&o.id)&&!t&&L&&!B.current&&(B.current=!0,L(o)),o!=null&&o.id||(B.current=!1)},[o==null?void 0:o.id,t,L]);const oe=T.useCallback(j=>{const q=parseInt(j,10);if(isNaN(q)||q<=0){console.error("‚ùå FormFields - Invalid empleado ID:",j);return}z("empleado_id",q)},[z]),re=T.useMemo(()=>C&&(A!=null&&A.files)?A.files:[],[C,A==null?void 0:A.files]),te=T.useMemo(()=>a.files||[],[a.files]);return t||Y?b.jsxs("div",{className:"flex items-center justify-center p-8",children:[b.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-custom-orange"}),b.jsx("span",{className:"ml-2 text-custom-gray-dark dark:text-custom-gray-light",children:"Cargando datos del permiso..."})]}):b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{className:"flex flex-col gap-1",children:[b.jsxs(ye,{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Empleado ",b.jsx("span",{className:"text-custom-orange",children:"*"})]}),b.jsx(Ee,{defaultValue:a.empleado_id,onChangeValue:(j,q)=>{oe(j),V("empleado_id")},className:"w-full rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",placeholder:"Seleccionar empleado..."})]}),b.jsx(Ae,{selectedPermiso:l,onPermisoSelect:i,maxDurationDays:d,formData:a,validationErrors:y,markFieldAsTouched:V,dateRange:f,empleadoId:a.empleado_id}),b.jsx(Ve,{dateRange:f,onDateRangeChange:m,formData:a,onInputChange:z,canShowCheckbox:c,canShowTimeFields:s,shouldForceFullDay:r,maxDurationMs:F,selectedPermiso:l,validationErrors:y,markFieldAsTouched:V,empleadoId:a.empleado_id}),b.jsx(je,{formData:a,onInputChange:z,canShowCheckbox:c,validationErrors:y,markFieldAsTouched:V}),b.jsx(ke,{existingFiles:re,newFiles:te,onFilesAdd:E,onFileRemove:H,onExistingFileDelete:$,showDeleteDialog:K,fileToDelete:R,onConfirmDelete:W,onCancelDelete:J,isDeletingFile:P,isEditing:C}),w&&b.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-3",children:[b.jsx("h4",{className:"text-sm font-medium text-red-800 mb-2",children:"Por favor, corrige los siguientes errores:"}),b.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:y.map((j,q)=>b.jsxs("li",{className:"flex items-start",children:[b.jsx("span",{className:"mr-2",children:"‚Ä¢"}),j]},q))})]}),N&&b.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 text-center",children:b.jsx("div",{className:"text-sm text-blue-700",children:C?"Actualizando permiso...":"Creando permiso..."})})]})});ue.displayName="FormFields";const qe=T.memo(ue),Ue={id:null,empleado_id:null,permiso_id:null,fecha_inicio:"",fecha_fin:"",hora_inicio:"",hora_fin:"",motivo:"",dia_completo:!1,recuperable:!1,estado_id:1,files:[]};function Pe({model:e,onOpenChange:p}){const{closeAllViews:o,updateData:u}=de(),n=T.useRef(),x=_e(Ue),S=h.useMemo(()=>!!e,[e]),C=T.useCallback(c=>{typeof c=="object"&&x.setData(s=>({...s,...c}))},[x.setData]),D=T.useCallback(async()=>{if(n.current&&n.current.handleFormSubmit)try{return await n.current.handleFormSubmit(s=>{try{s&&s.data&&s.data.solicitud&&u(s.data.solicitud),o()}catch(r){console.error("Error in success callback:",r);try{o()}catch(g){console.error("Error closing modal:",g)}}})}catch(c){return console.error("Submit error:",c),!1}else return console.warn("FormFields ref not available"),!1},[o,u]),[a,f]=T.useState(!1),[l,t]=T.useState(!1),F=T.useCallback(()=>{if(n.current){const c=n.current.isFormValid||!1,s=n.current.isSubmitting||!1;c!==a&&f(c),s!==l&&t(s)}},[]),d=T.useCallback(c=>{f(s=>c.isFormValid!==s?c.isFormValid:s),t(s=>c.isSubmitting!==s?c.isSubmitting:s)},[]);return T.useEffect(()=>{F()},[]),b.jsxs(Fe,{className:"sm:max-w-[700px] max-h-[80vh] flex flex-col bg-white dark:bg-custom-blackLight",children:[b.jsxs(ge,{className:"flex-shrink-0",children:[b.jsx(be,{className:"text-xl font-bold text-custom-blue dark:text-custom-white",children:S?"Editar Solicitud de Permiso":"Nueva Solicitud de Permiso"}),b.jsx(Se,{className:"text-custom-gray-dark dark:text-custom-gray-light",children:S?"Modifica los detalles de la solicitud de permiso.":"Complete los detalles para crear una nueva solicitud de permiso."})]}),b.jsx("div",{className:"flex-1 overflow-y-auto pr-2",children:b.jsx(qe,{ref:n,form:x,updateForm:C,model:e,isLoading:l,error:x.errors,onStateChange:d})}),b.jsx(xe,{className:"flex-shrink-0 flex flex-col sm:flex-row gap-2 pt-4 border-t border-custom-gray-light dark:border-custom-gray-darker",children:b.jsx(we,{onClick:D,disabled:l,className:"w-full sm:w-auto rounded-full bg-custom-orange hover:bg-custom-blue text-white",children:l?S?"Guardando...":"Creando...":S?"Guardar Cambios":"Crear Permiso"})})]})}const $e=h.memo(function({open:p,onOpenChange:o,model:u=null,onSaveData:n=null}){return b.jsx(De,{open:p,onOpenChange:o,children:b.jsx(Pe,{model:u,onOpenChange:o})})});function yr(){const{viewStates:e,closeAllViews:p}=de(),{open:o,model:u}=e.createUpdate;return b.jsx($e,{model:u,open:o,onOpenChange:()=>{p()}})}export{yr as default};
