import{r as s,G as W,j as e}from"./app-fwyInB3c.js";import{D as G,b as $,c as K,d as Q,f as X,g as Y}from"./dialog-iaZkf6Xy.js";import{I as C}from"./LucideIcon-CEqEhMjI.js";import{B as Z}from"./button-Blwr-A5N.js";import{I as g}from"./input-CqlBlYgU.js";import{D as ee}from"./DecisionModal-Dl8siGBG.js";import ae from"./DayItem-B2NjQ0h7.js";import te from"./WeekdayPreview-D9izSpUe.js";import J from"./FormDefaultValues-BPUSYtip.js";import{jornadasSchema as se}from"./jornadasSchema-Bc3C9LjL.js";import{calculateTotalWeekHours as re}from"./functions-B_hVx-4e.js";import{u as oe}from"./useTranslation-BtIkv0Na.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-DloWbRVd.js";import"./index-B7srb2QZ.js";import"./index-BIJodELy.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./utils-CytzSlOG.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./index-BwobEAja.js";import"./alert-dialog-kDfn0La3.js";import"./Button-CQuYVLGu.js";import"./TurnoSelect-DHdheWBO.js";import"./command-PoUoScut.js";import"./popover-DaRbHQOK.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./WeekDay-C1ZcXS4Y.js";import"./GetModalidadIcon-BUgIPR97.js";import"./skeleton-DSiYFg9q.js";import"./tooltip-DFfoxvAF.js";import"./index-CeuhGnKJ.js";import"./types-BZmDMmQb.js";function Ze({dataId:d,open:M,onOpenChange:m}){const[l,T]=s.useState(null),[j,F]=s.useState([]),[b,L]=s.useState([]),[u,P]=s.useState(!1),[v,N]=s.useState(!0),[z,k]=s.useState(!1),[o,y]=s.useState({}),[w,D]=s.useState(!1),{t:E}=oe("datatable"),[n,S]=s.useState(J),{data:B,setData:I,post:H,put:O,errors:i,reset:q}=W(J),R=[0,1,2,3,4,5,6],V=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"];s.useEffect(()=>{u||(async()=>{try{const[t,r]=await Promise.all([axios.get(route("api.v1.admin.modalidades.index")),axios.get(route("api.v1.admin.turnos.index"))]);t.status===200&&F(t.data.modalidades),r.status===200&&L(r.data.turnos),P(!0)}catch(t){console.error("Error fetching data:",t)}})()},[u]);const p=(a,t)=>{S(r=>({...r,[a]:t}))},_=()=>{try{return se(E).parse(B),y({}),!0}catch(a){const t={};return a.errors&&a.errors.forEach(r=>{const c=r.path.join(".");t[c]=r.message}),y(t),!1}},A=async()=>{_()&&(l?O(route("admin.jornadas.update",{id:l.id}),{onSuccess:()=>{q(),m()},onError:a=>{console.error("Error en la actualización:",a)},preserveState:!0,errorBag:"updateOrCreateJornada"}):H(route("admin.jornadas.store"),{onSuccess:()=>{q(),m()},onError:a=>{console.error("Error en la creación:",a)},errorBag:"updateOrCreateJornada"}))};return s.useEffect(()=>{const{id:a,name:t,description:r,esquema:c}=n,x=c.filter(({turno_id:f,modalidad_id:h,weekday_number:U})=>f&&h&&U!=null);I({id:a,name:t,description:r,esquema:x})},[n]),s.useEffect(()=>{if(d)return(async()=>{try{const t=await axios.get(route("api.v1.admin.jornadas.show",{id:d}));if(t.status===200){const r=t.data.jornada,{id:c,name:x,description:f,esquema:h}=r;T(t.data.jornada),S({id:c,name:x,description:f,esquema:h})}else k(!0)}catch{k(!0)}finally{N(!1)}})(),()=>{};N(!1)},[d]),e.jsxs(e.Fragment,{children:[e.jsx(G,{open:M,onOpenChange:m,children:e.jsxs($,{className:"sm:max-w-[1200px] max-h-[90vh] flex flex-col bg-custom-white dark:bg-custom-blackLight",children:[e.jsx(K,{className:"px-6 pt-4",children:e.jsx(Q,{className:"",children:d?"Editar Jornada":"Crear Jornada"})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-2",children:v?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("span",{className:"text-custom-blue dark:text-custom-white",children:"Cargando..."})}):z?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("span",{className:"text-red-500",children:"Error al cargar los datos"})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full",children:[e.jsxs("div",{className:"flex flex-col gap-2 ",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Nombre ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{placeholder:"Nombre de la jornada",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi flex-1",value:n.name,onChange:a=>p("name",a.target.value)}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{readOnly:!0,tabIndex:"-1",value:`${re(n.esquema)} h`,className:"rounded-full dark:text-custom-gray-default text-custom-gray-dark bg-custom-gray-default dark:bg-custom-blackSemi w-[120px] text-center pl-8 pointer-events-none select-none"}),e.jsx("div",{className:"absolute left-2.5 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsx(C,{name:"Clock",className:"text-custom-orange w-4 h-4"})}),e.jsx("span",{className:"absolute -top-7 text-sm font-bold text-custom-blue dark:text-custom-white",children:"H. Semanales"})]})]}),(i.name||o.name)&&e.jsx("span",{className:"text-xs text-red-500",children:i.name||o.name})]}),e.jsxs("div",{className:"flex flex-col gap-2 ",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:"Descripción"}),e.jsx(g,{placeholder:"Descripción de la jornada",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:n.description,onChange:a=>p("description",a.target.value)}),(i.description||o.description)&&e.jsx("span",{className:"text-xs text-red-500",children:i.description||o.description})]}),e.jsx("div",{className:"",children:u&&e.jsx(te,{esquema:n.esquema||[],turnos:b,modalidades:j})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-bold text-custom-blue dark:text-custom-white mb-2",children:"Esquema de Jornada"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Día"}),e.jsx("th",{className:"p-2 text-left",children:"Turno"}),e.jsx("th",{className:"p-2 text-left",children:"Modalidad"})]})}),e.jsx("tbody",{children:R.map(a=>e.jsx(ae,{weekdayName:V[a],weekday:n.esquema.find(({weekday_number:t})=>t===a)||{turno_id:null,modalidad_id:null,weekday_number:a},prevData:n,sincronizePrevData:p,turnos:b,modalidades:j},a))})]})}),(i.esquema||o.esquema||o.esquema)&&e.jsx("span",{className:"text-xs text-red-500 mt-1",children:i.esquema||o.esquema||o.esquema})]})]})}),e.jsxs(X,{className:"px-6 pb-4 pt-2 flex justify-end gap-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx(Y,{className:"inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 bg-hidden hover:bg-custom-gray-default dark:hover:bg-custom-blackSemi text-custom-black dark:text-custom-white rounded-full",children:E("tables.cancelar")}),e.jsx(Z,{className:"bg-custom-orange hover:bg-custom-blue text-custom-white dark:text-custom-black dark:hover:bg-custom-white rounded-full",onClick:()=>D(!0),disabled:v,children:l?"Editar":"Crear"})]})]})}),e.jsx(ee,{variant:"confirm",open:w,onOpenChange:()=>D(!w),action:A,title:l?"¿Estás seguro de actualizar esta jornada?":"¿Estás seguro de crear esta jornada?",content:l?"Esta acción actualizará la jornada en el sistema.":"Esta acción creará una nueva jornada en el sistema.",icon:e.jsx(C,{name:"TriangleAlert",className:"text-custom-orange"})})]})}export{Ze as default};
