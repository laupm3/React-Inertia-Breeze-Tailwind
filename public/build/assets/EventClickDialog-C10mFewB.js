import{r as c,a as $,j as e}from"./app-fwyInB3c.js";import{D as O,b as q,c as B,d as G,e as W}from"./dialog-iaZkf6Xy.js";import{B as X}from"./Button-CQuYVLGu.js";import{a as J}from"./ViewContext-ChS6KolG.js";import Q from"./TimelineSolicitud-D5eRBMN_.js";import{S as Y}from"./SheetTable-CiCNZjvD.js";import{F as Z}from"./FileUploadArea-uzmkw7Uv.js";import{P as U}from"./Pill-l4GaXyto.js";import{V as P}from"./VacacionesMapColor-BDtfIx91.js";import{I as o}from"./LucideIcon-CEqEhMjI.js";import ee from"./ApprovalActionsFooter-Dy8ZL7hG.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-DloWbRVd.js";import"./index-B7srb2QZ.js";import"./index-BIJodELy.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./utils-CytzSlOG.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./index-BwobEAja.js";import"./index-WlsBA3k2.js";import"./UserAvatar-cKyxDEhx.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./SheetTable-oFCbTdfY.js";import"./sheet-DHc5Hgr8.js";import"./tabs-DtCm3GAf.js";import"./index-v24TFYKQ.js";import"./index-C_F9oucK.js";import"./SheetTableHeader-vhJO3F_n.js";import"./avatar-oBOSifLN.js";import"./StatusEmpleadoMapColor-Bp2doaTo.js";import"./ContratosVigentesDialog-SpBmuJuH.js";import"./tooltip-DFfoxvAF.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./index-CeuhGnKJ.js";import"./DataHandlerContext--vx6a3_3.js";import"./useApiEndpoints-CHm1F3ft.js";import"./format-Be40hyfq.js";import"./constants-BKFt95HM.js";import"./toDate-qOSwr3PX.js";import"./WeekDay-C1ZcXS4Y.js";import"./GetModalidadIcon-BUgIPR97.js";import"./skeleton-DSiYFg9q.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./es-DNLwfvrq.js";import"./parseISO-Efi0RkWR.js";import"./dropdown-menu-bHoOJ61X.js";import"./DataHandlerContext-BFIpl_ls.js";import"./ApprovalConfirmationDialog-BzOIQ1Nc.js";import"./button-Blwr-A5N.js";import"./textarea-C969rVin.js";class te{constructor(){this.cache=new Map,this.listTimestamp=null,this.dataVersion=0}generateKey(t,s="detail"){return`${s}_${t}`}get(t,s="detail"){const n=this.generateKey(t,s),h=this.cache.get(n);return h?this.listTimestamp&&h.timestamp<this.listTimestamp?(this.cache.delete(n),null):h.data:null}set(t,s,n="detail"){const h=this.generateKey(t,n);this.cache.set(h,{data:s,timestamp:Date.now(),version:this.dataVersion})}invalidate(t=null,s=null){if(t&&s){const n=this.generateKey(t,s);this.cache.delete(n)}else t?["detail","list"].forEach(n=>{const h=this.generateKey(t,n);this.cache.delete(h)}):(this.cache.clear(),this.listTimestamp=Date.now(),this.dataVersion++)}markListChanged(){this.listTimestamp=Date.now(),this.dataVersion++;for(const[t,s]of this.cache.entries())s.timestamp<this.listTimestamp&&this.cache.delete(t)}getStats(){return{size:this.cache.size,listTimestamp:this.listTimestamp,dataVersion:this.dataVersion,keys:Array.from(this.cache.keys())}}}const b=new te;function se(){const[r,t]=c.useState(!1),[s,n]=c.useState(null),[h,j]=c.useState(null),[z,w]=c.useState(()=>b.getStats()),x=c.useCallback(()=>{w(b.getStats())},[]),g=c.useCallback(p=>{const m=b.get(p,"detail");return x(),m},[x]),N=c.useCallback((p,m)=>{b.set(p,m,"detail"),x()},[x]),v=c.useCallback((p=null)=>{b.invalidate(p,"detail"),x()},[x]),C=c.useCallback(()=>{b.markListChanged(),x()},[x]),D=c.useCallback(async(p,m=!1)=>{var a,i;if(!p)return n("ID de solicitud no válido"),null;const f=String(p);if(!m){const d=g(f);if(d)return j(d),n(null),d}t(!0),n(null);try{const d=await $.get(route("api.v1.admin.vacaciones.show",f));if(d.status===200&&d.data.solicitud){const y=d.data.solicitud;return N(f,y),j(y),y}else throw new Error("Respuesta inválida del servidor")}catch(d){const y=((i=(a=d.response)==null?void 0:a.data)==null?void 0:i.message)||d.message||"Error desconocido";return n(y),null}finally{t(!1)}},[g,N]),E=c.useCallback(()=>{j(null),n(null),t(!1)},[]),l=c.useCallback(p=>p?g(String(p)):null,[g]);return c.useEffect(()=>{x()},[x]),{isLoading:r,error:s,details:h,fetchSolicitudDetails:D,clearDetails:E,getCachedDetails:l,invalidateCache:v,markGlobalDataChanged:C,cacheStats:z}}const _=r=>{if(!r)return"Fecha no proporcionada";const t=new Date(r);if(isNaN(t.getTime()))return"Fecha inválida";const s=t.toLocaleDateString("es-ES",{weekday:"long"});return`${s.charAt(0).toUpperCase()+s.slice(1)}, ${t.toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}`},I=r=>{if(!r)return"Hora no proporcionada";const t=new Date(r);return isNaN(t.getTime())?"Hora inválida":t.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1})},ae=r=>{if(!r||!r.estado||!r.estado.nombre)return"Estado desconocido";const{estado:t,seen_at:s}=r;return s&&t.nombre,t.nombre},ut=({isOpen:r,onClose:t,eventData:s=null})=>{var A,F,L,V;const{handleSheetView:n}=J(),[h,j]=c.useState(!1),{isLoading:z,error:w,details:x,fetchSolicitudDetails:g,clearDetails:N,getCachedDetails:v}=se();if(c.useEffect(()=>{var H,M;if(!r||!s){N();return}const k=((M=(H=s.extendedProps)==null?void 0:H.permisoCompleto)==null?void 0:M.id)||s.id;!k||v(k)||g(k)},[r,s,g,N,v]),!r||!s)return null;const{title:C,start:D,end:E,extendedProps:l,backgroundColor:p}=s,m=x||(((A=l==null?void 0:l.permisoCompleto)==null?void 0:A.files)!==void 0?l.permisoCompleto:null),f=(l==null?void 0:l.permisoCompleto)||null,a=m||f,i=a==null?void 0:a.empleado,d=(i==null?void 0:i.nombreCompleto)||(l==null?void 0:l.empleadoNombre)||"Nombre no disponible",y=((F=i==null?void 0:i.tipoEmpleado)==null?void 0:F.nombre)||"Puesto no disponible",T=((L=i==null?void 0:i.user)==null?void 0:L.profile_photo_url)||(typeof(l==null?void 0:l.description)=="string"&&l.description.startsWith("http")?l.description:null),u=a?ae(a):"Desconocido",S=z,R=w!==null,K=()=>{i!=null&&i.id&&j(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(O,{open:r,onOpenChange:k=>{k||t()},children:e.jsxs(q,{className:"bg-custom-white dark:bg-custom-blackLight text-custom-blue dark:text-custom-white w-full md:max-w-2xl lg:max-w-3xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(B,{className:"px-6 py-4 border-b dark:border-gray-700 flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx(G,{className:"text-lg font-medium",children:"Resumen de la solicitud de permiso"}),e.jsx(W,{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Aquí se muestran los detalles de la solicitud de permiso, incluyendo el estado y la línea de tiempo."})]})}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-4 md:p-6 space-y-6 bg-custom-gray-default dark:bg-custom-blackLight",children:[S&&e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(o,{name:"MoreHorizontal",className:"animate-spin h-5 w-5 mr-2"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cargando detalles completos..."})]}),R&&!S&&e.jsxs("div",{className:"flex items-center justify-center py-4 text-yellow-600 dark:text-yellow-400",children:[e.jsx(o,{name:"AlertTriangle",className:"h-5 w-5 mr-2"}),e.jsx("span",{className:"text-sm",children:w||"No se pudieron cargar todos los detalles. Mostrando información básica."})]}),e.jsxs("div",{className:"p-3 md:p-4 bg-white dark:bg-custom-blackSemi rounded-lg shadow",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3 text-gray-700 dark:text-gray-300",children:"Empleado que solicita el permiso"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[T?e.jsx("img",{src:T,alt:d,className:"h-10 w-10 rounded-full mr-3 object-cover"}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 dark:bg-gray-600 mr-3 flex items-center justify-center text-white",children:e.jsx(o,{name:"User",size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-gray-800 dark:text-gray-100",children:d}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:y})]})]}),e.jsxs(X,{variant:"outline",size:"sm",className:"text-xs dark:text-gray-300 dark:border-gray-600 hover:dark:bg-gray-700",onClick:K,children:["Ver información ",e.jsx(o,{name:"ExternalLink",size:12,className:"ml-1.5"})]})]})]}),e.jsxs("div",{className:"p-3 md:p-4 bg-white dark:bg-custom-blackSemi rounded-lg shadow",children:[a&&e.jsxs("div",{className:"flex p-3 md:p-4 bg-white dark:bg-custom-blackSemi rounded-lg shadow",children:[e.jsx("h3",{className:"text-sm mt-1 font-semibold mb-2 text-gray-700 dark:text-gray-300",children:"Estado Actual del Permiso: "}),e.jsxs("div",{className:"flex ml-2 items-center gap-2",children:[u==="Aprobado"&&e.jsxs("span",{className:"bg-green-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(o,{name:"Check",size:12}),e.jsx("span",{children:"Aprobado"})]}),u==="Denegado"&&e.jsxs("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(o,{name:"XCircle",size:12}),e.jsx("span",{children:"Denegado"})]}),u==="En revisión"&&e.jsxs("span",{className:"bg-yellow-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(o,{name:"Info",size:12}),e.jsx("span",{children:"En revisión"})]}),u==="Solicitado"&&e.jsxs("span",{className:"bg-blue-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(o,{name:"Send",size:12}),e.jsx("span",{children:"Solicitado"})]}),u==="En proceso"&&e.jsxs("span",{className:"bg-purple-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(o,{name:"MoreHorizontal",size:12,className:"animate-spin"}),e.jsx("span",{children:"En proceso"})]}),!["Aprobado","Denegado","En revisión","Solicitado","En proceso"].includes(u)&&u!=="Desconocido"&&e.jsxs("span",{className:"bg-gray-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(o,{name:"HelpCircle",size:12}),e.jsx("span",{children:u})]}),u==="Desconocido"&&e.jsxs("span",{className:"bg-gray-400 text-black text-xs px-2 py-1 rounded-full flex items-center gap-1",children:[e.jsx(o,{name:"AlertTriangle",size:12}),e.jsx("span",{children:"Desconocido"})]})]})]}),a&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2 text-gray-700 dark:text-gray-300",children:"Línea de Tiempo:"}),e.jsx(Q,{permiso:a})]}),!a&&e.jsx("p",{className:"mt-4 text-xs text-center text-gray-500 dark:text-gray-400",children:"Nota: El seguimiento detallado requiere datos completos del permiso."})]}),e.jsxs("div",{className:"p-3 md:p-4 bg-white dark:bg-custom-blackSemi rounded-lg shadow ",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3 text-gray-700 dark:text-gray-300",children:"Fecha de permiso"}),e.jsxs("div",{className:"items-center gap-x-3 gap-y-2 text-xs flex",children:[e.jsx(o,{name:"CalendarDays",className:"text-orange-500",size:16}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:_(D)}),e.jsx(o,{name:"Clock",className:"text-orange-500 ml-2 md:ml-0",size:16}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:I(D)}),e.jsx(o,{name:"ArrowRight",className:"text-orange-500 hidden md:block place-self-center",size:16}),e.jsx("div",{className:"col-span-full md:hidden border-t my-1 dark:border-gray-700"}),e.jsx(o,{name:"CalendarDays",className:"text-orange-500",size:16}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:_(E)}),e.jsx(o,{name:"Clock",className:"text-orange-500 ml-2 md:ml-0",size:16}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:I(E)})]}),e.jsx("h3",{className:"text-sm font-semibold mt-4 mb-2 text-gray-700 dark:text-gray-300",children:"Permiso solicitado"}),e.jsx(U,{identifier:C||"No especificado",mapColor:P,size:"sm",children:C||"No especificado"}),((V=m||f)==null?void 0:V.motivo)&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-sm font-semibold mt-4 mb-1 text-gray-700 dark:text-gray-300",children:"Motivo"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 whitespace-pre-wrap",children:a==null?void 0:a.motivo})]}),(m||!S&&f)&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3 text-gray-700 dark:text-gray-300",children:"Documentos adjuntos"}),m!=null&&m.files&&m.files.length>0?e.jsx(Z,{id:"file-display-only",existingFiles:m.files,selectedFiles:[],onFileChange:()=>{},onRemoveExisting:null,showExistingFiles:!0,allowRemoveExisting:!1,disabled:!0,showPreview:!0,className:"opacity-90",text:"Archivos adjuntos a esta solicitud",downloadConfig:{endpoint:"/api/v1/files/{file}/download",fileIdField:"hash",fileNameField:"name"}}):S?e.jsxs("div",{className:"text-center py-6 text-gray-500 dark:text-gray-400",children:[e.jsx(o,{name:"MoreHorizontal",className:"animate-spin h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Cargando archivos adjuntos..."})]}):e.jsxs("div",{className:"text-center py-6 text-gray-500 dark:text-gray-400",children:[e.jsx(o,{name:"FileText",size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:(a==null?void 0:a.files_count)>0?`Hay ${a.files_count} archivo(s) adjunto(s), pero no se pudieron cargar`:"No hay documentos adjuntos a esta solicitud"})]})]})]})]}),e.jsx(ee,{solicitud:a,onClose:t})]})}),(i==null?void 0:i.id)&&e.jsx(Y,{open:h,onOpenChange:j,model:i.id,enableToView:!0})]})};export{ut as EventClickDialog};
