import{j as e,A as b,r as h,a as A,X as le}from"./app-fwyInB3c.js";import{B as j}from"./Button-CQuYVLGu.js";import{I as v}from"./LucideIcon-CEqEhMjI.js";import{D as ie}from"./DialogModal-BHNZflaY.js";import{I as ae}from"./InputError-CrNaC_eR.js";import{T as ne}from"./TextInput-CZi-2d99.js";import M from"./ExtensionIcon-DXg-3KoR.js";import ce from"./EditFolderForm-C05f1ht_.js";import de from"./EditFileForm-Cmjg9zjM.js";import me from"./RenameFolder-CaMENfpG.js";import{M as D}from"./Modal-BkRna8gK.js";import{D as he}from"./DecisionModal-Dl8siGBG.js";import{toast as V}from"./index-WlsBA3k2.js";const Ce=({folderStack:a,currentFolder:c,onBreadcrumbClick:d})=>e.jsx("nav",{className:"text-sm text-gray-700",children:e.jsx("ul",{className:"flex",children:a.map((l,r)=>e.jsxs("li",{className:"flex items-center",children:[r>0&&e.jsx(v,{name:"ChevronRight",className:"text-custom-gray-darker dark:text-custom-gray-dark"}),r==0?e.jsx("div",{className:"flex items-center",children:e.jsxs(j,{variant:"ghost",onClick:()=>b.visit(route("user.files.index")),className:"text-custom-gray-darker dark:text-custom-gray-dark font-bold text-xl",children:[e.jsx(v,{name:"House",className:"mr-2"})," Principal"]})}):e.jsx(e.Fragment,{children:r==a.length-1?e.jsx(j,{variant:"ghost",onClick:()=>d(l),className:"text-custom-orange font-bold text-xl",children:l.nombre}):e.jsx(j,{variant:"ghost",onClick:()=>d(l),className:"text-custom-gray-darker dark:text-custom-gray-dark font-bold text-xl",children:l.nombre})})]},r))})}),B=({x:a,y:c,options:d,onClose:l})=>(h.useEffect(()=>{const r=()=>l();return window.addEventListener("click",r),()=>window.removeEventListener("click",r)},[l]),e.jsx("div",{className:"w-[200px] absolute bg-custom-gray-light text-black shadow-md rounded-md border z-50",style:{top:c,left:a},onContextMenu:r=>{r.stopPropagation(),r.preventDefault()},children:d.map((r,o)=>e.jsx("div",{onClick:r.action,className:"w-full px-4 py-1.5 text-left bg-gray-100 hover:bg-orange-500/80 dark:text-black dark:hover:bg-custom-gray-semiLight cursor-pointer rounded-md ",children:e.jsxs("span",{className:`inline-flex gap-2 items-center ${r.iconLabel=="Trash2"?"text-red-600 font-bold":""} `,children:[e.jsx(v,{name:r.iconLabel,className:"h-5"}),r.label]})},o))}));function xe({show:a,onClose:c,onConfirmed:d}){const[l,r]=h.useState({password:"",error:"",processing:!1,attempts:0,locked:!1,lockTime:0}),o=h.useRef(null);h.useEffect(()=>{A.get(route("files.password.status")).then(({data:t})=>{t.confirmedUntil&&t.confirmedUntil>Date.now()?(d(),c()):t.locked?r(n=>({...n,attempts:t.attempts,locked:!0,lockTime:t.lockTime})):r(n=>({...n,attempts:t.attempts||0,locked:!1,lockTime:0}))}).catch(()=>{r(t=>({...t,attempts:0,locked:!1,lockTime:0}))})},[c,d]),h.useEffect(()=>{let t;return l.locked&&(t=setInterval(()=>{r(n=>{const u=n.lockTime-1;return u<=0?(clearInterval(t),{...n,locked:!1,lockTime:0,attempts:0}):{...n,lockTime:u}})},1e3)),()=>clearInterval(t)},[l.locked]);const f=()=>{if(!l.password.trim()){r(t=>({...t,error:"El campo contraseña no puede estar vacío."}));return}r(t=>({...t,processing:!0,error:""})),A.post(route("files.password.confirm"),{password:l.password}).then(()=>{d(),c()}).catch(t=>{const{data:n}=t.response;n.locked?r(u=>({...u,processing:!1,attempts:n.attempts,locked:!0,lockTime:n.lockTime,error:""})):r(u=>({...u,processing:!1,attempts:n.attempts,error:"La contraseña introducida es incorrecta."}))})};return e.jsxs(ie,{show:a,onClose:c,title:"Confirmar contraseña",footer:e.jsxs("div",{className:"flex items-center w-full space-x-2",children:[e.jsx(j,{variant:"ghost",onClick:c,className:"w-full",children:"Cancelar"}),e.jsx(j,{onClick:f,className:`w-full ${l.processing?"opacity-25":""}`,processing:l.processing?"true":"false",disabled:l.locked,children:l.locked?`${l.lockTime} segundos...`:"Aceptar"})]}),children:["Para continuar con el proceso de autenticación en dos pasos, necesitamos que confirmes tu contraseña.",e.jsxs("div",{className:"mt-4",children:[e.jsx(ne,{ref:o,onChange:t=>r(n=>({...n,password:t.target.value})),type:"password",className:"w-full bg-custom-gray-default border-none focus:ring-0",placeholder:"**********",autoComplete:"current-password",onKeyUp:t=>t.key==="Enter"&&f(),disabled:l.locked}),e.jsx(ae,{message:l.error,className:"mt-2"})]})]})}const Ee=({folderStructure:a,currentFolder:c,openFolder:d,view:l,user:r,activeContextMenu:o,handleRightClickFolder:f,handleClickAccionesArchivos:t,closeContextMenu:n,handleRightClickGlobal:u,setIsCreateFolderOpen:q,setIsFileUploadOpen:U})=>{const[T,N]=h.useState(!1),[W,y]=h.useState(!1),[I,L]=h.useState(!1),[H,F]=h.useState(!1),[S,O]=h.useState(null),[Z,G]=h.useState(null),[C,K]=h.useState(null),[k,E]=h.useState({visible:!1,folder:null}),X=le().props.auth.user.profile_photo_url,p=s=>{K(s),s.tipo_fichero_id==1&&(s.nivel_seguridad_id==3?N(!0):d(s)),s.tipo_fichero_id==2&&(s.nivel_seguridad_id==3?N(!0):P(s))},P=s=>{const m=route("admin.files.download-url",{hash:s.hash});fetch(m).then(i=>i.json()).then(i=>{const g=i.url,x=document.createElement("a");x.href=g,x.download=s.nombre,document.body.appendChild(x),x.click(),document.body.removeChild(x)}).catch(i=>{console.error("Error al generar la URL firmada:",i)})},J=()=>{C.tipo_fichero_id==1?d(C):P(C)},_=s=>{const m=new Date(s);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"short",year:"numeric"}).format(m).replace(".","")},Q=async s=>{try{const m=await axios.delete(`/admin/files/delete/${s.id}`);b.visit(`/user/folders/${c.hash}`,{preserveState:!0}),V.success("El fichero ha sido eliminado correctamente!")}catch{V.error("Error: No se ha podido eliminar el fichero!")}},Y=()=>y(!0),z=()=>y(!1),ee=()=>L(!0),$=()=>L(!1),se=()=>F(!0),R=()=>F(!1),re=s=>{O(s),Y()},oe=s=>{G(s),ee()},te=s=>{O(s),se()};return e.jsxs("div",{onContextMenu:s=>u(s),onClick:()=>n(),className:"min-h-[72dvh]",children:[o.visible&&o.type==="global"&&e.jsx(B,{x:o.x>window.innerWidth-200?o.x-190:o.x,y:o.y,options:[{label:"Nueva Carpeta",iconLabel:"FolderPlus",action:()=>q(!0)},{label:"Nuevo Archivo",iconLabel:"FilePlus",action:()=>U(!0)}]}),a.length>=1?l==="grid"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold text-lg ml-3 mb-4",children:"Carpetas"}),a.filter(s=>s.tipo_fichero_id==1).length<1&&e.jsx("span",{className:"ml-3",children:"No hay carpetas"}),e.jsx("div",{className:"relative flex flex-wrap mb-10 pl-2",children:a.filter(s=>s.tipo_fichero_id==1).sort((s,m)=>{const i=s.nombre,g=m.nombre,x=Number(i),w=Number(g);if(!isNaN(x)&&!isNaN(w))return x-w}).map((s,m)=>e.jsxs("div",{className:"cursor-pointer py-6 pl-7 pr-8 border-2 dark:border-custom-gray-dark rounded-3xl m-4 flex items-center justify-stretch w-[70%] sm:w-[44%] md:w-[45%] lg:w-[29%] xl:w-[22%] 2xl:w-[17%] 3xl:w-[5%] hover:border-custom-orange dark:hover:border-custom-orange transition-colors duration-300",onClick:()=>window.innerWidth<760?p(s):void 0,onDoubleClick:()=>window.innerWidth>=760?p(s):void 0,onContextMenu:i=>f(i,s),children:[e.jsx("svg",{width:"70",viewBox:"0 0 203 130",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"group mr-6",children:e.jsxs("g",{clipPath:"url(#clip0_2471_47803)",children:[e.jsx("path",{d:"M182.7 17.3333H91.35L71.05 0H20.3C9.135 0 0 7.8 0 17.3333V52H203V34.6667C203 25.1333 193.865 17.3333 182.7 17.3333Z",className:"fill-custom-gray-dark dark:fill-custom-gray-darker group-hover:fill-custom-blue dark:group-hover:fill-custom-white transition-colors duration-300"}),e.jsx("path",{d:"M182.7 17H20.3C9.135 17 0 24.2643 0 33.1429V113.857C0 122.736 9.135 130 20.3 130H182.7C193.865 130 203 122.736 203 113.857V33.1429C203 24.2643 193.865 17 182.7 17Z",className:"fill-custom-gray-semiLight dark:fill-custom-blackSemi transition-colors duration-300"})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-bold",children:s.nombre}),e.jsxs("span",{className:"font-normal text-sm",children:[s.qty_ficheros," elementos"]})]})]},m))}),a.filter(s=>s.tipo_fichero_id==2).length>0&&e.jsx("p",{className:"font-bold text-lg ml-3 mb-4",children:"Archivos"}),e.jsx("div",{className:"w-full flex justify-normal flex-wrap gap-8 p-4",children:a.filter(s=>s.tipo_fichero_id==2).map((s,m)=>e.jsx("div",{className:"flex justify-around items-center w-[90%] sm:w-[80%] md:w-[47%] lg:w-[30%] xl:w-[30%] 2xl:w-[23%] hover:border-spacing-8 mx-auto md:mx-0",onContextMenu:i=>t(i,s),children:e.jsxs("div",{className:"w-full flex flex-col bg-gray-300 p-5 rounded-2xl text-black",children:[e.jsxs("div",{className:"w-full h-max flex gap-2 text-sm ml-1",children:[e.jsx("div",{children:e.jsx(M,{extension:s.path.split(".").pop(),isDarkMode:!1,size:25})}),e.jsx("div",{className:"flex gap-1 h-fit w-full overflow-hidden",children:e.jsx("span",{children:s.path.split("/").pop()})}),e.jsx("div",{className:"cursor-pointer",onClick:i=>t(i,s),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-ellipsis-vertical",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1"}),e.jsx("circle",{cx:"12",cy:"5",r:"1"}),e.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})]}),e.jsx("div",{className:"w-full h-[100px] my-4 bg-white p-14 rounded-2xl flex justify-center items-center cursor-pointer",onClick:()=>window.innerWidth<760?p(s):void 0,onDoubleClick:()=>window.innerWidth>=760?p(s):void 0,children:e.jsx(M,{extension:s.path.split(".").pop(),isDarkMode:!1,size:70})}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx("img",{src:X,className:"size-[30px] rounded-full"}),e.jsx("span",{className:"font-bold",children:r.name})]}),e.jsx("span",{children:_(s.updated_at)})]})]})},m))})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-[98%] mx-auto shadow-md rounded-t-lg bg-custom-gray-default dark:bg-custom-blackSemi",children:e.jsxs("table",{className:"w-full text-left mb-12 rounded-t-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-700 bg-gray-300 rounded-t-lg",children:[e.jsx("th",{className:"py-3 px-4 w-1/3",children:"Nombre"}),e.jsx("th",{className:"py-3 px-4 w-1/3",children:"Subido por"}),e.jsx("th",{className:"py-3 px-4 w-1/3",children:"Último archivo subido"})]})}),e.jsxs("tbody",{children:[a.filter(s=>s.tipo_fichero_id==1).sort((s,m)=>{const i=s.nombre,g=m.nombre,x=Number(i),w=Number(g);if(!isNaN(x)&&!isNaN(w))return x-w}).map((s,m)=>e.jsxs("tr",{className:"border-t hover:bg-custom-gray-light dark:hover:bg-custom-gray-darker",children:[e.jsxs("td",{className:"py-3 px-4 w-full inline-flex gap-4 cursor-pointer hover:text-custom-orange",onClick:()=>window.innerWidth<760?p(s):void 0,onDoubleClick:()=>window.innerWidth>=760?p(s):void 0,children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-folder",children:e.jsx("path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z"})}),s.nombre]}),e.jsxs("td",{className:"py-3 px-4 w-1/3",children:[s.qty_ficheros," elementos"]}),e.jsxs("td",{className:"py-3 ps-4 pe-8 w-full inline-flex justify-between",children:[_(s.updated_at),e.jsx("span",{className:"hover:text-custom-orange rounded-full cursor-pointer",onClick:i=>f(i,s),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-ellipsis-vertical",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1"}),e.jsx("circle",{cx:"12",cy:"5",r:"1"}),e.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})]})]},m)),a.filter(s=>s.tipo_fichero_id==2).map((s,m)=>e.jsxs("tr",{className:"border-t hover:bg-custom-gray-light dark:hover:bg-custom-gray-darker",onContextMenu:i=>t(i,s),children:[e.jsxs("td",{className:"py-3 px-4 w-full inline-flex gap-4 max-h-12 cursor-pointer hover:text-custom-orange",onClick:()=>window.innerWidth<760?p(s):void 0,onDoubleClick:()=>window.innerWidth>=760?p(s):void 0,children:[e.jsx("div",{className:"w-5",children:e.jsx(M,{extension:s.path.split(".").pop(),isDarkMode:!1,size:"25"})}),e.jsxs("span",{children:[" ",s.path.split("/").pop()," "]})]}),e.jsx("td",{className:"py-3 px-4 w-1/3",children:r.name}),e.jsxs("td",{className:"py-3 ps-4 pe-8 w-full inline-flex justify-between",children:[_(s.created_at),e.jsx("span",{className:"hover:text-custom-orange rounded-full cursor-pointer",onClick:i=>t(i,s),children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-ellipsis-vertical",children:[e.jsx("circle",{cx:"12",cy:"12",r:"1"}),e.jsx("circle",{cx:"12",cy:"5",r:"1"}),e.jsx("circle",{cx:"12",cy:"19",r:"1"})]})})]})]},m))]})]})})}):e.jsx("p",{className:"text-gray-500 text-center",children:"No se encontraron archivos o carpetas."}),T&&e.jsx(xe,{show:T,onClose:()=>N(!1),onConfirmed:J}),o.visible&&o.type==="folder"&&e.jsx(B,{x:o.x,y:o.y,onClose:n,options:[{label:"Abrir",iconLabel:"FolderOpen",action:()=>p(o.folder)},{label:"Editar nombre",iconLabel:"SquarePen",action:()=>te(o.folder)},{label:"Cambiar permisos",iconLabel:"Lock",action:()=>re(o.folder)},{label:"Eliminar",iconLabel:"Trash2",action:()=>E({visible:!0,folder:o.folder})}]}),o.visible&&o.type==="file"&&e.jsx(e.Fragment,{children:e.jsx(B,{x:o.x>window.innerWidth-200?o.x-204:o.x+4,y:o.y,onClose:n,options:[{label:"Descargar",iconLabel:"Download",action:()=>p(o.folder)},{label:"Cambiar permisos",iconLabel:"Lock",action:()=>oe(o.folder)},{label:"Eliminar",iconLabel:"Trash2",action:()=>E({visible:!0,folder:o.folder})}]})}),e.jsx(D,{show:W,onClose:z,children:e.jsx(ce,{onClose:z,currentFolder:c,folderContextMenu:S,isModalEditFolderOpen:W,setIsModalEditFolderOpen:y})}),e.jsx(D,{show:I,onClose:$,children:e.jsx(de,{onClose:$,currentFolder:c,fileContextMenu:Z,isModalEditFileOpen:I,setIsModalEditFileOpen:L})}),e.jsx(D,{show:H,onClose:R,children:e.jsx(me,{onClose:R,currentFolder:c,folderContextMenu:S,isModalEditFolderOpen:H,setIsModalRenameFolderOpen:F})}),k.visible&&e.jsx(he,{title:"¿Estás seguro de que quieres eliminar este fichero?",content:"Esta acción no se puede deshacer. Todos los datos relacionados con este fichero se eliminarán.",open:k.visible,onOpenChange:()=>E(!k.visible),action:()=>Q(k.folder),variant:"destructive",icon:e.jsx(v,{name:"OctagonAlert",className:"w-6 h-6 text-red-500"})})]})},_e=({folderStack:a,setFolderStack:c,currentFolder:d,setCurrentFolder:l,homeHash:r})=>{const o=f=>{f.preventDefault(),d.parent.hash==r?b.visit(route("user.files.index")):b.visit(route("user.files.navigate",{hash:d.parent.hash}),{preserveState:!0})};return e.jsx(e.Fragment,{children:d.hash!=r&&e.jsxs("div",{onClick:o,className:"flex items-center ml-2 text-gray-700 hover:text-custom-orange dark:text-custom-white dark:hover:text-custom-orange",children:[e.jsx("svg",{className:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})}),e.jsx("button",{className:"font-semibold",children:"Volver"})]})})},Me=({view:a,setView:c,currentFolder:d,homeHash:l})=>e.jsx(e.Fragment,{children:d.hash!=l&&e.jsxs("div",{className:"flex space-x-4 mr-2",children:[e.jsxs("button",{className:`p-2 rounded relative ${a==="list"}`,onClick:()=>c("list"),children:[e.jsx("svg",{width:"27",height:"27",viewBox:"0 0 27 27",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M9 6.75H23.625M9 13.5H23.625M9 20.25H23.625M3.375 6.75H3.38625M3.375 13.5H3.38625M3.375 20.25H3.38625",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})}),a==="list"&&e.jsx("div",{className:"w-4 h-4 bg-custom-orange rounded-full absolute top-5 right-1 flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})})]}),e.jsxs("button",{className:`p-2 rounded relative ${a==="grid"}`,onClick:()=>c("grid"),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4h6v6H4zM14 4h6v6h-6zM4 14h6v6H4zM14 14h6v6h-6z"})}),a==="grid"&&e.jsx("div",{className:"w-4 h-4 bg-custom-orange rounded-full absolute top-5 right-1 flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})})]})]})});export{Ce as B,xe as C,Ee as F,_e as G,Me as V};
