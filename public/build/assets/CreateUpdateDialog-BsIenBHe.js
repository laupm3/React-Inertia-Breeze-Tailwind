import{r,j as e,G as I,a as P}from"./app-fwyInB3c.js";import{D as z,b as A,c as H,d as $,f as G,g as M}from"./dialog-iaZkf6Xy.js";import{B as O}from"./button-Blwr-A5N.js";import{I as u}from"./input-CqlBlYgU.js";import{S as _}from"./separator-BWKairMX.js";import{D as U}from"./DecisionModal-Dl8siGBG.js";import{I as x}from"./LucideIcon-CEqEhMjI.js";import{c as V}from"./utils-CytzSlOG.js";import{C as Q,f as R,b as X,c as q,d as J,e as K}from"./command-PoUoScut.js";import{P as W,a as Y,b as Z}from"./popover-DaRbHQOK.js";import ee from"./FormDefaultValues-wlRkHSRu.js";import se from"./turnoSchema-Dmj3JSc2.js";import{L as te}from"./LoadingSpinner-CiiXDndn.js";import{A as ae}from"./alert-D9izbOQG.js";import{u as re}from"./useTranslation-BtIkv0Na.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-DloWbRVd.js";import"./index-B7srb2QZ.js";import"./index-BIJodELy.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./index-BwobEAja.js";import"./alert-dialog-kDfn0La3.js";import"./Button-CQuYVLGu.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./types-BZmDMmQb.js";function oe({prevCentroId:i,fetchUrl:b,className:m,onSelect:j}){var h;const[o,f]=r.useState(!1),[l,d]=r.useState(null),[n,k]=r.useState([]),[N,p]=r.useState(null),[g,v]=r.useState(!0),s=a=>{j&&j(a)};return r.useEffect(()=>{if(i){const a=n.find(c=>c.id===i);a&&d(a)}else d(null)},[i,n]),r.useEffect(()=>((async()=>{try{const c=await axios.get(b);c.status===200?k(c.data.centros):p(!0)}catch{p(!0)}finally{v(!1)}})(),()=>{}),[b]),e.jsxs(W,{open:o,onOpenChange:f,modal:!0,children:[e.jsx(Y,{asChild:!0,children:e.jsxs("button",{role:"combobox","aria-expanded":o,className:`w-full justify-between rounded-full bg-custom-gray-default dark:bg-custom-gray-darker text-custom-gray-semilight ${m} text-sm flex p-2.5 items-center cursor-default`,onClick:()=>f(!o),children:[l?e.jsxs("div",{className:"flex items-center ml-4 -m-1.5",children:[l.nombre," ",(h=l.empresa)!=null&&h.siglas?`- ${l.empresa.siglas}`:""]}):"Seleccione un centro...",e.jsx(x,{name:"ChevronsUpDown",className:"ml-2 mr-4 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Z,{className:"w-full p-2",children:e.jsxs(Q,{children:[e.jsx(R,{className:"rounded-full dark:text-custom-gray-dark bg-custom-gray-default dark:bg-custom-blackSemi",placeholder:"Buscar centro..."}),e.jsxs(X,{children:[e.jsx(q,{children:N?"Ningún centro encontrado":e.jsx("span",{className:"text-red-500",children:"Error al cargar los centros."})}),e.jsx(J,{children:n.map(a=>{var c;return e.jsxs(K,{value:a.id,onSelect:()=>{d(a),f(!1),s(a)},children:[e.jsx(x,{name:"Check",className:V("mr-2 h-4 w-4",(l==null?void 0:l.id)===a.id?"opacity-100":"opacity-0")}),a.nombre," ",(c=a.empresa)!=null&&c.siglas?`- ${a.empresa.siglas}`:""]},a.id)})})]})]})})]})}function qe({dataId:i,open:b,onOpenChange:m}){const{t:j}=re("datatable"),[o,f]=r.useState(null),[l,d]=r.useState(!0),[n,k]=r.useState(!1),[N,p]=r.useState(!1),[g,v]=r.useState(!1),s=I(ee),h=r.useCallback(async()=>{if(!i){d(!1);return}try{const t=await P.get(route("api.v1.admin.turnos.show",{id:i}));t.status===200?(f(t.data.turno),a(t.data.turno)):k(!0)}catch{k(!0)}finally{d(!1)}},[i]);r.useEffect(()=>{h()},[h]);const a=r.useCallback(t=>{if(!t)return;const{id:y,nombre:C,color:T,horaFin:L,horaInicio:B,centro_id:le,descansoInicio:S,descansoFin:D,descripcion:F,centro:w}=t;s.setData({id:y,nombre:C||"",color:T||"#FB7D16",hora_inicio:B||"",hora_fin:L||"",centro_id:w==null?void 0:w.id,descripcion:F||"",descanso_inicio:S||"",descanso_fin:D||""}),v(!!S&&!!D)},[s]),c=r.useCallback(()=>{const t=se(j).safeParse(s.data);if(!t.success){const y=t.error.flatten().fieldErrors;Object.keys(y).forEach(C=>{s.setError(C,y[C][0])});return}o?s.put(route("admin.turnos.update",{id:o.id}),{onSuccess:()=>{m(!1)}}):s.post(route("admin.turnos.store"),{onSuccess:()=>{s.reset(),m(!1)},errorBag:"updateOrCreateTurno"})},[o,s,m]),E=i?"Editar Turno":"Crear Turno";return e.jsxs(e.Fragment,{children:[e.jsx(z,{open:b,onOpenChange:m,children:e.jsxs(A,{className:"sm:max-w-[625px] flex flex-col bg-custom-white dark:bg-custom-blackLight",children:[e.jsx(H,{children:e.jsx($,{children:E})}),l&&!n&&e.jsx(te,{}),n&&e.jsx(ae,{variant:"destructive",children:"Error al cargar los datos del turno"}),!l&&!n&&e.jsxs("div",{className:"flex-1 flex flex-col gap-4 overflow-y-auto p-4 max-h-[60vh]",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Nombre del Turno ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(u,{placeholder:"Turno de mañana 40 horas...",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:s.data.nombre||"",onChange:t=>s.setData("nombre",t.target.value)}),s.errors.nombre&&e.jsx("span",{className:"text-xs text-red-500",children:s.errors.nombre})]}),e.jsxs("div",{className:"col-span-1 flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:"Color"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"color",className:"h-10 w-42 rounded-xl border-none",value:s.data.color||"#FB7D16",onChange:t=>s.setData("color",t.target.value),id:"color"}),e.jsx("label",{className:"absolute -top-6 -right-5 p-2.5 bg-custom-white dark:bg-custom-blackLight rounded-full",for:"color",children:e.jsx(x,{name:"Pipette",size:"20",className:"bg-custom-white dark:bg-custom-blackLight"})})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:"Descripción"}),e.jsx(u,{placeholder:"Loren Ipsum...",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:s.data.descripcion||"",onChange:t=>s.setData("descripcion",t.target.value)}),s.errors.descripcion&&e.jsx("span",{className:"text-xs text-red-500",children:s.errors.descripcion})]}),e.jsx(_,{className:"bg-custom-blackSemi dark:bg-custom-white"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Centro asociado ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(oe,{fetchUrl:route("api.v1.admin.centros.index"),onSelect:t=>s.setData("centro_id",t.id),prevCentroId:s.data.centro_id}),s.errors.centro_id&&e.jsx("span",{className:"text-xs text-red-500",children:s.errors.centro_id})]}),e.jsx(_,{className:"bg-custom-blackSemi dark:bg-custom-white"}),e.jsx("h3",{className:"font-bold",children:"Horario"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Hora de inicio ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(u,{type:"time",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:s.data.hora_inicio||"",onChange:t=>s.setData("hora_inicio",t.target.value)}),s.errors.hora_inicio&&e.jsx("span",{className:"text-xs text-red-500",children:s.errors.hora_inicio})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Hora de fin ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(u,{type:"time",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:s.data.hora_fin||"",onChange:t=>s.setData("hora_fin",t.target.value)}),s.errors.hora_fin&&e.jsx("span",{className:"text-xs text-red-500",children:s.errors.hora_fin})]})]}),e.jsxs("button",{className:"flex flex-row items-center gap-3 text-sm font-semibold text-custom-blue dark:text-custom-white",onClick:t=>{t.preventDefault(),v(!g)},type:"button",children:[g?e.jsx(x,{name:"X",size:"16"}):e.jsx(x,{name:"Plus",size:"16"}),g?"Quitar descanso":"Añadir descanso"]}),g&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:"Inicio del descanso"}),e.jsx(u,{type:"time",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:s.data.descanso_inicio||"",onChange:t=>s.setData("descanso_inicio",t.target.value)})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:"Fin del descanso"}),e.jsx(u,{type:"time",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:s.data.descanso_fin||"",onChange:t=>s.setData("descanso_fin",t.target.value)})]})]})]}),e.jsxs(G,{className:"flex justify-end gap-4 mt-4 px-4 pb-4",children:[e.jsx(M,{className:"inline-flex items-center justify-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-10 px-4 py-2 bg-hidden hover:bg-custom-gray-default dark:hover:bg-custom-blackSemi text-custom-black dark:text-custom-white rounded-full",children:"Cancelar"}),e.jsx(O,{className:"bg-custom-orange hover:bg-custom-blue text-custom-white dark:text-custom-black dark:hover:bg-custom-white rounded-full",onClick:()=>p(!0),children:o?"Guardar cambios":"Crear turno"})]})]})}),e.jsx(U,{variant:"confirm",open:N,onOpenChange:()=>p(!N),action:c,title:o?"¿Estás seguro de actualizar este turno?":"¿Estás seguro de crear este turno?",content:o?"Esta acción actualizará el turno en el sistema.":"Esta acción creará un nuevo turno en el sistema.",icon:e.jsx(x,{name:"TriangleAlert",className:"text-custom-orange"})})]})}export{qe as default};
