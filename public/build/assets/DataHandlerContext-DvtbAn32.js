import{r as a,a as C,j as v}from"./app-fwyInB3c.js";const h=a.createContext(null),r=new Map,c=new Map;function k(){const i=a.useContext(h);if(!i)throw new Error("useDataHandler debe usarse dentro de DataHandlerContextProvider");return i}const H=({children:i})=>{const[D,l]=a.useState([]),[p,x]=a.useState(!0),y=a.useCallback(async t=>{if(r.has(t))return r.get(t);if(c.has(t))return c.get(t);const s=C.get(route("api.v1.admin.contratos.show",{contrato:t})).then(e=>{if(e.status===200){const f=e.data.contrato;return r.set(t,f),setTimeout(()=>{r.has(t)&&r.delete(t)},5*60*1e3),f}throw new Error("Error al obtener datos del contrato")}).finally(()=>{c.delete(t)});return c.set(t,s),s},[]),n=a.useCallback(t=>{r.has(t)&&r.delete(t)},[]),g=a.useCallback(t=>{l(s=>s.filter(e=>e&&typeof e.id<"u"&&e.id!==t)),n(t)},[n]),u=t=>{l(Array.isArray(t)?t.filter(s=>s&&typeof s.id<"u"):[])},d=a.useCallback(async()=>{x(!0);try{const t=await C.get(route("api.v1.admin.contratos.index"));t.status===200?u(t.data.contratos):u([])}catch(t){console.log("error :>> ",t),u([])}finally{x(!1)}},[]),b=a.useCallback(t=>{l(s=>{const e=s.filter(o=>o&&typeof o.id<"u");return e.some(o=>o.id===(t==null?void 0:t.id))?[t,...e.filter(o=>o.id!==t.id)]:[t,...e]}),t!=null&&t.id&&n(t.id)},[n]);return a.useEffect(()=>{d()},[d]),v.jsx(h.Provider,{value:{data:D,setData:l,fetchData:d,loading:p,updateData:b,deleteItem:g,getContratoDetail:y,clearContratoCache:n},children:i})};export{H as DataHandlerContextProvider,k as useDataHandler};
