import{j as e,r as u,G as se,a as ue}from"./app-fwyInB3c.js";import{D as pe,a as xe}from"./DataTable-D4Fn3B2g.js";import{useColumns as fe}from"./useColumns-3xwZt-hr.js";import{D as he}from"./DataTableContext-BYrqyX0i.js";import{useDataHandler as ge}from"./DataHandlerContext-BZN_ZmmA.js";import{B as Q}from"./BlockCard-TCX704se.js";import{useView as be}from"./ViewContext-DMP-1U8l.js";import je from"./Toolbar-CFqAJqhK.js";import{RangeZone as Ne}from"./RangeZone-hbn3uf5i.js";import{S as re}from"./SheetTable-oFCbTdfY.js";import{I as D}from"./LucideIcon-CEqEhMjI.js";import{B as V}from"./Button-CQuYVLGu.js";import{T as we,a as ve,b as oe,c as ae}from"./tabs-DtCm3GAf.js";import{S as ye}from"./SheetTableHeader-vhJO3F_n.js";import{P as te}from"./Pill-l4GaXyto.js";import{S as _e}from"./StatusEmpleadoMapColor-Bp2doaTo.js";import{C as ke}from"./ContratosVigentesDialog-SpBmuJuH.js";import{S as H}from"./skeleton-DSiYFg9q.js";import{f as Ce,c as Se,d as Te,e as Ee,b as Ae,D as $e}from"./dialog-iaZkf6Xy.js";import{o as Fe,a as G,s as z,c as He}from"./types-BZmDMmQb.js";import{toast as X}from"./index-WlsBA3k2.js";import{u as Ie}from"./useDebounce-xNcQ83OW.js";import{F as Pe}from"./FetchSelect-CvqHmH4Y.js";import{T as Le}from"./textarea-C969rVin.js";import{A as Ue}from"./AdvanceDropdown-qoEi4BOz.js";import"./avatar-oBOSifLN.js";import{T as De,a as Oe,b as ze,c as Me}from"./tooltip-DFfoxvAF.js";import{A as Re}from"./AdvancedHeader-CpvwMmYr.js";import{C as ie}from"./ColumnFilter-oxYUebdb.js";import{r as Ve}from"./RowActionsColumn-C3VJw1Sg.js";import{r as qe}from"./RowCheckedColumn-BShQ1j9z.js";import{C as Be,T as Y}from"./CreateUpdateDialog-DUyefDzi.js";import{S as Ge,a as Ke,b as Xe,c as Je,d as Ye}from"./select-B5O0TxCl.js";import"./input-CqlBlYgU.js";import"./alert-dialog-kDfn0La3.js";import{f as Ze}from"./format-Be40hyfq.js";import{e as Qe}from"./es-DNLwfvrq.js";import{S as We}from"./Spinner-DPRe7Z_J.js";import{O as es}from"./octagon-alert-BRAzZNeG.js";import{D as ss}from"./DecisionModal-Dl8siGBG.js";import"./table-cS0UKUSm.js";import"./utils-CytzSlOG.js";import"./index-Z1g0u-qm.js";import"./sidebar-CPh6C6LB.js";import"./index-DloWbRVd.js";import"./index-BwobEAja.js";import"./button-Blwr-A5N.js";import"./separator-BWKairMX.js";import"./index-BIJodELy.js";import"./sheet-DHc5Hgr8.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-B7srb2QZ.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./TableFilters-ZojjKFl2.js";import"./dropdown-menu-bHoOJ61X.js";import"./index-C_F9oucK.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./index-v24TFYKQ.js";import"./check-5DjPwM22.js";import"./chevron-right-B1iws4WK.js";import"./useTranslation-BtIkv0Na.js";import"./GlobalFilter-DNA5td8x.js";import"./ImportExportDropdown-COI3HdRN.js";import"./index-C-xs73Vr.js";import"./index-DpIruHMc.js";import"./card-DYkZYgg5.js";import"./badge-BgloL8Ae.js";import"./scroll-area-CvQ1XCoU.js";import"./checkbox-BQT_ir1e.js";import"./index-BxSEkZvI.js";import"./index-4A9uUPu1.js";import"./TableDebugging-C1u6ii1k.js";import"./EmpleadoAvatar-BBWI_HPN.js";import"./HorarioEmpleado-PNJSIrB3.js";import"./GetModalidadIcon-BUgIPR97.js";import"./FichajePills-kGTtBN3A.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./constants-BKFt95HM.js";import"./differenceInMilliseconds-D_qISUSz.js";import"./toDate-qOSwr3PX.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./chevron-up-OjKdrhzc.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./index-CeuhGnKJ.js";import"./BaseScheduleCell-DxtrDJoG.js";import"./RowSelectionColumn-COjZFz9T.js";import"./RangeItem-D2-j3G9k.js";import"./endOfWeek-DoVA-Yvp.js";import"./startOfToday-Dakg9Kzc.js";import"./popover-DaRbHQOK.js";import"./command-PoUoScut.js";import"./DatePicker-YJSItPq7.js";import"./calendar-DctTJhwg.js";import"./addDays-B9Fzl-_R.js";import"./parseISO-Efi0RkWR.js";import"./multi-select-BSyp-qjs.js";import"./DateRangeSelectors-DWki1vJK.js";import"./MonthPicker-BNKgMHFw.js";import"./DataHandlerContext--vx6a3_3.js";import"./useApiEndpoints-CHm1F3ft.js";import"./WeekDay-C1ZcXS4Y.js";import"./Create-tmHr2JLD.js";import"./AuthenticatedLayout-B4CSARVj.js";import"./PopUpIncidencias-CaovAEi3.js";import"./UserAvatar-cKyxDEhx.js";import"./ApplicationLogo-C2FcO4AY.js";import"./Yoopta-Dj4Guze5.js";import"./throttle-CmSTFqON.js";import"./PrimaryButton-SsXyLm2e.js";import"./useNotifications-CSWGH93r.js";import"./ShowNotificactionFromJestream-cKOlvVdg.js";import"./OnboardingModal-D0HRNKzO.js";import"./Modal-BkRna8gK.js";import"./transition-ByAjZSmr.js";import"./StepItem-bNLmZaq8.js";import"./StepProgress-DNpLodXf.js";import"./WelcomeContent-BPJ5E7_N.js";import"./onboardingImages-CoczwfNn.js";import"./AboutContent-DOlAXyok.js";import"./TeamContent-C0DysUYq.js";import"./CreateLanguageForm-xwtvYsjX.js";import"./alert-D9izbOQG.js";import"./InputSkeleton-CFMfUb-2.js";import"./RowActionsColumn-CM2slffX.js";import"./RowActionsTrigger-DnJzXomR.js";import"./RowActionsTrigger-C2PXJFNn.js";import"./index.modern-WcJlzckG.js";import"./CreateUpdateDialog-1qQQjI_x.js";import"./GoogleAddress-DWOptz48.js";import"./Map-D73hm0ip.js";import"./react-icons.esm-DXl_FId9.js";const ne=({label:a,value:s,isLast:o,isFirst:l})=>e.jsxs("div",{className:`overflow-hidden ${l?"rounded-t-[20px]":""} ${o?"rounded-b-[20px]":""}`,children:[e.jsx("div",{className:"bg-custom-gray-default/50 dark:bg-custom-gray-darker/50 p-3",children:e.jsx("span",{className:"text-sm text-custom-gray-semiDark dark:text-gray-300 font-medium",children:a})}),e.jsx("div",{className:`bg-white dark:bg-custom-gray-sidebar p-3 border-2 border-custom-gray-default dark:border-custom-gray-darker/50 -mt-[2px] ${o?"rounded-b-[20px]":""}`,children:e.jsx("span",{className:"text-sm text-custom-gray-semiDark dark:text-gray-200",children:s||"not Provided"})})]}),le=({label:a,value:s,className:o="",isHeader:l=!1,isLast:m=!1})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-custom-gray-default/50 dark:bg-custom-gray-darker/50 p-3 flex justify-between items-center",children:e.jsx("span",{className:"text-sm text-custom-gray-semiDark dark:text-gray-300 font-medium",children:a})}),e.jsx("div",{className:`bg-white dark:bg-custom-gray-sidebar p-3 flex items-center border-2 border-custom-gray-default dark:border-custom-gray-darker/50 ${o} ${m?"rounded-br-[20px]":""} ${l?"rounded-tr-[20px]":"-mt-[2px]"}`,children:e.jsx("span",{className:"text-sm text-custom-gray-semiDark dark:text-gray-200",children:s||"not Provided"})})]}),rs={Absentismo:{point:"bg-red-500",bg:"bg-red-500/30",text:"text-red-500",border:"border-red-500"},Pendiente:{point:"bg-gray-500",bg:"bg-gray-500/30",text:"text-gray-500",border:"border-gray-500"},Completo:{point:"bg-green-500",bg:"bg-green-500/30",text:"text-green-500",border:"border-green-500"},Parcial:{point:"bg-orange-500",bg:"bg-orange-500/30",text:"text-orange-500",border:"border-orange-500"},"En Revisión":{point:"bg-orange-500",bg:"bg-orange-500/30",text:"text-orange-500",border:"border-orange-500"},Justificado:{point:"bg-green-500",bg:"bg-green-500/30",text:"text-green-500",border:"border-green-500"},Permiso:{point:"bg-orange-500",bg:"bg-orange-500/30",text:"text-orange-500",border:"border-orange-500"},Retraso:{point:"bg-orange-500",bg:"bg-orange-500/30",text:"text-orange-500",border:"border-orange-500"},Suspensión:{point:"bg-gray-500",bg:"bg-gray-500/30",text:"text-gray-500",border:"border-gray-500"},Capacitación:{point:"bg-gray-500",bg:"bg-gray-500/30",text:"text-gray-500",border:"border-gray-500"}};function os({data:a}){var m,n;function s(r,y){const N=`https://www.google.com/maps?q=${r},${y}`;window.open(N,"_blank")}const o=({data:r})=>{var N,k,E,w,C,A,U,I;const y=[{label:"Empresa",value:((N=r.contrato.empresa)==null?void 0:N.nombre)||" "},{label:"Centro",value:((k=r.centro)==null?void 0:k.nombre)||" "},{label:"Turno",value:((E=r.turno)==null?void 0:E.nombre)||" "},{label:"Modalidad",value:((w=r.modalidad)==null?void 0:w.name)||" "},{label:"Estado del horario",value:e.jsx(te,{identifier:r.estadoHorario.name,children:r.estadoHorario.name,mapColor:rs,size:"text-xs",textClassName:"font-medium"})},{label:"Hora inicio",value:((C=r.turno)==null?void 0:C.horaInicio)||" "},{label:"Hora fin",value:((A=r.turno)==null?void 0:A.horaFin)||" "},{label:"Descanso inicio",value:((U=r.turno)==null?void 0:U.descansoInicio)||" "},{label:"Descanso fin",value:((I=r.turno)==null?void 0:I.descansoFin)||" "},...r.hora_inicio&&r.hora_fin?[{label:"Fichaje completado inicio",value:r.hora_inicio||" "},{label:"Fichaje completado fin",value:r.hora_fin||" "},{label:"Descanso completado inicio",value:r.descansoInicio||" "},{label:"Descanso completado fin",value:r.descansoFin||" "},{label:"Coordenadas de entrada",value:r.latitud_entrada&&r.longitud_entrada?e.jsxs("div",{className:"flex gap-4 items-center",children:[`${r.latitud_entrada}, ${r.longitud_entrada}`||" ",e.jsx(V,{variant:"secondary",size:"icon",onClick:()=>s(r.latitud_entrada,r.longitud_entrada),children:e.jsx(D,{name:"ArrowUpRight",size:"16"})})]}):" "},{label:"Coordenadas de salida",value:r.latitud_salida&&r.longitud_salida?e.jsxs("div",{className:"flex gap-4 items-center",children:[`${r.latitud_salida}, ${r.longitud_salida}`||" ",e.jsx(V,{variant:"secondary",size:"icon",onClick:()=>s(r.latitud_salida,r.longitud_salida),children:e.jsx(D,{name:"ArrowUpRight",size:"16"})})]}):" "},{label:"IP entrada",value:r.ip_address_entrada||" "},{label:"IP salida",value:r.ip_address_salida||" "},{label:"Dispositivo de entrada",value:r.user_agent_entrada||" "},{label:"Dispositivo de salida",value:r.user_agent_salida||" "},{label:"Observaciones",value:r.observaciones||" "}]:[]];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block sm:hidden space-y-2",children:y.map((x,j,S)=>e.jsx(ne,{label:x.label,value:x.value,isFirst:j===0,isLast:j===S.length-1},x.label))}),e.jsx("div",{className:"hidden sm:grid sm:grid-cols-2 overflow-hidden rounded-[20px]",children:y.map((x,j)=>e.jsx(le,{label:x.label,value:x.value,isHeader:j===0,isLast:j===y.length-1},x.label))})]})},l=({data:r})=>{var E,w,C,A,U,I,x,j,S,t,c,h,b,T,i;const[y,N]=u.useState(!1),k=[{label:"Nombre",value:((E=r.empleado)==null?void 0:E.nombre)||" "},{label:"Primer apellido",value:((w=r.empleado)==null?void 0:w.primerApellido)||" "},{label:"Segundo apellido",value:((C=r.empleado)==null?void 0:C.segundoApellido)||" "},{label:"NIF",value:((A=r.empleado)==null?void 0:A.nif)||" "},{label:"Id",value:((U=r.empleado)==null?void 0:U.id)||" "},{label:"Estado",value:e.jsx(te,{identifier:(x=(I=r.empleado)==null?void 0:I.estadoEmpleado)==null?void 0:x.nombre,mapColor:_e,children:((S=(j=r.empleado)==null?void 0:j.estadoEmpleado)==null?void 0:S.nombre)||""})},{label:"Direccion",value:((c=(t=r.empleado)==null?void 0:t.direccion)==null?void 0:c.full_address)||" "},{label:"Email",value:((h=r.empleado)==null?void 0:h.email)||" "},{label:"Email secundario",value:((b=r.empleado)==null?void 0:b.emailSecundario)||" "},{label:"Telefono",value:((T=r.empleado)==null?void 0:T.telefono)||" "},{label:"Telefono de emergencia",value:((i=r.empleado)==null?void 0:i.telefonoEmergencia)||" "},{label:"Contrato",value:e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center gap-2 text-custom-gray-semiDark hover:text-custom-gray-dark dark:text-gray-300 dark:hover:text-white transition-colors",children:[e.jsx("span",{className:"text-sm font-medium",children:"Contratos vigentes"}),e.jsx(D,{name:"ArrowUpRight",size:"16"})]}),y&&e.jsx(ke,{model:r.empleado.id,open:y,onOpenChange:N})]})}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"block sm:hidden space-y-2",children:k.map((p,f,_)=>e.jsx(ne,{label:p.label,value:p.value,isFirst:f===0,isLast:f===_.length-1},p.label))}),e.jsx("div",{className:"hidden sm:grid sm:grid-cols-2 overflow-hidden rounded-[20px]",children:k.map((p,f)=>e.jsx(le,{label:p.label,value:p.value,isHeader:f===0,isLast:f===k.length-1},p.label))})]})};return e.jsxs(e.Fragment,{children:[((m=a==null?void 0:a.empleado)==null?void 0:m.user)&&e.jsx(ye,{data:(n=a==null?void 0:a.empleado)==null?void 0:n.user}),e.jsxs(we,{defaultValue:"tab1",className:"w-full mt-6",children:[e.jsxs(ve,{className:"w-full h-12 grid grid-cols-2 bg-custom-gray-default/50 dark:bg-custom-gray-darker/50 rounded-lg",children:[e.jsx(oe,{value:"tab1",className:"h-full px-3 text-sm font-medium transition-all text-custom-gray-dark data-[state=active]:text-custom-gray-semiDark data-[state=active]:bg-white dark:text-gray-300 dark:data-[state=active]:bg-custom-gray-sidebar dark:data-[state=active]:text-white rounded-lg",children:e.jsx("span",{className:"whitespace-nowrap",children:"Información personal"})}),e.jsx(oe,{value:"tab2",className:"h-full px-3 text-sm font-medium transition-all text-custom-gray-dark data-[state=active]:text-custom-gray-semiDark data-[state=active]:bg-white dark:text-gray-300 dark:data-[state=active]:bg-custom-gray-sidebar dark:data-[state=active]:text-white rounded-lg",children:e.jsx("span",{className:"whitespace-nowrap",children:"Información laboral"})})]}),e.jsx(ae,{className:"mt-4 w-full",value:"tab1",children:e.jsx(o,{data:a})}),e.jsx(ae,{className:"mt-4 w-full",value:"tab2",children:e.jsx(l,{data:a})})]})]})}function as(){return e.jsxs("div",{className:"flex flex-col w-full space-y-8",children:[e.jsxs("div",{className:"w-full flex items-center space-x-4",children:[e.jsx(H,{className:"h-24 w-24 rounded-full"}),e.jsxs("div",{className:"flex flex-col justify-center space-y-2",children:[e.jsx(H,{className:"h-4 w-[250px]"}),e.jsx(H,{className:"h-4 w-[200px]"})]})]}),e.jsx(H,{className:"h-20 w-full"}),e.jsx(H,{className:"h-96 w-full"})]})}const ee=a=>u.useMemo(()=>({dataKey:"horario",show:a?route("api.v1.admin.horarios.show",{horario:a}):null,store:route("api.v1.admin.horarios.bulk-store"),update:a?route("api.v1.admin.horarios.bulk-update"):null,delete:a?route("api.v1.admin.horarios.bulk-destroy"):null,contratos:route("api.v1.admin.empleados.available-contracts")}),[a]);function ts({open:a,onOpenChange:s,model:o,enableToView:l=!0}){const m=ee(o),[n,r]=u.useState(null),[y,N]=u.useState(!0),[k,E]=u.useState(!1);return u.useEffect(()=>((async()=>{try{N(!0);const C=await axios.get(m.show);C.status===200?r(C.data[m.dataKey]):E(!0)}catch{E(!0)}finally{N(!1)}})(),()=>{}),[o]),y||!l?e.jsx(re,{title:null,open:a,onOpenChange:s,className:"w-full max-w-full sm:min-w-[600px]",descriptionContent:e.jsx("div",{className:"flex items-center justify-center w-full h-full mt-6",children:e.jsx(as,{})})}):e.jsx(re,{title:null,open:a,onOpenChange:s,className:"w-full max-w-full sm:min-w-[600px]",descriptionContent:e.jsx(e.Fragment,{children:n&&e.jsx(e.Fragment,{children:e.jsx(os,{data:n,setData:r})})})})}const is=()=>{const a=Fe({id:G().nullable().or(z().nullable()).optional(),turno_id:G().nullable().or(z().nullable()),modalidad_id:G().nullable().or(z().nullable()),estado_horario_id:G().nullable().or(z().nullable()),horario_inicio:z().min(1,"Horario de inicio requerido"),horario_fin:z().min(1,"Horario de fin requerido"),descanso_inicio:z().optional(),descanso_fin:z().optional(),observaciones:z().optional(),contrato_id:G().nullable().or(z().nullable()).optional(),anexo_id:G().nullable().or(z().nullable()).optional()}).passthrough();return He(a)},ce=[{id:null,contrato_id:null,anexo_id:null,turno_id:null,modalidad_id:null,estado_horario_id:1,horario_inicio:"",horario_fin:"",descanso_inicio:"",descanso_fin:"",observaciones:""}],Z=a=>{if(!a)return"";const s=new Date(a),o=k=>String(k).padStart(2,"0"),l=s.getUTCFullYear(),m=o(s.getUTCMonth()+1),n=o(s.getUTCDate()),r=o(s.getUTCHours()),y=o(s.getUTCMinutes()),N=o(s.getUTCSeconds());return`${l}-${m}-${n} ${r}:${y}:${N}`},ns=a=>{if(a)return a.map(s=>{var o,l,m;return{id:s.id||null,turno_id:((o=s.turno)==null?void 0:o.id)||null,modalidad_id:((l=s.modalidad)==null?void 0:l.id)||null,estado_horario_id:((m=s.estadoHorario)==null?void 0:m.id)||null,horario_inicio:Z(s.horario_inicio),horario_fin:Z(s.horario_fin),descanso_inicio:Z(s.descanso_inicio),descanso_fin:Z(s.descanso_fin),observaciones:s.observaciones||""}})},me=u.createContext(null),ls=({children:a,model:s,onOpenChange:o,dataKey:l,onSaveData:m=null,modelAlias:n="registro",data:r,dataForUpdate:y,setDataForUpdate:N,onDelete:k})=>{const[E,w]=u.useState(!1),[C,A]=u.useState(!1),[U,I]=u.useState(!1),[x,j]=u.useState(!1),S=ee(s),t=se(ce),c=se([]),h=is(),[b,T]=u.useState([]);u.useEffect(()=>{c.setData([]);const d=async()=>{try{I(!0),A(!1);const v=await axios.post(route("api.v1.admin.horarios.bulk-show",{horarios:s}));t.setData(ns(v.data.horarios))}catch(v){console.error("Error al cargar datos:",v),A(!0)}finally{I(!1)}};return t.clearErrors(),s&&Array.isArray(s)&&s.length>0?d():(t.setData(ce),A(!1),I(!1)),()=>{}},[s]),u.useEffect(()=>{if(r.length===0)return;(async()=>{if(!r||!Array.isArray(r))return;const v=r.map(g=>({empleado_id:g.empleado_id,fechas:g.fechas.map(L=>L.date)}));try{const g=await axios.post(route("api.v1.admin.empleados.available-contracts"),{empleados:v});T(g.data)}catch(g){console.error("Error al cargar contratos disponibles:",g),X.error("No se pudieron cargar los contratos disponibles.")}})()},[r]);const i=u.useCallback((d,v)=>{if(typeof d=="object"&&v===void 0){t.setData(g=>{if(Array.isArray(g)){const L=d.filter(F=>F.id!=null),O=d.filter(F=>F.id==null);return[...g.map(F=>{const M=L.find(B=>B.id===F.id);return M?{...F,...M}:F}),...O]}else return{...g,...d}});return}console.warn("updateForm: actualización por clave/valor no válida para arrays")},[t]),p=u.useCallback((d,v)=>{if(typeof d=="function"){c.setData(g=>d(g));return}if(typeof d=="object"&&v===void 0){c.setData(g=>{if(Array.isArray(g)){const L=d.filter(F=>F.id!=null),O=d.filter(F=>F.id==null);return[...g.map(F=>{const M=L.find(B=>B.id===F.id);return M?{...F,...M}:F}),...O]}else return{...g,...d}});return}},[c]),f=u.useCallback(()=>{const d=h.safeParse(t.data);if(t.clearErrors(),!d.success){const v=d.error.flatten().fieldErrors;Object.keys(v).forEach(g=>{t.setError(g,v[g][0])})}return d.success},[t,h]),_=u.useCallback(()=>{const d=h.safeParse(c.data);if(c.clearErrors(),!d.success){const v=d.error.flatten().fieldErrors;Object.keys(v).forEach(g=>{c.setError(g,v[g][0])})}return d.success},[c,h]),$=u.useCallback(async()=>{var q,F,M,B;const d=Array.isArray(t.data)&&t.data.length>0,v=Array.isArray(c.data)&&c.data.length>0;let g=!1,L=!1;j(!0),A(!1);const O={updated:[],created:[]};try{if(d)if(g=f(),g){const R=await axios.put(S.update,{horarios:t.data});(q=R.data)!=null&&q.horarios&&O.updated.push(...R.data.horarios)}else console.warn(" Edición inválida, no se envía.");if(v)if(L=_(),L){const R=await axios.post(S.store,{horarios:c.data});(F=R.data)!=null&&F.horarios&&O.created.push(...R.data.horarios)}else console.warn(" Creación inválida, no se envía.");g||L?(X.success("Horarios actualizados y/o creados con éxito."),o(!1),t.clearErrors(),c.clearErrors(),m&&m(),N({...y,...O})):console.warn(" Ningún formulario fue válido. No se hizo ninguna petición.")}catch(R){if(A(!0),(B=(M=R.response)==null?void 0:M.data)!=null&&B.errors){const{errors:W}=R.response.data;Object.keys(W).forEach(J=>{t.setError(J,W[J][0]),c.setError(J,W[J][0])})}X.error("Error al guardar los horarios.")}finally{j(!1)}},[t,c,S.update,S.store,f,_,o,m,N]),P=u.useMemo(()=>({modelAlias:n,model:s,error:C,form:t,formNewHorarios:c,data:r,contratos:b,updateForm:i,handleSubmit:$,setError:A,onOpenChange:o,isProcessing:E,isLoading:U,isSaving:x,setIsProcessing:w,updateFormNewHorarios:p,onDelete:k}),[n,s,C,t,c,r,b,i,$,o,E,U,x,p,k]);return e.jsx(me.Provider,{value:P,children:a})};function K(){const a=u.useContext(me);if(!a)throw new Error("useDialogData debe usarse dentro de DialogDataContextProvider");return a}function cs(){return u.useMemo(()=>[qe,{id:"empleado",title:"Nombre completo",enableHiding:!1,enableSorting:!0,sortUndefined:"last",enableFiltering:!0,header:({column:s})=>e.jsx(Re,{column:s,className:"max-w-[250px]"}),cell:({row:s})=>e.jsx(De,{children:e.jsxs(Oe,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs("div",{className:"flex flex-row gap-2 pb-2",children:[e.jsx("div",{className:"inline-block min-w-6 w-6 min-h-6 h-6 rounded-lg",style:{backgroundColor:s.original.color}}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("p",{children:s.original.nombre}),e.jsxs("span",{className:"flex flex-row items-center gap-1 text-xs p-1 px-2 rounded-full bg-custom-gray-default dark:bg-custom-blackLight w-fit",children:[e.jsx(D,{name:"Clock",size:"16"}),s.original.horaInicio," ",e.jsx(D,{name:"ArrowRight",className:"w-3"})," ",s.original.horaFin]})]})]})}),e.jsx(Me,{children:e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsxs("section",{className:"flex flex-row items-center gap-2 text-sm",children:[e.jsx("div",{className:"inline-block min-w-4 w-4 min-h-4 h-4 rounded-sm",style:{backgroundColor:s.original.color}}),e.jsx("p",{children:s.original.nombre})]}),e.jsxs("section",{className:"flex flex-row items-center gap-2 text-sm",children:[e.jsx(D,{name:"Clock",size:"16",className:"text-custom-orange"}),s.original.horaInicio," ",e.jsx(D,{name:"ArrowRight",className:"w-3"})," ",s.original.horaFin]}),e.jsxs("span",{className:"flex flex-row gap-2 text-sm",children:[e.jsx(D,{name:"Building",size:"16",className:"text-custom-orange"}),s.original.centro.nombre," - ",e.jsx("span",{className:"font-bold",children:s.original.centro.empresa.nombre})]})]})})]})}),accessorFn:s=>`${s.primerApellido} ${s.segundoApellido}, ${s.nombre}`,filterFn:(s,o,l)=>{if(!l.length)return!0;const m=s.getValue(o);return l.some(n=>m.toLowerCase().includes(n.toLowerCase()))}},{id:"centro",title:"Centro",enableHiding:!0,enableSorting:!0,sortUndefined:"last",enableFiltering:!0,hideColumn:!0,header:({column:s})=>e.jsx(ie,{column:s,className:"max-w-[250px]"},`filter${s.id}`),cell:({row:s})=>s.original.centro.nombre,accessorFn:s=>s.centro.nombre,filterFn:(s,o,l)=>{if(!l.length)return!0;const m=s.getValue(o);return l.some(n=>m.toLowerCase().includes(n.toLowerCase()))}},{id:"centro.empresa",title:"Empresa",enableHiding:!0,enableSorting:!0,sortUndefined:"last",enableFiltering:!0,hideColumn:!0,header:({column:s})=>e.jsx(ie,{column:s,className:"max-w-[250px]"},`filter${s.id}`),cell:({row:s})=>s.original.centro.empresa.nombre,accessorFn:s=>s.centro.empresa.nombre,filterFn:(s,o,l)=>{if(!l.length)return!0;const m=s.getValue(o);return l.some(n=>m.toLowerCase().includes(n.toLowerCase()))}},Ve],[])}function ds({defaultValue:a=null,onChangeValue:s=()=>{},enableCreateUpdateView:o=!1,enableSheetTableView:l=!1,handleResponse:m=()=>{}}){return e.jsx(Ue,{defaultValue:a,onChangeValue:s,renderSelection:n=>e.jsxs("span",{className:"flex items-center",children:[e.jsx("div",{className:"inline-block w-4 h-4 mr-2 rounded-full",style:{backgroundColor:n.color}}),n.nombre]}),fetchUrl:route("api.v1.admin.turnos.index"),dataKey:"turnos",columns:cs(),enableCreateUpdateView:o,enableSheetTableView:l,CreateUpdateViewComponent:Be,cacheDuration:2*60*10,handleResponse:m})}function ms({contratos:a,handleChange:s,id:o}){const[l,m]=u.useState("");return e.jsxs("span",{className:" font-bold",children:["Contrato ",e.jsx("span",{className:"text-custom-orange",children:"*"}),e.jsx("div",{className:"w-full",children:e.jsxs(Ge,{value:l,disabled:!1,onValueChange:n=>{m(n),s(o,{contrato_id:n})},children:[e.jsx(Ke,{className:"rounded-full dark:text-custom-gray-semiLight bg-custom-gray-default dark:bg-custom-blackSemi",children:e.jsx(Xe,{placeholder:"Contrato"})}),e.jsx(Je,{className:"bg-custom-gray-default dark:bg-custom-blackSemi",children:a.map(n=>e.jsx(Ye,{value:n.id,children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:n.asignacion.nombre}),e.jsx("p",{className:"text-xs text-muted-foreground",children:n.n_expediente})]})},n.id))})]})})]})}function de({id:a,localData:s,errors:o,handleChange:l,handleDelete:m=null,date:n,contratos:r}){var x,j,S,t,c,h,b,T;const[y,N]=u.useState(!!(s!=null&&s.descanso_fin)),[k,E]=u.useState({});u.useEffect(()=>{(r==null?void 0:r.length)===1&&l(a,{contrato_id:r[0].id})},[a]);const w=i=>{if(i instanceof Date){const p=i.getHours().toString().padStart(2,"0"),f=i.getMinutes().toString().padStart(2,"0");return`${p}:${f}`}return i},C=(i,p)=>{if(!n||!p)return l(a,{[i]:null});const f=w(p),_=`${n} ${f}:00`;l(a,{[i]:_})},A=(i,p)=>{if(!i||!p)return!1;const f=new Date(`${n} ${i}:00`),_=new Date(`${n} ${p}:00`);return f<_},U=(i,p,f)=>{if(!i||!p||!f)return!1;const _=new Date(`${n} ${i}:00`),$=new Date(`${n} ${p}:00`),P=new Date(`${n} ${f}:00`);return $<_&&_<P},I=i=>{const p=k;E(i),i!=null&&i.descansoInicio&&(i!=null&&i.descansoFin)&&N(!0),i!==p&&l(a,{horario_inicio:`${n} ${i==null?void 0:i.horaInicio}`||"",horario_fin:`${n} ${i==null?void 0:i.horaFin}`||"",descanso_inicio:`${n} ${i==null?void 0:i.descansoInicio}`||"",descanso_fin:`${n} ${i==null?void 0:i.descansoFin}`||""})};return e.jsxs("div",{className:"relative grid grid-cols-4 gap-4",children:[r&&r.length>1&&e.jsx("div",{className:"flex flex-col justify-center col-span-2 gap-2",children:e.jsx(ms,{contratos:r,handleChange:l,id:a})}),e.jsxs("div",{className:`flex flex-col gap-0 ${r&&r.length>1?"col-span-2":"col-span-4"}`,children:[e.jsxs("span",{className:"font-bold text-custom-blue dark:text-custom-gray-default",children:["Turno ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(ds,{defaultValue:(s==null?void 0:s.turno_id)||null,onChangeValue:i=>l(a,{turno_id:parseInt(i,10)}),enableCreateUpdateView:!0,handleResponse:i=>I(i)}),o.modalidad_id&&e.jsx("span",{className:"text-red-500 text-sm",children:o.modalidad_id})]}),e.jsxs("div",{className:"flex flex-col col-span-2 gap-2",children:[e.jsxs("span",{className:"font-bold text-custom-blue dark:text-custom-gray-default",children:["Modalidad ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(Pe,{fetchRoute:"api.v1.admin.modalidades.index",responseParameter:"modalidades",value:(s==null?void 0:s.modalidad_id)||null,onValueChange:i=>l(a,{modalidad_id:parseInt(i,10)}),disabled:!1}),o.modalidad_id&&e.jsx("span",{className:"text-red-500 text-sm",children:o.modalidad_id})]}),e.jsxs("div",{className:"flex flex-col col-span-1 gap-2",children:[e.jsxs("span",{className:"font-bold text-custom-blue dark:text-custom-gray-default",children:["Hora de inicio ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(Y,{value:((j=(x=s==null?void 0:s.horario_inicio)==null?void 0:x.split(" ")[1])==null?void 0:j.slice(0,5))||"",onChange:i=>C("horario_inicio",i),placeholder:"HH:mm",className:"w-full",outputFormat:"string"}),o.horario_inicio&&e.jsx("span",{className:"text-red-500 text-sm",children:o.horario_inicio})]}),e.jsxs("div",{className:"flex flex-col col-span-1 gap-2",children:[e.jsxs("span",{className:"font-bold text-custom-blue dark:text-custom-gray-default",children:["Hora de fin ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(Y,{value:((t=(S=s==null?void 0:s.horario_fin)==null?void 0:S.split(" ")[1])==null?void 0:t.slice(0,5))||"",onChange:i=>{var f;const p=w(i);A((f=s==null?void 0:s.horario_inicio)==null?void 0:f.split(" ")[1],p)&&C("horario_fin",i)},placeholder:"HH:mm",className:"w-full",outputFormat:"string"}),o.horario_fin&&e.jsx("span",{className:"text-red-500 text-sm",children:o.horario_fin})]}),y?e.jsxs("div",{className:"flex flex-row col-span-4 gap-4 px-2 py-4 rounded-xl",children:[e.jsxs("div",{className:"flex flex-col w-full gap-2",children:[e.jsx("span",{className:"font-bold text-custom-blue dark:text-custom-gray-default",children:"Inicio de descanso"}),e.jsx(Y,{value:((h=(c=s==null?void 0:s.descanso_inicio)==null?void 0:c.split(" ")[1])==null?void 0:h.slice(0,5))||"",onChange:i=>{var $,P;const p=w(i),f=($=s==null?void 0:s.horario_inicio)==null?void 0:$.split(" ")[1],_=(P=s==null?void 0:s.horario_fin)==null?void 0:P.split(" ")[1];U(p,f,_)&&C("descanso_inicio",i)},placeholder:"HH:mm",className:"w-full",outputFormat:"string"}),o.descanso_inicio&&e.jsx("span",{className:"text-red-500 text-sm",children:o.descanso_inicio})]}),e.jsxs("div",{className:"flex flex-col w-full gap-2",children:[e.jsx("span",{className:"font-bold text-custom-blue dark:text-custom-gray-default",children:"Fin de descanso"}),e.jsx(Y,{value:((T=(b=s==null?void 0:s.descanso_fin)==null?void 0:b.split(" ")[1])==null?void 0:T.slice(0,5))||"",onChange:i=>{var $,P,d;const p=w(i);($=s==null?void 0:s.horario_inicio)==null||$.split(" ")[1];const f=(P=s==null?void 0:s.horario_fin)==null?void 0:P.split(" ")[1],_=(d=s==null?void 0:s.descanso_inicio)==null?void 0:d.split(" ")[1];U(p,_,f)&&C("descanso_fin",i)},placeholder:"HH:mm",className:"w-full",outputFormat:"string"}),o.descanso_fin&&e.jsx("span",{className:"text-red-500 text-sm",children:o.descanso_fin})]}),e.jsx(V,{className:"aspect-square justify-center self-end",variant:"destructive",size:"icon",onClick:()=>{N(!1),l(a,{descanso_inicio:"",descanso_fin:""})},children:e.jsx(D,{name:"X",className:"w-5 h-5"})})]}):e.jsxs(V,{className:"col-span-4 justify-center",variant:"ghost",onClick:()=>N(!0),children:[e.jsx(D,{name:"Plus",className:"mr-1 w-4 h-4"}),"Añadir descanso"]}),e.jsxs("div",{className:"flex flex-col col-span-4 gap-2",children:[e.jsx("span",{className:"font-bold text-custom-blue dark:text-custom-gray-default",children:"Observaciones"}),e.jsx(Le,{name:"observaciones",value:s==null?void 0:s.observaciones,onChange:i=>l(a,{observaciones:i.target.value}),placeholder:"Observaciones...",className:"bg-custom-gray-default dark:bg-custom-blackSemi border-none rounded-xl p-2 resize-none h-28"}),o.observaciones&&e.jsx("span",{className:"text-red-500 text-sm",children:o.observaciones})]}),m&&e.jsx("div",{className:"absolute -top-5 -right-5",children:e.jsx(V,{variant:"destructive",onClick:()=>m(s==null?void 0:s.id),size:"icon",children:e.jsx(D,{name:"X",className:"w-5 h-5"})})})]})}function us({open:a,onOpenChange:s,model:o,onDelete:l}){const m=ee(o),n=async()=>{try{(await ue.delete(m.delete,{data:{horarios:o}})).status===200&&(l&&l(o),X.success("Registro eliminado correctamente"))}catch(r){console.error("error :>> ",r),X.error("Error al eliminar el registro")}};return e.jsx(ss,{title:(o==null?void 0:o.length)>1?`¿Estás seguro de que quieres eliminar ${o==null?void 0:o.length} horarios?`:"¿Estás seguro de que quieres eliminar este horario?",content:`Esta acción no se puede deshacer. Todos los datos relacionados con ${(o==null?void 0:o.length)>1?"estos "+(o==null?void 0:o.length)+" horarios":"el horario"} se eliminarán.`,open:a,onOpenChange:s,action:n,variant:"destructive",icon:e.jsx(D,{name:"OctagonAlert",className:"w-6 h-6 text-red-500"})})}function ps({}){var S;const{data:a,contratos:s,form:o,updateForm:l,formNewHorarios:m,updateFormNewHorarios:n,onDelete:r}=K(),{data:y,errors:N}=o,[k,E]=u.useState(y),[w,C]=u.useState(a[0]),A=Ie(l,500);u.useEffect(()=>{E(y)},[y]);const U=u.useCallback((t,c)=>{E(h=>h.map(b=>b.id===t?{...b,...c}:b)),Object.keys(c).forEach(h=>{N[h]&&delete N[h]}),A([{id:t,...c}])},[A]),I=u.useCallback(t=>{const c={tempId:Date.now(),contrato_id:"",anexo_id:"",turno_id:null,empleado_id:w.id,fecha:t.date,modalidad_id:null,estado_horario_id:2,horario_inicio:"",horario_fin:"",descanso_inicio:"",descanso_fin:"",observaciones:""};n([c])},[w,n]),x=u.useCallback((t,c)=>{n(h=>Array.isArray(h)?h.map(b=>b.tempId===t||b.id===t?{...b,...c}:b):h)},[n]),j=u.useCallback(t=>{n(c=>{if(Array.isArray(c)){const h=c.findIndex(b=>b.tempId===t||b.id===t);return h>-1?[...c.slice(0,h),...c.slice(h+1)]:c}return c})},[n]);return e.jsxs("div",{className:"flex flex-row gap-4",children:[a.length>1&&e.jsxs("section",{className:"flex flex-col min-w-56 overflow-y-auto dark:dark-scrollbar",children:[e.jsx("span",{className:"bg-custom-gray-default dark:bg-custom-blackSemi p-2 border",children:"Empleados"}),a==null?void 0:a.map(t=>e.jsxs("button",{onClick:()=>C(t),className:`flex flex-row items-center gap-2 p-2 text-sm hover:bg-custom-gray-default dark:hover:bg-custom-gray-semiDark ${t.empleado_id===w.empleado_id?"border-l-2 dark:bg-custom-blackSemi dark:border-custom-gray-semiDark":""}`,children:[e.jsx("img",{src:t.profile_photo_url,alt:t.nombre,className:"flex items-center justify-center h-8 w-8 rounded-full hover:bg-custom-gray-default"}),e.jsx("span",{children:t.nombre})]},t.empleado_id))]}),e.jsx("section",{className:"flex flex-row gap-4 w-full overflow-x-auto dark:dark-scrollbar",children:(S=w==null?void 0:w.fechas)==null?void 0:S.map((t,c)=>{var h,b,T,i,p,f,_,$,P;return e.jsx(Q,{title:Ze(new Date(t.date),"EEEE d 'de' MMMM",{locale:Qe}),className:"min-w-96 min-h-[500px] !p-4",children:e.jsxs("section",{className:"flex flex-col w-full h-full items-center max-h-[620px] overflow-y-auto",children:[!((b=(h=s.disponibilidad)==null?void 0:h[w.empleado_id])!=null&&b[t.date])||((i=(T=s.disponibilidad)==null?void 0:T[w.empleado_id])==null?void 0:i[t.date].length)===0?e.jsxs("section",{className:"flex flex-col w-48 justify-center items-center gap-2 mb-2",children:[e.jsx(D,{name:"AlertTriangle",size:"24"}),e.jsx("span",{children:"No hay contratos"})]}):t.horarios.length===0&&m.data.length===0?e.jsxs("section",{className:"flex flex-row w-full justify-center items-center gap-2 mb-2",children:[e.jsx(D,{name:"Info",size:"16"}),e.jsx("span",{children:"Aun no hay horarios"})]}):null,(f=(p=m.data)==null?void 0:p.filter(d=>d.empleado_id===w.id&&d.fecha===t.date))==null?void 0:f.map((d,v)=>{var g,L;return e.jsx(Q,{className:"min-w-[650px] mt-4",children:e.jsx(de,{id:d.tempId,localData:d,errors:m.errors,handleChange:(O,q)=>x(O,q),handleDelete:O=>j(O),date:t.date,contratos:(L=(g=s==null?void 0:s.disponibilidad)==null?void 0:g[w.empleado_id])==null?void 0:L[t.date]})},d.tempId||v)}),t.horarios&&t.horarios.length>0&&t.horarios.map(d=>e.jsx(Q,{className:"min-w-[650px] mt-4",children:e.jsx(de,{id:d.horarioId,localData:Array.isArray(k)?k.find(v=>v.id===d.horarioId):k,errors:N,handleChange:(v,g)=>U(v,g),date:t.date})})),((P=($=(_=s.disponibilidad)==null?void 0:_[w.empleado_id])==null?void 0:$[t.date])==null?void 0:P.length)>0&&e.jsxs(V,{className:"w-fit",onClick:()=>I(t),children:[e.jsx(D,{name:"Plus",size:"16",className:"mr-2"}),"Añadir nuevo Horario"]})]},c)})})})]})}function xs(){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col w-full gap-12 bg-custom-white dark:bg-custom-blackLight p-4",children:[e.jsx("div",{className:"flex flex-col gap-4 dark:dark-scrollbar",children:e.jsx(H,{className:"h-8 w-[350px]"})}),e.jsxs("div",{className:"flex flex-row w-full gap-4 overflow-y-auto dark:dark-scrollbar",children:[e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(H,{className:"h-8 w-[250px]"}),e.jsx(H,{className:"h-12 w-full"})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(H,{className:"h-8 w-[250px]"}),e.jsx(H,{className:"h-12 w-full"})]})]}),e.jsx(H,{className:"h-1 w-full"}),e.jsxs("div",{className:"flex flex-row w-full gap-4 overflow-y-auto dark:dark-scrollbar",children:[e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(H,{className:"h-8 w-[250px]"}),e.jsx(H,{className:"h-12 w-full"})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(H,{className:"h-8 w-[250px]"}),e.jsx(H,{className:"h-12 w-full"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 p-4",children:[e.jsx(H,{className:"h-10 w-24"}),e.jsx(H,{className:"h-10 w-24"})]})]})}function fs(){const{model:a,handleSubmit:s,onOpenChange:o,isSaving:l}=K();return e.jsxs(Ce,{children:[e.jsx("div",{className:"flex flex-row w-full items-center justify-between",children:e.jsxs("div",{className:"flex items-center ml-auto justify-end gap-2",children:[e.jsx(V,{variant:"secondary",onClick:()=>o(!1),disabled:l,children:"Cancelar"}),e.jsx(V,{variant:"primary",onClick:()=>s(),disabled:l,children:"Guardar"})]})}),l&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center gap-2",children:[e.jsx(We,{size:"sm",className:"text-custom-orange"}),e.jsxs("span",{className:"text-md",children:["Guardando...","..."]})]})]})}function hs(){const{modelAlias:a,model:s}=K(),o=u.useMemo(()=>s?`Actualizar ${a}`:`Crear ${a}`,[s]);return e.jsxs(Se,{children:[e.jsx(Te,{className:"dark:text-custom-white",children:o}),e.jsx(Ee,{className:"hidden",children:o})]})}const gs=()=>{const{error:a}=K();return a?e.jsxs("div",{className:"mt-4 mb-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-300 p-3 rounded-md flex items-start gap-2 animate-in fade-in slide-in-from-top-3 duration-300",children:[e.jsx(es,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Ha ocurrido un error"}),e.jsx("p",{className:"text-sm",children:"No se pudo procesar la solicitud. Por favor, inténtalo de nuevo."})]})]}):null};function bs({children:a}){const{isSaving:s}=K();return e.jsxs("div",{className:`flex flex-col gap-4 h-full overflow-y-auto p-4 dark:dark-scrollbar transition-opacity duration-200 ${s?"opacity-60":"opacity-100"}`,children:[e.jsx(gs,{}),a]})}function js(){const{isLoading:a}=K();return e.jsx(Ae,{className:"flex flex-col gap-4 justify-between w-fit sm:min-w-[800px] sm:max-w-[1500px] sm:max-h-[900px] bg-custom-white dark:bg-custom-blackLight",children:a?e.jsx(xs,{}):e.jsxs(e.Fragment,{children:[e.jsx(hs,{}),e.jsx(bs,{children:e.jsx(ps,{})}),e.jsx(fs,{})]})})}const Ns=u.memo(function({open:s,onOpenChange:o,model:l=null,onSaveData:m=null,data:n,dataForUpdate:r,setDataForUpdate:y,onDelete:N}){return e.jsx($e,{open:s,onOpenChange:o,children:e.jsx(ls,{model:l,onSaveData:m,onOpenChange:o,modelAlias:"Horario",dataKey:"horario",data:n,dataForUpdate:r,setDataForUpdate:y,onDelete:N,children:e.jsx(js,{})})})});function sa({}){const{horarios:a,setHorarios:s,loading:o}=ge(),l=be(),m=fe(),[n,r]=u.useState({updated:[],created:[]});u.useEffect(()=>{if(!n)return;const{updated:x,created:j}=n;!(x!=null&&x.length)&&!(j!=null&&j.length)||s(S=>{const t=[...S],c=(h,b)=>{b.forEach(T=>{var g;const i=(g=T.empleado)==null?void 0:g.id,p=T.fecha_inicio,f=T.id;if(!i||!p)return;const _=t.findIndex(L=>{var O;return((O=L.empleado)==null?void 0:O.id)===i});if(_===-1)return;const $={...t[_]},P={...$.horarios},d=[...P[p]??[]],v=d.findIndex(L=>L.id===f);h==="updated"&&v!==-1?d[v]={...d[v],...T}:h==="created"&&d.push({...T}),P[p]=d,$.horarios=P,t[_]=$})};return Array.isArray(x)&&c("updated",x),Array.isArray(j)&&c("created",j),t})},[n]);const[y,N]=u.useState(null),[k,E]=u.useState(null),[w,C]=u.useState([]),A=(k==null?void 0:k.filter(x=>x.horarioId!==null).map(x=>x.horarioId))??[];if(o)return e.jsx(pe,{rows:10,columns:6});const U=x=>{const j=new Map;return x==null||x.forEach(({key:S,horarioId:t,empleado:c,date:h})=>{const{id:b,nombre:T,profile_photo_url:i}=c;j.has(b)||j.set(b,{empleado_id:b,nombre:T,profile_photo_url:i,fechas:[]});const p=j.get(b);let f=p.fechas.find(_=>_.date===h);f||(f={date:h,horarios:[]},p.fechas.push(f)),t&&(f.horarios.some($=>$.horarioId===t)||f.horarios.push({key:S,horarioId:t}))}),Array.from(j.values())},I=(x=[])=>{if(!Array.isArray(x)||x.length===0)return;const j=a.map(S=>{const t={};return Object.entries(S.horarios).forEach(([c,h])=>{const b=h.filter(T=>!x.includes(T.id));b.length>0&&(t[c]=b)}),{...S,horarios:t}});s(j)};return e.jsxs(e.Fragment,{children:[e.jsx(he,{data:a,columnsDef:m,debug:!1,entity:"horarios",config:{getRowId:x=>x.empleado.id},initialState:{},viewContext:l,customToolbar:je,children:e.jsx(Q,{title:"Horarios Administración",children:e.jsx(Ne,{setSheetTable:N,setDialog:E,setDeleteHorarios:C,children:e.jsx(xe,{})})})},a.length),e.jsx(ts,{open:y!==null,onOpenChange:()=>N(null),model:y}),e.jsx(Ns,{open:k!==null,onOpenChange:()=>E(null),data:U(k),model:A,dataForUpdate:n,setDataForUpdate:r,onDelete:I}),e.jsx(us,{open:w.length>0,onOpenChange:()=>C([]),model:w,onDelete:I})]})}export{sa as default};
