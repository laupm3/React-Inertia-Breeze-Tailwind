import{r as g,j as e}from"./app-fwyInB3c.js";import{u as V}from"./sidebar-CPh6C6LB.js";import{I as i}from"./LucideIcon-CEqEhMjI.js";import{T as W,a as L,b as O,c as U}from"./tooltip-DFfoxvAF.js";import{D as q,b as J,c as B,d as K,e as Q,f as X}from"./dialog-iaZkf6Xy.js";import{F as Y,i as Z,a as R,b as I}from"./index-uaNH1BE9.js";import{i as v}from"./index-CePWpK7c.js";import E from"./SkeletonHorario-BeVelAWG.js";import{f as m}from"./format-Be40hyfq.js";import{e as x}from"./es-DNLwfvrq.js";import"./index-DloWbRVd.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./button-Blwr-A5N.js";import"./input-CqlBlYgU.js";import"./separator-BWKairMX.js";import"./index-BIJodELy.js";import"./sheet-DHc5Hgr8.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-B7srb2QZ.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./skeleton-DSiYFg9q.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./index-CeuhGnKJ.js";import"./constants-BKFt95HM.js";import"./toDate-qOSwr3PX.js";function qe({type:h,events:w=null}){var M,D,C,S,T;const{isMobile:d}=V(),u=g.useRef(null),[s,b]=g.useState(null),[o,P]=g.useState({from:"",to:""}),$=t=>{const r=t.startStr.split("T")[0],a=new Date(t.endStr.split("T")[0]);a.setDate(a.getDate()-1);const l=a.toISOString().split("T")[0];P({from:r,to:l})};g.useEffect(()=>{!u.current||!h||queueMicrotask(()=>{const t=u.current.getApi(),a=d?"listWeek":{day:"timeGridDay",week:"timeGridWeek",month:"dayGridMonth"}[h]??"timeGridWeek";t.view.type!==a&&t.changeView(a)})},[d,h]);const A=t=>(Array.isArray(t)?t:[]).filter(r=>r.fecha_inicio&&r.hora_inicio).map(r=>{var c,f,j;const a=`${r.fecha_inicio}T${r.hora_inicio}`,[l,p]=r.hora_inicio.split(":"),n=new Date(r.fecha_inicio);return n.setHours(+l+1,+p),{id:r.id,title:r.nombre??"Sin título",start:a,end:n.toISOString(),backgroundColor:((c=r.tipo_evento)==null?void 0:c.color)??"#888",extendedProps:{image:r.imagen,day:r.fecha_inicio,time:r.hora_inicio,rawDescription:r.descripcion,creator:((f=r.creador)==null?void 0:f.name)??"Desconocido",type:((j=r.tipo_evento)==null?void 0:j.nombre)??"N/A",users:r.users??[],canManage:r.can_manage??!1}}}),_=t=>t.length===0?{start:21600,end:79200}:t.reduce((r,a)=>{const l=new Date(a.start),p=new Date(a.end),n=l.getHours()*3600,c=(p.getHours()+1)*3600;return{start:r.start===void 0?n:Math.min(r.start,n),end:r.end===void 0?c:Math.max(r.end,c)}},{}),k=t=>{const r=String(Math.floor(t/3600)).padStart(2,"0"),a=String(Math.floor(t%3600/60)).padStart(2,"0");return`${r}:${a}:00`},z=t=>{const r=t.view.type==="timeGridDay",a=t.view.type==="timeGridWeek",l=t.view.type==="dayGridMonth";return e.jsx("section",{onClick:()=>b(t.event),className:`flex flex-col w-full bg-custom-gray-default dark:bg-custom-blackSemi shadow-md shadow-custom-black/15 dark:shadow-custom-black/80 rounded-2xl p-2 items-start overflow-hidden text-ellipsis cursor-pointer hover:shadow-sm duration-300 ${d&&"max-w-32"}`,children:r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row w-full",children:[e.jsx("div",{className:"flex flex-row items-center",children:e.jsxs("div",{className:"flex flex-row items-center",children:[e.jsx("div",{className:"mi-w-4 w-4 min-h-4 h-4 rounded-full mr-2",style:{backgroundColor:t.event.backgroundColor}}),e.jsx("p",{className:"text-custom-black dark:text-custom-white font-bold text-nowrap",style:{color:t.event.backgroundColor},children:t.event.title})]})}),e.jsxs("div",{className:"flex flex-col gap-1 ml-auto text-custom-orange p-1",children:[e.jsxs("div",{className:"flex flex-row items-center gap-1",children:[e.jsx(i,{name:"Calendar",size:"12"}),e.jsx("p",{className:"text-custom-black dark:text-custom-white text-xs",children:m(new Date(t.event.extendedProps.day),"dd MMM yyyy",{locale:x})})]}),e.jsxs("div",{className:"flex flex-row items-center gap-1",children:[e.jsx(i,{name:"Clock",size:"12"}),e.jsx("p",{className:"text-custom-black dark:text-custom-white text-xs",children:t.event.extendedProps.time})]})]})]}),e.jsxs("div",{className:"flex flex-row items-center gap-1 mt-2 pb-1",children:[e.jsx(i,{name:"User",size:"16",className:"text-custom-orange"}),e.jsx("p",{className:"text-custom-black dark:text-custom-white text-xs",children:t.event.extendedProps.creator})]})]}):a||l||d?e.jsxs("div",{className:"flex flex-row w-full items-center",children:[e.jsx("div",{className:"w-4 h-4 min-w-4 min-h-4 rounded-full mr-2",style:{backgroundColor:t.event.backgroundColor}}),e.jsx("p",{className:"text-custom-black dark:text-custom-white font-bold text-sm truncate whitespace-nowrap overflow-hidden",children:t.event.title})]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{name:"AlertTriangle",size:"16"}),e.jsx("p",{className:"font-bold",children:"Ha ocurrido un error"})]})})},y=A(w),N=_(y),H=()=>{var t;return(t=u.current)==null?void 0:t.getApi().today()},F=()=>{var t;return(t=u.current)==null?void 0:t.getApi().prev()},G=()=>{var t;return(t=u.current)==null?void 0:t.getApi().next()};return e.jsxs(e.Fragment,{children:[!w&&e.jsx(E,{}),(o==null?void 0:o.from)&&(o==null?void 0:o.to)&&d&&e.jsxs("div",{className:"flex flex-row mb-2 items-center w-fit text-sm px-4 py-2 gap-4 rounded-full font-medium bg-custom-gray-default dark:bg-custom-blackSemi text-custom-black dark:text-custom-white",children:[e.jsx("button",{onClick:F,className:"flex items-center justify-center w-6 h-6 mr-2 rounded-full hover:bg-custom-gray-light dark:hover:bg-custom-blackLight",children:e.jsx(i,{name:"ChevronLeft",size:"24"})}),e.jsx("button",{onClick:H,className:"flex flex-row items-center",children:h==="day"?m(new Date(o.from),"d MMMM",{locale:x}):`${m(new Date(o.from),"d MMMM",{locale:x})} - ${m(new Date(o.to),"d MMMM",{locale:x})}`}),e.jsx("button",{onClick:G,className:"flex items-center justify-center w-6 h-6 ml-2 rounded-full hover:bg-custom-gray-light dark:hover:bg-custom-blackLight",children:e.jsx(i,{name:"ChevronRight",size:"24"})})]}),e.jsx("section",{className:`${w?"":"hidden"}`,children:e.jsx(Y,{ref:u,showNonCurrentDates:!0,dayMaxEventRows:!0,locale:"es",plugins:[Z,R,I,v],initialView:d?"listWeek":"timeGridWeek",headerToolbar:{left:`${d?"":"prev today next"}`,center:"",right:""},editable:!1,selectable:!1,events:y,datesSet:$,eventContent:z,allDaySlot:!1,slotMinTime:k(N.start),slotMaxTime:k(N.end),scrollTime:"00:00:00",slotLabelFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},firstDay:1,buttonText:{today:o!=null&&o.from&&(o!=null&&o.to)?h==="day"?m(new Date(o.from),"d MMMM",{locale:x}):`${m(new Date(o.from),"d MMMM",{locale:x})} - ${m(new Date(o.to),"d MMMM",{locale:x})}`:"",month:"Mes",week:"Semana",list:"Lista"}})}),e.jsx(q,{open:s!==null,onOpenChange:()=>b(null),children:e.jsxs(J,{className:"bg-custom-white dark:bg-custom-blackLight",children:[e.jsxs(B,{children:[e.jsxs(K,{className:"flex flex-row",children:[e.jsx("div",{className:"w-4 h-4 min-w-4 min-h-4 rounded-full mr-2",style:{backgroundColor:s==null?void 0:s.backgroundColor}}),s==null?void 0:s.title]}),e.jsx(Q,{className:"hidden",children:s==null?void 0:s.title})]}),e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsxs("div",{className:"flex flex-row items-center gap-1 rounded-full px-2 py-1 bg-custom-gray-default dark:bg-custom-blackSemi",children:[e.jsx(i,{name:"Calendar",size:"16",className:"text-custom-orange"}),(M=s==null?void 0:s.extendedProps)==null?void 0:M.day]}),e.jsxs("div",{className:"flex flex-row items-center gap-1 rounded-full px-2 py-1 bg-custom-gray-default dark:bg-custom-blackSemi",children:[e.jsx(i,{name:"Clock",size:"16",className:"text-custom-orange"}),(D=s==null?void 0:s.extendedProps)==null?void 0:D.time]}),e.jsxs("div",{className:"flex flex-row items-center gap-1 rounded-full px-2 py-1 bg-custom-gray-default dark:bg-custom-blackSemi",style:{backgroundColor:`${s==null?void 0:s.backgroundColor}50`},children:[e.jsx("div",{className:"mi-w-4 w-4 min-h-4 h-4 rounded-full",style:{backgroundColor:s==null?void 0:s.backgroundColor}}),(C=s==null?void 0:s.extendedProps)==null?void 0:C.type]})]}),e.jsx("div",{className:"mt-4 text-sm",children:e.jsx("div",{className:"felx flex-col bg-custom-gray-default dark:bg-custom-blackSemi py-2 px-4 rounded-xl",children:(()=>{var t,r,a,l,p,n,c;try{const f=JSON.parse(((t=s==null?void 0:s.extendedProps)==null?void 0:t.rawDescription)??"{}");return((c=(n=(p=(l=(a=(r=Object.values(f))==null?void 0:r[0])==null?void 0:a.value)==null?void 0:l[0])==null?void 0:p.children)==null?void 0:n[0])==null?void 0:c.text)??"Sin descripción"}catch{return"Descripción no válida"}})()})}),e.jsx(X,{children:e.jsxs("section",{className:"flex flex-col w-full gap-1 overflow-hidden",children:[((S=s==null?void 0:s.extendedProps)==null?void 0:S.creator)&&e.jsxs("div",{className:"flex flex-row w-full items-center gap-1",children:[e.jsx(i,{name:"User",size:"16",className:"text-custom-orange"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Creador: ",s.extendedProps.creator]})]}),((T=s==null?void 0:s.extendedProps)==null?void 0:T.creator)&&e.jsxs("div",{className:"flex flex-row w-full items-center gap-1",children:[e.jsx(i,{name:"Share2",size:"16",className:"text-custom-orange"}),e.jsx(W,{children:e.jsxs(L,{children:[e.jsx(O,{children:e.jsxs("p",{className:"text-sm text-muted-foreground text-nowrap truncate",children:["Conpartido con: ",s.extendedProps.users.slice(0,3).map(t=>t.name).join(", "),s.extendedProps.users.length>3?"...":""]})}),e.jsx(U,{children:e.jsx("div",{className:"text-xs",children:s.extendedProps.users.map(t=>e.jsx("div",{children:t.name},t.id))})})]})})]})]})})]})})]})}export{qe as default};
