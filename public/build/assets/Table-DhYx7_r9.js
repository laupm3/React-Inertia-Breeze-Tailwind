import{r as d,G as J,j as e,a as H}from"./app-fwyInB3c.js";import{B as q}from"./BlockCard-TCX704se.js";import{I as G}from"./input-CqlBlYgU.js";import{T as Q}from"./textarea-C969rVin.js";import{B as X}from"./Button-CQuYVLGu.js";import{I as g}from"./LucideIcon-CEqEhMjI.js";import{P as Y,a as K,b as D}from"./popover-DaRbHQOK.js";import{C as ee}from"./checkbox-BQT_ir1e.js";import{B as se}from"./button-Blwr-A5N.js";import{toast as v}from"./index-WlsBA3k2.js";import{o as R,c as I,e as te,s as _,n as E,d as C,a as B}from"./types-BZmDMmQb.js";import{D as re}from"./DecisionModal-Dl8siGBG.js";import{S as ae}from"./SheetTable-Cfz8sMya.js";import{T as ne,a as oe,b as ie,c as le}from"./tooltip-DFfoxvAF.js";import{D as ce,b as me,c as de,d as xe,e as ue}from"./dialog-iaZkf6Xy.js";import{D as O,a as F,b as U,c as T}from"./dropdown-menu-bHoOJ61X.js";const pe=()=>R({id:E(B()),name:_().nonempty({message:"El nombre es obligatorio"}),description:_().nonempty({message:"La descripción es obligatoria"}),icon:_().nonempty({message:"El icono es obligatorio"}),bg_color:_().nonempty({message:"El color de fondo es obligatorio"}),icon_color:_().nonempty({message:"El color del icono es obligatorio"}),personal_team:te(),owner:R({id:B(),name:_(),email:_(),profile_photo_url:_(),profile_photo_path:_(),empleado:E(C()),role:E(C()),departamentos:E(I(C())),centros:E(I(C())),asignaciones:E(I(C())),contratos:E(I(C())),membership:E(C())}),users:I(C()),teamInvitations:I(C())}),A={id:null,name:"",description:"",icon:"Box",bg_color:"#16b83a",icon_color:"#ed703b",personal_team:!1,owner:{id:0,name:"",email:"",profile_photo_url:"",profile_photo_path:"",empleado:null,role:null,departamentos:null,centros:null,asignaciones:null,contratos:null,membership:null},users:[],teamInvitations:[]},he=s=>{var a,x,c,r,p,m,u,n,i,f,j,o;return s?{id:s.id||null,name:s.name||"",description:s.description||"",icon:s.icon||"Box",bg_color:s.bg_color||"#16b83a",icon_color:s.icon_color||"#ed703b",personal_team:s.personal_team||!1,owner:{id:((a=s.owner)==null?void 0:a.id)||0,name:((x=s.owner)==null?void 0:x.name)||"",email:((c=s.owner)==null?void 0:c.email)||"",profile_photo_url:((r=s.owner)==null?void 0:r.profile_photo_url)||"",profile_photo_path:((p=s.owner)==null?void 0:p.profile_photo_path)||"",empleado:((m=s.owner)==null?void 0:m.empleado)||null,role:((u=s.owner)==null?void 0:u.role)||null,departamentos:((n=s.owner)==null?void 0:n.departamentos)||null,centros:((i=s.owner)==null?void 0:i.centros)||null,asignaciones:((f=s.owner)==null?void 0:f.asignaciones)||null,contratos:((j=s.owner)==null?void 0:j.contratos)||null,membership:((o=s.owner)==null?void 0:o.membership)||null},users:s.users||[],teamInvitations:s.teamInvitations||[]}:void 0},fe=s=>d.useMemo(()=>({dataKey:"team",show:s?route("api.v1.admin.teams.show",{team:s}):null,store:route("api.v1.admin.teams.store"),update:s?route("api.v1.admin.teams.update",{team:s}):null,delete:s?route("api.v1.admin.teams.destroy",{team:s}):null}),[s]),W=d.createContext(null),Oe=({children:s,model:t,onOpenChange:a,dataKey:x,onSaveData:c=null,modelAlias:r="registro"})=>{const[p,m]=d.useState(!1),[u,n]=d.useState(!1),[i,f]=d.useState(!1),[j,o]=d.useState(!1),h=fe(t),l=J(A),y=pe(),[k,M]=d.useState({});d.useEffect(()=>{const b=async()=>{try{f(!0),n(!1);const w=await axios.get(h.show);w.status===200?l.setData(he(w.data[x]),M(w.data.teamPermissions)):n(!0)}catch(w){console.error("Error al cargar datos:",w),n(!0)}finally{f(!1)}};return l.clearErrors(),t?b():(M({}),l.setData(A),n(!1),f(!1)),()=>{}},[t]);const P=d.useCallback((b,w)=>{if(typeof b=="object"&&w===void 0){l.setData(S=>({...S,...b}));return}l.setData(S=>({...S,[b]:w}))},[l]),N=d.useCallback(()=>{const b=y.safeParse(l.data);if(l.clearErrors(),!b.success){const w=b.error.flatten().fieldErrors;Object.keys(w).forEach(S=>{l.setError(S,w[S][0])})}return b.success},[l,y]),$=d.useCallback(async()=>{try{o(!0),n(!1),l.clearErrors();const b=t?await axios.put(h.update,l.data):await axios.post(h.store,l.data);c&&c(b.data[x]),a&&a(!1),l.clearErrors(),v.success(t?`Registro ${r} actualizado con éxito`:`Registro ${r} creado con éxito`)}catch(b){if(n(!0),console.error(b),b.response&&b.response.data&&b.response.data.errors){const{errors:w}=b.response.data;Object.keys(w).forEach(S=>{l.setError(S,w[S][0])})}v.error(t?`Error al actualizar el ${r}`:`Error al crear el ${r}`)}finally{o(!1)}},[t,h.update,h.store,l,c,a]),z=d.useCallback(()=>{N()&&$()},[N,$]),Z=d.useMemo(()=>({modelAlias:r,model:t,error:u,form:l,permissions:k.permissions,roles:k.availableRoles,updateForm:P,handleSubmit:z,setError:n,onOpenChange:a,isProcessing:p,isLoading:i,isSaving:j,setIsProcessing:m}),[r,t,u,l,k,P,z,a,p,i,j]);return e.jsx(W.Provider,{value:Z,children:s})};function L(){const s=d.useContext(W);if(!s)throw new Error("useDialogData debe usarse dentro de DialogDataContextProvider");return s}function Fe({errors:s,localData:t,handleChange:a}){const{model:x,permissions:c}=L();return e.jsxs(q,{title:"Datos del equipo",className:"w-full",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Nombre del equipo ",e.jsx("span",{className:"text-custom-orange",children:" *"})]}),e.jsx(G,{type:"text",className:"rounded-full border border-gray-300 p-2 dark:bg-custom-blackSemi dark:text-custom-gray-semiLight bg-custom-gray-default w-full",onChange:r=>{a("name",r.target.value)},value:(t==null?void 0:t.name)||"",disabled:x?!(c!=null&&c.canUpdateTeam):!1,placeholder:"Nombre del equipo"}),(s==null?void 0:s.name)&&e.jsx("span",{className:"text-xs text-red-500",children:s.name})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Descripción ",e.jsx("span",{className:"text-custom-orange",children:" *"})]}),e.jsx(Q,{name:"description",value:t==null?void 0:t.description,onChange:r=>a("description",r.target.value),placeholder:"Descripción del equipo",className:"bg-custom-gray-default dark:bg-custom-blackSemi border-none rounded-xl p-2 resize-none h-28 w-full",disabled:x?!(c!=null&&c.canUpdateTeam):!1}),(s==null?void 0:s.description)&&e.jsx("span",{className:"text-xs text-red-500",children:s.description})]})]})}const ge=["Smile","Swords","Banana","Beef","Bone","HandMetal","Brush","Coffee","ChartBar","Send","Zap","Rocket","House","Cookie","CodeXml","Box","Clapperboard","Backpack","Webhook","Lightbulb","Flame"];function Ue({errors:s,localData:t,handleChange:a}){var r,p,m,u;const{model:x,permissions:c}=L();return e.jsxs(q,{title:"Imagen del equipo",className:"w-full",children:[e.jsxs("section",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex flex-col items-center md:items-start gap-4",children:e.jsx("div",{className:"w-24 h-24 sm:w-28 sm:h-28 p-4 rounded-xl mx-auto md:mx-0",style:{backgroundColor:t==null?void 0:t.bg_color},children:e.jsx(g,{name:t==null?void 0:t.icon,className:"w-full h-full",color:t==null?void 0:t.icon_color})})}),((c==null?void 0:c.canUpdateTeam)||!x)&&e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-bold text-custom-blue dark:text-custom-white mb-3 text-center md:text-left",children:"Seleccionar icono"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-6 gap-2",children:ge.map((n,i)=>e.jsx(X,{variant:"ghost",size:"icon",onClick:()=>a("icon",n),className:"w-8 h-8 sm:w-10 sm:h-10",children:e.jsx(g,{name:n,className:`w-5 h-5 sm:w-5 sm:h-5 ${(t==null?void 0:t.icon)===n?"text-custom-orange":"text-custom-gray-semiLight"}`})},i))})}),e.jsxs("div",{className:"flex flex-row md:flex-col gap-4 md:gap-3 justify-center md:justify-start",children:[e.jsxs("div",{className:"flex flex-col items-center md:items-start gap-2",children:[e.jsx("span",{className:"text-xs sm:text-sm font-bold text-custom-blue dark:text-custom-white text-center md:text-left",children:"Color de fondo"}),e.jsx("input",{type:"color",value:t==null?void 0:t.bg_color,onChange:n=>a("bg_color",n.target.value),className:"w-12 h-8 rounded cursor-pointer"})]}),e.jsxs("div",{className:"flex flex-col items-center md:items-start gap-2",children:[e.jsx("span",{className:"text-xs sm:text-sm font-bold text-custom-blue dark:text-custom-white text-center md:text-left",children:"Color de icono"}),e.jsx("input",{type:"color",value:t==null?void 0:t.icon_color,onChange:n=>a("icon_color",n.target.value),className:"w-12 h-8 rounded cursor-pointer"})]})]})]})]})]}),x&&e.jsxs("div",{className:"flex flex-col gap-2 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:"Equipo creado por:"}),e.jsxs("div",{className:"flex flex-row items-center gap-4",children:[e.jsx("img",{className:"w-10 h-10 sm:w-12 sm:h-12 rounded-full",src:(r=t==null?void 0:t.owner)==null?void 0:r.profile_photo_url,alt:(p=t==null?void 0:t.owner)==null?void 0:p.name}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:(m=t==null?void 0:t.owner)==null?void 0:m.name}),e.jsx("span",{className:"text-xs opacity-75",children:(u=t==null?void 0:t.owner)==null?void 0:u.email})]})]})]}),e.jsxs("div",{className:"mt-2",children:[(s==null?void 0:s.icon)&&e.jsx("span",{className:"text-xs text-red-500 block",children:s.icon}),(s==null?void 0:s.icon_color)&&e.jsx("span",{className:"text-xs text-red-500 block",children:s.icon_color}),(s==null?void 0:s.bg_color)&&e.jsx("span",{className:"text-xs text-red-500 block",children:s.bg_color})]})]})}function be({selectedUsers:s,handleChange:t,localData:a}){const[x,c]=d.useState([]),[r,p]=d.useState(null),[m,u]=d.useState(!0),[n,i]=d.useState("");d.useEffect(()=>{(async()=>{var h,l,y;try{const k=await H.get(route("api.v1.admin.users.index"));if(k.status===200){const M=new Set([...(h=a==null?void 0:a.users)==null?void 0:h.map(N=>N.email),...(l=a==null?void 0:a.teamInvitations)==null?void 0:l.map(N=>N.email),(y=a==null?void 0:a.owner)==null?void 0:y.email]),P=k.data.users.filter(N=>!M.has(N.email)).map(N=>({email:N.email,name:N.name,profile_photo_url:N.profile_photo_url}));c(P)}else p(!0)}catch(k){console.error("Error al cargar datos:",k),p(!0)}finally{u(!1)}})()},[a]);const f=o=>{const l=s.some(y=>y.email===o.email)?s.filter(y=>y.email!==o.email):[...s,o];t(l)},j=d.useMemo(()=>{if(!n.trim())return x;const o=n.toLowerCase().trim();return x.filter(({email:h,name:l})=>{const y=h.toLowerCase(),k=l.toLowerCase();return y.includes(o)||k.includes(o)})},[x,n]);return e.jsxs("section",{className:"flex flex-col w-full gap-2",children:[e.jsxs(Y,{modal:!0,children:[e.jsx(K,{asChild:!0,children:e.jsx(se,{variant:"secondary",className:"w-full justify-start text-left rounded-full",children:"Seleccionar empleados"})}),e.jsxs(D,{className:"w-[300px] p-2",children:[m&&e.jsx("p",{className:"text-sm",children:"Cargando..."}),r&&e.jsx("p",{className:"text-sm text-red-500",children:"Error al cargar emails"}),!m&&!r&&e.jsxs("div",{className:"max-h-60 overflow-y-auto dark:dark-scrollbar",children:[e.jsx(G,{type:"search",placeholder:"Buscar",value:n,onChange:o=>i(o.target.value),className:"sticky top-0 px-2 py-1 w-full"}),j.map(o=>{const h=s.some(l=>l.email===o.email);return e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer px-2 py-1 hover:bg-muted rounded",children:[e.jsx(ee,{checked:h,onCheckedChange:()=>f(o),id:`check-${o.email}`}),e.jsxs("span",{className:"text-sm",children:[o.name," (",o.email,")"]})]},o.email)})]})]})]}),s.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:s.map(o=>e.jsxs("div",{className:"flex items-center rounded-full bg-custom-orange px-2 py-1 text-sm text-custom-white cursor-pointer",onClick:()=>f(o),children:[o.name,e.jsx(g,{name:"Trash",size:"16",className:"ml-2"})]},o.email))})]})}function Ae({errors:s,localData:t}){const{model:a,updateForm:x,permissions:c}=L(),[r,p]=d.useState([]),[m,u]=d.useState(!1),n=d.useCallback(async()=>{var i,f,j,o;if(!r.length){v.error("Seleccione al menos un usuario para invitar");return}if(!a){v.error("Debe guardar el equipo antes de invitar miembros");return}try{u(!0);const h=await H.post(`/api/v1/teams/${a}/members`,{emails:r.map(l=>l.email),role:"member"});p([]),x({teamInvitations:h.data.team.teamInvitations,users:h.data.team.users}),v.success(`${r.length} miembro(s) invitado(s) correctamente`)}catch(h){const l=((f=(i=h.response)==null?void 0:i.data)==null?void 0:f.message)||((o=(j=h.response)==null?void 0:j.data)==null?void 0:o.error)||"Error al invitar miembros";v.error(l),console.error("Error invitando miembros:",h)}finally{u(!1)}},[r,a,x]);return c!=null&&c.canAddTeamMembers?e.jsxs(q,{title:"Invitar miembros al equipo",children:[e.jsx("p",{className:"text-sm opacity-80 mb-4",children:'Busque empleados por nombre o correo electrónico para invitarlos al equipo. Los miembros invitados recibirán el rol de "Miembro" por defecto.'}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start gap-4",children:[e.jsx("div",{className:"flex-1 w-full",children:e.jsx(be,{localData:t,selectedUsers:r,handleChange:p})}),e.jsx(X,{variant:"primary",size:"sm",onClick:n,disabled:!r.length||m||!a,className:"whitespace-nowrap w-full sm:w-auto",children:m?e.jsxs(e.Fragment,{children:[e.jsx(g,{name:"Loader",size:"16",className:"mr-2 animate-spin"}),"Invitando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{name:"Plus",size:"16",className:"mr-2"}),"Invitar ",r.length>0&&`(${r.length})`]})})]}),s.responsable_id&&e.jsx("span",{className:"text-xs text-red-500",children:s.responsable_id})]}):null}const V={admin:"bg-orange-300 text-orange-800 dark:bg-orange-900 dark:text-orange-300",member:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",miembro:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",editor:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"},je={member:{label:"Miembro",description:"Puede ver y participar en el equipo",permissions:["Ver información del equipo","Ver miembros","Participar en actividades"],style:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"},editor:{label:"Editor",description:"Puede gestionar contenido y algunos aspectos del equipo",permissions:["Permisos de Miembro","Crear y editar contenido","Gestionar actividades","Invitar nuevos miembros"],style:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"},admin:{label:"Administrador",description:"Control total sobre el equipo excepto su eliminación",permissions:["Permisos de Editor","Gestionar miembros","Asignar roles","Configurar equipo"],style:"bg-orange-300 text-orange-800 dark:bg-orange-900 dark:text-orange-300"}};function we({user:s,open:t,onOpenChange:a,updateMembers:x}){var n;const{roles:c}=L(),[r,p]=d.useState(!1),m=(n=s.membership)==null?void 0:n.team_id,u=async i=>{var f,j,o;if(!m||!s.id){v.error("Error: Información del equipo no disponible");return}p(!0);try{await axios.put(`/api/v1/teams/${m}/members/${s.id}`,{role:i},{headers:{Accept:"application/json","Content-Type":"application/json"}}),v.success("Rol actualizado correctamente"),a(),x("update",{id:s.id,membership:{role:i}})}catch(h){console.error("Error al actualizar rol:",(f=h.response)==null?void 0:f.data),v.error(((o=(j=h.response)==null?void 0:j.data)==null?void 0:o.message)||"Error al actualizar el rol")}finally{p(!1)}};return m?e.jsx(ce,{open:t,onOpenChange:a,children:e.jsxs(me,{className:"sm:max-w-[500px] bg-custom-gray-default dark:bg-custom-blackLight",children:[e.jsxs(de,{children:[e.jsxs(xe,{children:["Editar Rol - ",s.name]}),e.jsx(ue,{children:"Selecciona el rol apropiado según los permisos necesarios"})]}),e.jsx("div",{className:"grid gap-4 py-4",children:c.map(i=>{var f;return e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-custom-gray-light dark:hover:bg-custom-blackSemi cursor-pointer",onClick:()=>!r&&u(i.key),children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`${(f=je[i.key])==null?void 0:f.style} px-2 py-1 text-xs font-medium rounded-full`,children:i.key}),e.jsx("span",{className:"text-sm font-medium",children:i.name})]})}),e.jsx(ne,{children:e.jsxs(oe,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{name:"Info",size:"12"}),e.jsx("span",{className:"text-sm opacity-70 cursor-pointer",children:i.description})]})}),e.jsx(le,{className:"max-w-48 bg-custom-blackSemi",children:e.jsx("div",{className:"pl-4 bg-custom-blackSemi",children:e.jsx("ul",{className:"list-disc text-sm text-gray-500 dark:text-gray-400",children:i.permissions.map((j,o)=>e.jsx("li",{children:j},o))})})})]})})]},i.key)})}),r&&e.jsxs("div",{className:"flex items-center justify-center py-2",children:[e.jsx(g,{name:"Loader",className:"w-4 h-4 animate-spin mr-2"}),e.jsx("span",{children:"Actualizando..."})]})]})}):null}function Ne({user:s,role:t,updateMembers:a,allowEdit:x}){const{model:c,permissions:r}=L(),[p,m]=d.useState(!1),[u,n]=d.useState(!1),[i,f]=d.useState(!1),j=async()=>{var o,h;if(!c||!s.id){v.error("Error: Información del equipo no disponible");return}try{await axios.delete(`/api/v1/teams/${c}/members/${s.id}`),v.success("Miembro eliminado correctamente"),a("delete",[s.id]),f(!1)}catch(l){v.error(((h=(o=l.response)==null?void 0:o.data)==null?void 0:h.message)||"No tienes permisos para eliminar miembros")}};return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"hidden md:flex items-center gap-3 p-2 rounded-lg hover:bg-custom-gray-light dark:hover:bg-custom-blackLight transition-colors",children:[e.jsxs("div",{className:`flex items-center gap-2 ${x?"w-1/4":"w-3/12"} min-w-0`,children:[e.jsx("img",{src:s.profile_photo_url,alt:s.name,className:"w-8 h-8 rounded-full flex-shrink-0"}),e.jsx("span",{className:"text-xs truncate",children:s.name})]}),e.jsx("div",{className:`flex items-center gap-2 ${x?"w-1/4":"w-3/12"} min-w-0`,children:t?e.jsx("div",{className:`flex py-1 px-2 lg:px-3 rounded-full text-xs ${V[t]} truncate`,children:t}):e.jsxs("span",{className:"flex items-center gap-1 text-xs",children:[e.jsx(g,{name:"Plus",size:"14"}),e.jsx("span",{className:"hidden lg:inline",children:"Sin rol"})]})}),e.jsx("div",{className:`flex items-center gap-2 ${x?"w-1/4":"w-6/12"} min-w-0`,children:e.jsx("span",{className:"text-xs truncate",children:s.email})}),x&&e.jsx("div",{className:"flex items-center gap-2 w-1/4 min-w-0 justify-center",children:e.jsxs(O,{children:[e.jsx(F,{asChild:!0,children:e.jsx("button",{className:"flex items-center justify-center gap-2 p-1 hover:bg-custom-gray-default dark:hover:bg-custom-blackSemi rounded",children:e.jsx(g,{name:"Ellipsis",size:"16"})})}),e.jsxs(U,{className:"dark:bg-custom-blackSemi",children:[e.jsxs(T,{onSelect:()=>m(!0),children:[e.jsx(g,{name:"Info",className:"w-4 mr-2"})," Información"]}),(r==null?void 0:r.canUpdateTeamMembers)&&e.jsxs(T,{onSelect:()=>n(!u),children:[e.jsx(g,{name:"UserCog",className:"w-4 mr-2"})," Editar Rol"]}),(r==null?void 0:r.canRemoveTeamMembers)&&e.jsxs(T,{className:"text-red-500 font-bold hover:!bg-red-500/40 hover:!text-red-500",onSelect:()=>f(!0),children:[e.jsx(g,{name:"X",className:"w-4 mr-2"})," Eliminar"]})]})]})})]}),e.jsxs("section",{className:"md:hidden flex flex-col gap-3 p-3 rounded-lg bg-custom-white dark:bg-custom-blackLight",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("img",{src:s.profile_photo_url,alt:s.name,className:"w-10 h-10 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium truncate",children:s.name}),e.jsx("span",{className:"text-xs text-custom-black/70 dark:text-custom-white/70 truncate",children:s.email})]})]}),x&&e.jsx("div",{className:"flex items-center justify-center h-10 ml-2",children:e.jsxs(O,{children:[e.jsx(F,{asChild:!0,children:e.jsx("button",{className:"flex items-center justify-center w-8 h-8 hover:bg-custom-gray-default dark:hover:bg-custom-blackSemi rounded",children:e.jsx(g,{name:"Ellipsis",size:"16"})})}),e.jsxs(U,{className:"dark:bg-custom-blackSemi",children:[e.jsxs(T,{onSelect:()=>m(!0),children:[e.jsx(g,{name:"Info",className:"w-4 mr-2"})," Información"]}),(r==null?void 0:r.canUpdateTeamMembers)&&e.jsxs(T,{onSelect:()=>n(!u),children:[e.jsx(g,{name:"UserCog",className:"w-4 mr-2"})," Editar Rol"]}),(r==null?void 0:r.canRemoveTeamMembers)&&e.jsxs(T,{className:"text-red-500 font-bold hover:!bg-red-500/40 hover:!text-red-500",onSelect:()=>f(!0),children:[e.jsx(g,{name:"X",className:"w-4 mr-2"})," Eliminar"]})]})]})})]}),e.jsx("div",{className:"flex items-center justify-start",children:t?e.jsx("div",{className:`flex py-1 px-3 rounded-full text-xs ${V[t]}`,children:t}):e.jsxs("span",{className:"flex items-center gap-2 text-xs opacity-70",children:[e.jsx(g,{name:"Plus",size:"16"}),"Sin rol"]})})]}),p&&e.jsx(ae,{model:s.id,open:p,onOpenChange:()=>m(!p)}),u&&e.jsx(we,{user:s,open:u,onOpenChange:()=>n(!u),updateMembers:a}),i&&e.jsx(re,{title:"¿Estás seguro de que quieres eliminar este miembro?",content:"Esta acción eliminará al miembro del equipo, pero no eliminará su cuenta de usuario.",open:i,onOpenChange:()=>f(!i),action:j,variant:"destructive",icon:e.jsx(g,{name:"OctagonAlert",className:"w-6 h-6 text-red-500"})})]})}function ve({allowEdit:s}){const{permissions:t}=L();return e.jsxs("div",{className:"hidden sm:flex items-center justify-between px-4 py-2 rounded-t-3xl text-custom-black dark:text-custom-white bg-custom-gray-default dark:bg-custom-blackSemi",children:[e.jsx("div",{className:"w-1/4 min-w-0",children:e.jsx("span",{className:"text-sm font-semibold",children:"Nombre"})}),e.jsx("div",{className:"w-1/4 min-w-0 hidden md:block",children:e.jsx("span",{className:"text-sm font-semibold",children:"Rol"})}),e.jsx("div",{className:`${s?"w-1/4 md:w-1/4":"w-2/4 md:w-2/4"} min-w-0`,children:e.jsx("span",{className:"text-sm font-semibold",children:"Email"})}),s&&e.jsx("div",{className:"w-1/4 min-w-0 flex justify-center",children:e.jsx("span",{className:"text-sm font-semibold",children:"Acciones"})})]})}function Ve({title:s,users:t,allowEdit:a}){const[x,c]=d.useState([]);d.useEffect(()=>{c(t)},[t]);const r=d.useCallback((p,m)=>{c(u=>{switch(p){case"update":return u.map(n=>{var i;return((i=n.user)==null?void 0:i.id)===m.id||n.id===m.id?{...n,...m}:n});case"delete":return u.filter(n=>{var i;return!(m.includes(n.id)||m.includes((i=n.user)==null?void 0:i.id))});case"add":return[...u,...m];default:return u}})},[]);return e.jsx(q,{title:s,children:x.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ve,{allowEdit:a}),e.jsx("div",{className:"flex flex-col gap-2 sm:gap-4 px-2 sm:px-4 max-h-[350px] overflow-y-auto",children:x.map((p,m)=>{var u;return e.jsx(Ne,{user:p.user||p,role:((u=p.membership)==null?void 0:u.role)||p.role,updateMembers:r,allowEdit:a},m)})})]}):e.jsxs("div",{className:"flex items-center gap-2 p-4",children:[e.jsx(g,{name:"AlertTriangle",size:"16"}),e.jsxs("span",{className:"text-sm text-custom-black dark:text-custom-white opacity-70",children:["No hay ",s.toLowerCase()]})]})})}export{Oe as D,Ae as I,Ue as P,Ve as T,Fe as a,fe as b,L as u};
