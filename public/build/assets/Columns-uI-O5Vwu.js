import{r as b,j as e}from"./app-fwyInB3c.js";import"./button-Blwr-A5N.js";import{C as y}from"./Checkbox-DRGhoIDo.js";import{I as f}from"./LucideIcon-CEqEhMjI.js";import{D as k,b as C,c as S,d as v,e as D}from"./dialog-iaZkf6Xy.js";import{V as w}from"./Yoopta-Dj4Guze5.js";import{u as _}from"./useNotifications-CSWGH93r.js";import{toast as m}from"./index-WlsBA3k2.js";import{T as I,a as M,b as A,c as H}from"./tooltip-DFfoxvAF.js";import"./index-DloWbRVd.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./index-BxSEkZvI.js";import"./index-p2DxCSsL.js";import"./index-DmpKZt4E.js";import"./index-4A9uUPu1.js";import"./index-BZgm3BCW.js";import"./index-BZxTbISK.js";import"./index-BIJodELy.js";import"./check-5DjPwM22.js";import"./createLucideIcon-DoJ0Kelj.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./x-2mzC_aTV.js";import"./index-DVo7DTeW.js";import"./index-B7srb2QZ.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./throttle-CmSTFqON.js";import"./index-CLai1W86.js";import"./index-CeuhGnKJ.js";function R({notification:s,onClose:a}){const{markAsRead:i,markAsUnread:r}=_(),[t,l]=b.useState(s),d=h=>new Date(h).toLocaleDateString(),N=h=>new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit"}).format(new Date(h));b.useEffect(()=>{l(s)},[s]);const p=async h=>{h.stopPropagation();try{t.is_read?(await r(t.id),l(j=>({...j,is_read:!1})),m.success("Notificación marcada como no leída")):(await i(t.id),l(j=>({...j,is_read:!0})),m.success("Notificación marcada como leída"))}catch{m.error("Error al cambiar el estado de la notificación")}};return e.jsx(k,{open:!0,onOpenChange:a,children:e.jsxs(C,{className:"bg-custom-white dark:bg-custom-blackSemi p-6 space-y-4 max-w-xl w-full",children:[e.jsxs(S,{className:"space-y-4",children:[e.jsx(v,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("img",{src:t.sender.profile_photo_url,alt:t.sender.name,className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"space-y-1 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-bold text-custom-orange",children:t.sender.name}),e.jsx(I,{children:e.jsxs(M,{children:[e.jsx(A,{asChild:!0,children:e.jsx("button",{onClick:p,className:"text-custom-orange/70 hover:text-custom-orange transition-colors p-1",children:e.jsx(f,{name:t.is_read?"MailOpen":"Mail",className:"w-4 h-4"})})}),e.jsx(H,{children:e.jsx("p",{children:t.is_read?"Marcar como no leída":"Marcar como leída"})})]})})]}),e.jsx("p",{className:"text-base text-custom-gray-darker dark:text-custom-white",children:t.title})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 mr-8",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-custom-gray-default dark:bg-custom-blackSemi rounded-full px-3 py-1",children:[e.jsx(f,{name:"Calendar",className:"w-3.5 h-3.5 text-custom-orange"}),e.jsx("p",{className:"text-xs text-custom-gray-darker dark:text-custom-gray-light",children:d(t.sent_at)})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-custom-gray-default dark:bg-custom-blackSemi rounded-full px-3 py-1",children:[e.jsx(f,{name:"Clock",className:"w-3.5 h-3.5 text-custom-orange"}),e.jsx("p",{className:"text-xs text-custom-gray-darker dark:text-custom-gray-light",children:N(t.sent_at)})]})]})]})}),e.jsxs(D,{className:"sr-only",children:["Detalles de la notificación de ",t.sender.name]})]}),e.jsxs("div",{className:"space-y-4",children:[t.content&&e.jsx("p",{className:"text-custom-gray-darker dark:text-custom-gray-light text-sm bg-custom-gray-default dark:bg-custom-blackLight p-4 rounded-xl",children:t.content}),t.yoopta_content&&e.jsx("div",{className:"w-full dark:dark-scrollbar max-h-[250px] overflow-y-auto",children:e.jsx(w,{value:t.yoopta_content})})]})]})})}const T=s=>{const[a,i]=b.useState(null),[r,t]=b.useState(null),{markAsRead:l,markAsUnread:d,notifications:N,setNotifications:p}=_();return{openModalId:a,localNotification:r,handleNotificationClick:async n=>{if(i(n.id),t(n),!n.is_read)try{await l(n.id,!0)&&(t(c=>c?{...c,is_read:!0}:{...n,is_read:!0}),p(c=>c.map(u=>u.id===n.id?{...u,is_read:!0}:u)),s.original.is_read=!0,m.success("Notificación marcada como leída"))}catch(o){console.error("Error al marcar como leída:",o),m.error("Error al marcar la notificación como leída")}},handleReadStatusToggle:async(n,o)=>{n.stopPropagation();try{let u;o.is_read?(u=await d(o.id,!0),u?(a===o.id&&t(g=>({...g,is_read:!1})),p(g=>g.map(x=>x.id===o.id?{...x,is_read:!1}:x)),o.is_read=!1,m.success("Notificación marcada como no leída")):m.error("Error al marcar la notificación como no leída")):(u=await l(o.id,!0),u?(a===o.id&&t(g=>({...g,is_read:!0})),p(g=>g.map(x=>x.id===o.id?{...x,is_read:!0}:x)),o.is_read=!0,m.success("Notificación marcada como leída")):m.error("Error al marcar la notificación como leída"))}catch(c){console.error("Error al cambiar el estado de lectura:",c),m.error("Error al cambiar el estado de la notificación")}},handleModalClose:()=>{if(r&&a){const n=N.findIndex(o=>o.id===a);n!==-1&&N[n].is_read!==r.is_read&&(p(o=>o.map(c=>c.id===a?{...c,is_read:r.is_read}:c)),s.original.id===a&&(s.original.is_read=r.is_read))}i(null),t(null)}}},E=(s,a)=>e.jsx(y,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:i=>s.toggleAllPageRowsSelected(!!i),"aria-label":a("datatable.selectAll"),className:"border-custom-orange border-2"}),F=(s,a)=>e.jsx(y,{checked:s.getIsSelected(),onCheckedChange:i=>s.toggleSelected(!!i),"aria-label":a("datatable.selectRow"),className:"border-custom-orange border-2"}),P=s=>{const{openModalId:a,localNotification:i,handleNotificationClick:r,handleReadStatusToggle:t,handleModalClose:l}=T(s);return e.jsxs(e.Fragment,{children:[a===s.original.id&&i&&e.jsx(R,{onClose:l,notification:i}),e.jsxs("div",{className:`md:flex justify-between gap-4 p-4 hover:bg-custom-gray-light/50 dark:hover:bg-custom-gray-darker rounded-xl duration-300 cursor-pointer group ${s.original.is_read?"opacity-30":""}`,onClick:()=>r(s.original),children:[e.jsxs("div",{className:"flex items-start gap-4 w-full",children:[e.jsx("div",{children:e.jsx("img",{src:s.original.sender.profile_photo_url,alt:s.original.sender.name,className:"w-8 h-8 rounded-full"})}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("p",{className:"text-xs font-bold text-custom-orange",children:s.original.sender.name}),e.jsx("div",{className:"transition-all duration-700 ease-in-out no-scrollbar",children:e.jsx("p",{className:"text-sm text-justify transition-opacity duration-700 ease-in-out",children:e.jsx("span",{className:"text-base font-bold text-custom-blue dark:text-custom-white",children:s.original.title})})})]})]}),e.jsxs("div",{className:"flex flex-col min-w-32 justify-start mt-2 items-end",children:[e.jsxs("button",{onClick:d=>t(d,s.original),className:`mb-2 text-xs opacity-0 group-hover:opacity-100 flex items-center gap-1 text-custom-orange hover:text-custom-blue transition-opacity ${s.original.is_read?"opacity-100":""}`,title:s.original.is_read?"Marcar como no leído":"Marcar como leído",children:[e.jsx(f,{name:s.original.is_read?"MailOpen":"Mail",size:"14"}),e.jsx("span",{children:s.original.is_read?"No leído":"Leído"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(f,{name:"Calendar",size:"12",className:"mr-2"}),e.jsx("p",{className:"text-xs",children:new Date(s.original.sent_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(f,{name:"Clock",size:"12",className:"mr-2"}),e.jsx("p",{className:"text-xs",children:`${String(new Date(s.original.sent_at).getHours()).padStart(2,"0")}:${String(new Date(s.original.sent_at).getMinutes()).padStart(2,"0")}`})]})]})]},s.original.id)]})},_e=s=>[{id:"selector",header:({table:a})=>E(a,s),cell:({row:a})=>F(a,s),enableSorting:!1,enableHiding:!1},{id:"read_status",accessorFn:a=>({title:a.title,sender:a.sender.name,is_read:a.is_read}),header:({column:a})=>"",cell:({row:a})=>P(a),enableSorting:!1,enableHiding:!1,filterFn:(a,i,r)=>!r||!Array.isArray(r)||r.length===0?!0:r.some(t=>t==="unread"?!a.original.is_read:t==="read"?a.original.is_read:!1)},{accessorKey:"notifiable_model",isHidden:!0,enableHiding:!1,filterFn:(a,i,r)=>!r||!Array.isArray(r)||r.length===0?!0:r.includes(a.original.notifiable_model)},{accessorKey:"action_model",isHidden:!0,enableHiding:!1,filterFn:(a,i,r)=>!r||!Array.isArray(r)||r.length===0?!0:r.includes(a.original.action_model)},{accessorKey:"sender_id",isHidden:!0,enableHiding:!1,filterFn:(a,i,r)=>{var l;if(!r||!Array.isArray(r)||r.length===0)return!0;const t=String((l=a.original.sender)==null?void 0:l.id);return r.some(d=>String(d)===t)}},{accessorKey:"sent_at",isHidden:!0,enableHiding:!1,filterFn:(a,i,r)=>{if(!r||!r.from||!r.to)return!0;const t=new Date(a.original.sent_at),l=new Date(r.from),d=new Date(r.to);return d.setHours(23,59,59,999),t>=l&&t<=d}}];export{_e as columns};
