import{r as i,j as e}from"./app-fwyInB3c.js";import{I as n}from"./LucideIcon-CEqEhMjI.js";import{P as k}from"./Pill-l4GaXyto.js";import{V as w}from"./VacacionesMapColor-BDtfIx91.js";import{C as _,l as C,m as S,n as T}from"./charts-D-b4h_4c.js";import{P as E,a as A}from"./PieChart-DDiBUCNq.js";import"./createLucideIcon-DoJ0Kelj.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./x-2mzC_aTV.js";import"./throttle-CmSTFqON.js";import"./utils-CytzSlOG.js";import"./index-DpIruHMc.js";import"./PolarAngleAxis-CNFzyAg3.js";function F({selectedPermiso:s,empleadoId:l,fechaInicio:d,fechaFin:o}){const[c,j]=i.useState(null),[u,f]=i.useState(!1),[m,g]=i.useState(null),[p,N]=i.useState(!1),y=t=>{if(!t)return[];const a=[];if(t.usage>0){const r=Math.ceil(t.usage/864e5);a.push({name:"Tiempo usado",value:r,color:"#3b82f6",formatted:t.formatted_usage})}if(t.remaining_usage>0){const r=Math.ceil(t.remaining_usage/864e5);a.push({name:"Tiempo restante",value:r,color:"#f97316",formatted:t.remaining_usage_formatted})}return t.usage===0&&t.remaining_usage>0?[{name:"Tiempo disponible",value:Math.ceil(t.remaining_usage/864e5),color:"#22c55e",formatted:t.remaining_usage_formatted||t.max_formatted_duration}]:a},v={used:{label:"Tiempo usado",color:"#3b82f6"},remaining:{label:"Tiempo restante",color:"#f97316"},available:{label:"Tiempo disponible",color:"#22c55e"}},b=i.useCallback(async()=>{if(!(!l||!(s!=null&&s.id)||!d||!o)){f(!0),g(null);try{const t=route("api.v1.admin.empleados.permiso-usage-stats",{empleado:l,permiso:s.id})+`?fecha_inicio=${d}&fecha_fin=${o}`,a=await fetch(t);if(!a.ok)throw new Error(`Error ${a.status}: ${a.statusText}`);const r=await a.json();j(r.stats||null)}catch(t){g(t.message)}finally{f(!1)}}},[l,s==null?void 0:s.id,d,o]);return i.useEffect(()=>{s!=null&&s.id&&l&&d&&o?b():(j(null),g(null))},[b]),!s||!l||!d||!o?null:e.jsxs("div",{className:"mt-3",children:[e.jsxs("button",{type:"button",onClick:()=>N(!p),className:"flex items-center justify-between w-full p-2 text-sm bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-md hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{name:"ChartPie",className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),e.jsx("span",{className:"font-medium text-blue-800 dark:text-blue-200",children:"Estadísticas de Uso"}),!l&&e.jsx("span",{className:"text-xs text-yellow-600 dark:text-yellow-400 bg-yellow-100 dark:bg-yellow-800 px-2 py-1 rounded-full",children:"Selecciona empleado"}),!s&&l&&e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded-full",children:"Selecciona permiso"}),u&&e.jsx(n,{name:"Loader",className:"w-4 h-4 animate-spin text-blue-600 dark:text-blue-400"}),m&&e.jsx("span",{className:"text-xs text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-800 px-2 py-1 rounded-full",children:"Error"}),c&&!u&&!m&&e.jsxs("span",{className:"text-xs text-blue-600 dark:text-blue-400 bg-blue-100 dark:bg-blue-800 px-2 py-1 rounded-full",children:[Object.values(c).map(t=>t.remaining_usage_formatted||"0 días").join(", ")," restantes"]})]}),e.jsx(n,{name:p?"ChevronUp":"ChevronDown",className:"w-4 h-4 text-blue-600 dark:text-blue-400"})]}),p&&e.jsx("div",{className:"border border-blue-200 dark:border-blue-800 rounded-md bg-blue-50/50 dark:bg-blue-900/10 p-3 mt-2",children:l?s?m?e.jsxs("div",{className:"text-center py-4 text-red-600",children:[e.jsx(n,{name:"AlertTriangle",className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:m}),e.jsx("button",{type:"button",onClick:b,className:"mt-2 text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"Reintentar"})]}):u?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(n,{name:"Loader",className:"w-6 h-6 mx-auto mb-2 animate-spin text-blue-600 dark:text-blue-400"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Cargando estadísticas..."})]}):c?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsx(k,{identifier:s.nombre,mapColor:w,size:"sm",children:s.nombre})}),Object.entries(c).map(([t,a])=>{const r=y(a);return e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("h4",{className:"font-medium text-sm mb-4 text-center text-gray-800 dark:text-gray-200",children:["Año ",t]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:a.usage>0?a.formatted_usage:"0 días"}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Tiempo usado"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-orange-600 dark:text-orange-400",children:a.remaining_usage_formatted||"0 días"}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Tiempo restante"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:a.max_formatted_duration||"0 días"}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Duración máxima"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-600 dark:text-purple-400",children:a.count_approved_requests||0}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Solicitudes aprobadas"})]})]}),r.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h5",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-3 text-center",children:"Distribución del tiempo"}),e.jsx(_,{config:v,className:"h-[200px] w-full",children:e.jsxs(E,{children:[e.jsx(C,{content:e.jsx(S,{})}),e.jsx(A,{data:r,cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:5,dataKey:"value",children:r.map((x,h)=>e.jsx(T,{fill:x.color},`cell-${h}`))})]})}),e.jsx("div",{className:"flex justify-center gap-4 mt-3",children:r.map((x,h)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:x.color}}),e.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[x.name,": ",x.formatted]})]},h))})]}),a.usage_percentage>=0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Progreso de uso"}),e.jsxs("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:[a.usage_percentage,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${Math.min(a.usage_percentage,100)}%`}})})]})]},t)})]}):e.jsxs("div",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:[e.jsx(n,{name:"Info",className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"No hay datos disponibles para el período seleccionado"})]}):e.jsxs("div",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:[e.jsx(n,{name:"FileText",className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Selecciona un tipo de permiso para ver estadísticas"})]}):e.jsxs("div",{className:"text-center py-4 text-yellow-600 dark:text-yellow-400",children:[e.jsx(n,{name:"User",className:"w-6 h-6 mx-auto mb-2"}),e.jsx("p",{className:"text-sm",children:"Selecciona un empleado para ver estadísticas"})]})})]})}export{F as default};
