import{r,j as e}from"./app-fwyInB3c.js";import{D as ie,b as ce,c as de,d as me,e as ue,f as xe}from"./dialog-iaZkf6Xy.js";import{B as q}from"./Button-CQuYVLGu.js";import{L as W}from"./label-zCtqi3J5.js";import{T as he}from"./textarea-C969rVin.js";import{F as ge}from"./FileUploadArea-uzmkw7Uv.js";import{I as l}from"./LucideIcon-CEqEhMjI.js";import{D as pe}from"./DecisionModal-Dl8siGBG.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-DloWbRVd.js";import"./index-B7srb2QZ.js";import"./index-BIJodELy.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./utils-CytzSlOG.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./index-BwobEAja.js";import"./dropdown-menu-bHoOJ61X.js";import"./index-C_F9oucK.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./index-v24TFYKQ.js";import"./check-5DjPwM22.js";import"./chevron-right-B1iws4WK.js";import"./index-WlsBA3k2.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./chevron-up-OjKdrhzc.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./alert-dialog-kDfn0La3.js";import"./button-Blwr-A5N.js";const R={image:["jpg","jpeg","png","gif","bmp","svg","webp"],video:["mp4","webm","ogg","mov","avi"],audio:["mp3","wav","ogg","m4a","aac"],office:["doc","docx","xls","xlsx","ppt","pptx"],text:["txt","rtf","md"]},B={image:"Image",pdf:"FileText",video:"Video",audio:"Music",office:"FileSpreadsheet",text:"FileText",default:"File"};function be({file:t,isOpen:b,onClose:O,onDownload:k}){var H;const[h,g]=r.useState(!1),[p,S]=r.useState(!1),[D,f]=r.useState(!0),[i,d]=r.useState(1),[I,v]=r.useState({x:0,y:0}),[j,w]=r.useState(!1),[m,N]=r.useState({x:0,y:0}),[_,C]=r.useState(!0),[E,A]=r.useState({}),M=r.useRef(null),P=r.useRef(null),u=r.useMemo(()=>{if(!(t!=null&&t.extension))return null;const s=t.extension.toLowerCase();return s==="pdf"?"pdf":Object.keys(R).find(o=>R[o].includes(s))||"default"},[t==null?void 0:t.extension]),{isImage:F,isPdf:X,isVideo:T,isAudio:n,isOfficeDoc:y,isText:c}=r.useMemo(()=>({isImage:u==="image",isPdf:u==="pdf",isVideo:u==="video",isAudio:u==="audio",isOfficeDoc:u==="office",isText:u==="text"}),[u]),G=()=>{g(!1),S(!1),f(!0),C(!0),d(1),v({x:0,y:0}),w(!1)};if(r.useEffect(()=>{t&&G()},[t]),r.useEffect(()=>{t!=null&&t.hash&&!E[t.hash]&&Z(t,!0).then(s=>{s&&A(o=>({...o,[t.hash]:s}))})},[t]),r.useEffect(()=>{b||(d(1),v({x:0,y:0}),w(!1))},[b]),r.useEffect(()=>{const s=a=>{if(j&&i>1){const{clientX:x,clientY:L}=a,ne=x-m.x,le=L-m.y;v(J=>({x:J.x+ne,y:J.y+le})),N({x,y:L})}},o=()=>w(!1);return j?(document.addEventListener("mousemove",s),document.addEventListener("mouseup",o),document.body.style.cursor="grabbing"):document.body.style.cursor="",()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",o),document.body.style.cursor=""}},[j,i,m]),r.useEffect(()=>{const s=o=>{var a;if(t&&F&&M.current&&((a=P.current)!=null&&a.contains(o.target))){o.preventDefault();const x=o.deltaY>0?.9:1.1;d(L=>Math.max(.5,Math.min(5,L*x)))}};if(b&&t&&F)return document.addEventListener("wheel",s,{passive:!1}),()=>document.removeEventListener("wheel",s)},[b,t,F]),!b||!t)return null;const $=s=>{if(!s||s===0)return"0 Bytes";const o=1024,a=["Bytes","KB","MB","GB"],x=Math.floor(Math.log(s)/Math.log(o));return parseFloat((s/Math.pow(o,x)).toFixed(2))+" "+a[x]},V=(s,o=null)=>{const a=o||s.toLowerCase().split(".").pop();if(a==="pdf")return B.pdf;const x=Object.keys(R).find(L=>R[L].includes(a));return B[x]||B.default},Z=async(s,o=!1)=>{try{const a=await fetch(`/api/v1/files/${s.hash}/url`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return(await a.json()).url}catch(a){return console.error("Error generando URL firmada:",a),null}},U=async s=>{try{const o=await Z(s,!1);if(o){const a=document.createElement("a");a.href=o,a.download=s.name,a.target="_blank",a.rel="noopener noreferrer",document.body.appendChild(a),a.click(),document.body.removeChild(a)}else{const a=document.createElement("a");a.href=`/api/v1/files/${s.hash}/download`,a.download=s.name,a.target="_blank",a.rel="noopener noreferrer",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}catch(o){console.error("Error al descargar archivo:",o),k?k(s):alert("Error al descargar el archivo. Por favor, inténtalo de nuevo.")}},z=s=>s.hash&&E[s.hash]?E[s.hash]:s.hash?`/files/${s.hash}/signed-route/generate?preview=true`:s.preview||s.url||null,K=()=>d(s=>Math.min(s*1.3,5)),Q=()=>d(s=>Math.max(s/1.3,.5)),ee=()=>{d(1),v({x:0,y:0})},te=s=>{i>1&&(w(!0),N({x:s.clientX,y:s.clientY}),s.preventDefault())},se=()=>{f(!1),g(!1)},Y=()=>{f(!1),g(!0)},ae=()=>C(!1),re=()=>{C(!1),S(!0)},oe=()=>{const s=[];return t.size&&s.push({label:"Tamaño",value:$(t.size)}),t.extension&&s.push({label:"Tipo",value:t.extension.toUpperCase()}),t.created_at&&s.push({label:"Subido",value:new Date(t.created_at).toLocaleDateString()}),s};return e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-2 sm:p-4",children:e.jsxs("div",{className:"bg-white dark:bg-custom-blackLight rounded-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 sm:p-4 border-b border-custom-gray-light dark:border-custom-gray-darker bg-custom-gray-default dark:bg-custom-blackSemi gap-3 sm:gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx(l,{name:V(t.name,t.extension),size:24,className:"text-custom-blue dark:text-custom-orange flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-base sm:text-lg font-medium text-custom-blue dark:text-custom-white truncate",children:t.name}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs sm:text-sm text-custom-gray-dark dark:text-custom-gray-light",children:[e.jsx("span",{className:"flex-shrink-0",children:$(t.size)}),t.description&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"hidden sm:inline",children:"•"}),e.jsx("span",{className:"truncate max-w-[200px]",children:t.description})]})]})]})]}),"                    ",e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0 self-end sm:self-center",children:[e.jsx("button",{onClick:()=>U(t),className:"text-custom-green hover:bg-custom-green/10 rounded-lg p-2 transition-colors",title:"Descargar",children:e.jsx(l,{name:"Download",size:18,className:"sm:w-5 sm:h-5"})}),e.jsx("button",{onClick:O,className:"text-custom-gray-dark hover:text-red-500 transition-colors rounded-lg p-2 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(l,{name:"X",size:20,className:"sm:w-6 sm:h-6"})})]})]}),e.jsx("div",{ref:P,className:"p-3 sm:p-4 max-h-[calc(95vh-120px)] sm:max-h-[calc(95vh-100px)] overflow-auto",children:F?e.jsxs("div",{className:"relative",children:[!h&&e.jsxs("div",{className:"absolute top-2 right-2 z-10 flex items-center gap-1 bg-black/70 backdrop-blur-sm rounded-lg p-1",children:[e.jsx("button",{onClick:Q,disabled:i<=.5,className:"p-1.5 text-white hover:bg-white/20 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Reducir zoom",children:e.jsx(l,{name:"ZoomOut",size:16})}),e.jsxs("span",{className:"text-white text-xs px-2 min-w-[3rem] text-center",children:[Math.round(i*100),"%"]}),e.jsx("button",{onClick:K,disabled:i>=5,className:"p-1.5 text-white hover:bg-white/20 rounded disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Aumentar zoom",children:e.jsx(l,{name:"ZoomIn",size:16})}),e.jsx("button",{onClick:ee,className:"p-1.5 text-white hover:bg-white/20 rounded transition-colors",title:"Restablecer zoom",children:e.jsx(l,{name:"RotateCcw",size:16})})]}),D&&!h&&e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-custom-blue"})}),e.jsx("div",{className:"flex justify-center items-center min-h-[60vh] sm:min-h-[70vh] overflow-hidden",children:h?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx(l,{name:"ImageOff",size:48,className:"text-custom-gray-dark dark:text-custom-gray-light mb-4"}),e.jsx("p",{className:"text-lg text-custom-gray-dark dark:text-custom-gray-light mb-2",children:"Error al cargar la imagen"}),e.jsx("p",{className:"text-sm text-custom-gray-dark dark:text-custom-gray-light mb-4",children:"No se pudo cargar la imagen. Intenta descargarla para verla."}),e.jsxs("button",{onClick:()=>U(t),className:"flex items-center gap-2 px-4 py-2 bg-custom-blue hover:bg-custom-blue/90 text-white rounded-lg transition-colors",children:[e.jsx(l,{name:"Download",size:16}),e.jsx("span",{children:"Descargar imagen"})]})]}):e.jsx("img",{ref:M,src:z(t),alt:t.name,className:`max-w-full max-h-[60vh] sm:max-h-[70vh] object-contain rounded-lg shadow-lg transition-transform select-none ${i>1?j?"cursor-grabbing":"cursor-grab":"cursor-default"}`,style:{transform:`scale(${i}) translate(${I.x/i}px, ${I.y/i}px)`,transformOrigin:"center center"},onLoad:se,onError:Y,onMouseDown:te,draggable:!1})}),!h&&!D&&e.jsx("div",{className:"text-center mt-4 text-sm text-custom-gray-dark dark:text-custom-gray-light",children:e.jsx("p",{children:"Usa la rueda del ratón para hacer zoom • Arrastra para mover la imagen cuando esté ampliada"})})]}):X?e.jsxs("div",{className:"relative",children:[_&&!p&&e.jsx("div",{className:"absolute inset-0 flex justify-center items-center bg-custom-gray-default/50 dark:bg-custom-blackSemi/50 backdrop-blur-sm z-10",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-custom-blue"}),e.jsx("p",{className:"text-sm text-custom-gray-dark dark:text-custom-gray-light",children:"Cargando PDF..."})]})}),p?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx(l,{name:"FileX",size:48,className:"text-custom-gray-dark dark:text-custom-gray-light mb-4"}),e.jsx("p",{className:"text-lg text-custom-gray-dark dark:text-custom-gray-light mb-2",children:"Error al cargar el PDF"}),e.jsx("p",{className:"text-sm text-custom-gray-dark dark:text-custom-gray-light mb-4",children:"No se pudo cargar el PDF en el navegador. Intenta descargarlo para verlo."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("a",{href:E[t.hash]||`/files/${t.hash}/preview`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-custom-blue hover:bg-custom-blue/90 text-white rounded-lg transition-colors",children:[e.jsx(l,{name:"ExternalLink",size:16}),e.jsx("span",{children:"Abrir en nueva pestaña"})]}),e.jsxs("button",{onClick:()=>U(t),className:"flex items-center gap-2 px-4 py-2 bg-custom-green hover:bg-custom-green/90 text-white rounded-lg transition-colors",children:[e.jsx(l,{name:"Download",size:16}),e.jsx("span",{children:"Descargar PDF"})]})]})]}):e.jsxs("div",{className:"relative",children:[e.jsx("iframe",{src:z(t),className:"w-full h-[60vh] sm:h-[70vh] rounded-lg border border-custom-gray-light dark:border-custom-gray-darker",title:`Preview of ${t.name}`,onLoad:ae,onError:re}),e.jsx("div",{className:"absolute top-2 right-2 bg-black/70 backdrop-blur-sm rounded-lg p-1",children:e.jsxs("a",{href:z(t),target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 px-2 py-1 text-white hover:bg-white/20 rounded text-xs transition-colors",title:"Abrir en nueva pestaña",children:[e.jsx(l,{name:"ExternalLink",size:14}),e.jsx("span",{children:"Abrir"})]})})]})]}):T?e.jsx("div",{className:"flex justify-center items-center min-h-[60vh] sm:min-h-[70vh]",children:e.jsx("video",{src:z(t),controls:!0,className:"max-w-full max-h-[60vh] sm:max-h-[70vh] rounded-lg shadow-lg",preload:"metadata",onError:Y,children:"Tu navegador no soporta la reproducción de video."})}):n?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20",children:[e.jsx(l,{name:"Music",size:64,className:"text-custom-blue dark:text-custom-orange mb-6"}),e.jsx("h3",{className:"text-xl font-medium text-custom-blue dark:text-custom-white mb-4",children:t.name}),e.jsx("audio",{src:z(t),controls:!0,className:"mb-6 w-full max-w-md",preload:"metadata",children:"Tu navegador no soporta la reproducción de audio."}),e.jsxs("div",{className:"text-sm text-custom-gray-dark dark:text-custom-gray-light",children:[$(t.size)," • ",(H=t.extension)==null?void 0:H.toUpperCase()]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(l,{name:V(t.name,t.extension),size:64,className:"text-custom-gray-dark dark:text-custom-gray-light mb-6"}),e.jsx("h3",{className:"text-xl font-medium text-custom-blue dark:text-custom-white mb-2",children:t.name}),e.jsx("p",{className:"text-custom-gray-dark dark:text-custom-gray-light mb-6 max-w-md",children:y?"Documento de Office. Descarga el archivo para abrirlo con la aplicación correspondiente.":c?"Archivo de texto. La vista previa no está disponible en el navegador.":"Vista previa no disponible para este tipo de archivo."}),e.jsxs("div",{className:"bg-custom-gray-default dark:bg-custom-blackSemi rounded-lg p-4 mb-6 max-w-sm w-full",children:[e.jsx("h4",{className:"text-sm font-medium text-custom-blue dark:text-custom-white mb-3",children:"Información del archivo"}),e.jsx("div",{className:"space-y-2",children:oe().map((s,o)=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"text-custom-gray-dark dark:text-custom-gray-light",children:[s.label,":"]}),e.jsx("span",{className:"text-custom-blue dark:text-custom-white font-medium",children:s.value})]},o))})]}),k&&e.jsxs("button",{onClick:()=>U(t),className:"flex items-center gap-2 px-6 py-3 bg-custom-blue hover:bg-custom-blue/90 text-white rounded-lg transition-colors text-base font-medium",children:[e.jsx(l,{name:"Download",size:20}),e.jsx("span",{children:"Descargar archivo"})]})]})})]})})}function st({fichajeData:t,onUpload:b,isOpen:O,onClose:k}){const[h,g]=r.useState([]),[p,S]=r.useState(!1),[D,f]=r.useState(!1),[i,d]=r.useState(null),[I,v]=r.useState(null),[j,w]=r.useState(!1),[m,N]=r.useState(""),_=n=>{g(n)},C=n=>{g(y=>y.filter(c=>c!==n))},E=n=>{d(n),f(!0)},A=()=>{console.log("Eliminar archivo:",i),f(!1),d(null)},M=()=>{f(!1),d(null)},P=n=>{v(n),w(!0)},u=()=>{w(!1),v(null)},F=n=>{if(n instanceof File){const y=URL.createObjectURL(n),c=document.createElement("a");c.href=y,c.download=n.name,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(y)}else{const c="/api/v1/files/{file}/download".replace("{file}",n.hash);window.open(c,"_blank")}},X=async()=>{if(h.length===0&&m.trim()===""){alert("Por favor selecciona al menos un archivo o escribe el motivo");return}S(!0);try{await b(t==null?void 0:t.id,h,m.trim()),g([]),N(""),k()}catch(n){console.error("Error al subir archivos:",n),alert("Error al subir los archivos. Inténtalo de nuevo.")}finally{S(!1)}},T=()=>{p||(g([]),N(""),j&&u(),k())};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{open:O,onOpenChange:T,children:e.jsxs(ce,{className:"max-w-lg bg-custom-gray-light dark:bg-custom-blackLight",children:[e.jsxs(de,{children:[e.jsx(me,{children:"Subir Justificante"}),e.jsxs(ue,{children:["Selecciona el archivo de justificante o escribe el motivo de tu fichaje tardío para el día "," ",e.jsx("span",{className:"font-semibold",children:t==null?void 0:t.fecha_inicio})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(W,{className:"text-sm font-medium text-custom-blackLight dark:text-custom-gray-default",children:["Motivo del fichaje tarde",e.jsx("span",{className:"text-xs text-custom-gray-dark font-normal ml-2",children:"(Opcional si adjuntas documentos)"})]}),e.jsx(he,{value:m,onChange:n=>N(n.target.value),placeholder:"Explica brevemente el motivo de tu fichaje tarde...",className:"min-h-[80px] resize-none bg-custom-gray-light dark:bg-zinc-700",disabled:p}),e.jsxs("div",{className:"text-xs text-gray-400 text-right",children:[m.length," caracteres",m.trim()!==""&&e.jsx("span",{className:"text-green-600 ml-2",children:"✓ Texto válido"})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs(W,{className:"text-sm font-medium text-custom-blackLight dark:text-custom-gray-default",children:["Documentos de justificación",e.jsx("span",{className:"text-xs text-gray-500 font-normal ml-2",children:"(Opcional si escribes el motivo)"})]}),e.jsx(ge,{id:"file-upload-justificante",className:"bg-custom-gray-light dark:bg-custom-blackLight",multiple:!0,onFileChange:_,selectedFiles:h,onRemoveSelected:C,accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx,.txt",text:"Haga clic aquí o arrastre los documentos necesarios",existingFiles:t!=null&&t.justificante?[t.justificante]:[],showExistingFiles:!!(t!=null&&t.justificante),onRemoveExisting:E,allowRemoveExisting:!0,showPreview:!0,onPreview:P,downloadConfig:{endpoint:"/api/v1/files/{file}/download",fileIdField:"hash",fileNameField:"name"}})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("strong",{children:"Máximo:"})," 10 MB por archivo",e.jsx("br",{}),e.jsx("strong",{children:"Formatos permitidos:"})," PDF, DOC, DOCX, XLS, XLSX, TXT, Imágenes"]})]}),e.jsxs(xe,{children:[e.jsx(q,{variant:"secondary",onClick:T,disabled:p,children:"Cancelar"}),e.jsx(q,{onClick:X,disabled:h.length===0&&m.trim()===""||p,children:p?"Subiendo...":"Subir Justificante"})]})]})}),e.jsx(be,{file:I,isOpen:j,onClose:u,onDownload:F}),e.jsx(pe,{variant:"destructive",open:D,onOpenChange:M,action:A,title:"¿Eliminar archivo?",content:i?e.jsxs("span",{children:["¿Estás seguro de que deseas eliminar el archivo ",e.jsxs("strong",{children:['"',i.name||i.nombre_original,'"']}),"? Esta acción no se puede deshacer."]}):"Esta acción no se puede deshacer.",icon:e.jsx(l,{name:"Trash2",className:"text-red-500"})})]})}export{st as JustificanteUploadDialog,st as default};
