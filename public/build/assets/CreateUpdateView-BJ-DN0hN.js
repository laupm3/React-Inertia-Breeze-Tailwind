import{r as o,G as I,j as b}from"./app-fwyInB3c.js";import{u as U}from"./useTranslation-BtIkv0Na.js";import{o as $,i as q,d as m,s as S,n as F,a as M,Z as z}from"./types-BZmDMmQb.js";import{toast as j}from"./index-WlsBA3k2.js";import{useDataHandler as O}from"./DataHandlerContext-D_ReySQQ.js";import{useView as k}from"./ViewContext-CSNxR0eG.js";const L=()=>{const{t:e}=U(["datatable"]);return $({id:F(M()),nombre:S().nonempty({message:"El nombre del archivo es requerido"}),user:m().refine(t=>t,{message:"El empleado vinculado es requerido"}),created_at:S().optional(),created_by:m().optional(),updated_by:m().optional(),archivo:q(File).nullable()}).superRefine((t,n)=>{!t.id&&!t.archivo&&n.addIssue({code:z.custom,path:["archivo"],message:"El archivo es requerido al crear un nuevo registro."})})},V={id:null,nombre:"",user:null,created_at:"",created_by:null,updated_by:null,archivo:null},Z=e=>e?{id:e.id||null,nombre:e.nombre||"",user:e.user||null,created_at:e.created_at||"",created_by:e.created_by||null,updated_by:e.updated_by||null,archivo:null}:{id:null,nombre:"",user:null,created_at:"",created_by:null,updated_by:null,archivo:null},G=e=>o.useMemo(()=>({show:e?route("api.v1.admin.nominas.show",{nomina:e}):null,store:route("api.v1.admin.nominas.store"),update:e?route("api.v1.admin.nominas.update",{nomina:e}):null,delete:e?route("api.v1.admin.nominas.destroy",{nomina:e}):null}),[e]),T=o.createContext(null),H=({children:e,model:t,onOpenChange:n,dataKey:p,onSaveData:l=null,modelAlias:i="registro"})=>{const[h,P]=o.useState(!1),[g,c]=o.useState(!1),[v,f]=o.useState(!1),[E,y]=o.useState(!1),d=G(t),r=I(V),x=L();o.useEffect(()=>{const a=async()=>{try{f(!0),c(!1);const s=await axios.get(d.show);s.status===200?r.setData(Z(s.data[p])):c(!0)}catch(s){console.error("Error al cargar datos:",s),c(!0)}finally{f(!1)}};return r.clearErrors(),t?a():(r.setData(V),c(!1),f(!1)),()=>{}},[t]);const D=o.useCallback((a,s)=>{if(typeof a=="object"&&s===void 0){r.setData(u=>({...u,...a}));return}r.setData(u=>({...u,[a]:s}))},[r]),_=o.useCallback(()=>{const a=x.safeParse(r.data);if(r.clearErrors(),!a.success){const s=a.error.flatten().fieldErrors;Object.keys(s).forEach(u=>{r.setError(u,s[u][0])})}return a.success},[r,x]),w=o.useCallback(async()=>{try{y(!0),c(!1),r.clearErrors();const a=t?await axios.put(d.update,r.data):await axios.post(d.store,r.data);l&&l(a.data[p]),n(!1),r.clearErrors(),j.success(t?`Registro ${i} actualizado con éxito`:`Registro ${i} creado con éxito`)}catch(a){if(c(!0),a.response&&a.response.data&&a.response.data.errors){const{errors:s}=a.response.data;Object.keys(s).forEach(u=>{r.setError(u,s[u][0])})}j.error(t?`Error al actualizar el ${i}`:`Error al crear el ${i}`)}finally{y(!1)}},[t,d.update,d.store,r,l,n]),C=o.useCallback(()=>{_()&&w()},[_,w]),R=o.useMemo(()=>({modelAlias:i,model:t,error:g,form:r,updateForm:D,handleSubmit:C,setError:c,onOpenChange:n,isProcessing:h,isLoading:v,isSaving:E,setIsProcessing:P}),[i,t,g,r,D,C,n,h,v,E]);return b.jsx(T.Provider,{value:R,children:e})};function A(){const e=o.useContext(T);if(!e)throw new Error("useDialogData debe usarse dentro de DialogDataContextProvider");return e}function B(){const{createUpdateView:e,handleCreateUpdateView:t,CreateUpdateViewComponent:n}=k(),{updateData:p}=O(),{open:l,model:i}=e;return n?b.jsx(H,{model:i,onSaveData:p,dataKey:"nomina",children:b.jsx(n,{open:l,onOpenChange:()=>t()})}):null}const K=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{B as C,H as D,G as a,K as b,A as u};
