import{r as n,j as e}from"./app-fwyInB3c.js";import{u as $}from"./DataTableContext-BYrqyX0i.js";import{P as L,a as I,b as P}from"./popover-DaRbHQOK.js";import{B as w}from"./button-Blwr-A5N.js";import{I as R}from"./input-CqlBlYgU.js";import{F as J,M as ee,g as te}from"./LucideIcon-CEqEhMjI.js";import{c as re}from"./index-BwobEAja.js";import{c as C}from"./utils-CytzSlOG.js";import{S as ae}from"./separator-BWKairMX.js";import{C as se,a as W,b as le,c as ie,d as _,e as D}from"./command-PoUoScut.js";import{B as ne}from"./badge-BgloL8Ae.js";import{X as U}from"./x-2mzC_aTV.js";import{C as H}from"./check-5DjPwM22.js";import{B as T}from"./Button-CQuYVLGu.js";import{S as oe,a as ce,b as de,c as ue,d as me}from"./select-B5O0TxCl.js";import{D as M}from"./DatePicker-YJSItPq7.js";import{C as xe}from"./calendar-k1x2vwx8.js";import{p as A}from"./parseISO-Efi0RkWR.js";import{f as B,i as X}from"./format-Be40hyfq.js";import{b as O}from"./calendar-DctTJhwg.js";function K(r,o){const[i,d]=n.useState(r);return n.useEffect(()=>{const s=setTimeout(()=>{d(r)},o);return()=>{clearTimeout(s)}},[r,o]),i}function q(r=""){const[o,i]=n.useState(r),[d,s]=n.useState(""),m=n.useCallback(t=>/^-?\d*\.?\d*$/.test(t)||t===""?(i(t),s(""),!0):(s("Formato de número inválido"),!1),[]),l=n.useCallback(()=>{i(r),s("")},[r]);return{value:o,error:d,setValue:m,reset:l,numericValue:o!==""&&!isNaN(Number(o))?Number(o):void 0}}function fe({column:r,debounceMs:o=300}){const[i,d]=n.useState(!1),{table:s}=$(),m=n.useMemo(()=>r.getFilterValue(),[r]),l=q(""),t=q("");K(l.value,o),K(t.value,o),n.useEffect(()=>{m?(l.setValue(String(m.min||"")),t.setValue(String(m.max||""))):(l.reset(),t.reset())},[m]);const a=n.useCallback(()=>{const h=l.numericValue,V=t.numericValue;h!==void 0&&V!==void 0&&h>V||(h!==void 0||V!==void 0?r.setFilterValue({min:h,max:V}):r.setFilterValue(void 0),d(!1))},[l.numericValue,t.numericValue,r]),p=n.useCallback(()=>{l.reset(),t.reset(),r.setFilterValue(void 0),d(!1)},[l,t,r]),N=n.useCallback(h=>{h.key==="Enter"?a():h.key==="Escape"&&d(!1)},[a]),E=n.useMemo(()=>!!m,[m]),f=n.useMemo(()=>{const h=l.error||t.error,V=l.numericValue!==void 0&&t.numericValue!==void 0&&l.numericValue>t.numericValue;return h||V},[l.error,t.error,l.numericValue,t.numericValue]);return r.getCanFilter()?e.jsxs(L,{open:i,onOpenChange:d,children:[e.jsx(I,{asChild:!0,children:e.jsx(w,{variant:"ghost",size:"sm",className:`p-0 h-8 w-8 transition-colors ${E?"text-orange-500 hover:text-orange-600":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,title:E?"Filtro activo - Click para editar":"Filtrar por rango","aria-label":"Filtrar por rango",children:e.jsx(J,{size:16})})}),e.jsx(P,{className:"w-80 p-4 dark:bg-custom-blackLight",align:"start",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm dark:text-white",children:"Filtrar por rango"}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsxs("div",{className:"grid gap-2 flex-1",children:[e.jsx("label",{htmlFor:"min-value",className:"text-xs dark:text-gray-300",children:"Valor mínimo"}),e.jsx(R,{id:"min-value",type:"text",placeholder:"Ej: -10.5",value:l.value,onChange:h=>l.setValue(h.target.value),onKeyDown:N,className:`dark:bg-custom-blackSemi dark:text-white ${l.error?"border-red-500":""}`,"aria-describedby":l.error?"min-error":void 0}),l.error&&e.jsx("span",{id:"min-error",className:"text-xs text-red-500",children:l.error})]}),e.jsxs("div",{className:"grid gap-2 flex-1",children:[e.jsx("label",{htmlFor:"max-value",className:"text-xs dark:text-gray-300",children:"Valor máximo"}),e.jsx(R,{id:"max-value",type:"text",placeholder:"Ej: 100.25",value:t.value,onChange:h=>t.setValue(h.target.value),onKeyDown:N,className:`dark:bg-custom-blackSemi dark:text-white ${t.error?"border-red-500":""}`,"aria-describedby":t.error?"max-error":void 0}),t.error&&e.jsx("span",{id:"max-error",className:"text-xs text-red-500",children:t.error})]})]}),l.numericValue!==void 0&&t.numericValue!==void 0&&l.numericValue>t.numericValue&&e.jsx("div",{className:"text-xs text-red-500",children:"El valor mínimo no puede ser mayor que el máximo"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(w,{variant:"outline",size:"sm",onClick:p,className:"dark:bg-custom-blackSemi dark:text-white dark:hover:bg-custom-gray-semiDark",children:"Limpiar"}),e.jsx(w,{size:"sm",onClick:a,disabled:f,className:"bg-orange-500 text-white hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Aplicar"})]})]})})]}):null}function he(r,o,i=void 0){if(r==null||!o)return i;try{return o.split(".").reduce((d,s)=>d!=null&&d[s]!==void 0?d[s]:i,r)}catch{return i}}const ge=re("m-1 transition ease-in-out delay-150 hover:-translate-y-1 hover:scale-110 duration-300",{variants:{variant:{default:"border-foreground/10 text-foreground bg-card hover:bg-card/80",secondary:"border-foreground/10 bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",inverted:"inverted"}},defaultVariants:{variant:"default"}}),Y=n.forwardRef(({column:r,options:o,onValueChange:i,variant:d,animation:s=0,modalPopover:m=!1,asChild:l=!1,className:t,...a},p)=>{const{table:N}=$(),{columnFilters:E}=N.getState(),f=n.useMemo(()=>r.getFilterValue()||[],[r,E]),[h,V]=n.useState({selectedValues:f,isPopoverOpen:!1,searchValue:""}),{selectedValues:b,isPopoverOpen:S,searchValue:u}=h,v=n.useMemo(()=>Object.fromEntries(b.map(c=>[c,!0])),[b]),j=n.useMemo(()=>{if(!u.trim())return o;const c=u.toLowerCase().trim();return o.filter(k=>{const y=typeof k.label=="string"?k.label.toLowerCase():"";return k.value.toLowerCase().includes(c)||y.includes(c)})},[o,u]),g=n.useCallback(c=>{V(k=>({...k,...c}))},[]),Q=n.useCallback(c=>{const k=b.includes(c)?b.filter(y=>y!==c):[...b,c];g({selectedValues:k}),i(k)},[b,i,g]),Z=n.useCallback(c=>{g({searchValue:c||""})},[g]),z=n.useCallback(()=>{g({selectedValues:[],searchValue:""}),i([])},[i,g]);return e.jsxs(L,{open:S,onOpenChange:c=>g({isPopoverOpen:c}),modal:m,children:[e.jsx(I,{asChild:!0,children:e.jsxs(w,{ref:p,...a,onClick:()=>g({isPopoverOpen:!S}),className:C("flex w-full p-1 rounded-md min-h-10 h-auto items-center justify-between [&_svg]:pointer-events-auto bg-inherit hover:bg-inherit dark:text-custom-gray-default !border-0 gap-1",t),children:[e.jsx("div",{className:"font-medium flex gap-2 items-center text-sm text-muted-foreground",children:f.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(ne,{className:C("text-primary hover:bg-primary/10 w-6 h-6 flex items-center justify-center rounded-full",ge({variant:d})),children:["+",f.length]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(U,{className:"h-4 cursor-pointer text-muted-foreground hover:text-primary",onClick:c=>{c.stopPropagation(),z()}})})]})}),e.jsx(J,{size:16,className:`text-muted-foreground ${f.length>0?" text-orange-500":S?"text-primary":""}`})]})}),e.jsxs(P,{className:"w-auto p-0",align:"start",onEscapeKeyDown:()=>g({isPopoverOpen:!1}),children:[e.jsx("div",{className:"p-2",children:e.jsx(R,{placeholder:"Buscar...",value:u,onChange:c=>Z(c.target.value),className:"mb-2"})}),e.jsxs(se,{shouldFilter:!1,className:"w-full",children:[e.jsxs("div",{className:"flex items-center cursor-pointer p-3 py-1 gap-2 hover:bg-accent hover:text-accent-foreground rounded-sm",onClick:()=>{const c=j.map(y=>y.value);if(c.every(y=>b.includes(y))){const y=b.filter(F=>!c.includes(F));g({selectedValues:y}),i(y)}else{const y=[...b.filter(F=>!c.includes(F)),...c];g({selectedValues:y}),i(y)}},children:[e.jsx("div",{className:C("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",j.length>0&&j.every(c=>b.includes(c.value))?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx("span",{children:u?j.every(c=>b.includes(c.value))?`Deseleccionar resultados (${j.length})`:`Seleccionar resultados (${j.length})`:b.length===o.length?"Deseleccionar todo":"Seleccionar todo"})]}),e.jsx(W,{}),e.jsxs(le,{children:[e.jsx(ie,{children:"No results found."}),e.jsx(_,{children:j.map(c=>{const k=v[c.value];return e.jsxs(D,{onSelect:()=>Q(c.value),className:"cursor-pointer",children:[e.jsx("div",{className:C("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",k?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx("span",{children:c.label})]},c.value)})})]}),e.jsx(W,{}),e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[b.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(D,{onSelect:z,className:"flex-1 justify-center cursor-pointer",children:"Clear"}),e.jsx(ae,{orientation:"vertical",className:"flex min-h-6 h-full"})]}),e.jsx(D,{onSelect:()=>g({isPopoverOpen:!1}),className:"flex-1 justify-center cursor-pointer max-w-full",children:"Close"})]})})]})]})]})});Y.displayName="MultiSelect";function pe({column:r,labelFn:o,valueFn:i,className:d}){const{table:s}=$(),m=n.useMemo(()=>be(s,r),[s.getState().columnFilters,r.id]),{columnDef:l,accessorFn:t}=r,{cell:a}=l,p=n.useMemo(()=>m?s.getFilteredRowModel().rows:s.getPreFilteredRowModel().rows,[m]),N=n.useMemo(()=>{const f=ve(p,r,i,o,t,a);return Array.from(f.values())},[p,a,t,o,i]),E=n.useCallback(f=>{r==null||r.setFilterValue(f.length>0?f:void 0)},[r]);return r.getCanFilter()&&e.jsx(Y,{column:r,options:N,onValueChange:E,className:`
                    flex gap-0 items-center justify-center rounded-full bg-custom-gray-default hover:bg-custom-gray-semiLight dark:bg-custom-blackSemi dark:hover:bg-custom-blackLight
                    ${i?"absolute bg-custom-white !border-2 max-w-[250px] justify-end px-4 hover:bg-custom-gray-default dark:bg-custom-blackSemi dark:hover:bg-custom-blackSemi":`${!r.getFilterValue()&&"w-10 h-10"}`}
                    ${d}
                `})}const ve=(r,o,i,d,s,m)=>{if(!r||r.length===0)return[];const l=new Map;return r.reduce((t,a)=>{const p=he(a.original,o.id)||a.original;if(!p)return t;const N=i?p:a.original,E=d?p:{row:a};if(Array.isArray(p))p.forEach(f=>{const h={value:i(f),label:d(f)};l.has(h.value)||l.set(h.value,h)});else{const f={value:i?i(N):s(N),label:d?d(E):m(E)};l.has(f.value)||l.set(f.value,f)}return t},l)},be=(r,o)=>r.getState().columnFilters.filter(i=>i.id!==o.id).map(i=>`${i.id}:${JSON.stringify(i.value)}`).join("|");function je({column:r}){const o=r.getIsSorted();return r.getCanSort()&&e.jsx("div",{className:"flex items-center",children:e.jsxs("button",{className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 flex",onClick:r.getToggleSortingHandler(),title:"Ordenar",children:[e.jsx(ee,{size:16,className:`${o==="asc"?"text-orange-500":""}`}),e.jsx(te,{size:16,className:`-ml-1.5 ${o==="desc"?"text-orange-500":""}`})]})})}function G(r=""){const[o,i]=n.useState(r),[d,s]=n.useState(""),m=n.useCallback(t=>{if(t==="")return i(t),s(""),!0;try{const a=A(t);return X(a)?(i(t),s(""),!0):(s("Fecha inválida"),!1)}catch{return s("Formato de fecha inválido"),!1}},[]),l=n.useCallback(()=>{i(r),s("")},[r]);return{value:o,error:d,setValue:m,reset:l,dateValue:o!==""&&X(A(o))?A(o):void 0}}const x={BETWEEN:"between",AFTER:"after",BEFORE:"before",EXACT:"exact"},ye={[x.BETWEEN]:"Entre fechas",[x.AFTER]:"Después de",[x.BEFORE]:"Antes de",[x.EXACT]:"Fecha exacta"};function Ne({column:r,debounceMs:o=300}){const[i,d]=n.useState(!1),[s,m]=n.useState(x.BETWEEN),l=r.getFilterValue(),t=G(""),a=G("");n.useEffect(()=>{l?(m(l.type||x.BETWEEN),t.setValue(l.startDate||""),a.setValue(l.endDate||"")):(m(x.BETWEEN),t.reset(),a.reset())},[l]);const p=n.useCallback(()=>{const u=t.dateValue,v=a.dateValue;let j=!1,g=null;switch(s){case x.BETWEEN:u&&v&&(O(u,v)||(j=!0,g={type:s,startDate:t.value,endDate:a.value}));break;case x.AFTER:u&&(j=!0,g={type:s,startDate:t.value});break;case x.BEFORE:v&&(j=!0,g={type:s,endDate:a.value});break;case x.EXACT:u&&(j=!0,g={type:s,startDate:t.value});break}j?r.setFilterValue(g):!u&&!v&&r.setFilterValue(void 0),d(!1)},[s,t.dateValue,a.dateValue,t.value,a.value,r]),N=n.useCallback(()=>{t.reset(),a.reset(),m(x.BETWEEN),r.setFilterValue(void 0),d(!1)},[t,a,r]),E=n.useCallback(()=>{t.reset(),a.reset(),m(x.BETWEEN),r.setFilterValue(void 0)},[t,a,r]);n.useCallback(u=>{u.key==="Enter"?p():u.key==="Escape"&&d(!1)},[p]);const f=n.useMemo(()=>!!l&&(l.startDate||l.endDate),[l]),h=n.useMemo(()=>{const u=t.error||a.error,v=s===x.BETWEEN&&t.dateValue&&a.dateValue&&O(t.dateValue,a.dateValue);return u||v},[s,t.error,a.error,t.dateValue,a.dateValue]),V=n.useMemo(()=>{if(h)return!1;switch(s){case x.BETWEEN:return t.dateValue&&a.dateValue;case x.AFTER:case x.EXACT:return t.dateValue;case x.BEFORE:return a.dateValue;default:return!1}},[s,h,t.dateValue,a.dateValue]);if(!r.getCanFilter())return null;const b=s!==x.BEFORE,S=s===x.BETWEEN;return e.jsxs(L,{open:i,onOpenChange:d,children:[e.jsx(I,{asChild:!0,children:e.jsxs(T,{variant:"secondary",size:"icon",title:f?"Filtro activo - Click para editar":"Filtrar por fecha","aria-label":"Filtrar por fecha",children:[e.jsx("div",{className:"font-medium flex gap-2 items-center text-sm",children:f&&e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(U,{className:"h-4 cursor-pointer text-muted-foreground hover:text-primary transition-colors",onClick:u=>{u.stopPropagation(),N()}})})}),e.jsx(xe,{size:16,className:`transition-colors ${f?"text-orange-500":i?"text-primary":"text-muted-foreground"}`})]})}),e.jsx(P,{className:"w-80 sm:w-96 p-4 dark:bg-custom-blackLight",align:"center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-sm dark:text-white",children:"Filtrar por fecha"}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs dark:text-gray-300",children:"Tipo de filtro"}),e.jsxs(oe,{value:s,onValueChange:m,children:[e.jsx(ce,{className:"dark:bg-custom-blackSemi dark:text-white bg-custom-gray-default rounded-full hover:bg-custom-gray-light focus:ring-0 focus:ring-offset-0",children:e.jsx(de,{placeholder:"Seleccionar tipo"})}),e.jsx(ue,{className:"dark:bg-custom-blackLight",children:Object.entries(ye).map(([u,v])=>e.jsx(me,{value:u,className:"dark:text-white dark:focus:bg-custom-blackSemi",children:v},u))})]})]}),e.jsxs("div",{className:`grid gap-3 ${S?"grid-cols-2 sm:grid-cols-2":"grid-cols-1"}`,children:[b&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"start-date",className:"text-xs dark:text-gray-300",children:s===x.EXACT?"Fecha":s===x.AFTER?"Después de":"Fecha inicio"}),e.jsx(M,{selectedDate:t.dateValue,onSelect:u=>{const v=u?B(u,"yyyy-MM-dd"):"";t.setValue(v)},className:`min-w-0 ${t.error?"border-red-500":""}`}),t.error&&e.jsx("span",{id:"start-error",className:"text-xs text-red-500",children:t.error})]}),S&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"end-date",className:"text-xs dark:text-gray-300",children:"Fecha fin"}),e.jsx(M,{selectedDate:a.dateValue,onSelect:u=>{const v=u?B(u,"yyyy-MM-dd"):"";a.setValue(v)},className:`min-w-0 ${a.error?"border-red-500":""}`}),a.error&&e.jsx("span",{id:"end-error",className:"text-xs text-red-500",children:a.error})]}),s===x.BEFORE&&e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"before-date",className:"text-xs dark:text-gray-300",children:"Antes de"}),e.jsx(M,{selectedDate:a.dateValue,onSelect:u=>{const v=u?B(u,"yyyy-MM-dd"):"";a.setValue(v)},className:`min-w-0 ${a.error?"border-red-500":""}`}),a.error&&e.jsx("span",{id:"before-error",className:"text-xs text-red-500",children:a.error})]})]}),s===x.BETWEEN&&t.dateValue&&a.dateValue&&O(t.dateValue,a.dateValue)&&e.jsx("div",{className:"text-xs text-red-500",children:"La fecha de inicio no puede ser posterior a la fecha de fin"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(T,{variant:"ghost",size:"sm",onClick:E,children:"Limpiar"}),e.jsx(T,{size:"sm",onClick:p,disabled:!V,children:"Aplicar"})]})]})})]})}function _e({column:r,labelFn:o,valueFn:i,className:d,filterType:s="default"}){const{title:m}=r.columnDef;return e.jsxs("div",{className:"flex items-center whitespace-nowrap text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 text-primary-foreground w-full min-h-10 h-auto justify-between hover:bg-inherit [&_svg]:pointer-events-auto dark:text-custom-white rounded-full",children:[e.jsxs("div",{className:"flex justify-between items-center flex-1",children:[m&&e.jsx("div",{className:`pointer-events-none text-muted-foreground dark:text-custom-white ${i&&"z-10 ml-4 opacity-50 font-normal"}`,children:m}),s==="range"?e.jsx(fe,{column:r}):s==="date"?e.jsx(Ne,{column:r}):e.jsx(pe,{column:r,labelFn:o,valueFn:i,className:d})]}),e.jsx("div",{children:e.jsx(je,{column:r})})]})}export{_e as A,he as g};
