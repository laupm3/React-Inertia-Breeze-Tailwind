import{r as p,j as e,X as S}from"./app-fwyInB3c.js";/* empty css               */import{u as G}from"./sidebar-CPh6C6LB.js";import{I as w}from"./LucideIcon-CEqEhMjI.js";import{G as A}from"./GetModalidadIcon-BUgIPR97.js";import{T as D,a as C,b as $,c as F}from"./tooltip-DFfoxvAF.js";import{F as V,i as z,a as J,b as L}from"./index-uaNH1BE9.js";import{i as U}from"./index-CePWpK7c.js";import q from"./SkeletonHorario-BZOGxRTm.js";import{A as B,a as O,b as X}from"./avatar-oBOSifLN.js";import{S as N}from"./skeleton-DSiYFg9q.js";import{d as g}from"./differenceInMilliseconds-D_qISUSz.js";function ne({range:o,horarios:r,fetchHorarios:b,loading:l}){const{isMobile:d}=G(),c=p.useRef(null);p.useEffect(()=>{c.current&&queueMicrotask(()=>{const s=c.current.getApi(),t=d?"listWeek":"timeGridWeek";s.view.type!==t&&s.changeView(t)})},[d]);const x=(Array.isArray(r)?r:[]).filter(s=>s.horario_inicio&&s.horario_fin).map(s=>({id:s.id,title:s.turno.nombre,start:s.horario_inicio,end:s.horario_fin,backgroundColor:s.turno.color,extendedProps:{hora_inicion:s.hora_inicio,hora_fin:s.hora_fin,turnoDescription:s.turno.descripcion,modalidadDescription:s.modalidad.description,type:s.modalidad.name??"N/A",center:s.centro.nombre??"N/A",centroEmail:s.centro.email??"N/A",description:s.descripcion??"Sin descripción"}})),u=x.length>0?x.reduce((s,t)=>{const a=new Date(t.start),n=new Date(t.end),m=a.getHours()*3600+a.getMinutes()*60,j=n.getHours()*3600+n.getMinutes()*60;return{start:s.start===void 0?m:Math.min(s.start,m),end:s.end===void 0?j:Math.max(s.end,j)}},{}):{start:21600},f=s=>`${String(Math.floor(s/3600)).padStart(2,"0")}:00:00`,i=s=>{const t=s.startStr.split("T")[0],a=s.endStr.split("T")[0],n=new Date(a);n.setDate(n.getDate()-1);const m=n.toISOString().split("T")[0];b(t,m)},h=s=>{const t=s.view.type==="timeGridWeek",a=s.view.type==="dayGridMonth";return s.view.type,e.jsxs("div",{className:"w-full h-full rounded-2xl p-2 bg-custom-gray-default dark:bg-custom-gray-darker text-custom-black dark:text-custom-white shadow-md shadow-custom-black/15 dark:shadow-custom-black/80 flex flex-col justify-between",style:{border:`4px solid ${s.event.backgroundColor}`},children:[e.jsx("div",{className:"w-fit max-w-full py-0.5 px-2 rounded-xl text-custom-black font-medium mb-1",style:{backgroundColor:s.event.backgroundColor},children:e.jsx(D,{children:e.jsxs(C,{children:[e.jsx($,{children:e.jsx("p",{className:"text-xs font-bold text-wrap",children:s.event.title})}),e.jsx(F,{children:a?e.jsxs("div",{className:"text-xs space-y-2",children:[e.jsx("p",{children:s.event.extendedProps.center}),e.jsx("p",{children:s.event.extendedProps.modalidadDescription}),e.jsx("p",{children:s.event.extendedProps.turnoDescription}),e.jsxs("p",{children:[s.event.extendedProps.hora_inicion," - ",s.event.extendedProps.hora_fin]})]}):e.jsx("p",{className:"text-xs",children:s.event.extendedProps.turnoDescription})})]})})}),s.event.extendedProps.type==="vacations"?e.jsx("div",{className:"w-fit p-2 rounded-full text-custom-black",style:{backgroundColor:s.event.backgroundColor},children:e.jsx(w,{name:"TreePalm",size:"14"})}):e.jsxs("div",{children:[t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center text-xs text-nowrap overflow-hidden italic mb-2",children:[e.jsx("div",{className:"min-w-4 w-4 mr-1",children:e.jsx(A,{modalidad:s.event.extendedProps.type})}),e.jsx(D,{children:e.jsxs(C,{children:[e.jsx($,{children:e.jsx("p",{className:"text-xs font-bold",children:s.event.extendedProps.center})}),e.jsx(F,{children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("p",{className:"text-xs font-bold",children:s.event.extendedProps.center}),e.jsx("p",{className:"text-xs",children:s.event.extendedProps.modalidadDescription}),e.jsx("p",{className:"text-xs mt-2",children:s.event.extendedProps.centroEmail})]})})]})})]}),e.jsx("div",{className:"flex items-center text-xs italic",children:s.timeText||"N/A"})]}),(a||d)&&e.jsxs("div",{className:"flex flex-col text-xs text-nowrap overflow-hidden italic",children:[e.jsxs("p",{className:"text-xs",children:[s.event.extendedProps.hora_inicion," - ",s.event.extendedProps.hora_fin]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"min-w-4 w-4 mr-1",children:e.jsx(A,{modalidad:s.event.extendedProps.type})}),e.jsx("p",{className:"text-xs font-bold",children:s.event.extendedProps.center})]})]})]})]})};return e.jsxs(e.Fragment,{children:[l&&e.jsx(q,{}),e.jsx("section",{className:`${l&&"hidden"}`,children:e.jsx(V,{ref:c,locale:"es",scrollTime:"00:00:00",datesSet:i,plugins:[z,J,L,U],headerToolbar:{left:"prev today next",center:"",right:d?"":"timeGridWeek,dayGridMonth"},initialView:d?"listWeek":"timeGridWeek",editable:!1,selectable:!1,selectMirror:!0,dayMaxEvents:!1,events:x,allDaySlot:!1,eventContent:h,buttonText:{today:`${o.from} - ${o.to}`,month:"Mes",week:"Semana",day:"Día",list:"Lista"},firstDay:1,slotLabelFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},slotMinTime:f(u.start),slotMaxTime:"24:00:00"})})]})}function oe({horarios:o}){var f;const r=S().props.auth.user,b=S().props.jetstream,[l,d]=p.useState({fichajeReal:"00:00",totalHoras:"00:00",balance:"00:00"}),c=p.useRef(!1);p.useEffect(()=>{if(!c.current&&Array.isArray(o)&&o.length>0){const i=x(o);d(i),c.current=!0}},[o]);const x=i=>{const h={msFichajeTotal:0,msTeoricoTotal:0},s=i.reduce((a,n)=>{const{horario_inicio:m,horario_fin:j,descanso_inicio:y,descanso_fin:v,fichaje_entrada:k,fichaje_salida:T,descansosAdicionales:M}=n,H=y&&v?g(v,y):0,E=g(j,m),P=k&&T?g(T,k):0,R=P&&M?M.reduce((W,_)=>W+g(_.descanso_fin,_.descanso_inicio),0):0;return a.msFichajeTotal+=Math.max(0,P-R),a.msTeoricoTotal+=Math.max(0,E-H),a},h),t=s.msFichajeTotal-s.msTeoricoTotal;return{fichajeReal:u(s.msFichajeTotal),totalHoras:u(s.msTeoricoTotal),balance:u(t)}};function u(i){const h=i<0?"-":i>0?"+":"",s=Math.abs(i);let t=parseInt(s/(1e3*60)%60),a=Math.floor(s/(1e3*60*60));return a=a<10?"0"+a:a,t=t<10?"0"+t:t,`${h}${a}:${t}`}return e.jsxs("div",{className:"lg:flex gap-12 space-y-8",children:[e.jsx("div",{className:"m-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"h-20 w-20 rounded-full ml-2",children:b.managesProfilePhotos?e.jsx(O,{src:r.profile_photo_url,alt:r.name}):e.jsx(X,{className:"rounded-lg",children:r.name})}),e.jsx("div",{className:"ml-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex truncate text-lg font-semibold pt-2",children:(r==null?void 0:r.name)||"N/A"}),e.jsxs("span",{className:"truncate text-xs flex pt-2",children:[e.jsx(w,{name:"Mail",size:16,className:"mr-2 text-custom-orange"}),(r==null?void 0:r.email)||"N/A"]}),e.jsxs("span",{className:"truncate text-xs flex pt-2",children:[e.jsx(w,{name:"Phone",size:16,className:"mr-2 text-custom-orange"}),((f=r==null?void 0:r.empleado)==null?void 0:f.telefono)||"N/A"]})]})})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row w-full items-end justify-end space-y-4 md:space-y-0 md:space-x-4",children:[l.fichajeReal!=="00:00"?e.jsxs("div",{className:"rounded-lg p-2 bg-custom-gray-default dark:bg-custom-gray-darker w-full md:w-fit",children:[e.jsx("h2",{className:"font-semibold mb-2 text-custom-orange",children:"Jornada semanal efectuada"}),e.jsx("p",{className:"text-sm",children:`${l.fichajeReal} horas`})]}):e.jsx(N,{className:"h-full w-48"}),l.totalHoras!=="00:00"?e.jsxs("div",{className:"rounded-lg p-2 bg-custom-gray-default dark:bg-custom-gray-darker w-full md:w-fit",children:[e.jsx("h2",{className:"font-semibold mb-2 text-custom-orange",children:"Jornada semanal total"}),e.jsx("p",{className:"text-sm",children:`${l.totalHoras} horas`})]}):e.jsx(N,{className:"h-full w-40"}),l.balance!=="00:00"?e.jsxs("div",{className:"rounded-lg p-2 bg-custom-gray-default dark:bg-custom-gray-darker w-full md:w-fit",children:[e.jsx("h2",{className:"font-semibold mb-2 text-custom-orange",children:"Balance de horas"}),e.jsx("p",{className:`text-sm ${l.balance.startsWith("-")?"text-muted-foreground":"text-green-500"}`,children:`${l.balance} horas`})]}):e.jsx(N,{className:"h-full w-36"})]})]})}export{ne as C,oe as U};
