import{r as l,j as e}from"./app-fwyInB3c.js";import{S as R}from"./SheetTable-oFCbTdfY.js";import{L as D}from"./LoadingSpinner-CiiXDndn.js";import{T as F,a as _,b,c as v}from"./tabs-DtCm3GAf.js";import{I as d}from"./LucideIcon-CEqEhMjI.js";import{A as z}from"./alert-D9izbOQG.js";import{A as B,a as H,b as U}from"./avatar-oBOSifLN.js";import{B as w}from"./BlockCard-TCX704se.js";import{S as M}from"./switch-C4_FZWz0.js";import{L as I}from"./label-zCtqi3J5.js";import{T as V}from"./TextInput-B-VFdlBC.js";import{u as $}from"./useTranslation-BtIkv0Na.js";import"./sheet-DHc5Hgr8.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-DloWbRVd.js";import"./index-B7srb2QZ.js";import"./index-BIJodELy.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./index-v24TFYKQ.js";import"./index-C_F9oucK.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./index-4A9uUPu1.js";import"./index-BZgm3BCW.js";import"./input-CqlBlYgU.js";function Es({dataId:p,open:N,onOpenChange:k}){var g;const{t:h}=$(["datatable"]),[x,i]=l.useState(null),[y,S]=l.useState(!0),[n,T]=l.useState([]),[t,c]=l.useState(null),[m,C]=l.useState(null),[u,L]=l.useState(""),f=m==null?void 0:m.filter(s=>s.name.toLowerCase().includes(u.toLowerCase()));l.useEffect(()=>((async()=>{try{const[r,a]=await Promise.all([axios.get(route("api.v1.admin.roles.show",{id:p})),axios.get(route("api.v1.admin.modules.index"))]);r.status===200?c(r.data.role):i(!0),a.status===200?C(a.data.modules):i(!0)}catch(r){i(!0),console.error("Error fetching data:",r)}finally{S(!1)}})(),()=>{}),[p]);const P=async(s,r)=>{try{const a=await axios.put(route("api.v1.admin.roles.permission.switch",{role:s,permission:r}));if(console.log("response :>> ",a.data.roleHasPermission),a.status===200){const o=await axios.get(route("api.v1.admin.roles.show",{id:s}));return o.status===200?c(o.data.role):i(!0),a.data.roleHasPermission}}catch(a){i(!0),console.error("Error changing permission:",a)}},E=async(s,r)=>{try{const a=await axios.put(route("api.v1.admin.users.role.switch",{user:s,role:r}));if(console.log("response :>> ",a.data),a.status===200){const o=await axios.get(route("api.v1.admin.roles.show",{id:r}));return o.status===200?c(o.data.role):i(!0),a.data.roleHasPermission}}catch(a){i(!0),console.error("Error changing permission:",a)}};return e.jsx(R,{title:e.jsx("span",{className:"text-custom-orange",children:t&&t.name}),open:N,onOpenChange:k,className:"min-w-[600px] no-scrollbar",descriptionContent:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"text-custom-black dark:text-custom-white",children:[t&&t.description&&e.jsx("div",{className:"p-4 mb-4 rounded-xl bg-custom-gray-light dark:bg-custom-blackSemi",children:t.description}),t&&e.jsxs(F,{defaultValue:"permisos",className:"w-auto",children:[e.jsxs(_,{className:"flex flex-col sm:flex-row items-center gap-4 mb-4 w-full",children:[e.jsx(b,{value:"permisos",className:"w-full",children:h("tables.permisos")}),e.jsx(b,{value:"usuarios",className:"w-full",children:h("tables.usuarios")})]}),e.jsxs(v,{value:"permisos",children:[e.jsx(V,{type:"text",placeholder:"Buscar...",value:u,onChange:s=>L(s.target.value),className:"ml-auto w-1/2"}),e.jsx("div",{className:"max-h-[calc(100vh-350px)] overflow-y-auto dark:dark-scrollbar mt-4",children:e.jsx(w,{title:"Permisos",marginLeft:"ml-4",className:"border-4 rounded-xl p-4 mb-6 text-custom-blackLight dark:text-custom-gray-default",children:f&&f.map(s=>{const r=t==null?void 0:t.permissions.filter(a=>s.permissions.some(o=>o.id===a.id)).length;return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between space-y-4",children:[e.jsx("p",{children:s.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-xs font-bold text-custom-orange",children:[r," / ",s.permissions.length]}),e.jsxs("div",{className:"flex items-center w-fit p-2 mr-2 rounded-lg bg-custom-gray-default dark:bg-custom-blackSemi hover:opacity-50 duration-300 cursor-pointer select-none",onClick:()=>T(s.id===n?null:s.id),children:["editar permisos",n===s.id?e.jsx(d,{name:"ChevronUp",className:"w-4 h-4 ml-2 text-custom-orange"}):e.jsx(d,{name:"ChevronDown",className:"w-4 h-4 ml-2"})]})]})]}),n===s.id&&e.jsx("div",{className:"absolute mt-2 right-4 bg-white dark:bg-custom-blackSemi p-4 rounded-lg shadow-lg z-10",children:s.permissions.map(a=>{var j;const o=(j=t==null?void 0:t.permissions)==null?void 0:j.some(A=>A.id===a.id);return e.jsxs("div",{className:"flex items-center justify-between gap-2 space-y-4",children:[e.jsx(I,{htmlFor:a.name,className:"capitalize",children:a.name}),e.jsx(M,{id:a.name,checked:o,className:"data-[state=checked]:bg-custom-orange",onCheckedChange:()=>P(t.id,a.id)})]},a.id)})})]},s.id)})})})]}),e.jsx(v,{value:"usuarios",children:e.jsx("div",{className:"dark:dark-scrollbar max-h-[calc(100vh-300px)] overflow-y-auto",children:e.jsx(w,{title:"Usuarios",marginLeft:"ml-4",className:"border-4 rounded-xl p-4 mb-6 text-custom-blackLight dark:text-custom-gray-default",children:(g=t==null?void 0:t.users)==null?void 0:g.map(s=>e.jsxs("div",{className:"flex flex-row w-full items-center justify-start mb-4",children:[e.jsx(B,{className:"h-12 w-12 rounded-full",children:s!=null&&s.profile_photo_url?e.jsx(H,{src:s==null?void 0:s.profile_photo_url,alt:s==null?void 0:s.name}):e.jsx(U,{className:"rounded-lg",children:s==null?void 0:s.name[0]})}),e.jsxs("div",{className:"flex flex-col ml-4",children:[e.jsx("span",{className:"text-sm",children:s==null?void 0:s.name}),e.jsx("span",{className:"text-xs opacity-75",children:s==null?void 0:s.email})]}),e.jsx("div",{onClick:()=>E(s.id,t.id),className:"ml-auto mr-4",children:e.jsx(d,{name:"Trash",size:"16"})})]},s.id))})})})]}),y&&!x&&e.jsx(D,{}),x&&e.jsx(z,{variant:"destructive",children:"Error Fetching Data"})]})})})}export{Es as SheetTable};
