import{r as g,a as W,R as T,j as x,G as be}from"./app-fwyInB3c.js";import{useDataHandler as le}from"./DataHandlerContext-BFIpl_ls.js";import{b as Se,c as xe,d as we,e as De,f as Ee,D as ve}from"./dialog-iaZkf6Xy.js";import{B as ye}from"./button-Blwr-A5N.js";import{I as re}from"./LucideIcon-CEqEhMjI.js";import{L as Ce}from"./label-zCtqi3J5.js";import{A as Ie}from"./AdvanceDropdown-CXptW6sy.js";import{f as se}from"./dateUtils-B_14HGRQ.js";import{o as Ae,a as Te,e as ne,c as Ve,s as K,f as ae,i as je,Z}from"./types-BZmDMmQb.js";import{toast as P}from"./index-WlsBA3k2.js";import{DateTimeSection as Ne,AdditionalDetailsSection as Re}from"./FormSections-BOaE6Vup.js";import{FileUploadSection as Me}from"./FileUploadSection-CYpiNal_.js";import"./ViewContext-ChS6KolG.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-DloWbRVd.js";import"./index-B7srb2QZ.js";import"./index-BIJodELy.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./utils-CytzSlOG.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./index-BwobEAja.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./AdvanceDropdown-qoEi4BOz.js";import"./Create-tmHr2JLD.js";import"./AuthenticatedLayout-B4CSARVj.js";import"./sidebar-CPh6C6LB.js";import"./input-CqlBlYgU.js";import"./separator-BWKairMX.js";import"./sheet-DHc5Hgr8.js";import"./skeleton-DSiYFg9q.js";import"./tooltip-DFfoxvAF.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./index-CeuhGnKJ.js";import"./dropdown-menu-bHoOJ61X.js";import"./index-C_F9oucK.js";import"./index-v24TFYKQ.js";import"./popover-DaRbHQOK.js";import"./avatar-oBOSifLN.js";import"./PopUpIncidencias-CaovAEi3.js";import"./card-DYkZYgg5.js";import"./Button-CQuYVLGu.js";import"./textarea-C969rVin.js";import"./useTranslation-BtIkv0Na.js";import"./UserAvatar-cKyxDEhx.js";import"./ApplicationLogo-C2FcO4AY.js";import"./Yoopta-Dj4Guze5.js";import"./throttle-CmSTFqON.js";import"./PrimaryButton-SsXyLm2e.js";import"./DecisionModal-Dl8siGBG.js";import"./alert-dialog-kDfn0La3.js";import"./useNotifications-CSWGH93r.js";import"./ShowNotificactionFromJestream-cKOlvVdg.js";import"./OnboardingModal-D0HRNKzO.js";import"./Modal-BkRna8gK.js";import"./transition-ByAjZSmr.js";import"./StepItem-bNLmZaq8.js";import"./StepProgress-DNpLodXf.js";import"./WelcomeContent-BPJ5E7_N.js";import"./onboardingImages-CoczwfNn.js";import"./AboutContent-DOlAXyok.js";import"./TeamContent-C0DysUYq.js";import"./CreateLanguageForm-xwtvYsjX.js";import"./checkbox-BQT_ir1e.js";import"./index-BxSEkZvI.js";import"./index-4A9uUPu1.js";import"./alert-D9izbOQG.js";import"./InputSkeleton-CFMfUb-2.js";import"./table-cS0UKUSm.js";import"./GlobalFilter-DNA5td8x.js";import"./DataTableContext-BYrqyX0i.js";import"./index-Z1g0u-qm.js";import"./TableDebugging-C1u6ii1k.js";import"./AdvancedHeader-CpvwMmYr.js";import"./command-PoUoScut.js";import"./badge-BgloL8Ae.js";import"./select-B5O0TxCl.js";import"./DatePicker-YJSItPq7.js";import"./calendar-DctTJhwg.js";import"./endOfWeek-DoVA-Yvp.js";import"./toDate-qOSwr3PX.js";import"./format-Be40hyfq.js";import"./constants-BKFt95HM.js";import"./addDays-B9Fzl-_R.js";import"./parseISO-Efi0RkWR.js";import"./RowActionsColumn-CM2slffX.js";import"./RowActionsTrigger-DnJzXomR.js";import"./EmpleadoAvatar-BBWI_HPN.js";import"./ColumnFilter-oxYUebdb.js";import"./multi-select-BSyp-qjs.js";import"./Pill-l4GaXyto.js";import"./StatusEmpleadoMapColor-Bp2doaTo.js";import"./RowActionsColumn-C3VJw1Sg.js";import"./RowActionsTrigger-C2PXJFNn.js";import"./RowCheckedColumn-BShQ1j9z.js";import"./CreateUpdateDialog-1qQQjI_x.js";import"./useApiEndpoints-CHm1F3ft.js";import"./GoogleAddress-DWOptz48.js";import"./Map-D73hm0ip.js";import"./index.modern-WcJlzckG.js";import"./useDebounce-xNcQ83OW.js";import"./FetchSelect-CvqHmH4Y.js";import"./Spinner-DPRe7Z_J.js";import"./SheetTable-CiCNZjvD.js";import"./SheetTable-oFCbTdfY.js";import"./tabs-DtCm3GAf.js";import"./SheetTableHeader-vhJO3F_n.js";import"./ContratosVigentesDialog-SpBmuJuH.js";import"./DataHandlerContext--vx6a3_3.js";import"./WeekDay-C1ZcXS4Y.js";import"./GetModalidadIcon-BUgIPR97.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./es-DNLwfvrq.js";import"./PermisoAdvanceDropdown-CMmjCTaL.js";import"./StatusTipoPermisoMapColor-uADlCWR0.js";import"./PermisoStatsInline-Bx30kg1z.js";import"./charts-D-b4h_4c.js";import"./index-DpIruHMc.js";import"./PieChart-DDiBUCNq.js";import"./PolarAngleAxis-CNFzyAg3.js";import"./FileUploadArea-uzmkw7Uv.js";const de=1,te={empleado_id:null,permiso_id:de,fecha_inicio:se(new Date),fecha_fin:se(new Date),hora_inicio:"",hora_fin:"",motivo:"",dia_completo:!1,files:[],recuperable:!1,estado_id:1},ke=Ae({empleado_id:ae.number({invalid_type_error:"Debe seleccionar un empleado.",required_error:"Debe seleccionar un empleado."}).int("ID de empleado debe ser un entero.").positive("Debe seleccionar un empleado.").nullable().refine(e=>e!==null,"Debe seleccionar un empleado."),permiso_id:ae.number({invalid_type_error:"Tipo de permiso inv√°lido.",required_error:"Tipo de permiso requerido."}).int("ID de permiso debe ser un entero.").positive("Tipo de permiso inv√°lido.").default(de),fecha_inicio:K().min(1,"La fecha de inicio es requerida.").regex(/^\d{4}-\d{2}-\d{2}$/,"Formato de fecha de inicio inv√°lido (YYYY-MM-DD)."),fecha_fin:K().min(1,"La fecha de fin es requerida.").regex(/^\d{4}-\d{2}-\d{2}$/,"Formato de fecha de fin inv√°lido (YYYY-MM-DD)."),hora_inicio:K().optional(),hora_fin:K().optional(),motivo:K().min(1,"El motivo es requerido.").max(1e3,"El motivo no puede exceder los 1000 caracteres."),dia_completo:ne(),files:Ve(je(File)).optional().default([]),recuperable:ne(),estado_id:Te().int().positive("El estado es inv√°lido.")}).superRefine((e,h)=>{if(e.fecha_inicio===e.fecha_fin&&!e.dia_completo&&(e.hora_inicio?/^([01]\d|2[0-3]):([0-5]\d)$/.test(e.hora_inicio)||h.addIssue({code:Z.custom,path:["hora_inicio"],message:"Formato de hora de inicio inv√°lido (HH:MM)."}):h.addIssue({code:Z.custom,path:["hora_inicio"],message:"La hora de inicio es requerida si no es d√≠a completo."}),e.hora_fin?/^([01]\d|2[0-3]):([0-5]\d)$/.test(e.hora_fin)||h.addIssue({code:Z.custom,path:["hora_fin"],message:"Formato de hora de fin inv√°lido (HH:MM)."}):h.addIssue({code:Z.custom,path:["hora_fin"],message:"La hora de fin es requerida si no es d√≠a completo."}),e.hora_inicio&&e.hora_fin&&/^([01]\d|2[0-3]):([0-5]\d)$/.test(e.hora_inicio)&&/^([01]\d|2[0-3]):([0-5]\d)$/.test(e.hora_fin)&&e.hora_fin<=e.hora_inicio&&h.addIssue({code:Z.custom,path:["hora_fin"],message:"La hora de fin debe ser posterior a la hora de inicio."})),e.fecha_inicio&&e.fecha_fin){const u=/^\d{4}-\d{2}-\d{2}$/.test(e.fecha_inicio),c=/^\d{4}-\d{2}-\d{2}$/.test(e.fecha_fin);if(u&&c){const w=new Date(e.fecha_inicio+"T00:00:00");new Date(e.fecha_fin+"T00:00:00")<w&&h.addIssue({code:Z.custom,path:["fecha_fin"],message:"La fecha de fin no puede ser anterior a la fecha de inicio."})}}}),X=e=>{if(!e)return"";const h=e.getFullYear(),i=(e.getMonth()+1).toString().padStart(2,"0"),u=e.getDate().toString().padStart(2,"0");return`${h}-${i}-${u}`},ce={START:"09:00",END:"17:00"},ee={START:["00:00","02:00"],END:["23:59","01:59"]},Le=(e=null,h=!1)=>{const[i,u]=g.useState(te),[c,w]=g.useState(void 0),[b,y]=g.useState(null),[a,p]=g.useState({}),[_,d]=g.useState({hora_inicio:"",hora_fin:""}),[r,m]=g.useState(!1),l=!!e,n=(b==null?void 0:b.duracion)||null,s=n?Math.floor(n/(1e3*60*60*24)):null,t=i.fecha_inicio&&i.fecha_fin&&i.fecha_inicio===i.fecha_fin,F=i.fecha_inicio&&i.fecha_fin&&i.fecha_inicio!==i.fecha_fin,D=t&&!F,C=D&&!i.dia_completo,$=o=>{let f="",S="",E=!!o.dia_completo;return o.fecha_inicio&&(f=new Date(o.fecha_inicio).toTimeString().slice(0,5)),o.fecha_fin&&(S=new Date(o.fecha_fin).toTimeString().slice(0,5)),ee.START.includes(f)&&ee.END.includes(S)&&(E=!0),{horaInicio:f,horaFin:S,esDiaCompleto:E}},N=()=>{u(te),w(void 0),y(null),p({}),d({hora_inicio:"",hora_fin:""}),m(!1)},J=o=>{var H,V;if(!o||!o.id){console.error("üîç [usePermisoForm] Invalid permiso data for edit:",o);return}m(!0);const{horaInicio:f,horaFin:S,esDiaCompleto:E}=$(o);d({hora_inicio:f,hora_fin:S});const A={empleado_id:((H=o.empleado)==null?void 0:H.id)||o.empleado_id||null,permiso_id:((V=o.permiso)==null?void 0:V.id)||null,fecha_inicio:o.fecha_inicio?X(new Date(o.fecha_inicio)):"",fecha_fin:o.fecha_fin?X(new Date(o.fecha_fin)):"",hora_inicio:E?"":f,hora_fin:E?"":S,motivo:o.motivo||"",dia_completo:E,recuperable:!!o.recuperable,estado_id:o.estado_id||te.estado_id,files:[]};if(u(A),o.fecha_inicio&&o.fecha_fin){const U={from:new Date(o.fecha_inicio),to:new Date(o.fecha_fin)};w(U)}o.permiso&&y(o.permiso),setTimeout(()=>{m(!1)},100)},z=o=>{if(o){const f={hora_inicio:i.hora_inicio||_.hora_inicio,hora_fin:i.hora_fin||_.hora_fin};d(f),u(S=>({...S,dia_completo:!0,hora_inicio:"",hora_fin:""}))}else{let f=_.hora_inicio,S=_.hora_fin;(!f||ee.START.includes(f))&&(f=ce.START),(!S||ee.END.includes(S))&&(S=ce.END),u(E=>({...E,dia_completo:!1,hora_inicio:f,hora_fin:S})),d({hora_inicio:f,hora_fin:S})}},R=(o,f)=>{o==="dia_completo"?z(f):q(o,f),a[o]&&p(S=>{const E={...S};return delete E[o],E})},q=(o,f)=>{if(o==="files"){const S=Array.isArray(f)?f:f?[f]:[];u(E=>({...E,[o]:S}))}else u(S=>({...S,[o]:f}));(o==="hora_inicio"||o==="hora_fin")&&!i.dia_completo&&!r&&d(S=>({...S,[o]:f}))},M=o=>{(b==null?void 0:b.id)!==(o==null?void 0:o.id)&&(y(o),w(void 0),d({hora_inicio:"",hora_fin:""}),u(f=>({...f,permiso_id:(o==null?void 0:o.id)||null,fecha_inicio:"",fecha_fin:"",dia_completo:!1,hora_inicio:"",hora_fin:""})))},Y=o=>{w(o)},B=()=>{const o=ke.safeParse(i);if(!o.success){const f=o.error.flatten().fieldErrors,S={};return Object.entries(f).forEach(([E,A])=>{S[E]=A[0]}),p(S),null}return p({}),o.data};return g.useEffect(()=>{if(!r&&(c!=null&&c.from)&&(c!=null&&c.to)){const o=X(c.from),f=X(c.to);(i.fecha_inicio!==o||i.fecha_fin!==f)&&u(S=>({...S,fecha_inicio:o,fecha_fin:f}))}},[c==null?void 0:c.from,c==null?void 0:c.to,r]),g.useEffect(()=>{r||F&&(!i.dia_completo||i.hora_inicio||i.hora_fin)&&u(o=>({...o,dia_completo:!0,hora_inicio:"",hora_fin:""}))},[F,i.dia_completo,i.hora_inicio,i.hora_fin,r]),{formData:i,dateRange:c,selectedPermiso:b,errors:a,isInitializing:r,isEditing:l,maxDurationMs:n,maxDurationDays:s,isSingleDay:t,shouldForceFullDay:F,canShowCheckbox:D,canShowTimeFields:C,resetForm:N,initializeFormForEdit:J,handleInputChange:R,handlePermisoSelect:M,handleDateRangeChange:Y,validateForm:B,setErrors:p,setFormData:u}};function $e(){const[e,h]=g.useState(null),[i,u]=g.useState(!1),[c,w]=g.useState(!1),b=async(r,m)=>{var l,n;w(!0);try{const s=`/api/v1/admin/solicitudes/${r}/folder/${m}`;if((await W.delete(s)).status===200)return P.success("Archivo eliminado correctamente"),!0}catch(s){console.error("Error al eliminar archivo:",s);const t=((n=(l=s.response)==null?void 0:l.data)==null?void 0:n.message)||"Error al eliminar el archivo";return P.error(t),!1}finally{w(!1),u(!1),h(null)}};return{fileToDelete:e,showDeleteFileDialog:i,isDeletingFile:c,initiateFileDelete:(r,m,l=null)=>{h({permisoId:r,file:m,onSuccess:l}),u(!0)},confirmDeleteFile:async()=>{if(!e)return;await b(e.permisoId,e.file.hash)&&e.onSuccess&&e.onSuccess(e.file)},cancelFileDelete:()=>{u(!1),h(null)},addFilesToForm:(r,m,l)=>{const s=(Array.isArray(r)?r:Array.from(r)).filter(t=>!m.some(D=>D.name===t.name&&D.size===t.size&&D.lastModified===t.lastModified));s.length>0&&l(t=>{const F=[...t.files||[],...s];return{...t,files:F}})},removeFileFromForm:(r,m)=>{m(l=>{const n=l.files.filter((s,t)=>t!==r);return{...l,files:n}})},executeFileDelete:b}}function ze(e,h){const[i,u]=g.useState(new Set),[c,w]=g.useState(!1),b=g.useRef(null);g.useEffect(()=>{b.current||(b.current={permiso_id:e.permiso_id,fecha_inicio:e.fecha_inicio,fecha_fin:e.fecha_fin,hora_inicio:e.hora_inicio,hora_fin:e.hora_fin,motivo:e.motivo,dia_completo:e.dia_completo})},[]),g.useEffect(()=>{if(!b.current)return;const t=b.current;(e.permiso_id!==t.permiso_id||e.fecha_inicio!==t.fecha_inicio||e.fecha_fin!==t.fecha_fin||e.hora_inicio!==t.hora_inicio||e.hora_fin!==t.hora_fin||e.motivo!==t.motivo||e.dia_completo!==t.dia_completo)&&w(!0)},[e]);const y=g.useCallback(t=>{u(F=>new Set([...F,t])),w(!0)},[]),a=()=>{u(new Set(["empleado_id","permiso_id","fecha","motivo","hora_inicio","hora_fin"])),w(!0)},p=(t=[])=>{u(F=>{const D=new Set(F);return t.forEach(C=>D.delete(C)),D})},_=()=>{u(new Set),w(!1)};g.useEffect(()=>{var F,D;!e.permiso_id&&!e.motivo&&!e.hora_inicio&&!e.hora_fin&&e.fecha_inicio===((F=b.current)==null?void 0:F.fecha_inicio)&&e.fecha_fin===((D=b.current)==null?void 0:D.fecha_fin)&&(u(new Set),w(!1),b.current=null)},[e]);const d=g.useMemo(()=>!(!["permiso_id","fecha_inicio","fecha_fin","motivo"].every(D=>{const C=e[D];return D==="permiso_id"?C!=null&&C!==""&&C>0:C!=null&&C!==""})||!e.dia_completo&&(!e.hora_inicio||!e.hora_fin||e.hora_inicio>=e.hora_fin)),[e]),r=g.useMemo(()=>{if(!e.fecha_inicio||!e.fecha_fin||!(h!=null&&h.duracion))return{isValid:!0,message:""};const t=new Date(e.fecha_inicio),F=new Date(e.fecha_fin),D=Math.abs(F-t),C=Math.ceil(D/(1e3*60*60*24))+1,$=h.duracion,N=Math.floor($/(1e3*60*60*24));return C>N?{isValid:!1,message:`La duraci√≥n m√°xima permitida es de ${N} d√≠a(s)`}:{isValid:!0,message:""}},[e.fecha_inicio,e.fecha_fin,h]),m=g.useMemo(()=>{if(!e.fecha_inicio||!e.fecha_fin)return{isValid:!0,message:""};const t=new Date(e.fecha_inicio),F=new Date(e.fecha_fin);return new Date().setHours(0,0,0,0),t.setHours(0,0,0,0),F.setHours(0,0,0,0),t>F?{isValid:!1,message:"La fecha de inicio no puede ser posterior a la fecha de fin"}:{isValid:!0,message:""}},[e.fecha_inicio,e.fecha_fin]),l=g.useMemo(()=>e.dia_completo?{isValid:!0,message:""}:!e.hora_inicio||!e.hora_fin?{isValid:!1,message:"Las horas de inicio y fin son requeridas"}:e.hora_inicio>=e.hora_fin?{isValid:!1,message:"La hora de inicio debe ser anterior a la hora de fin"}:{isValid:!0,message:""},[e.dia_completo,e.hora_inicio,e.hora_fin]),n=g.useMemo(()=>{if(!c)return[];const t=[];return(!e.empleado_id||e.empleado_id<=0)&&t.push("Debe seleccionar un empleado"),(!e.permiso_id||e.permiso_id<=0)&&t.push("Debe seleccionar un tipo de permiso"),(!e.motivo||e.motivo.trim()==="")&&t.push("El motivo es requerido"),!m.isValid&&(i.has("fecha")||c)&&t.push(m.message),!l.isValid&&(i.has("hora_inicio")||i.has("hora_fin")||c&&!e.dia_completo)&&t.push(l.message),t},[m,l,r,c,i,e.dia_completo,e.fecha_inicio,e.fecha_fin,e.empleado_id,e.permiso_id,e.motivo]),s=n.length>0;return{isFormValid:d,hasValidationErrors:s,validationErrors:n,dateValidation:m,timeValidation:l,durationValidation:r,hasUserInitiatedAction:c,touchedFields:i,markFieldAsTouched:y,markAllFieldsAsTouched:a,clearTouchedFields:p,resetUserInteraction:_}}function qe(){const[e,h]=g.useState(!1),i=a=>{console.log("üîç [Admin] Frontend - Datos originales del formulario:",a);const _=["empleado_id","permiso_id","fecha_inicio","fecha_fin","motivo"].filter(r=>{const m=a[r];return!m||typeof m=="string"&&m.trim()===""});if(_.length>0)throw new Error(`Campos requeridos faltantes: ${_.join(", ")}`);if(a.dia_completo===void 0||a.dia_completo===null)throw new Error("El campo dia_completo es requerido");if(a.files&&Array.isArray(a.files)&&a.files.length>0){const r=new FormData,m={};return Object.entries(a).forEach(([l,n])=>{if(l==="files")n.forEach(s=>r.append("files[]",s));else if(l==="permiso_id"||l==="empleado_id"){const s=parseInt(n,10);r.append(l,s.toString())}else typeof n=="boolean"?r.append(l,n?"1":"0"):n!=null&&r.append(l,n||"")}),{requestData:r,headers:m}}else{const r={},m={"Content-Type":"application/json"};return Object.entries(a).forEach(([l,n])=>{l!=="files"&&(l==="permiso_id"||l==="empleado_id"?r[l]=parseInt(n,10):l==="dia_completo"||l==="recuperable"?r[l]=!!n:n!=null&&(r[l]=n))}),{requestData:r,headers:m}}},u=async(a,p,_,d)=>d?p instanceof FormData?(p.append("_method","PUT"),await W.post(a,p,{headers:_})):await W.put(a,p,{headers:_}):await W.post(a,p,{headers:_}),c=async a=>{console.log("üîç [Admin] Datos originales del formulario:",a);const{requestData:p,headers:_}=i(a);if(p instanceof FormData){console.log("üîç [Admin] Enviando como FormData:");for(let[r,m]of p.entries())console.log(`  ${r}: ${m} (tipo: ${typeof m})`)}else console.log("üîç [Admin] Enviando como JSON:",p);return console.log("üîç [Admin] Headers:",_),await u("/api/v1/admin/vacaciones",p,_,!1)},w=async(a,p)=>{const{requestData:_,headers:d}=i(a),r=`/api/v1/admin/vacaciones/${p}`;return await u(r,_,d,!0)};return{isSubmitting:e,createPermiso:c,updatePermiso:w,handleSubmit:async(a,p,_,d=null)=>{var r,m,l,n;h(!0);try{let s;if(p&&_?(s=await w(a,_),P.success("¬°Vacaciones actualizadas!",{description:"Los cambios en la solicitud de vacaciones han sido guardados correctamente.",duration:5e3})):(s=await c(a),P.success("¬°Vacaciones creadas!",{description:"La nueva solicitud de vacaciones ha sido creada correctamente."})),d&&typeof d=="function")try{d(s)}catch{}return s}catch(s){if((m=(r=s.response)==null?void 0:r.data)!=null&&m.errors){const t=Object.values(s.response.data.errors).flat();P.error("Errores de validaci√≥n",{description:t.join(", "),duration:8e3})}else{const t=((n=(l=s.response)==null?void 0:l.data)==null?void 0:n.message)||(p?"Error al actualizar las vacaciones":"Error al crear las vacaciones");P.error("Error",{description:t,duration:5e3})}throw s}finally{h(!1)}},getSolicitudDetails:async a=>{var p,_;try{const d=`/api/v1/admin/vacaciones/${a}`,r=await W.get(d);if(r.data&&r.data.solicitud)return r.data.solicitud;throw new Error("No se pudieron obtener los detalles de la solicitud de vacaciones")}catch(d){console.error("Error al obtener detalles de la solicitud de vacaciones:",d);const r=((_=(p=d.response)==null?void 0:p.data)==null?void 0:_.message)||"Error al cargar los detalles de la solicitud de vacaciones";throw P.error(r),d}}}}function He(e=null){const[h,i]=g.useState(e),[u,c]=g.useState(!1);g.useEffect(()=>{i(e)},[e==null?void 0:e.id]);const{formData:w,dateRange:b,selectedPermiso:y,errors:a,isInitializing:p,isEditing:_,maxDurationMs:d,maxDurationDays:r,isSingleDay:m,shouldForceFullDay:l,canShowCheckbox:n,canShowTimeFields:s,resetForm:t,initializeFormForEdit:F,handleInputChange:D,handlePermisoSelect:C,handleDateRangeChange:$,validateForm:N,setErrors:J,setFormData:z}=Le(e),{fileToDelete:R,showDeleteFileDialog:q,isDeletingFile:M,initiateFileDelete:Y,confirmDeleteFile:B,cancelFileDelete:o}=$e(),{isFormValid:f,hasValidationErrors:S,validationErrors:E,dateValidation:A,timeValidation:H,durationValidation:V,hasUserInitiatedAction:U,touchedFields:G,markFieldAsTouched:ie,markAllFieldsAsTouched:Q,clearTouchedFields:O,resetUserInteraction:k}=ze(w,y),{isSubmitting:me,handleSubmit:fe,getSolicitudDetails:he}=qe();return{formData:w,dateRange:b,selectedPermiso:y,errors:a,isInitializing:p,setFormData:z,fullModel:h,isLoadingCompleteData:u,isEditing:_,maxDurationMs:d,maxDurationDays:r,isSingleDay:m,shouldForceFullDay:l,canShowCheckbox:n,canShowTimeFields:s,isFormValid:f,hasValidationErrors:S,validationErrors:E,dateValidation:A,timeValidation:H,durationValidation:V,hasUserInitiatedAction:U,touchedFields:G,markFieldAsTouched:ie,markAllFieldsAsTouched:Q,clearTouchedFields:O,resetUserInteraction:k,fileToDelete:R,showDeleteFileDialog:q,isDeletingFile:M,initiateFileDelete:Y,confirmDeleteFile:B,cancelFileDelete:o,handleFilesAdd:I=>{const v=Array.isArray(I)?I:I?[I]:[];z(j=>({...j,files:v}))},handleFileRemove:I=>{z(v=>{const oe=(v.files||[]).filter((pe,L)=>L!==I);return{...v,files:oe}})},handleExistingFileDelete:I=>{h!=null&&h.id&&Y(h.id,I,v=>{i(j=>{if(!j)return j;const oe=j.files.filter(L=>{const _e=L.id&&v.id&&L.id===v.id,ge=L.hash&&v.hash&&L.hash===v.hash,Fe=L.name===v.name&&L.size===v.size;return!(_e||ge||Fe)});return{...j,files:oe}}),!G.has("fecha")&&!G.has("fecha_inicio")&&G.has("fecha_fin")})},isSubmitting:me,handleFormSubmit:async(I=null)=>{Q();const v=N();if(!v)return!1;try{return await fe(v,_,e==null?void 0:e.id,I)}catch(j){return console.error("Form submission failed:",j),!1}},resetForm:t,initializeForEdit:async I=>{if(!I||!I.id){console.error("initializeForEdit: data is invalid",I);return}try{c(!0);const v=await he(I.id);i(v),F(v)}catch(v){console.error("Error al cargar detalles completos:",v),i(I),F(I)}finally{c(!1)}},handleInputChange:D,handlePermisoSelect:C,handleDateRangeChange:$,validateForm:N,setErrors:J}}const ue=g.forwardRef(({form:e,updateForm:h,model:i,isLoading:u,error:c,onStateChange:w},b)=>{const y=!!i,{formData:a,dateRange:p,selectedPermiso:_,isInitializing:d,maxDurationMs:r,canShowCheckbox:m,canShowTimeFields:l,shouldForceFullDay:n,isFormValid:s,hasValidationErrors:t,validationErrors:F,markFieldAsTouched:D,fileToDelete:C,showDeleteFileDialog:$,isDeletingFile:N,confirmDeleteFile:J,cancelFileDelete:z,isSubmitting:R,initializeForEdit:q,handleInputChange:M,handleDateRangeChange:Y,validateForm:B,handleFilesAdd:o,handleFileRemove:f,handleExistingFileDelete:S,handleFormSubmit:E,fullModel:A,isLoadingCompleteData:H}=He(i);g.useImperativeHandle(b,()=>({handleFormSubmit:E,isFormValid:s,isSubmitting:R,formData:a,validateForm:B}),[E,s,R,a,B]);const V=T.useCallback(w,[]);g.useEffect(()=>{V&&V({isFormValid:s,isSubmitting:R,hasValidationErrors:t,validationErrors:F})},[s,R,t,F,V]);const U=T.useRef(!1);g.useEffect(()=>{y&&(i!=null&&i.id)&&!d&&q&&!U.current&&(U.current=!0,q(i)),i!=null&&i.id||(U.current=!1)},[i==null?void 0:i.id,d,q]);const G=T.useCallback(O=>{const k=parseInt(O,10);isNaN(k)||k<=0||M("empleado_id",k)},[M]),ie=T.useMemo(()=>y&&(A!=null&&A.files)?A.files:[],[y,A==null?void 0:A.files]),Q=T.useMemo(()=>a.files||[],[a.files]);return d||H?x.jsxs("div",{className:"flex items-center justify-center p-8",children:[x.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-custom-orange"}),x.jsx("span",{className:"ml-2 text-custom-gray-dark dark:text-custom-gray-light",children:"Cargando datos de la vacaci√≥n..."})]}):x.jsxs("div",{className:"space-y-4",children:[x.jsxs("div",{className:"flex flex-col gap-1",children:[x.jsxs(Ce,{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Empleado ",x.jsx("span",{className:"text-custom-orange",children:"*"})]}),x.jsx(Ie,{defaultValue:a.empleado_id,onChangeValue:(O,k)=>{G(O),D("empleado_id")},className:"w-full rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",placeholder:"Seleccionar empleado..."})]}),x.jsx(Ne,{dateRange:p,onDateRangeChange:Y,formData:a,onInputChange:M,canShowCheckbox:m,canShowTimeFields:l,shouldForceFullDay:n,maxDurationMs:r,selectedPermiso:_,validationErrors:F,markFieldAsTouched:D,empleadoId:a.empleado_id}),x.jsx(Re,{formData:a,onInputChange:M,canShowCheckbox:m,validationErrors:F,markFieldAsTouched:D}),x.jsx(Me,{existingFiles:ie,newFiles:Q,onFilesAdd:o,onFileRemove:f,onExistingFileDelete:S,showDeleteDialog:$,fileToDelete:C,onConfirmDelete:J,onCancelDelete:z,isDeletingFile:N,isEditing:y}),t&&x.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-3",children:[x.jsx("h4",{className:"text-sm font-medium text-red-800 mb-2",children:"Por favor, corrige los siguientes errores:"}),x.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:F.map((O,k)=>x.jsxs("li",{className:"flex items-start",children:[x.jsx("span",{className:"mr-2",children:"‚Ä¢"}),O]},k))})]}),R&&x.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded p-3 text-center",children:x.jsx("div",{className:"text-sm text-blue-700",children:y?"Actualizando vacaci√≥n...":"Creando vacaci√≥n..."})})]})});ue.displayName="FormFields";const Ue=T.memo(ue),Oe={id:null,empleado_id:null,permiso_id:1,fecha_inicio:"",fecha_fin:"",hora_inicio:"",hora_fin:"",motivo:"",dia_completo:!1,recuperable:!1,estado_id:1,files:[]};function Pe({model:e,onOpenChange:h}){const{closeAllViews:i,updateData:u}=le(),c=T.useRef(),w=be(Oe),b=g.useMemo(()=>!!e,[e]),y=T.useCallback(n=>{typeof n=="object"&&w.setData(s=>({...s,...n}))},[w.setData]),a=T.useCallback(async()=>{if(c.current&&c.current.handleFormSubmit)try{return await c.current.handleFormSubmit(s=>{try{s&&s.data&&s.data.solicitud&&u(s.data.solicitud),i()}catch(t){console.error("Error in success callback:",t);try{i()}catch(F){console.error("Error closing modal:",F)}}})}catch(n){return console.error("Submit error:",n),!1}else return console.warn("FormFields ref not available"),!1},[i,u]),[p,_]=T.useState(!1),[d,r]=T.useState(!1),m=T.useCallback(()=>{if(c.current){const n=c.current.isFormValid||!1,s=c.current.isSubmitting||!1;n!==p&&_(n),s!==d&&r(s)}},[]),l=T.useCallback(n=>{_(s=>n.isFormValid!==s?n.isFormValid:s),r(s=>n.isSubmitting!==s?n.isSubmitting:s)},[]);return T.useEffect(()=>{m()},[]),x.jsxs(Se,{className:"sm:max-w-[600px] max-h-[80vh] flex flex-col bg-white dark:bg-custom-blackLight",children:[x.jsxs(xe,{className:"flex-shrink-0",children:[x.jsxs(we,{className:"text-xl font-bold text-custom-blue dark:text-custom-white",children:[x.jsx(re,{name:b?"Pencil":"Plus",className:"inline mr-2",size:20}),b?"Editar Solicitud de Vacaciones":"Nueva Solicitud de Vacaciones"]}),x.jsx(De,{className:"text-custom-gray-dark dark:text-custom-gray-light",children:b?"Modifica los detalles de la solicitud de vacaciones.":"Complete los detalles para crear una nueva solicitud de vacaciones."})]}),x.jsx("div",{className:"flex-1 overflow-y-auto pr-2",children:x.jsx(Ue,{ref:c,form:w,updateForm:y,model:e,isLoading:d,error:w.errors,onStateChange:l})}),x.jsx(Ee,{className:"flex-shrink-0 flex flex-col sm:flex-row gap-2 pt-4 border-t border-custom-gray-light dark:border-custom-gray-darker",children:x.jsxs(ye,{onClick:a,disabled:d,className:"w-full sm:w-auto rounded-full bg-custom-orange hover:bg-custom-blue text-white",children:[x.jsx(re,{name:d?"Loader2":b?"Save":"Plus",className:`mr-2 ${d?"animate-spin":""}`,size:16}),d?b?"Guardando...":"Creando...":b?"Guardar Cambios":"Crear Vacaciones"]})})]})}const Ye=g.memo(function({open:h,onOpenChange:i,model:u=null,onSaveData:c=null}){return x.jsx(ve,{open:h,onOpenChange:i,children:x.jsx(Pe,{model:u,onOpenChange:i})})});function yt(){const{viewStates:e,closeAllViews:h}=le(),{open:i,model:u}=e.createUpdate;return x.jsx(Ye,{model:u,open:i,onOpenChange:()=>{h()}})}export{yt as default};
