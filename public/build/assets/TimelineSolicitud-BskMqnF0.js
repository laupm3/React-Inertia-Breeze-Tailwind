import{j as o}from"./app-fwyInB3c.js";import{I as z}from"./LucideIcon-CEqEhMjI.js";import{U as P}from"./UserAvatar-cKyxDEhx.js";import"./createLucideIcon-DoJ0Kelj.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./x-2mzC_aTV.js";const b=t=>{if(!t)return"--/--/--";const n=new Date(t);return isNaN(n.getTime())?"--/--/--":n.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"}).replace(/\.$/,"")},C=t=>{if(!t||!t.estado)return[{titulo:"Permiso solicitado",fecha:"--/--/--",completado:!1,icono:"ArrowUp",aprobador:null,observacion:null,esRechazo:!1},{titulo:"En Revisión",fecha:"--/--/--",completado:!1,icono:"Search",aprobador:null,observacion:null,esRechazo:!1},{titulo:"En Proceso",fecha:"--/--/--",completado:!1,icono:"Loader",aprobador:null,observacion:null,esRechazo:!1},{titulo:"Resultado Final",fecha:"--/--/--",completado:!1,icono:"Check",aprobador:null,observacion:null,esRechazo:!1}];const{aprobaciones:n,estado:s,fecha_inicio:m,seen_at:a,updated_at:d,created_at:x,requiere_aprobacion_manager:u,requiere_aprobacion_hr:f,is_cancelled:v}=t,e=[{titulo:"Permiso solicitado",fecha:b(m||x),completado:!0,icono:"ArrowUp",aprobador:null,observacion:null,esRechazo:!1,esAutomatico:!1},{titulo:"En Revisión",fecha:a?b(a):"--/--/--",completado:!1,icono:"Search",aprobador:null,observacion:null,esRechazo:!1,esAutomatico:!1},{titulo:"En Proceso",fecha:"--/--/--",completado:!1,icono:"Loader",aprobador:null,observacion:null,esRechazo:!1,esAutomatico:!1},{titulo:"Resultado Final",fecha:"--/--/--",completado:!1,icono:"Check",aprobador:null,observacion:null,esRechazo:!1,esAutomatico:!1}];if(v||s.nombre==="Cancelación")return e[0].completado=!0,e[1].completado=!0,e[2].completado=!0,e[3].completado=!0,e[3].titulo="Permiso Cancelado",e[3].fecha=b(d),e[3].icono="XCircle",e[3].esRechazo=!0,e[3].observacion="Solicitud de cancelación por el usuario",e;const r=n==null?void 0:n.find(l=>l.tipo_aprobacion==="manager"),i=n==null?void 0:n.find(l=>l.tipo_aprobacion==="hr");r?(e[1].fecha=b(r.created_at),e[1].titulo=r.aprobado?"Encargado (Aprobado)":"Encargado (Rechazado)",e[1].aprobador=r.approvedBy,e[1].observacion=r.observacion,e[1].esRechazo=!r.aprobado,e[1].esAutomatico=r.is_automatic||!1):a&&s.nombre==="Solicitado"?e[1].titulo="En Revisión (Visto)":u===!1&&s.nombre!=="Solicitado"&&(e[1].titulo="Encargado (No Req.)");const R=r?r.aprobado:u===!1;R?i?(e[2].fecha=b(i.created_at),e[2].titulo=i.aprobado?"RRHH (Aprobado)":"RRHH (Rechazado)",e[2].aprobador=i.approvedBy,e[2].observacion=i.observacion,e[2].esRechazo=!i.aprobado,e[2].esAutomatico=i.is_automatic||!1):f===!1&&(s.nombre==="Aprobado"||s.nombre==="Denegado"||s.nombre==="Aprobado RRHH"||s.nombre==="Pendiente RRHH")?(e[2].titulo="RRHH (No Req.)",r&&(e[2].fecha=b(r.created_at))):s.nombre==="Pendiente RRHH"&&(e[2].titulo="RRHH (En Proceso)",r&&(e[2].fecha=b(r.created_at))):r&&!r.aprobado&&(e[2].titulo="RRHH (Cancelado)",e[2].fecha=b(r.created_at));let p=d||x;const c=[...n||[]].filter(l=>l.tipo_aprobacion==="manager"&&u!==!1||l.tipo_aprobacion==="hr"&&f!==!1).sort((l,g)=>new Date(g.created_at)-new Date(l.created_at));switch(c.length>0&&(p=c[0].created_at),(s.nombre==="Aprobado"||s.nombre==="Denegado")&&(e[3].fecha=b(p),c.length>0&&(e[3].aprobador=c[0].approvedBy,e[3].observacion=c[0].observacion,e[3].esRechazo=s.nombre==="Denegado")),s.nombre){case"Cancelación":break;case"Solicitado":a&&!r&&(e[1].completado=!0);break;case"Pendiente RRHH":e[0].completado=!0,e[1].completado=!0;break;case"Aprobado RRHH":e[0].completado=!0,e[1].completado=!0,e[2].completado=!0;break;case"Aprobado":e[0].completado=!0,e[1].completado=!0,e[2].completado=!0,e[3].completado=!0,e[3].titulo="Permiso Aprobado",c.length>0&&(e[3].aprobador=c[0].approvedBy,e[3].observacion=c[0].observacion,e[3].esRechazo=!1,e[3].esAutomatico=c[0].is_automatic||!1),!r&&u!==!1?e[1].titulo="Revisión Encargado":!r&&u===!1&&(e[1].titulo="Encargado (No Req.)"),!i&&f!==!1&&R?e[2].titulo="Proceso RRHH":!i&&f===!1&&R&&(e[2].titulo="RRHH (No Req.)");break;case"Denegado":e[0].completado=!0,e[3].completado=!0,e[3].titulo="Permiso Denegado",c.length>0&&(e[3].aprobador=c[0].approvedBy,e[3].observacion=c[0].observacion,e[3].esRechazo=!0,e[3].esAutomatico=c[0].is_automatic||!1),r?(e[1].completado=!0,r.aprobado,e[2].completado=!0):(e[1].completado=!0,e[2].completado=!0);break}return e},D=(t,n,s,m)=>{if(!t)return 0;if(n&&t==="Solicitado"&&!s)return 1;switch(t){case"Cancelación":return 3;case"Solicitado":return 0;case"Pendiente RRHH":return 2;case"Aprobado RRHH":return 2;case"Aprobado":case"Denegado":return 3;default:let a=-1;for(let d=0;d<m.length&&m[d].completado;d++)a=d;return a===m.length-1&&(t==="Aprobado"||t==="Denegado")?m.length-1:a<m.length-1?a+1:a}},Y=({permiso:t})=>{var x,u,f,v;if(!t)return null;const n=C(t),s=(x=t.aprobaciones)==null?void 0:x.find(e=>e.tipo_aprobacion==="manager"),m=D((u=t.estado)==null?void 0:u.nombre,t.seen_at,s,n);let a=((f=t.estado)==null?void 0:f.nombre)||"Solicitado";t.seen_at&&a==="Solicitado"&&!s?m===1&&(a="En revisión"):m===2&&(a==="Pendiente RRHH"||a==="Aprobado RRHH")?a="En proceso":m===3&&(a==="Aprobado"||a==="Denegado"||a==="Cancelación")&&(a=(v=t.estado)==null?void 0:v.nombre);let d="0%";return a==="Solicitado"?d="13%":a==="En revisión"?d="36%":a==="En proceso"||a==="Pendiente RRHH"||a==="Aprobado RRHH"?d="63%":(a==="Aprobado"||a==="Denegado"||a==="Cancelación")&&(d="100%"),o.jsxs("div",{className:"mt-4 px-2",children:[o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"absolute left-0 right-0 top-[60px] h-1 bg-gray-200 dark:bg-gray-700 z-0",style:{transform:"translateY(-50%)"},children:o.jsx("div",{className:"absolute left-0 top-0 h-full bg-custom-orange transition-all duration-300",style:{width:d}})}),o.jsx("div",{className:"flex justify-between relative z-10",children:n.map((e,r)=>{var H,j,A,y,N,_;const i=m===r,R=e.completado,p=r===n.length-1;let c="bg-gray-200 dark:bg-gray-500",l="text-gray-400 dark:text-gray-300",g="bg-gray-300 dark:bg-gray-600 border-none",h="text-gray-600 dark:text-gray-400",k="text-gray-500 dark:text-gray-500";return R&&(p&&((H=t.estado)==null?void 0:H.nombre)==="Denegado"?(c="bg-red-600/30 dark:bg-red-600/30",l="text-red-600 dark:text-red-400",g="bg-red-600 border-red-600",h="text-red-600 dark:text-red-400 font-bold"):p&&((j=t.estado)==null?void 0:j.nombre)==="Cancelación"?(c="bg-orange-600/30 dark:bg-orange-600/30",l="text-orange-600 dark:text-orange-400",g="bg-orange-600 border-orange-600",h="text-orange-600 dark:text-orange-400 font-bold"):p&&((A=t.estado)==null?void 0:A.nombre)==="Aprobado"?(c="bg-green-100 dark:bg-green-900",l="text-green-500 dark:text-green-400",g="bg-green-500 border-green-600",h="text-green-600 dark:text-green-400 font-bold"):(c="bg-custom-orange/30 dark:bg-custom-orange/30",l="text-custom-orange dark:text-custom-orange",g="bg-custom-orange border-custom-orange dark:border-custom-orange",h="text-custom-orange dark:text-custom-orange")),i&&!(p&&(((y=t.estado)==null?void 0:y.nombre)==="Aprobado"||((N=t.estado)==null?void 0:N.nombre)==="Denegado"||((_=t.estado)==null?void 0:_.nombre)==="Cancelación"))&&(c="bg-custom-orange/30 dark:bg-custom-orange/30",l="text-custom-orange dark:text-custom-orange",g="bg-custom-orange border-custom-orange dark:border-custom-orange ring-custom-orange dark:ring-custom-orange ring-offset-1 dark:ring-offset-gray-800",h="text-custom-orange dark:text-custom-orange font-bold",k="text-gray-500 dark:text-gray-500"),o.jsxs("div",{className:"flex flex-col items-center text-center w-1/4 px-1",children:[o.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center mb-2 ${c}`,children:e.icono&&o.jsx(z,{name:e.icono,size:20,className:l})}),o.jsx("div",{className:`w-5 h-5 rounded-full border-2 ${g} mb-2`}),o.jsxs("div",{className:"min-h-[100px] flex flex-col justify-start items-center space-y-1 gap-4",children:[o.jsxs("div",{className:`text-xs font-medium ${h} h-8 flex items-center justify-center`,children:[o.jsx("div",{className:"sm:hidden sm:text-lg text-[10px] leading-tight text-center",children:e.titulo.includes("(")?e.titulo.split("(")[0].trim():e.titulo}),o.jsx("div",{className:"hidden sm:block text-center ",children:e.titulo})]}),o.jsx("div",{className:`text-xs ${k} h-4 flex items-center justify-center`,children:e.fecha!=="--/--/--"?`(${e.fecha})`:""}),o.jsx("div",{className:"min-h-[60px] flex flex-col justify-start pt-2 items-center gap-1 space-y-1",children:e.aprobador?o.jsxs(o.Fragment,{children:[o.jsx(P,{user:e.aprobador,showName:!1,size:"w-5 h-5"}),o.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 max-w-16 sm:max-w-none text-center mt-1",children:[o.jsx("div",{className:"sm:hidden",children:e.aprobador.name.split(" ")[0]}),o.jsx("div",{className:"hidden sm:block",children:e.aprobador.name})]})]}):null})]})]},r)})})]}),n.some(e=>e.observacion&&e.esRechazo)&&o.jsxs("div",{className:"mt-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[o.jsxs("h4",{className:"text-sm font-semibold text-red-800 dark:text-red-200 mb-3 flex items-center gap-2",children:[o.jsx(z,{name:"AlertCircle",size:16}),"Motivos de rechazo"]}),o.jsx("div",{className:"space-y-3",children:n.map((e,r)=>{var i;return e.observacion&&e.esRechazo&&o.jsxs("div",{className:"border-l-4 border-red-400 pl-4",children:[o.jsxs("div",{className:"text-sm font-medium text-red-700 dark:text-red-300",children:[e.titulo," - ",(i=e.aprobador)==null?void 0:i.name]}),o.jsx("div",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:e.observacion}),o.jsx("div",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:e.fecha!=="--/--/--"&&`Rechazado el ${e.fecha}`})]},r)})})]})]})};export{Y as default};
