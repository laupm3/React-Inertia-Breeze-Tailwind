import{r as o,j as t,a as S}from"./app-fwyInB3c.js";import{B as m}from"./button-Blwr-A5N.js";import{I as he}from"./input-CqlBlYgU.js";import{D as N,a as C,b as v,d as K}from"./dropdown-menu-bHoOJ61X.js";import{I as l}from"./LucideIcon-CEqEhMjI.js";import{R as b}from"./RenderDinamicFilter-NN3FnG2M.js";import{C as fe}from"./calendar-DctTJhwg.js";import{P as pe,a as ge,b as xe}from"./popover-DaRbHQOK.js";import{toast as g}from"./index-WlsBA3k2.js";import{u as we}from"./useNotifications-CSWGH93r.js";import{u as ye}from"./useTranslation-BtIkv0Na.js";import{f as G}from"./format-Be40hyfq.js";import{e as be}from"./es-DNLwfvrq.js";import"./index-DloWbRVd.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-BIJodELy.js";import"./index-C_F9oucK.js";import"./index-B7srb2QZ.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./index-BZxTbISK.js";import"./index-v24TFYKQ.js";import"./check-5DjPwM22.js";import"./createLucideIcon-DoJ0Kelj.js";import"./chevron-right-B1iws4WK.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./chevron-up-OjKdrhzc.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./x-2mzC_aTV.js";import"./multi-select-BSyp-qjs.js";import"./separator-BWKairMX.js";import"./badge-BgloL8Ae.js";import"./command-PoUoScut.js";import"./index-DVo7DTeW.js";import"./dialog-iaZkf6Xy.js";import"./endOfWeek-DoVA-Yvp.js";import"./toDate-qOSwr3PX.js";import"./addDays-B9Fzl-_R.js";import"./constants-BKFt95HM.js";function pt({table:a,unreadCount:H,onMarkAllAsRead:U}){const[F,X]=o.useState(""),[M,J]=o.useState(!1),[R,Q]=o.useState(!1),[u,T]=o.useState([]),[w,V]=o.useState([]),[_,W]=o.useState([]),[h,D]=o.useState([]),[E,Y]=o.useState([]),[f,A]=o.useState([]),[O,Z]=o.useState([]),[r,k]=o.useState({from:null,to:null}),{t:c}=ye(["datatable"]),{markAsRead:ee,markAsUnread:te,refreshNotifications:$}=we(),y=o.useMemo(()=>[...u,...w,...h,...f,...r.from&&r.to?["date-range"]:[]].length,[u,w,h,f,r]),z=o.useMemo(()=>[{value:"unread",label:c("notifications.status.unread","No leídas"),icon:"Mail"},{value:"read",label:c("notifications.status.read","Leídas"),icon:"MailOpen"}],[c]),I=o.useMemo(()=>[10,20,30,40,50,100],[]),L=o.useCallback(({target:{value:e}})=>{X(e),a.setGlobalFilter(String(e))},[a]),P=o.useCallback(()=>{T([]),V([]),D([]),A([]),k({from:null,to:null}),["read_status","notifiable_model","action_model","sender_id","sent_at"].forEach(s=>{const n=a.getColumn(s);n&&n.setFilterValue(null)})},[a]),q=o.useCallback(e=>{T(e)},[]),se=o.useCallback(()=>t.jsx("div",{className:"w-full sm:max-w-sm",children:t.jsxs("div",{className:"relative",children:[t.jsx(l,{name:"Search",className:"dark:text-custom-white text-custom-gray-dark w-5 h-5 absolute left-3 top-1/2 transform -translate-y-1/2"}),t.jsx(he,{placeholder:`${c("datatable.search")}...`,value:F,onChange:L,className:"pl-10 rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi"})]})}),[F,L,c]),ae=o.useCallback(()=>t.jsxs(N,{open:M,onOpenChange:J,modal:!1,children:[t.jsx(C,{asChild:!0,children:t.jsxs(m,{variant:"secondary",className:"rounded-full bg-custom-gray-default dark:bg-custom-blackSemi hover:bg-custom-gray-light dark:hover:bg-accent focus:border-none",children:[c("tables.columnas")," ",t.jsx(l,{name:"ChevronDown",className:"w-4"})]})}),t.jsx(v,{align:"end",className:"bg-custom-gray-default dark:bg-custom-blackLight",onCloseAutoFocus:e=>e.preventDefault(),children:a.getAllColumns().filter(e=>e.getCanHide()).map(e=>t.jsx(K,{className:"capitalize",checked:e.getIsVisible(),onCheckedChange:s=>e.toggleVisibility(!!s),onSelect:s=>s.preventDefault(),children:e.id},e.id))})]}),[M,a,c]),oe=(e,s,n,d,me)=>{const[j,ue]=o.useState(me||null);return t.jsxs(N,{children:[t.jsx(C,{asChild:!0,children:t.jsxs(m,{variant:"secondary",className:"rounded-full bg-custom-gray-default dark:bg-custom-blackSemi hover:bg-custom-gray-light dark:hover:bg-accent focus:border-none",children:[j?`${e}: ${j}`:e," ",t.jsx(l,{name:"ChevronDown",className:"w-4"})]})}),t.jsx(v,{align:"end",className:"bg-custom-gray-default dark:bg-custom-blackLight",children:s.map(p=>t.jsx(K,{className:`capitalize focus:bg-custom-gray-semiLight ${j===p?"bg-custom-gray-dark text-white":""}`,checked:n(p),onCheckedChange:B=>{ue(B?p:null),d(p,B)},children:p},p))})]})},re=o.useCallback(()=>oe(c("tables.paginador"),I,e=>a.pageSize===e,(e,s)=>a.setPageSize(s?e:10),a.pageSize),[a.pageSize,c,I]),ne=o.useMemo(()=>t.jsxs(N,{open:R,onOpenChange:Q,modal:!1,children:[t.jsx(C,{asChild:!0,children:t.jsxs(m,{variant:"outline",className:"rounded-full bg-hidden border-none",children:["Filtros",y>0&&t.jsx("span",{className:"ml-1 min-w-[20px] h-[20px] inline-flex items-center justify-center bg-custom-orange text-white rounded-full text-xs",children:y}),t.jsx(l,{name:"SlidersHorizontal",className:"ml-1 w-5 text-custom-orange"})]})}),t.jsx(v,{align:"start",className:"bg-custom-white dark:bg-custom-blackLight rounded-2xl p-4",onCloseAutoFocus:e=>e.preventDefault(),children:t.jsxs("div",{className:"flex flex-col gap-4 w-full min-w-[20rem] max-w-[20rem]",children:[t.jsxs("div",{className:"flex justify-between items-center w-full",children:[t.jsx("h4",{className:"text-lg font-bold text-custom-blue dark:text-custom-white",children:"Filtros"}),y>0&&t.jsx(m,{className:"bg-transparent hover:bg-slate-200 dark:hover:bg-accent text-custom-blue dark:text-custom-white rounded-full",onClick:P,children:"Borrar Filtros"})]}),t.jsx("div",{className:"",children:t.jsx(b,{table:a,columnKey:"read_status",placeholder:"Estado de lectura",selectedValues:u,setSelectedValues:q,uniqueOptions:z})}),t.jsx("div",{className:"",children:t.jsx(b,{table:a,columnKey:"notifiable_model",placeholder:"Tipo de notificación",selectedValues:w,setSelectedValues:V,uniqueOptions:_})}),t.jsx("div",{className:"",children:t.jsx(b,{table:a,columnKey:"action_model",placeholder:"Tipo de acción",selectedValues:h,setSelectedValues:D,uniqueOptions:E})}),t.jsx("div",{className:"",children:t.jsx(b,{table:a,columnKey:"sender_id",placeholder:"Filtrar por remitente",selectedValues:f,setSelectedValues:e=>{A(e);const s=a.getColumn("sender_id");s&&s.setFilterValue(e)},uniqueOptions:O,searchable:!0})}),t.jsxs(pe,{children:[t.jsx(ge,{asChild:!0,children:t.jsx("div",{className:"relative",children:t.jsxs("button",{className:"w-full flex items-center justify-between rounded-full bg-custom-white dark:bg-custom-blackSemi border-2 px-3 py-2 text-sm text-custom-gray-darker dark:text-custom-white hover:bg-custom-gray-default dark:hover:bg-custom-blackLight",children:[r.from&&r.to?`${G(r.from,"dd/MM/yyyy")} - ${G(r.to,"dd/MM/yyyy")}`:"Rango de fechas",t.jsx(l,{name:"ChevronDown",className:"w-4 h-4 opacity-50"})]})})}),t.jsx(xe,{className:"w-auto p-4 bg-custom-white dark:bg-custom-blackLight border-none shadow-lg rounded-xl",align:"start",children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm text-custom-gray-darker dark:text-custom-white",children:"Seleccionar rango de fechas"}),r.from&&r.to&&t.jsx("button",{onClick:()=>{k({from:null,to:null});const e=a.getColumn("sent_at");e&&e.setFilterValue(null)},className:"text-xs text-custom-orange hover:text-custom-orange/80",children:"Limpiar selección"})]}),t.jsx(fe,{mode:"range",selected:r,onSelect:e=>{k(e||{from:null,to:null});const s=a.getColumn("sent_at");s&&s.setFilterValue(e!=null&&e.from&&(e!=null&&e.to)?e:null)},numberOfMonths:2,locale:be,className:"rounded-lg border-none",initialFocus:!0})]})})]})]})})]}),[R,y,P,u,z,q,w,_,h,E,f,O,r]);o.useEffect(()=>{const e=a.getColumn("read_status");e&&e.setFilterValue(u)},[u,a]),o.useEffect(()=>{(async()=>{try{const s=await S.get("/api/v1/admin/notifications/types");W(s.data.types)}catch(s){console.error("Error fetching notification types:",s)}})()},[]),o.useEffect(()=>{(async()=>{try{const s=await S.get("/api/v1/admin/notifications/actions");Y(s.data.actions)}catch(s){console.error("Error fetching action types:",s)}})()},[]),o.useEffect(()=>{(async()=>{try{const s=await S.get("/api/v1/admin/notifications/senders");Z(s.data.senders)}catch(s){console.error("Error fetching senders:",s)}})()},[]),o.useEffect(()=>{const e=a.getColumn("action_model");e&&e.setFilterValue(h)},[h,a]),o.useEffect(()=>{const e=a.getColumn("sender_id");e&&e.setFilterValue(f)},[f,a]),o.useEffect(()=>{const e=a.getColumn("sent_at");e&&e.setFilterValue(r.from&&r.to?r:null)},[r,a]);const i=a.getSelectedRowModel().rows,x=i.length>0,ce=async()=>{if(x)try{const e=i.map(d=>d.original.id),s=i.filter(d=>!d.original.is_read),n=s.length;if(n===0){g.info("Todas las notificaciones seleccionadas ya están marcadas como leídas"),a.resetRowSelection();return}await Promise.all(s.map(async d=>{await ee(d.original.id)})),g.success(`${n} notificaciones marcadas como leídas`),a.resetRowSelection(),await $(),a.resetRowSelection(),a.resetGlobalFilter()}catch(e){g.error("Error al marcar las notificaciones como leídas"),console.error(e)}},le=async()=>{if(x)try{const e=i.filter(n=>n.original.is_read),s=e.length;if(s===0){g.info("Todas las notificaciones seleccionadas ya están marcadas como no leídas"),a.resetRowSelection();return}await Promise.all(e.map(async n=>{await te(n.original.id)})),g.success(`${s} notificaciones marcadas como no leídas`),a.resetRowSelection(),await $(),a.resetRowSelection(),a.resetGlobalFilter()}catch(e){g.error("Error al marcar las notificaciones como no leídas"),console.error(e)}},ie=()=>{if(!x)return null;const e=i.filter(n=>n.original.is_read).length,s=i.length-e;return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(m,{onClick:ce,className:"bg-custom-white dark:bg-custom-blackSemi hover:bg-custom-gray-light dark:hover:bg-accent border-custom-orange border text-custom-orange rounded-full flex items-center gap-1",size:"sm",disabled:s===0,title:s>0?`Marcar ${s} como leídas`:"Todas las seleccionadas ya están leídas",children:[t.jsx(l,{name:"MailOpen",className:"w-4 h-4"}),t.jsxs("span",{children:["Leídas ",s>0?`(${s})`:""]})]}),t.jsxs(m,{onClick:le,className:"bg-custom-white dark:bg-custom-blackSemi hover:bg-custom-gray-light dark:hover:bg-accent border-custom-orange border text-custom-orange rounded-full flex items-center gap-1",size:"sm",disabled:e===0,title:e>0?`Marcar ${e} como no leídas`:"Todas las seleccionadas ya están no leídas",children:[t.jsx(l,{name:"Mail",className:"w-4 h-4"}),t.jsxs("span",{children:["No leídas ",e>0?`(${e})`:""]})]}),t.jsx(m,{onClick:()=>a.resetRowSelection(),className:"bg-transparent hover:bg-custom-gray-light dark:hover:bg-accent text-custom-gray-darker dark:text-custom-gray-light rounded-full",size:"sm",variant:"ghost",title:"Cancelar selección",children:t.jsx(l,{name:"X",className:"w-4 h-4"})})]})},de=o.useCallback(()=>t.jsx("span",{className:"absolute top-24 bg-custom-white dark:bg-custom-blackLight text-custom-blue dark:text-custom-white font-bold border-none text-lg px-2 capitalize",children:"Notificaciones"}),[]);return t.jsxs("div",{className:"grid",children:[de(),t.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap justify-between items-center m-2 gap-4",children:[t.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-4 w-full sm:w-auto",children:[x?t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"text-custom-gray-darker dark:text-custom-white text-sm",children:[i.length," seleccionadas"]}),ie()]}):ne,!x&&H>0&&t.jsx("button",{onClick:U,className:"text-xs text-custom-orange hover:text-custom-gray-darker dark:hover:text-custom-gray-light",children:c("notifications.actions.markAllAsRead","Marcar todas como leídas")})]}),t.jsxs("div",{className:"flex flex-wrap sm:flex-nowrap items-center gap-4 w-full sm:w-auto",children:[se(),ae(),re()]})]})]})}export{pt as default};
