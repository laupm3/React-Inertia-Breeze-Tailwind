import{r,j as e,a as re,A as oe}from"./app-fwyInB3c.js";import{u as ne}from"./index-C-xs73Vr.js";import{C as le,c as ie}from"./card-DYkZYgg5.js";import{L as ce}from"./label-zCtqi3J5.js";import{B as E}from"./button-Blwr-A5N.js";import{toast as f}from"./index-WlsBA3k2.js";import"./index-DpIruHMc.js";import"./tslib.es6-BUas5LQb.js";import"./utils-CytzSlOG.js";import"./index-BIJodELy.js";import"./index-DloWbRVd.js";import"./index-BwobEAja.js";const de=()=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-sliders-horizontal cursor-pointer",children:[e.jsx("line",{x1:"21",x2:"14",y1:"4",y2:"4"}),e.jsx("line",{x1:"10",x2:"3",y1:"4",y2:"4"}),e.jsx("line",{x1:"21",x2:"12",y1:"12",y2:"12"}),e.jsx("line",{x1:"8",x2:"3",y1:"12",y2:"12"}),e.jsx("line",{x1:"21",x2:"16",y1:"20",y2:"20"}),e.jsx("line",{x1:"12",x2:"3",y1:"20",y2:"20"}),e.jsx("line",{x1:"14",x2:"14",y1:"2",y2:"6"}),e.jsx("line",{x1:"8",x2:"8",y1:"10",y2:"14"}),e.jsx("line",{x1:"16",x2:"16",y1:"18",y2:"22"})]}),me=p=>e.jsx("svg",{width:"30",height:"30",viewBox:"0 0 15 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",...p,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.68396 3.05371C7.93172 3.05371 8.13257 3.29249 8.13257 3.58704V12.9661L10.9556 9.60992C11.1308 9.40164 11.4149 9.40164 11.5901 9.60992C11.7652 9.8182 11.7652 10.1559 11.5901 10.3642L8.00117 14.6309C7.91705 14.7308 7.80294 14.787 7.68396 14.787C7.56498 14.787 7.45087 14.7308 7.36675 14.6309L3.77788 10.3642C3.60268 10.1559 3.60268 9.8182 3.77788 9.60992C3.95307 9.40164 4.23712 9.40164 4.41231 9.60992L7.23535 12.9661V3.58704C7.23535 3.29249 7.4362 3.05371 7.68396 3.05371Z",fill:"#CBCBCB",stroke:"#CBCBCB"})});function ke({onClose:p,currentFolder:n,currentFiles:v,empleados:d,setIsFileUploadOpen:A}){const[x,b]=r.useState([]),[h,j]=r.useState(!1),[_,pe]=r.useState(n.hash),[y,N]=r.useState(n.path),[B,w]=r.useState(n.id),[l,D]=r.useState(""),[i,R]=r.useState(""),[c,z]=r.useState(""),[C,$]=r.useState("L1"),[m,P]=r.useState(""),[U,u]=r.useState(!1),[q,xe]=r.useState(d),S=r.useRef(null),[k,I]=r.useState(!1);r.useEffect(()=>{S.current.focus()},[]);const M=r.useCallback(s=>{b(a=>{const t=50-a.length,o=s.slice(0,t);return[...a,...o]})},[]),{getRootProps:T,getInputProps:H,isDragActive:O}=ne({onDrop:M,accept:{"application/pdf":[".pdf"],"application/zip":[".zip"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/vnd.ms-excel":[".xls"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"image/jpeg":[".jpg"],"image/png":[".png"],"image/webp":[".webp"],"text/csv":[".csv"]},maxFiles:100,maxSize:200*1024*1024,multiple:!0}),V=async()=>{if(x.length===0){f.error("Error: No hay archivos para subir. Seleccione uno o mÃ¡s archivos.");return}j(!0);const s=new FormData;x.forEach(a=>{s.append("files[]",a)}),s.append("folder_parent_id",B),s.append("nivel_seguridad",C),s.append("enviar_empresa",l),s.append("enviar_departamento",i),s.append("enviar_centro",c),s.append("path_folder_selected",y),s.append("id_empleado",n.id_empleado),s.append("enviar_todos",k),s.append("path_selected",y);try{const a=await re.post("/admin/files/upload",s,{headers:{"Content-Type":"multipart/form-data"}});oe.visit(`/user/folders/${_}`,{preserveState:!0}),f.success("Archivos subidos correctamente!")}catch(a){f.error(a.response.data.errors[0].error||"Error: No se han podido subir los archivos")}finally{j(!1),A(!1)}},g=n.path.split("/");g.pop();const G=s=>{if(s==n.id){w(n.id),N(n.path);return}const a=v.find(t=>t.id==s).path;w(s),N(a)},W=s=>{D(s.target.value),u(!0)},Z=s=>{R(s.target.value),u(!0)},J=s=>{z(s.target.value),u(!0)},K=s=>{$(s.target.value)},Q=[...new Set(d.flatMap(s=>s.empresas.map(a=>`${a.id}-${a.siglas}`)))].map(s=>{const[a,t]=s.split("-");return{id:a,siglas:t}}),X=[...new Set(d.flatMap(s=>s.departamentos.map(a=>`${a.id}-${a.nombre}`)))].map(s=>{const[a,t]=s.split("-");return{id:a,nombre:t}}),Y=[...new Set(d.flatMap(s=>s.centros.map(a=>`${a.id}-${a.nombre}`)))].map(s=>{const[a,t]=s.split("-");return{id:a,nombre:t}}),ee=s=>{const a=s.nombre.toLowerCase().includes(m.toLowerCase())||s.primerApellido.toLowerCase().includes(m.toLowerCase())||s.departamentos[0].nombre.toLowerCase().includes(m.toLowerCase());let t=!0;return U?(l&&l!==""&&(t=t&&s.empresas.some(o=>o.id==l)),i&&i!==""&&(t=t&&s.departamentos.some(o=>o.id==i)),c&&c!==""&&(t=t&&s.centros.some(o=>o.id==c)),a&&t):a},se=q.filter(ee),ae=s=>{b(a=>a.filter((t,o)=>o!==s))},te=s=>{I(s.target.checked)};return e.jsx("div",{className:"w-full bg-gray-50",children:e.jsxs(le,{className:"w-full max-h-[95dvh] shadow-lg rounded-lg overflow-hidden px-2 pt-3 pb-1",children:[e.jsxs("div",{className:"pl-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 dark:text-white mb-3",children:"Subir documentos"}),e.jsx("p",{className:"mb-3",children:"Carga archivos masivamente o individualmente"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"selectFolder",children:"Elige la carpeta "}),e.jsxs("select",{name:"selectFolder",id:"selectFolder",className:"block rounded-3xl border-gray-300 text-sm shadow-sm focus:ring-orange-500 focus:border-orange-500 dark:text-gray-900",onChange:s=>G(s.target.value),ref:S,children:[e.jsxs("option",{value:n.id,children:["Carpeta Actual (ðŸ“",g[g.length-1]=="Empleados"?" Principal":n.nombre,")"]}),v.filter(s=>s.tipo_fichero_id==1).sort((s,a)=>{const t=s.nombre,o=a.nombre,F=Number(t),L=Number(o);if(!isNaN(F)&&!isNaN(L))return F-L}).map((s,a)=>e.jsxs("option",{value:s.id,children:["ðŸ“‚ ",s.nombre]},a))]})]})]}),e.jsx(ie,{className:"flex-grow space-y-6 -ml-2",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{children:e.jsx("strong",{children:"Archivos"})}),e.jsxs("div",{...T(),id:"my-dropzone",className:"border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center p-6 bg-gray-50",children:[e.jsx("input",{...H()}),e.jsx(me,{className:"w-10 h-10 text-gray-400"}),O?e.jsx("span",{className:"text-sm font-medium text-gray-500 mt-2",children:"Suelta los archivos aquÃ­..."}):e.jsx("span",{className:"text-sm font-medium text-gray-500 mt-2",children:"Arrastra y suelta aquÃ­ para aÃ±adir archivos"}),e.jsx("span",{className:"text-xs text-gray-400",children:"PDF, zip, doc, docx, xls, xlsx, jpg, png, webp, csv"})]}),e.jsx("div",{className:"flex flex-wrap gap-3 py-1 pr-2 max-h-[146px] overflow-y-auto",children:x.map((s,a)=>e.jsxs("div",{className:"px-2 py-1 border border-custom-orange rounded inline-flex gap-2 items-center text-sm",children:[s.name,e.jsx("span",{className:"text-red-500 hover:text-red-300 cursor-pointer text-lg",onClick:()=>ae(a),children:"âœ˜"})]},a))}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(ce,{htmlFor:"security-type",className:"text-sm font-medium text-gray-800 dark:text-gray-300",children:"Tipo de seguridad del archivo"}),e.jsxs("select",{id:"security-type",className:"block mt-1 rounded-md border-gray-300 text-sm shadow-sm focus:ring-orange-500 focus:border-orange-500 dark:text-gray-900",value:C,onChange:K,children:[e.jsx("option",{value:"L1",children:"L1"}),e.jsx("option",{value:"L2",children:"L2"}),e.jsx("option",{value:"L3",children:"L3"})]}),e.jsxs("ul",{children:[e.jsxs("li",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"text-lg text-custom-orange mr-1",children:"*"}),"L1: No requiere autenticaciÃ³n"]}),e.jsx("li",{className:"text-xs text-gray-500 ml-3",children:"L2: Requiere contraseÃ±a"}),e.jsx("li",{className:"text-xs text-gray-500 ml-3",children:"L3: Requiere autenticaciÃ³n en 2 pasos"})]})]}),e.jsx("div",{children:e.jsxs("label",{htmlFor:"",children:["Enviar a toda la empresa",e.jsx("input",{type:"checkbox",name:"sendAll",id:"sendAll",className:"ml-3 border-gray-300 shadow-sm focus:ring-orange-500 focus:border-orange-500",checked:k,onChange:te})]})}),e.jsxs("div",{className:"w-full flex items-center gap-4",children:["EnviarÂ a",e.jsxs("select",{className:"w-full mt-1 rounded-md border-gray-300 text-xs shadow-sm focus:ring-orange-500 focus:border-orange-500 dark:text-gray-900",value:l,onChange:W,children:[e.jsx("option",{className:"font-bold text-sm mb-2",value:"",disabled:!0,children:"Empresas"}),e.jsx("option",{className:"font-bold mb-2",value:"",children:" "}),Q.map((s,a)=>e.jsx("option",{value:s.id,children:s.siglas},a))]}),e.jsxs("select",{className:"w-full block mt-1 rounded-md border-gray-300 text-xs shadow-sm focus:ring-orange-500 focus:border-orange-500 dark:text-gray-900",value:i,onChange:Z,children:[e.jsx("option",{className:"font-bold text-sm mb-2",value:"",disabled:!0,children:"Departamentos"}),e.jsx("option",{className:"font-bold mb-2",value:"",children:" "}),X.map((s,a)=>e.jsx("option",{value:s.id,children:s.nombre},a))]}),e.jsxs("select",{className:"w-full block mt-1 rounded-md border-gray-300 text-xs shadow-sm focus:ring-orange-500 focus:border-orange-500 dark:text-gray-900",value:c,onChange:J,children:[e.jsx("option",{className:"font-bold text-sm mb-2",value:"",disabled:!0,children:"Centros"}),e.jsx("option",{className:"font-bold mb-2",value:"",children:" "}),Y.map((s,a)=>e.jsx("option",{value:s.id,children:s.nombre},a))]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-3",children:[e.jsx("input",{type:"text",placeholder:"Buscar por nombre del empleado o departamento...",value:m,onChange:s=>P(s.target.value),className:"w-11/12 px-4 py-2 border rounded-3xl bg-[#F6F6F6] dark:bg-[#2C3034] text-sm text-[#575757] dark:text-[#F6F6F6] placeholder-[#575757]/80 dark:placeholder-[#F6F6F6]/80"}),e.jsx("span",{className:"inline-flex gap-3 cursor-pointer",onClick:()=>{},children:e.jsx(de,{})})]}),e.jsx("div",{className:"w-full max-h-[156px] overflow-y-auto pt-2",children:se.map((s,a)=>{var t;return e.jsxs("div",{className:"w-[24%] inline-flex items-center text-xs mr-1 mb-3",children:[e.jsx("div",{className:"",children:e.jsx("img",{src:s.user.profile_photo_url,alt:"",width:"25",height:"25",className:"rounded-full mr-2"})}),e.jsxs("div",{className:"inline-flex flex-col",children:[e.jsxs("span",{children:[s.nombre," ",s.primerApellido]}),e.jsxs("span",{children:[s.departamentos[0].nombre," ",(t=s.departamentos[1])==null?void 0:t.nombre]})]})]},a)})}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(E,{variant:"outline",className:"text-orange-500 border-orange-500 hover:bg-transparent hover:text-custom-gray-default mt-4 rounded-full",onClick:p,disabled:h,children:"Cancelar"}),e.jsx(E,{className:"bg-orange-500 text-white hover:bg-orange-600 mt-4 rounded-full",onClick:V,disabled:h,children:h?"Subiendo...":"Enviar archivos"})]})]})})]})})}export{ke as default};
