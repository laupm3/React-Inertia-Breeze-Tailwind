import{r as n,G as q,j as e}from"./app-fwyInB3c.js";import{f as B,c as V,d as A,e as R,b as O,D as G}from"./dialog-iaZkf6Xy.js";import{u as U}from"./useTranslation-BtIkv0Na.js";import{o as Q,s as D,a as X}from"./types-BZmDMmQb.js";import{toast as H}from"./index-WlsBA3k2.js";import{I}from"./input-CqlBlYgU.js";import"./separator-BWKairMX.js";import"./index.modern-WcJlzckG.js";import{P as J,a as W,b as Y}from"./popover-DaRbHQOK.js";import{u as Z}from"./useDebounce-xNcQ83OW.js";import{F as K}from"./FetchSelect-CvqHmH4Y.js";import"./AdvanceDropdown-qoEi4BOz.js";import"./avatar-oBOSifLN.js";import"./tooltip-DFfoxvAF.js";import"./DataTableContext-BYrqyX0i.js";import"./button-Blwr-A5N.js";import"./AdvancedHeader-CpvwMmYr.js";import{B as E}from"./Button-CQuYVLGu.js";import"./select-B5O0TxCl.js";import"./calendar-DctTJhwg.js";import"./multi-select-BSyp-qjs.js";import"./RowActionsTrigger-C2PXJFNn.js";import"./CreateUpdateDialog-1qQQjI_x.js";import"./sheet-DHc5Hgr8.js";import"./tabs-DtCm3GAf.js";import{I as P}from"./LucideIcon-CEqEhMjI.js";import"./DataHandlerContext--vx6a3_3.js";import{a as ee}from"./react-icons.esm-DXl_FId9.js";import{c as se}from"./utils-CytzSlOG.js";import{S as z,a as $}from"./scroll-area-CvQ1XCoU.js";import{f as ae}from"./format-Be40hyfq.js";import{e as te}from"./es-DNLwfvrq.js";import{S as g}from"./skeleton-DSiYFg9q.js";import{S as re}from"./Spinner-DPRe7Z_J.js";import{O as oe}from"./octagon-alert-BRAzZNeG.js";const ie=()=>{const{t:s}=U(["datatable"]);return Q({nombre:D().min(1,s?s("validation.required",{field:"nombre"}):"El nombre es requerido"),color:D().optional(),hora_inicio:D().min(1,s?s("validation.required",{field:"hora de inicio"}):"La hora de inicio es requerida"),hora_fin:D().min(1,s?s("validation.required",{field:"hora de fin"}):"La hora de fin es requerida"),centro_id:X({message:s?s("validation.required",{field:"centro"}):"El centro es requerido"}),descripcion:D().optional(),descanso_inicio:D().optional(),descanso_fin:D().optional()})},L={id:null,nombre:"",color:"",hora_inicio:"",hora_fin:"",centro_id:null,descripcion:"",descanso_inicio:"",descanso_fin:""},ne=s=>s?{id:s.id||null,nombre:s.nombre||"",color:s.color||"",hora_inicio:s.horaInicio||"",hora_fin:s.horaFin||"",centro_id:s.centro.id||null,descripcion:s.descripcion||"",descanso_inicio:s.descansoInicio||"",descanso_fin:s.descansoFin||""}:void 0,le=s=>n.useMemo(()=>({dataKey:"turno",show:s?route("api.v1.admin.turnos.show",{turno:s}):null,store:route("api.v1.admin.turnos.store"),update:s?route("api.v1.admin.turnos.update",{turno:s}):null,delete:s?route("api.v1.admin.turnos.destroy",{turno:s}):null}),[s]),M=n.createContext(null),ce=({children:s,model:a,onOpenChange:c,dataKey:i,onSaveData:d=null,modelAlias:x="registro"})=>{const[w,v]=n.useState(!1),[k,m]=n.useState(!1),[S,t]=n.useState(!1),[f,j]=n.useState(!1),l=le(a),u=q(L),T=ie();n.useEffect(()=>{const o=async()=>{try{t(!0),m(!1);const h=await axios.get(l.show);h.status===200?u.setData(ne(h.data[i])):m(!0)}catch(h){console.error("Error al cargar datos:",h),m(!0)}finally{t(!1)}};return u.clearErrors(),a?o():(u.setData(L),m(!1),t(!1)),()=>{}},[a]);const _=n.useCallback((o,h)=>{if(typeof o=="object"&&h===void 0){u.setData(b=>({...b,...o}));return}u.setData(b=>({...b,[o]:h}))},[u]),C=n.useCallback(()=>{const o=T.safeParse(u.data);if(u.clearErrors(),!o.success){const h=o.error.flatten().fieldErrors;Object.keys(h).forEach(b=>{u.setError(b,h[b][0])})}return o.success},[u,T]),r=n.useCallback(async()=>{try{j(!0),m(!1),u.clearErrors();const o=a?await axios.put(l.update,u.data):await axios.post(l.store,u.data);d&&d(o.data[i]),c(!1),u.clearErrors(),H.success(a?`Registro ${x} actualizado con éxito`:`Registro ${x} creado con éxito`)}catch(o){if(m(!0),o.response&&o.response.data&&o.response.data.errors){const{errors:h}=o.response.data;Object.keys(h).forEach(b=>{u.setError(b,h[b][0])})}H.error(a?`Error al actualizar el ${x}`:`Error al crear el ${x}`)}finally{j(!1)}},[a,l.update,l.store,u,d,c]),p=n.useCallback(()=>{C()&&r()},[C,r]),N=n.useMemo(()=>({modelAlias:x,model:a,error:k,form:u,updateForm:_,handleSubmit:p,setError:m,onOpenChange:c,isProcessing:w,isLoading:S,isSaving:f,setIsProcessing:v}),[x,a,k,u,_,p,c,w,S,f]);return e.jsx(M.Provider,{value:N,children:s})};function y(){const s=n.useContext(M);if(!s)throw new Error("useDialogData debe usarse dentro de DialogDataContextProvider");return s}const de=s=>{if(!(!s||s===""))try{const[a,c]=s.split(":").map(Number);if(isNaN(a)||isNaN(c))return;const i=new Date;return i.setHours(a,c,0,0),i}catch(a){console.warn("Error converting time string to date:",a);return}},me=s=>{if(!s||!(s instanceof Date)||isNaN(s.getTime()))return"";try{const a=s.getHours().toString().padStart(2,"0"),c=s.getMinutes().toString().padStart(2,"0");return`${a}:${c}`}catch(a){return console.warn("Error converting date to time string:",a),""}};function F({value:s,onChange:a,placeholder:c="HH:mm",disabled:i=!1,minuteStep:d=5,format:x="HH:mm",className:w,modal:v=!1,outputFormat:k="date"}){const m=r=>typeof r=="string"?de(r):r,[S,t]=n.useState(m(s)),[f,j]=n.useState(!1),l=s!==void 0?m(s):S,u=n.useMemo(()=>Array.from({length:24},(r,p)=>p),[]),T=n.useMemo(()=>Array.from({length:60/d},(r,p)=>p*d),[d]),_=n.useCallback(r=>{s===void 0&&t(r);const p=k==="string"?me(r):r;a==null||a(p)},[s,a,k]),C=n.useCallback((r,p)=>{const N=parseInt(p,10);if(!isNaN(N)&&!(r==="hour"&&(N<0||N>23))&&!(r==="minute"&&(N<0||N>59)))if(l&&l instanceof Date&&!isNaN(l.getTime())){const o=new Date(l.getTime());r==="hour"?o.setHours(N):r==="minute"&&o.setMinutes(N),_(o)}else{const o=new Date;o.setSeconds(0,0),r==="hour"?(o.setHours(N),o.setMinutes(0)):r==="minute"&&(o.setMinutes(N),o.setHours(0)),_(o)}},[l,_]);return n.useEffect(()=>{s!==void 0&&t(m(s))},[s]),n.useEffect(()=>{const r=p=>{p.key==="Escape"&&f&&j(!1)};if(f)return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[f]),e.jsxs(J,{open:f,onOpenChange:j,modal:v,children:[e.jsx(W,{asChild:!0,children:e.jsxs(E,{variant:"ghost",className:se("w-full justify-start text-left font-normal p-2 bg-custom-gray-default dark:bg-custom-blackSemi border-none text-gray-800 dark:text-gray-200 hover:bg-custom-gray-default dark:hover:bg-custom-blackSemi",!l&&"text-gray-500 dark:text-gray-500",i&&"opacity-50 cursor-not-allowed",w),disabled:i,"aria-label":"Seleccionar hora","aria-expanded":f,"aria-haspopup":"dialog",children:[e.jsx(ee,{className:"mr-2 h-4 w-4 flex-shrink-0 text-custom-orange"}),e.jsx("span",{className:"truncate",children:l&&l instanceof Date&&!isNaN(l.getTime())?ae(l,x,{locale:te}):c})]})}),e.jsx(Y,{className:"w-auto p-0 bg-custom-white dark:bg-custom-blackLight border-custom-gray-light dark:border-custom-gray-darker",align:"start",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:h-[300px] divide-y sm:divide-y-0 sm:divide-x",children:[e.jsxs(z,{className:"w-64 sm:w-auto",children:[e.jsxs("div",{className:"flex sm:flex-col p-2",children:[e.jsx("div",{className:"text-sm font-medium p-2 sm:hidden text-custom-blue dark:text-custom-white",children:"Horas"}),u.map(r=>e.jsx(E,{size:"icon",variant:l&&l instanceof Date&&!isNaN(l.getTime())&&l.getHours()===r?"primary":"ghost",className:"sm:w-full shrink-0 aspect-square rounded-lg",onClick:()=>C("hour",r.toString()),"aria-label":`Seleccionar hora ${r.toString().padStart(2,"0")}`,children:e.jsx("span",{className:"text-sm",children:r.toString().padStart(2,"0")})},r))]}),e.jsx($,{orientation:"horizontal",className:"sm:hidden"})]}),e.jsxs(z,{className:"w-64 sm:w-auto",children:[e.jsxs("div",{className:"flex sm:flex-col p-2",children:[e.jsx("div",{className:"text-sm font-medium p-2 sm:hidden text-custom-blue dark:text-custom-white",children:"Minutos"}),T.map(r=>e.jsx(E,{size:"icon",variant:l&&l instanceof Date&&!isNaN(l.getTime())&&l.getMinutes()===r?"primary":"ghost",className:"sm:w-full shrink-0 aspect-square rounded-lg",onClick:()=>C("minute",r.toString()),"aria-label":`Seleccionar minuto ${r.toString().padStart(2,"0")}`,children:e.jsx("span",{className:"text-sm",children:r.toString().padStart(2,"0")})},r))]}),e.jsx($,{orientation:"horizontal",className:"sm:hidden"})]})]})})]})}function ue({}){const{form:s,updateForm:a}=y(),{data:c,errors:i}=s,[d,x]=n.useState(c),w=Z(a,500),[v,k]=n.useState(!!(d.descanso_inicio&&d.descanso_fin));n.useEffect(()=>{x(c)},[c]);const m=n.useCallback((t,f)=>{x(typeof t=="object"?j=>({...j,...t}):j=>({...j,[t]:f})),i[t]&&delete i[t],w(t,f)},[w]),S=(t,f)=>{x(j=>({...j,[t]:f})),a(t,f)};return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 flex-1",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Nombre del Turno ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(I,{placeholder:"Turno de mañana 40 horas...",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:d.nombre||"",onChange:t=>m("nombre",t.target.value)}),i.nombre&&e.jsx("span",{className:"text-xs text-red-500",children:i.nombre})]}),e.jsxs("div",{className:"col-span-1 flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:"Color"}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"color",className:"h-10 w-16",value:d.color||"#FB7D16",onChange:t=>m("color",t.target.value),id:"color"})})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:"Descripción"}),e.jsx(I,{placeholder:"Loren Ipsum...",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:d.descripcion||"",onChange:t=>m("descripcion",t.target.value)}),i.descripcion&&e.jsx("span",{className:"text-xs text-red-500",children:i.descripcion})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Centro asociado ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(K,{fetchRoute:"api.v1.admin.centros.index",responseParameter:"centros",value:d.centro_id,onValueChange:t=>m("centro_id",t),disabled:!1}),i.centro_id&&e.jsx("span",{className:"text-xs text-red-500",children:i.centro_id})]}),e.jsx("h3",{className:"font-bold",children:"Horario"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Hora de inicio ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(F,{className:"rounded-full",value:d.hora_inicio||"",onChange:t=>{m("hora_inicio",t)},placeholder:"Selecciona hora de inicio",outputFormat:"string"}),i.hora_inicio&&e.jsx("span",{className:"text-xs text-red-500",children:i.hora_inicio})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Hora de fin ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsx(F,{className:"rounded-full",value:d.hora_fin||"",onChange:t=>{m("hora_fin",t)},placeholder:"Selecciona hora de fin",outputFormat:"string"}),i.hora_fin&&e.jsx("span",{className:"text-xs text-red-500",children:i.hora_fin})]})]}),e.jsxs("button",{className:"flex flex-row items-center gap-3 text-sm font-semibold text-custom-blue dark:text-custom-white",onClick:t=>{t.preventDefault(),k(!v),S("descanso_inicio",""),S("descanso_fin","")},type:"button",children:[v?e.jsx(P,{name:"X",size:"16"}):e.jsx(P,{name:"Plus",size:"16"}),v?"Quitar descanso":"Añadir descanso"]}),v&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:"Inicio del descanso"}),e.jsx(F,{className:"rounded-full",value:d.descanso_inicio||"",onChange:t=>{m("descanso_inicio",t)},placeholder:"Selecciona inicio descanso",outputFormat:"string"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:"Fin del descanso"}),e.jsx(F,{className:"rounded-full",value:d.descanso_fin||"",onChange:t=>{m("descanso_fin",t)},placeholder:"Selecciona fin descanso",outputFormat:"string"})]})]})]})}function xe(){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col w-full gap-12 bg-custom-white dark:bg-custom-blackLight p-4",children:[e.jsx("div",{className:"flex flex-col gap-4 dark:dark-scrollbar",children:e.jsx(g,{className:"h-8 w-[350px]"})}),e.jsxs("div",{className:"flex flex-row w-full gap-4 overflow-y-auto dark:dark-scrollbar",children:[e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(g,{className:"h-8 w-[250px]"}),e.jsx(g,{className:"h-12 w-full"})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(g,{className:"h-8 w-[250px]"}),e.jsx(g,{className:"h-12 w-full"})]})]}),e.jsx(g,{className:"h-1 w-full"}),e.jsxs("div",{className:"flex flex-row w-full gap-4 overflow-y-auto dark:dark-scrollbar",children:[e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(g,{className:"h-8 w-[250px]"}),e.jsx(g,{className:"h-12 w-full"})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(g,{className:"h-8 w-[250px]"}),e.jsx(g,{className:"h-12 w-full"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 p-4",children:[e.jsx(g,{className:"h-10 w-24"}),e.jsx(g,{className:"h-10 w-24"})]})]})}function fe(){const{model:s,handleSubmit:a,onOpenChange:c,isSaving:i}=y(),d=s?"Actualizar":"Guardar",x=s?"Actualizando...":"Guardando...";return e.jsxs(B,{children:[e.jsx("div",{className:"flex flex-row w-full items-center justify-between",children:e.jsxs("div",{className:"flex items-center ml-auto justify-end gap-2",children:[e.jsx(E,{variant:"secondary",onClick:()=>c(!1),disabled:i,children:"Cancelar"}),e.jsx(E,{variant:"primary",onClick:()=>a(),disabled:i,children:d})]})}),i&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center gap-2",children:[e.jsx(re,{size:"sm",className:"text-custom-orange"}),e.jsxs("span",{className:"text-md",children:[x,"..."]})]})]})}function he(){const{modelAlias:s,model:a}=y(),c=n.useMemo(()=>a?`Actualizar ${s}`:`Crear ${s}`,[a]);return e.jsxs(V,{children:[e.jsx(A,{className:"dark:text-custom-white",children:c}),e.jsx(R,{className:"hidden",children:c})]})}const pe=()=>{const{error:s}=y();return s?e.jsxs("div",{className:"mt-4 mb-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-300 p-3 rounded-md flex items-start gap-2 animate-in fade-in slide-in-from-top-3 duration-300",children:[e.jsx(oe,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Ha ocurrido un error"}),e.jsx("p",{className:"text-sm",children:"No se pudo procesar la solicitud. Por favor, inténtalo de nuevo."})]})]}):null};function ge({children:s}){const{isSaving:a}=y();return e.jsxs("div",{className:`flex flex-col gap-4 h-full overflow-y-auto p-4 dark:dark-scrollbar transition-opacity duration-200 ${a?"opacity-60":"opacity-100"}`,children:[e.jsx(pe,{}),s]})}function je(){const{isLoading:s}=y();return e.jsx(O,{className:"flex flex-col gap-4 justify-between sm:max-w-[1225px] sm:h-[725px] bg-custom-white dark:bg-custom-blackLight",children:s?e.jsx(xe,{}):e.jsxs(e.Fragment,{children:[e.jsx(he,{}),e.jsx(ge,{children:e.jsx(ue,{})}),e.jsx(fe,{})]})})}const es=n.memo(function({open:a,onOpenChange:c,model:i=null,onSaveData:d=null}){return e.jsx(G,{open:a,onOpenChange:c,children:e.jsx(ce,{model:i,onSaveData:d,onOpenChange:c,modelAlias:"Turno",dataKey:"turno",children:e.jsx(je,{})})})});export{es as C,F as T,le as u};
