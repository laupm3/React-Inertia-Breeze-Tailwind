import{j as r}from"./app-fwyInB3c.js";import{I as P}from"./LucideIcon-CEqEhMjI.js";import{U as C}from"./UserAvatar-cKyxDEhx.js";import"./createLucideIcon-DoJ0Kelj.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./x-2mzC_aTV.js";const g=o=>{if(!o)return"--/--/--";const n=new Date(o);return isNaN(n.getTime())?"--/--/--":n.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"}).replace(/\.$/,"")},z=o=>{if(!o||!o.estado)return[{titulo:"Vacaciones solicitadas",fecha:"--/--/--",completado:!1,icono:"ArrowUp",aprobador:null,observacion:null,esRechazo:!1},{titulo:"En Revisión",fecha:"--/--/--",completado:!1,icono:"Search",aprobador:null,observacion:null,esRechazo:!1},{titulo:"En Proceso",fecha:"--/--/--",completado:!1,icono:"Loader",aprobador:null,observacion:null,esRechazo:!1},{titulo:"Resultado Final",fecha:"--/--/--",completado:!1,icono:"Check",aprobador:null,observacion:null,esRechazo:!1}];const{aprobaciones:n,estado:c,fecha_inicio:d,seen_at:a,updated_at:l,created_at:h,requiere_aprobacion_manager:m,requiere_aprobacion_hr:u,is_cancelled:v}=o,e=[{titulo:"Vacaciones solicitadas",fecha:g(d||h),completado:!0,icono:"ArrowUp",aprobador:null,observacion:null,esRechazo:!1,esAutomatico:!1},{titulo:"En Revisión",fecha:a?g(a):"--/--/--",completado:!1,icono:"Search",aprobador:null,observacion:null,esRechazo:!1,esAutomatico:!1},{titulo:"En Proceso",fecha:"--/--/--",completado:!1,icono:"Loader",aprobador:null,observacion:null,esRechazo:!1,esAutomatico:!1},{titulo:"Resultado Final",fecha:"--/--/--",completado:!1,icono:"Check",aprobador:null,observacion:null,esRechazo:!1,esAutomatico:!1}];if(v||c.nombre==="Cancelación")return e[0].completado=!0,e[1].completado=!0,e[2].completado=!0,e[3].completado=!0,e[3].titulo="Vacaciones Canceladas",e[3].fecha=g(l),e[3].icono="XCircle",e[3].esRechazo=!0,e[3].observacion="Solicitud de cancelación por el usuario",e;const t=n==null?void 0:n.find(s=>s.tipo_aprobacion==="manager"),i=n==null?void 0:n.find(s=>s.tipo_aprobacion==="hr");t?(e[1].fecha=g(t.created_at),e[1].titulo=t.aprobado?"Encargado (Aprobado)":"Encargado (Rechazado)",e[1].aprobador=t.approvedBy,e[1].observacion=t.observacion,e[1].esRechazo=!t.aprobado,e[1].esAutomatico=t.is_automatic||!1):a&&c.nombre==="Solicitado"?e[1].titulo="En Revisión (Visto)":m===!1&&c.nombre!=="Solicitado"&&(e[1].titulo="Encargado (No Req.)");const R=t?t.aprobado:m===!1;R?i?(e[2].fecha=g(i.created_at),e[2].titulo=i.aprobado?"RRHH (Aprobado)":"RRHH (Rechazado)",e[2].aprobador=i.approvedBy,e[2].observacion=i.observacion,e[2].esRechazo=!i.aprobado,e[2].esAutomatico=i.is_automatic||!1):u===!1&&(c.nombre==="Aprobado"||c.nombre==="Denegado"||c.nombre==="Aprobado RRHH"||c.nombre==="Pendiente RRHH")?(e[2].titulo="RRHH (No Req.)",t&&(e[2].fecha=g(t.created_at))):c.nombre==="Pendiente RRHH"&&(e[2].titulo="RRHH (En Proceso)",t&&(e[2].fecha=g(t.created_at))):t&&!t.aprobado&&(e[2].titulo="RRHH (Cancelado)",e[2].fecha=g(t.created_at));let p=l||h;const b=[...n||[]].filter(s=>s.tipo_aprobacion==="manager"&&m!==!1||s.tipo_aprobacion==="hr"&&u!==!1).sort((s,f)=>new Date(f.created_at)-new Date(s.created_at));switch(b.length>0&&(p=b[0].created_at),(c.nombre==="Aprobado"||c.nombre==="Denegado")&&(e[3].fecha=g(p)),c.nombre){case"Cancelación":break;case"Solicitado":a&&!t&&(e[1].completado=!0);break;case"Pendiente RRHH":e[0].completado=!0,e[1].completado=!0;break;case"Aprobado RRHH":e[0].completado=!0,e[1].completado=!0,e[2].completado=!0;break;case"Aprobado":e[0].completado=!0,e[1].completado=!0,e[2].completado=!0,e[3].completado=!0,e[3].titulo="Vacaciones Aprobadas",!t&&m!==!1?e[1].titulo="Revisión Encargado":!t&&m===!1&&(e[1].titulo="Encargado (No Req.)"),!i&&u!==!1&&R?e[2].titulo="Proceso RRHH":!i&&u===!1&&R&&(e[2].titulo="RRHH (No Req.)");break;case"Denegado":e[0].completado=!0,e[3].completado=!0,e[3].titulo="Vacaciones Denegadas",t?(e[1].completado=!0,t.aprobado,e[2].completado=!0):(e[1].completado=!0,e[2].completado=!0);break}return e},w=(o,n,c,d)=>{if(!o)return 0;if(n&&o==="Solicitado"&&!c)return 1;switch(o){case"Cancelación":return 3;case"Solicitado":return 0;case"Pendiente RRHH":return 2;case"Aprobado RRHH":return 2;case"Aprobado":case"Denegado":return 3;default:let a=-1;for(let l=0;l<d.length&&d[l].completado;l++)a=l;return a===d.length-1&&(o==="Aprobado"||o==="Denegado")?d.length-1:a<d.length-1?a+1:a}},O=({permiso:o})=>{var h,m,u,v;if(!o)return null;const n=z(o),c=(h=o.aprobaciones)==null?void 0:h.find(e=>e.tipo_aprobacion==="manager"),d=w((m=o.estado)==null?void 0:m.nombre,o.seen_at,c,n);let a=((u=o.estado)==null?void 0:u.nombre)||"Solicitado";o.seen_at&&a==="Solicitado"&&!c?d===1&&(a="En revisión"):d===2&&(a==="Pendiente RRHH"||a==="Aprobado RRHH")?a="En proceso":d===3&&(a==="Aprobado"||a==="Denegado"||a==="Cancelación")&&(a=(v=o.estado)==null?void 0:v.nombre);let l="0%";return a==="Solicitado"?l="13%":a==="En revisión"?l="36%":a==="En proceso"||a==="Pendiente RRHH"||a==="Aprobado RRHH"?l="63%":(a==="Aprobado"||a==="Denegado"||a==="Cancelación")&&(l="100%"),r.jsxs("div",{className:"mt-4 px-2",children:[r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute left-0 right-0 top-[60px] h-1 bg-gray-200 dark:bg-gray-700 z-0",style:{transform:"translateY(-50%)"},children:r.jsx("div",{className:"absolute left-0 top-0 h-full bg-custom-orange transition-all duration-300",style:{width:l}})}),r.jsx("div",{className:"grid grid-cols-4 gap-1 relative z-10",style:{minHeight:"120px"},children:n.map((e,t)=>{var H,y,A,j,_,N;const i=d===t,R=e.completado,p=t===n.length-1;let b="bg-gray-200 dark:bg-gray-500",s="text-gray-400 dark:text-gray-300",f="bg-gray-300 dark:bg-gray-600 border-none",x="text-gray-600 dark:text-gray-400",k="text-gray-500 dark:text-gray-500";return R&&(p&&((H=o.estado)==null?void 0:H.nombre)==="Denegado"?(b="bg-red-600/30 dark:bg-red-600/30",s="text-red-600 dark:text-red-400",f="bg-red-600 border-red-600",x="text-red-600 dark:text-red-400 font-bold"):p&&((y=o.estado)==null?void 0:y.nombre)==="Cancelación"?(b="bg-orange-600/30 dark:bg-orange-600/30",s="text-orange-600 dark:text-orange-400",f="bg-orange-600 border-orange-600",x="text-orange-600 dark:text-orange-400 font-bold"):p&&((A=o.estado)==null?void 0:A.nombre)==="Aprobado"?(b="bg-green-100 dark:bg-green-900",s="text-green-500 dark:text-green-400",f="bg-green-500 border-green-600",x="text-green-600 dark:text-green-400 font-bold"):(b="bg-custom-orange/30 dark:bg-custom-orange/30",s="text-custom-orange dark:text-custom-orange",f="bg-custom-orange border-custom-orange dark:border-custom-orange",x="text-custom-orange dark:text-custom-orange")),i&&!(p&&(((j=o.estado)==null?void 0:j.nombre)==="Aprobado"||((_=o.estado)==null?void 0:_.nombre)==="Denegado"||((N=o.estado)==null?void 0:N.nombre)==="Cancelación"))&&(b="bg-custom-orange/30 dark:bg-custom-orange/30",s="text-custom-orange dark:text-custom-orange",f="bg-custom-orange border-custom-orange dark:border-custom-orange ring-custom-orange dark:ring-custom-orange ring-offset-1 dark:ring-offset-gray-800",x="text-custom-orange dark:text-custom-orange font-bold",k="text-gray-500 dark:text-gray-500"),r.jsxs("div",{className:"flex flex-col items-center text-center px-1",children:[r.jsx("div",{className:`w-8 h-8 sm:w-10 sm:h-10 rounded-lg flex items-center justify-center mb-2 ${b}`,children:e.icono&&r.jsx(P,{name:e.icono,size:16,className:`${s} sm:w-5 sm:h-5`})}),r.jsx("div",{className:`w-4 h-4 sm:w-5 sm:h-5 rounded-full border-2 ${f} mb-2`}),r.jsx("div",{className:`text-xs font-medium ${x} sm:text-xs leading-tight`,children:e.titulo}),r.jsx("div",{className:`text-xs ${k} mb-1`,children:e.fecha!=="--/--/--"?`(${e.fecha})`:""}),e.aprobador&&r.jsx("div",{className:"mt-1",children:r.jsx(C,{user:e.aprobador,size:"sm",className:"w-6 h-6 text-xs"})})]},t)})})]}),n.some(e=>e.observacion&&e.observacion.trim()!=="")&&r.jsxs("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[r.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Observaciones:"}),r.jsx("div",{className:"space-y-3",children:n.filter(e=>e.observacion&&e.observacion.trim()!=="").map((e,t)=>r.jsxs("div",{className:"text-sm",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsxs("span",{className:`font-medium ${e.esRechazo?"text-red-600 dark:text-red-400":"text-green-600 dark:text-green-400"}`,children:[e.titulo,":"]}),e.aprobador&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx(C,{user:e.aprobador,size:"xs",className:"w-4 h-4 text-xs"}),r.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[e.aprobador.name," ",e.aprobador.apellidos]})]})]}),r.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm pl-2 border-l-2 border-gray-300 dark:border-gray-600",children:e.observacion})]},t))})]})]})};export{O as default};
