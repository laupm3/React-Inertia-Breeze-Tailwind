import{r as d,G as B,j as e}from"./app-fwyInB3c.js";import{f as G,c as H,d as J,e as W,b as A,D as O}from"./dialog-iaZkf6Xy.js";import{u as U}from"./useTranslation-BtIkv0Na.js";import{o as F,c as Q,s as L,a as _}from"./types-BZmDMmQb.js";import{toast as I}from"./index-WlsBA3k2.js";import{I as E}from"./input-CqlBlYgU.js";import{u as X}from"./useDebounce-xNcQ83OW.js";import{calculateTotalWeekHours as Y}from"./functions-B_hVx-4e.js";import{I as C}from"./LucideIcon-CEqEhMjI.js";import{T as Z,M as K}from"./TurnoSelect-DHdheWBO.js";import{G as ee}from"./GetModalidadIcon-BUgIPR97.js";import{S as g}from"./skeleton-DSiYFg9q.js";import{B as P}from"./Button-CQuYVLGu.js";import{S as ae}from"./Spinner-DPRe7Z_J.js";import{O as se}from"./octagon-alert-BRAzZNeG.js";const te=()=>{const{t:a}=U(["datatable"]);return F({id:_().optional().nullable(),name:L().min(1,a("validation.required",{field:"nombre"})),description:L().optional().nullable(),esquema:Q(F({weekday_number:_(),turno_id:_().nullable().optional(),modalidad_id:_().nullable().optional()}).refine(s=>!(s.turno_id&&!s.modalidad_id||s.modalidad_id&&!s.turno_id),{message:"Turno y modalidad deben seleccionarse juntos",path:["turno_modalidad"]})).optional()})},$={id:null,name:"",description:"",esquema:[]},re=a=>a?{id:a.id||null,name:a.name||"",description:a.description||"",esquema:a.esquema.filter(({turno_id:c,modalidad_id:l,weekday_number:o})=>c&&l&&o!=null)}:void 0,le=a=>d.useMemo(()=>({dataKey:"jornada",show:a?route("api.v1.admin.jornadas.show",{jornada:a}):null,store:route("api.v1.admin.jornadas.store"),update:a?route("api.v1.admin.jornadas.update",{jornada:a}):null,delete:a?route("api.v1.admin.jornadas.destroy",{jornada:a}):null}),[a]),R=d.createContext(null),oe=({children:a,model:s,onOpenChange:c,dataKey:l,onSaveData:o=null,modelAlias:f="registro"})=>{const[r,p]=d.useState(!1),[u,i]=d.useState(!1),[n,m]=d.useState(()=>()=>{}),[h,D]=d.useState(!1),[S,k]=d.useState(!1),v=le(s),t=B($),j=te();d.useEffect(()=>{const x=async()=>{try{D(!0),i(!1);const b=await axios.get(v.show);b.status===200?t.setData(re(b.data[l])):i(!0)}catch(b){console.error("Error al cargar datos:",b),i(!0)}finally{D(!1)}};return t.clearErrors(),s?x():(t.setData($),i(!1),D(!1)),()=>{}},[s]),d.useCallback(x=>{m(()=>x)},[]);const N=d.useCallback((x,b)=>{if(typeof x=="object"&&b===void 0){t.setData(w=>({...w,...x}));return}t.setData(w=>({...w,[x]:b}))},[t]),q=d.useCallback(()=>{const x=j.safeParse(t.data);if(t.clearErrors(),!x.success){const b=x.error.flatten().fieldErrors;Object.keys(b).forEach(w=>{t.setError(w,b[w][0])})}return x.success},[t,j]),T=d.useCallback(async()=>{try{k(!0),i(!1),t.clearErrors();const x=s?await axios.put(v.update,t.data):await axios.post(v.store,t.data);o&&o(x.data[l]),c(!1),t.clearErrors(),I.success(s?`Registro ${f} actualizado con éxito`:`Registro ${f} creado con éxito`)}catch(x){if(i(!0),x.response&&x.response.data&&x.response.data.errors){const{errors:b}=x.response.data;Object.keys(b).forEach(w=>{t.setError(w,b[w][0])})}I.error(s?`Error al actualizar el ${f}`:`Error al crear el ${f}`)}finally{k(!1)}},[s,v.update,v.store,t,o,c]),M=d.useCallback(()=>{n&&n(),setTimeout(()=>{q()&&T()},50)},[q,T,n,t.data]),V=d.useMemo(()=>({modelAlias:f,model:s,error:u,form:t,updateForm:N,handleSubmit:M,setError:i,onOpenChange:c,isProcessing:r,isLoading:h,isSaving:S,setIsProcessing:p}),[f,s,u,t,N,M,c,r,h,S]);return e.jsx(R.Provider,{value:V,children:a})};function y(){const a=d.useContext(R);if(!a)throw new Error("useDialogData debe usarse dentro de DialogDataContextProvider");return a}function ne({weekdayName:a,weekday:s,prevData:c,sincronizePrevData:l,turnos:o=[],modalidades:f=[]}){const{weekday_number:r}=s,{esquema:p}=c,u=n=>{const m=p.find(h=>h.weekday_number===r);if(m){m.turno_id=n?n.id:null,m.turno=n,n||(m.modalidad_id=null,m.modalidad=null),l("esquema",[...p.filter(h=>h.weekday_number!==r),m]);return}l("esquema",[...p,{weekday_number:r,turno_id:n?n.id:null,turno:n,modalidad_id:null}])},i=n=>{const m=p.find(h=>h.weekday_number===r);if(m){m.modalidad_id=n?n.id:null,m.modalidad=n,l("esquema",[...p.filter(h=>h.weekday_number!==r),m]);return}l("esquema",[...p,{weekday_number:r,turno_id:null,modalidad_id:n?n.id:null,modalidad:n}])};return e.jsxs("tr",{className:"",children:[e.jsx("td",{className:" p-2 font-medium",children:a}),e.jsx("td",{className:" p-2",children:e.jsx(Z,{turnosData:o,onSelect:u,prevTurnoId:s.turno_id})}),e.jsx("td",{className:" p-2",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(K,{modalidadesData:f,onSelect:i,prevModalidadId:s.modalidad_id,disabled:!s.turno_id}),s.turno_id&&!s.modalidad_id&&e.jsx("span",{className:"text-xs text-red-500",children:"Selecciona una modalidad"})]})})]})}function de({weekday:a,dayIndex:s=0,isLoading:c=!1}){var i,n,m;const l=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"],o=a&&a.weekday_name?a.weekday_name:s>=0&&s<l.length?l[s]:l[0],{esquema:f={},turno:r={},modalidad:p={}}=a||{},u=Object.keys(f).length===0;return e.jsx("div",{className:"flex",children:u?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-full min-h-full w-[10px] min-w-[10px] rounded-ss-xl rounded-es-xl"}),e.jsxs("div",{className:`flex flex-col flex-1 py-2 px-3 bg-custom-gray-default dark:bg-custom-blackSemi rounded-ee-xl rounded-se-xl gap-1
           max-w-[12rem] min-w-[12rem] overflow-hidden`,children:[e.jsx("div",{className:"flex font-bold",children:e.jsx("span",{children:o})}),e.jsxs("div",{className:"flex flex-row justify-start gap-1 items-center",children:[e.jsx(C,{name:"Clock",className:"w-4 h-4"}),e.jsx(g,{className:"h-4 w-full bg-custom-gray-semiLight"})]}),e.jsx("div",{className:"flex flex-row flex-nowrap justify-start gap-1 items-center",children:e.jsx(g,{className:"h-4 w-full bg-custom-gray-semiLight"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-full min-h-full w-[10px] min-w-[10px] rounded-ss-xl rounded-es-xl",style:{backgroundColor:(r==null?void 0:r.color)||"#ccc"}}),e.jsxs("div",{className:"flex flex-col flex-1 py-2 px-3 bg-custom-gray-default dark:bg-custom-blackLight rounded-ee-xl rounded-se-xl gap-1 max-w-[12rem] min-w-[12rem] overflow-hidden",children:[e.jsx("div",{className:"flex text-end font-bold",children:o}),e.jsxs("div",{className:"flex flex-row justify-start gap-1 items-center text-nowrap",children:[e.jsx(C,{name:"Clock",className:"w-4 h-4"}),r==null?void 0:r.horaInicio,e.jsx(C,{name:"ArrowRight",className:"w-4 h-4"}),r==null?void 0:r.horaFin]}),e.jsx("div",{className:"flex flex-row flex-nowrap justify-start gap-1 items-center",children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx(ee,{modalidad:p==null?void 0:p.name,className:"h-4 w-4"})}),e.jsx("span",{className:"text-nowrap",children:((i=r==null?void 0:r.centro)==null?void 0:i.nombre)||"Sin centro"}),"-",e.jsx("span",{className:"text-ellipsis overflow-hidden text-nowrap font-medium",children:((m=(n=r==null?void 0:r.centro)==null?void 0:n.empresa)==null?void 0:m.nombre)||"Sin centro"})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"Sin modalidad asignada"})})]})]})})}function ie({esquema:a=[],turnos:s=[],modalidades:c=[]}){const l=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"],o=[0,1,2,3,4,5,6],f=u=>s.find(i=>i.id===u)||null,r=u=>c.find(i=>i.id===u)||null,p=o.map(u=>{const i=a.find(h=>h.weekday_number===u);if(!i||!i.turno_id)return{dayIndex:u,weekday_name:l[u]};const n=f(i.turno_id),m=r(i.modalidad_id);return{dayIndex:u,weekday_name:l[u],turno:n,modalidad:m,esquema:{centro:i.centro}}});return e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-bold text-custom-blue dark:text-custom-white mb-2",children:"Previsualización de la jornada"}),e.jsx("div",{className:"flex gap-2 overflow-auto p-2",children:p.map(u=>e.jsx(de,{weekday:u,dayIndex:u.dayIndex,isLoading:!1},u.dayIndex))})]})}function ce({}){const{form:a,updateForm:s}=y(),{data:c,errors:l}=a,[o,f]=d.useState(c),[r,p]=d.useState(!1),[u,i]=d.useState([]),[n,m]=d.useState([]),h=X(s,500),D=[0,1,2,3,4,5,6],S=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"];d.useCallback(()=>{s(o)},[o,s]),d.useEffect(()=>{f(c)},[c]);const k=d.useCallback((t,j)=>{f(typeof t=="object"?N=>({...N,...t}):N=>({...N,[t]:j})),l[t]&&delete l[t],h(t,j)},[h]),v=d.useCallback(()=>{var t;return((t=o.esquema)==null?void 0:t.filter(j=>j.turno_id&&!j.modalidad_id))||[]},[o.esquema]);return d.useEffect(()=>{r||(async()=>{try{const[j,N]=await Promise.all([axios.get(route("api.v1.admin.modalidades.index")),axios.get(route("api.v1.admin.turnos.index"))]);j.status===200&&i(j.data.modalidades),N.status===200&&m(N.data.turnos),p(!0)}catch(j){console.error("Error fetching data:",j)}})()},[r]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 ",children:[e.jsxs("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:["Nombre ",e.jsx("span",{className:"text-custom-orange",children:"*"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{placeholder:"Nombre de la jornada",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi flex-1",value:o.name,onChange:t=>k("name",t.target.value)}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{readOnly:!0,tabIndex:"-1",value:`${Y(o.esquema)} h`,className:"rounded-full dark:text-custom-gray-default text-custom-gray-dark bg-custom-gray-default dark:bg-custom-blackSemi w-[120px] text-center pl-8 pointer-events-none select-none"}),e.jsx("div",{className:"absolute left-2.5 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsx(C,{name:"Clock",className:"text-custom-orange w-4 h-4"})}),e.jsx("span",{className:"absolute -top-7 text-sm font-bold text-custom-blue dark:text-custom-white",children:"H. Semanales"})]})]}),l.name&&e.jsx("span",{className:"text-xs text-red-500",children:l.name})]}),e.jsxs("div",{className:"flex flex-col gap-2 ",children:[e.jsx("span",{className:"text-sm font-bold text-custom-blue dark:text-custom-white",children:"Descripción"}),e.jsx(E,{placeholder:"Descripción de la jornada",className:"rounded-full dark:text-custom-gray-default bg-custom-gray-default dark:bg-custom-blackSemi",value:o.description,onChange:t=>k("description",t.target.value)}),l.description&&e.jsx("span",{className:"text-xs text-red-500",children:l.description})]}),e.jsx("div",{className:"",children:r&&e.jsx(ie,{esquema:o.esquema||[],turnos:n,modalidades:u})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-bold text-custom-blue dark:text-custom-white mb-2",children:"Esquema de Jornada"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left",children:"Día"}),e.jsx("th",{className:"p-2 text-left",children:"Turno"}),e.jsx("th",{className:"p-2 text-left",children:"Modalidad"})]})}),e.jsx("tbody",{children:D.map(t=>e.jsx(ne,{weekdayName:S[t],weekday:o.esquema.find(({weekday_number:j})=>j===t)||{turno_id:null,modalidad_id:null,weekday_number:t},prevData:o,sincronizePrevData:k,turnos:n,modalidades:u},t))})]})}),l.esquema&&e.jsx("span",{className:"text-xs text-red-500 mt-1",children:l.esquema}),v().length>0&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("span",{className:"text-sm text-red-600 dark:text-red-400",children:["⚠️ Días incompletos: ",v().map(t=>S[t.weekday_number]).join(", "),e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Todos los turnos deben tener una modalidad asignada."})]})})]})]})}function ue(){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col w-full gap-12 bg-custom-white dark:bg-custom-blackLight p-4",children:[e.jsx("div",{className:"flex flex-col gap-4 dark:dark-scrollbar",children:e.jsx(g,{className:"h-8 w-[350px]"})}),e.jsxs("div",{className:"flex flex-row w-full gap-4 overflow-y-auto dark:dark-scrollbar",children:[e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(g,{className:"h-8 w-[250px]"}),e.jsx(g,{className:"h-12 w-full"})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(g,{className:"h-8 w-[250px]"}),e.jsx(g,{className:"h-12 w-full"})]})]}),e.jsx(g,{className:"h-1 w-full"}),e.jsxs("div",{className:"flex flex-row w-full gap-4 overflow-y-auto dark:dark-scrollbar",children:[e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(g,{className:"h-8 w-[250px]"}),e.jsx(g,{className:"h-12 w-full"})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-4 dark:dark-scrollbar",children:[e.jsx(g,{className:"h-8 w-[250px]"}),e.jsx(g,{className:"h-12 w-full"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 p-4",children:[e.jsx(g,{className:"h-10 w-24"}),e.jsx(g,{className:"h-10 w-24"})]})]})}function me(){const{model:a,handleSubmit:s,onOpenChange:c,isSaving:l}=y(),o=a?"Actualizar":"Guardar",f=a?"Actualizando...":"Guardando...";return e.jsxs(G,{children:[e.jsx("div",{className:"flex flex-row w-full items-center justify-between",children:e.jsxs("div",{className:"flex items-center ml-auto justify-end gap-2",children:[e.jsx(P,{variant:"secondary",onClick:()=>c(!1),disabled:l,children:"Cancelar"}),e.jsx(P,{variant:"primary",onClick:()=>s(),disabled:l,children:o})]})}),l&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center gap-2",children:[e.jsx(ae,{size:"sm",className:"text-custom-orange"}),e.jsxs("span",{className:"text-md",children:[f,"..."]})]})]})}function xe(){const{modelAlias:a,model:s}=y(),c=d.useMemo(()=>s?`Actualizar ${a}`:`Crear ${a}`,[s]);return e.jsxs(H,{children:[e.jsx(J,{className:"dark:text-custom-white",children:c}),e.jsx(W,{className:"hidden",children:c})]})}const fe=()=>{const{error:a}=y();return a?e.jsxs("div",{className:"mt-4 mb-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-300 p-3 rounded-md flex items-start gap-2 animate-in fade-in slide-in-from-top-3 duration-300",children:[e.jsx(se,{className:"h-5 w-5 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:"Ha ocurrido un error"}),e.jsx("p",{className:"text-sm",children:"No se pudo procesar la solicitud. Por favor, inténtalo de nuevo."})]})]}):null};function pe({children:a}){const{isSaving:s}=y();return e.jsxs("div",{className:`flex flex-col gap-4 h-full overflow-y-auto p-4 dark:dark-scrollbar transition-opacity duration-200 ${s?"opacity-60":"opacity-100"}`,children:[e.jsx(fe,{}),a]})}function he(){const{isLoading:a}=y();return e.jsx(A,{className:"flex flex-col gap-4 justify-between max-w-[1225px] h-[725px] bg-custom-white dark:bg-custom-blackLight",children:a?e.jsx(ue,{}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{}),e.jsx(pe,{children:e.jsx(ce,{})}),e.jsx(me,{})]})})}const Me=d.memo(function({open:s,onOpenChange:c,model:l=null,onSaveData:o=null}){return e.jsx(O,{open:s,onOpenChange:c,children:e.jsx(oe,{model:l,onSaveData:o,onOpenChange:c,modelAlias:"Jornada",dataKey:"jornada",children:e.jsx(he,{})})})});export{Me as C,le as u};
