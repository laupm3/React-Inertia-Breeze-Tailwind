import{r as a,a as z,j as y}from"./app-fwyInB3c.js";import{B as $}from"./button-Blwr-A5N.js";import{D as ai,b as ri,c as ci,d as li,e as ui,f as di}from"./dialog-iaZkf6Xy.js";import{DateTimeSection as fi,AdditionalDetailsSection as hi}from"./FormSections-0e8lUbqB.js";import{FileUploadSection as mi}from"./FileUploadSection-Cmij3b6t.js";import{defaultPermisoValues as O,TIPO_PERMISO_VACACIONES_ID as G}from"./PermisoSchema-BYopIQNb.js";import{formatDate as Y}from"./dateUtils-C_-2qk2u.js";import{toast as M}from"./index-WlsBA3k2.js";import"./index-DloWbRVd.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./index-DVo7DTeW.js";import"./index-DmpKZt4E.js";import"./index-p2DxCSsL.js";import"./index-B7srb2QZ.js";import"./index-BIJodELy.js";import"./index-DmaU4p-o.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./index-BZxTbISK.js";import"./x-2mzC_aTV.js";import"./createLucideIcon-DoJ0Kelj.js";import"./label-zCtqi3J5.js";import"./textarea-C969rVin.js";import"./checkbox-BQT_ir1e.js";import"./index-BxSEkZvI.js";import"./index-4A9uUPu1.js";import"./index-BZgm3BCW.js";import"./check-5DjPwM22.js";import"./input-CqlBlYgU.js";import"./LucideIcon-CEqEhMjI.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./PermisoAdvanceDropdown-DgUeyyBh.js";import"./Pill-l4GaXyto.js";import"./VacacionesMapColor-BDtfIx91.js";import"./AdvanceDropdown-qoEi4BOz.js";import"./Create-tmHr2JLD.js";import"./AuthenticatedLayout-B4CSARVj.js";import"./sidebar-CPh6C6LB.js";import"./separator-BWKairMX.js";import"./sheet-DHc5Hgr8.js";import"./skeleton-DSiYFg9q.js";import"./tooltip-DFfoxvAF.js";import"./index-CLai1W86.js";import"./index-CeuhGnKJ.js";import"./dropdown-menu-bHoOJ61X.js";import"./index-C_F9oucK.js";import"./index-v24TFYKQ.js";import"./popover-DaRbHQOK.js";import"./avatar-oBOSifLN.js";import"./PopUpIncidencias-CaovAEi3.js";import"./card-DYkZYgg5.js";import"./Button-CQuYVLGu.js";import"./useTranslation-BtIkv0Na.js";import"./UserAvatar-cKyxDEhx.js";import"./ApplicationLogo-C2FcO4AY.js";import"./Yoopta-Dj4Guze5.js";import"./throttle-CmSTFqON.js";import"./PrimaryButton-SsXyLm2e.js";import"./DecisionModal-Dl8siGBG.js";import"./alert-dialog-kDfn0La3.js";import"./useNotifications-CSWGH93r.js";import"./ShowNotificactionFromJestream-cKOlvVdg.js";import"./OnboardingModal-D0HRNKzO.js";import"./Modal-BkRna8gK.js";import"./transition-ByAjZSmr.js";import"./StepItem-bNLmZaq8.js";import"./StepProgress-DNpLodXf.js";import"./WelcomeContent-BPJ5E7_N.js";import"./onboardingImages-CoczwfNn.js";import"./AboutContent-DOlAXyok.js";import"./TeamContent-C0DysUYq.js";import"./CreateLanguageForm-xwtvYsjX.js";import"./alert-D9izbOQG.js";import"./InputSkeleton-CFMfUb-2.js";import"./table-cS0UKUSm.js";import"./GlobalFilter-DNA5td8x.js";import"./DataTableContext-BYrqyX0i.js";import"./index-Z1g0u-qm.js";import"./TableDebugging-C1u6ii1k.js";import"./AdvancedHeader-CpvwMmYr.js";import"./command-PoUoScut.js";import"./badge-BgloL8Ae.js";import"./select-B5O0TxCl.js";import"./DatePicker-YJSItPq7.js";import"./calendar-DctTJhwg.js";import"./endOfWeek-DoVA-Yvp.js";import"./toDate-qOSwr3PX.js";import"./format-Be40hyfq.js";import"./constants-BKFt95HM.js";import"./addDays-B9Fzl-_R.js";import"./parseISO-Efi0RkWR.js";import"./RowActionsColumn-CM2slffX.js";import"./RowActionsTrigger-DnJzXomR.js";import"./PermisoStatsInline-DDA6tud8.js";import"./charts-D-b4h_4c.js";import"./index-DpIruHMc.js";import"./PieChart-DDiBUCNq.js";import"./PolarAngleAxis-CNFzyAg3.js";import"./es-DNLwfvrq.js";import"./FileUploadArea-uzmkw7Uv.js";import"./types-BZmDMmQb.js";const K={START:"09:00",END:"17:00"},q={START:["00:00","02:00"],END:["23:59","01:59"]};function pi(i=null){const[f,t]=a.useState(O),[F,b]=a.useState(void 0),[x,w]=a.useState(null),[s,d]=a.useState({hora_inicio:"",hora_fin:""}),[h,S]=a.useState(!1),l=!!i,n=(x==null?void 0:x.duracion)||null,c=n?Math.floor(n/(1e3*60*60*24)):null,e=f.fecha_inicio&&f.fecha_fin&&f.fecha_inicio===f.fecha_fin,r=f.fecha_inicio&&f.fecha_fin&&f.fecha_inicio!==f.fecha_fin,_=e&&!r,m=_&&!f.dia_completo,I=a.useCallback(()=>{t(O),b(void 0),w(null),d({hora_inicio:"",hora_fin:""}),S(!1)},[]),A=o=>{let u="",p="",g=!!o.dia_completo;const R=o.fecha_inicio?o.fecha_inicio.split("T")[0]:"",j=o.fecha_fin?o.fecha_fin.split("T")[0]:"";return R&&j&&R!==j&&(g=!0),o.fecha_inicio&&(u=new Date(o.fecha_inicio).toTimeString().slice(0,5)),o.fecha_fin&&(p=new Date(o.fecha_fin).toTimeString().slice(0,5)),q.START.includes(u)&&q.END.includes(p)&&(g=!0),g&&(u="",p=""),{horaInicio:u,horaFin:p,esDiaCompleto:g}},H=a.useCallback(o=>{var j,N;S(!0);const{horaInicio:u,horaFin:p,esDiaCompleto:g}=A(o);d({hora_inicio:g?"":u,hora_fin:g?"":p});const R={permiso_id:((j=o.permiso)==null?void 0:j.id)||o.permiso_id||((N=o.tipo_permiso)==null?void 0:N.id)||o.tipo_permiso_id||null,fecha_inicio:o.fecha_inicio?o.fecha_inicio.split("T")[0]:"",fecha_fin:o.fecha_fin?o.fecha_fin.split("T")[0]:"",hora_inicio:g?"":u,hora_fin:g?"":p,motivo:o.motivo||"",dia_completo:g,recuperable:!!o.recuperable,estado_id:o.estado_id||O.estado_id,files:[]};if(t(R),o.fecha_inicio&&o.fecha_fin){const C=o.fecha_inicio.split("T")[0],T=o.fecha_fin.split("T")[0];b({from:new Date(C+"T12:00:00"),to:new Date(T+"T12:00:00")})}o.permiso?w(o.permiso):o.tipo_permiso?w(o.tipo_permiso):console.warn("DEBUG - No se pudo encontrar informaci贸n del tipo de permiso"),setTimeout(()=>{if(R.permiso_id===null){const C=o.permiso||o.tipo_permiso;C!=null&&C.id&&t(T=>({...T,permiso_id:C.id}))}S(!1)},150)},[]),E=a.useCallback(o=>{t(u=>{if(o){const p={hora_inicio:u.hora_inicio||s.hora_inicio,hora_fin:u.hora_fin||s.hora_fin};return d(p),{...u,dia_completo:!0,hora_inicio:"",hora_fin:""}}else{let p=s.hora_inicio,g=s.hora_fin;return(!p||q.START.includes(p))&&(p=K.START),(!g||q.END.includes(g))&&(g=K.END),d({hora_inicio:p,hora_fin:g}),{...u,dia_completo:!1,hora_inicio:p,hora_fin:g}}})},[s.hora_inicio,s.hora_fin]),L=a.useCallback((o,u)=>{if(o==="files"){const p=Array.isArray(u)?u:u?[u]:[];t(g=>({...g,[o]:p}))}else t(p=>({...p,[o]:u}))},[]),U=a.useCallback((o,u)=>{o==="dia_completo"?E(u):L(o,u)},[E,L]),B=a.useCallback(o=>{w(o),b(void 0),d({hora_inicio:"",hora_fin:""}),t(u=>({...u,permiso_id:(o==null?void 0:o.id)||null,fecha_inicio:"",fecha_fin:"",dia_completo:!1,hora_inicio:"",hora_fin:""}))},[]),P=a.useCallback(o=>{b(o)},[]);return a.useEffect(()=>{if(!h&&(F!=null&&F.from)&&(F!=null&&F.to)){const o=Y(F.from),u=Y(F.to);t(p=>p.fecha_inicio!==o||p.fecha_fin!==u?{...p,fecha_inicio:o,fecha_fin:u,...o!==u&&{dia_completo:!0,hora_inicio:"",hora_fin:""}}:p)}},[F,h]),a.useEffect(()=>{!l&&!h&&(t(o=>({...o,permiso_id:G})),w({id:G,nombre:"Vacaciones",descripcion:"Solicitud de vacaciones"}))},[l,h]),{formData:f,dateRange:F,selectedPermiso:x,isInitializing:h,isEditing:l,maxDurationMs:n,maxDurationDays:c,isSingleDay:e,shouldForceFullDay:r,canShowCheckbox:_,canShowTimeFields:m,resetForm:I,initializeFormForEdit:H,handleInputChange:U,handlePermisoSelect:B,handleDateRangeChange:P,setFormData:t,setDateRange:b,setSelectedPermiso:w}}function _i(){const[i,f]=a.useState(null),[t,F]=a.useState(!1),[b,x]=a.useState(!1),w=async(n,c)=>{var e,r;x(!0);try{const _=`/api/v1/user/vacaciones/${n}/folder/${c}`;if((await z.delete(_)).status===200)return M.success("Archivo eliminado correctamente"),!0}catch(_){console.error("Error al eliminar archivo:",_);const m=((r=(e=_.response)==null?void 0:e.data)==null?void 0:r.message)||"Error al eliminar el archivo";return M.error(m),!1}finally{x(!1),F(!1),f(null)}};return{fileToDelete:i,showDeleteFileDialog:t,isDeletingFile:b,initiateFileDelete:(n,c,e=null)=>{f({permisoId:n,file:c,onSuccess:e}),F(!0)},confirmDeleteFile:async()=>{if(!i)return;await w(i.permisoId,i.file.hash)&&i.onSuccess&&i.onSuccess(i.file)},cancelFileDelete:()=>{F(!1),f(null)},addFilesToForm:(n,c,e)=>{const _=(Array.isArray(n)?n:Array.from(n)).filter(m=>!c.some(A=>A.name===m.name&&A.size===m.size&&A.lastModified===m.lastModified));_.length>0&&e(m=>{const I=[...m.files||[],..._];return{...m,files:I}})},removeFileFromForm:(n,c)=>{c(e=>{const r=e.files.filter((_,m)=>m!==n);return{...e,files:r}})},executeFileDelete:w}}function Fi(i,f){const[t,F]=a.useState(new Set),[b,x]=a.useState(!1),w=a.useRef(null);a.useEffect(()=>{w.current||(w.current={permiso_id:i.permiso_id,fecha_inicio:i.fecha_inicio,fecha_fin:i.fecha_fin,hora_inicio:i.hora_inicio,hora_fin:i.hora_fin,motivo:i.motivo,dia_completo:i.dia_completo})},[]),a.useEffect(()=>{if(!w.current)return;const e=w.current;(i.permiso_id!==e.permiso_id||i.fecha_inicio!==e.fecha_inicio||i.fecha_fin!==e.fecha_fin||i.hora_inicio!==e.hora_inicio||i.hora_fin!==e.hora_fin||i.motivo!==e.motivo||i.dia_completo!==e.dia_completo)&&x(!0)},[i]);const s=e=>{F(r=>new Set([...r,e])),x(!0)};a.useEffect(()=>{var r,_;!i.permiso_id&&!i.motivo&&!i.hora_inicio&&!i.hora_fin&&i.fecha_inicio===((r=w.current)==null?void 0:r.fecha_inicio)&&i.fecha_fin===((_=w.current)==null?void 0:_.fecha_fin)&&(F(new Set),x(!1),w.current=null)},[i]);const d=a.useMemo(()=>!(!["permiso_id","fecha_inicio","fecha_fin","motivo"].every(_=>{const m=i[_];return _==="permiso_id"?m!=null&&m!==""&&m>0:m!=null&&m!==""})||!i.dia_completo&&(!i.hora_inicio||!i.hora_fin||i.hora_inicio>=i.hora_fin)),[i]),h=a.useMemo(()=>{if(!i.fecha_inicio||!i.fecha_fin||!(f!=null&&f.duracion))return{isValid:!0,message:""};const e=new Date(i.fecha_inicio),r=new Date(i.fecha_fin),_=Math.abs(r-e),m=Math.ceil(_/(1e3*60*60*24))+1,I=f.duracion,A=Math.floor(I/(1e3*60*60*24));return m>A?{isValid:!1,message:`La duraci贸n m谩xima permitida es de ${A} d铆a(s)`}:{isValid:!0,message:""}},[i.fecha_inicio,i.fecha_fin,f]),S=a.useMemo(()=>{if(!i.fecha_inicio||!i.fecha_fin)return{isValid:!0,message:""};const e=new Date(i.fecha_inicio),r=new Date(i.fecha_fin),_=new Date;return _.setHours(0,0,0,0),e.setHours(0,0,0,0),r.setHours(0,0,0,0),e>r?{isValid:!1,message:"La fecha de inicio no puede ser posterior a la fecha de fin"}:r<_?{isValid:!1,message:"La fecha de fin no puede ser anterior a hoy"}:{isValid:!0,message:""}},[i.fecha_inicio,i.fecha_fin]),l=a.useMemo(()=>i.dia_completo?{isValid:!0,message:""}:!i.hora_inicio||!i.hora_fin?{isValid:!1,message:"Las horas de inicio y fin son requeridas"}:i.hora_inicio>=i.hora_fin?{isValid:!1,message:"La hora de inicio debe ser anterior a la hora de fin"}:{isValid:!0,message:""},[i.dia_completo,i.hora_inicio,i.hora_fin]),n=a.useMemo(()=>{if(!b)return[];const e=[];return!S.isValid&&(t.has("fecha")||b)&&e.push(S.message),!l.isValid&&(t.has("hora_inicio")||t.has("hora_fin")||b&&!i.dia_completo)&&e.push(l.message),!h.isValid&&i.fecha_inicio&&i.fecha_fin&&e.push(h.message),e},[S,l,h,b,t,i.dia_completo,i.fecha_inicio,i.fecha_fin]),c=n.length>0;return{isFormValid:d,hasValidationErrors:c,validationErrors:n,dateValidation:S,timeValidation:l,durationValidation:h,hasUserInitiatedAction:b,touchedFields:t,markFieldAsTouched:s}}function gi(){const[i,f]=a.useState(!1),t=s=>{console.log(" Frontend - Datos originales del formulario:",s);const h=["permiso_id","fecha_inicio","fecha_fin","motivo"].filter(l=>{const n=s[l];return!n||typeof n=="string"&&n.trim()===""});if(h.length>0)throw new Error(`Campos requeridos faltantes: ${h.join(", ")}`);if(s.dia_completo===void 0||s.dia_completo===null)throw new Error("El campo dia_completo es requerido");if(s.files&&Array.isArray(s.files)&&s.files.length>0){const l=new FormData,n={};return Object.entries(s).forEach(([c,e])=>{if(c==="files")e.forEach(r=>l.append("files[]",r));else if(c==="permiso_id"){const r=parseInt(e,10);l.append(c,r.toString())}else typeof e=="boolean"?l.append(c,e?"1":"0"):e!=null&&l.append(c,e||"")}),{requestData:l,headers:n}}else{const l={},n={"Content-Type":"application/json"};return Object.entries(s).forEach(([c,e])=>{c!=="files"&&(c==="permiso_id"?l[c]=parseInt(e,10):c==="dia_completo"||c==="recuperable"?l[c]=!!e:e!=null&&(l[c]=e))}),{requestData:l,headers:n}}},F=async(s,d,h,S)=>S?d instanceof FormData?(d.append("_method","PUT"),await z.post(s,d,{headers:h})):await z.put(s,d,{headers:h}):await z.post(s,d,{headers:h}),b=async s=>{const{requestData:d,headers:h}=t(s);return await F("/api/v1/user/vacaciones",d,h,!1)},x=async(s,d)=>{const{requestData:h,headers:S}=t(s),l=`/api/v1/user/vacaciones/${d}`;return await F(l,h,S,!0)};return{isSubmitting:i,createPermiso:b,updatePermiso:x,handleSubmit:async(s,d,h)=>{var S,l,n,c;f(!0);try{let e;return d&&h?(e=await x(s,h),M.success("隆Vacaciones actualizadas!",{description:"Los cambios en tu solicitud de vacaciones han sido guardados correctamente.",duration:5e3})):(e=await b(s),M.success("隆Vacaciones solicitadas!",{description:"Tu solicitud de vacaciones ha sido enviada correctamente y est谩 pendiente de aprobaci贸n.",duration:5e3})),e}catch(e){if((l=(S=e.response)==null?void 0:S.data)!=null&&l.errors){const r=Object.values(e.response.data.errors).flat();M.error("Errores de validaci贸n",{description:r.join(", "),duration:8e3})}else if((c=(n=e.response)==null?void 0:n.data)!=null&&c.message)M.error("Error de validaci贸n",{description:e.response.data.message,duration:8e3});else{const r=d?"Error al actualizar las vacaciones":"Error al solicitar las vacaciones";M.error("Error",{description:r,duration:5e3})}throw e}finally{f(!1)}}}}function yo({open:i,onOpenChange:f,permisoToEdit:t=null,onSuccess:F}){const[b,x]=a.useState(null),[w,s]=a.useState(!1),{formData:d,dateRange:h,selectedPermiso:S,isInitializing:l,isEditing:n,maxDurationMs:c,canShowCheckbox:e,canShowTimeFields:r,shouldForceFullDay:_,resetForm:m,initializeFormForEdit:I,handleInputChange:A,handleDateRangeChange:H,setFormData:E}=pi(t),{fileToDelete:L,showDeleteFileDialog:U,isDeletingFile:B,initiateFileDelete:P,confirmDeleteFile:o,cancelFileDelete:u,removeFileFromForm:p}=_i(),{isFormValid:g,validationErrors:R,hasValidationErrors:j,markFieldAsTouched:N}=Fi(d,S),{isSubmitting:C,handleSubmit:T}=gi(),W=async D=>{try{s(!0);const V=(await z.get(`/api/v1/user/vacaciones/${D}`)).data.solicitudPermiso;return x(V),V}catch(v){return console.error("Error al cargar vacaciones completas:",v),null}finally{s(!1)}};a.useEffect(()=>{i&&n&&(t!=null&&t.id)?W(t.id).then(D=>{D&&I(D)}):i&&!n&&m()},[i,t==null?void 0:t.id]),a.useEffect(()=>{i||(m(),x(null))},[i,m]);const J=async()=>{if(!(!g||j))try{await T(d,n,t==null?void 0:t.id),f(!1),F&&F()}catch(D){console.error("Form submission error:",D)}},Q=D=>{const v=Array.isArray(D)?D:D?[D]:[];E(V=>({...V,files:v}))},X=D=>{p(D,E)},Z=D=>{t!=null&&t.id&&P(t.id,D,v=>{x(V=>{if(!V)return V;const oi=V.files.filter(k=>{const ti=k.id&&v.id&&k.id===v.id,ni=k.hash&&v.hash&&k.hash===v.hash,si=k.name===v.name&&k.size===v.size;return!(ti||ni||si)});return{...V,files:oi}})})},ii=!g||j||l||C,ei=(b==null?void 0:b.files)||(t==null?void 0:t.files)||[];return y.jsx(ai,{open:i,onOpenChange:f,children:y.jsxs(ri,{className:"bg-custom-white dark:bg-custom-blackLight max-w-3xl w-full max-h-[90vh] flex flex-col",children:[y.jsxs(ci,{className:"flex-shrink-0",children:[y.jsx(li,{children:n?"Editar Vacaciones":"Solicitar Vacaciones"}),y.jsx(ui,{children:n?"Modifica los datos de tu solicitud de vacaciones existente.":"Completa el formulario para solicitar nuevas vacaciones."})]}),y.jsx("div",{className:"flex-1 overflow-y-auto",children:n&&w?y.jsxs("div",{className:"flex items-center justify-center py-8",children:[y.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-custom-orange"}),y.jsx("span",{className:"ml-2 text-custom-gray-dark dark:text-custom-gray-light",children:"Cargando datos de las vacaciones..."})]}):y.jsxs("form",{className:"space-y-3 pr-2",children:[y.jsx(fi,{dateRange:h,onDateRangeChange:H,formData:d,onInputChange:A,canShowCheckbox:e,canShowTimeFields:r,shouldForceFullDay:_,maxDurationMs:c,selectedPermiso:S,validationErrors:R,markFieldAsTouched:N,empleadoId:null}),y.jsx(hi,{formData:d,onInputChange:A}),y.jsx(mi,{existingFiles:ei,newFiles:d.files||[],onFilesAdd:Q,onFileRemove:X,onExistingFileDelete:Z,showDeleteDialog:U,fileToDelete:L,onConfirmDelete:o,onCancelDelete:u,isDeletingFile:B,isEditing:n})]})}),y.jsxs(di,{className:"px-6 pb-4 pt-6 flex justify-end gap-4 flex-shrink-0 border-t border-custom-gray-light dark:border-custom-gray-darker",children:[y.jsx($,{variant:"outline",onClick:()=>f(!1),disabled:C,className:"bg-hidden hover:bg-custom-gray-default dark:hover:bg-custom-blackSemi text-custom-black dark:text-custom-white rounded-full",children:"Cancelar"}),y.jsx($,{onClick:J,disabled:ii,className:"bg-custom-orange hover:bg-custom-blue text-custom-white dark:text-custom-black dark:hover:bg-custom-white rounded-full",children:C?n?"Actualizando...":"Creando...":n?"Guardar Cambios":"Solicitar Vacaciones"})]})]})})}export{yo as default};
