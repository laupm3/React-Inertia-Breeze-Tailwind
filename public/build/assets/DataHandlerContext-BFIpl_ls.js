import{r as t,a as g,j as U}from"./app-fwyInB3c.js";import{toast as C}from"./index-WlsBA3k2.js";import{u as K,V as ee}from"./ViewContext-ChS6KolG.js";const T=t.createContext(null);function oe(){const d=t.useContext(T);if(!d)throw new Error("useDataHandler debe usarse dentro de DataHandlerContextProvider");return d}const ne=({children:d})=>{const{processApproval:m,isProcessing:P}=K(),p=t.useRef(!1),w={manager:{label:"Manager de departamento",icon:"UserCheck",order:1},hr:{label:"Recursos Humanos",icon:"Users",order:2},direction:{label:"DirecciÃ³n",icon:"Crown",order:3}},[F,l]=t.useState([]),[I,V]=t.useState(!0),[H,S]=t.useState(0),[b,j]=t.useState([]),[L,M]=t.useState([]),[c,x]=t.useState(null),[R,f]=t.useState(!1),[_,v]=t.useState(!1),[O,te]=t.useState(!1),[z,A]=t.useState({createUpdate:{open:!1,model:null},sheet:{open:!1,model:null},delete:{open:!1,model:null}}),y=t.useCallback(async()=>{V(!0);try{const e=await g.get(route("api.v1.admin.vacaciones.index"));if(e.status===200){const a=(e.data.solicitudes||[]).filter(r=>r&&r.id!==void 0);l(a),j(e.data.user_approval_types||[]),M(e.data.approval_types||[]),p.current=!0}else l([]),p.current=!0}catch{l([]),p.current=!0}finally{V(!1)}},[]),h=t.useCallback(()=>{S(e=>e+1),y()},[]),i=t.useCallback(e=>{if(!e||e.id===void 0){console.error("updateData: newItem is invalid",e);return}l(a=>{const r=a.filter(s=>s&&s.id!==void 0);return r.findIndex(s=>s.id===e.id)!==-1?a.map(s=>s&&s.id===e.id?e:s):[e,...r]}),setTimeout(()=>{S(a=>a+1)},100)},[]),D=t.useCallback(e=>{l(a=>a.filter(r=>r&&r.id!==e)),setTimeout(()=>{S(a=>a+1)},100)},[]),q=t.useCallback((e,a)=>{l(r=>r.map(n=>n&&n.id===e?{...n,estado:a,updated_at:new Date().toISOString()}:n)),setTimeout(h,100)},[h]),o=t.useCallback((e,a)=>{A(r=>({...r,[e]:{...r[e],...a}}))},[]),B=t.useCallback(()=>{x(null),o("createUpdate",{open:!0,model:null})},[o]),G=t.useCallback(e=>{if(!e||!e.id){console.error("handleUpdateView: model is invalid",e);return}x(e),o("createUpdate",{open:!0,model:e})},[o]),J=t.useCallback(e=>{if(!e||!e.id){console.error("handleSheetView: model is invalid",e);return}o("sheet",{open:!0,model:e})},[o]),N=t.useCallback(e=>{if(!e||!e.id){console.error("handleDeleteView: model is invalid",e);return}o("delete",{open:!0,model:e})},[o]),u=t.useCallback(()=>{A({createUpdate:{open:!1,model:null},sheet:{open:!1,model:null},delete:{open:!1,model:null}}),x(null)},[]),Q=t.useCallback(async e=>{var a;f(!0),v(!1);try{const r=c?route("api.v1.admin.vacaciones.update",c.id):route("api.v1.admin.vacaciones.store"),s=await g[c?"patch":"post"](r,e,{headers:{"Content-Type":"multipart/form-data"}});if(s.status===200||s.status===201)return C.success(c?"Solicitud de vacaciones actualizada correctamente":"Solicitud de vacaciones creada correctamente"),(a=s.data)!=null&&a.solicitud?i(s.data.solicitud):h(),u(),!0}catch(r){return console.error("Error en el formulario:",r),v(!0),C.error("Error al procesar la solicitud"),!1}finally{f(!1)}},[c,i,h,u]),W=t.useCallback(async e=>{if(!e||!e.id)return console.error("handleDelete: model is invalid",e),!1;f(!0),v(!1);try{if((await g.delete(route("api.v1.admin.vacaciones.destroy",e.id))).status===200)return C.success("Solicitud de vacaciones eliminada correctamente"),D(e.id),u(),!0}catch(a){return console.error("Error al eliminar vacaciones:",a),v(!0),C.error("Error al eliminar la solicitud de vacaciones"),!1}finally{f(!1)}},[D,u]),X=t.useCallback(async(e,a,r,n=null)=>{const s=e.id||e;try{return{success:await m(s,a,r,n,k=>{k&&k.solicitud&&i(k.solicitud)})}}catch(E){return console.error("Error en handleDropdownAction:",E),{success:!1}}},[m,i]),Y=t.useCallback(e=>w[e]||{label:e,icon:"User",order:999},[]),Z=t.useCallback(e=>b.includes(e),[b]);t.useEffect(()=>{p.current||y()},[]);const $={data:F,loading:I,dataVersion:H,userApprovalTypes:b,approvalTypes:L,approvalTypeMap:w,fetchData:y,updateData:i,deleteItem:D,updateSolicitudStatus:q,currentFormModel:c,isFormProcessing:R,formError:_,isFormLoading:O,viewStates:z,handleCreateView:B,handleUpdateView:G,handleSheetView:J,handleDeleteView:N,closeAllViews:u,handleSubmit:Q,handleDelete:W,processApproval:m,isProcessingApproval:P,handleDropdownAction:X,getApprovalTypeInfo:Y,canApproveAs:Z};return U.jsx(T.Provider,{value:$,children:U.jsx(ee,{children:d})})};export{ne as DataHandlerContextProvider,oe as useDataHandler};
