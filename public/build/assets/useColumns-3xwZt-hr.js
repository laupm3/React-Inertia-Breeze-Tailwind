import{r as k,j as i}from"./app-fwyInB3c.js";import{useDataHandler as N}from"./DataHandlerContext-BZN_ZmmA.js";import{E}from"./EmpleadoAvatar-BBWI_HPN.js";import S from"./HorarioEmpleado-PNJSIrB3.js";import y from"./BaseScheduleCell-DxtrDJoG.js";import{A as M}from"./AdvancedHeader-CpvwMmYr.js";import{C as D}from"./ColumnFilter-oxYUebdb.js";import{r as T}from"./RowSelectionColumn-COjZFz9T.js";import{RangeItem as F}from"./RangeItem-D2-j3G9k.js";import{t as b}from"./toDate-qOSwr3PX.js";import{d as g}from"./differenceInMilliseconds-D_qISUSz.js";import{f as j,a as $}from"./format-Be40hyfq.js";import{e as I}from"./es-DNLwfvrq.js";import{e as w}from"./endOfWeek-DoVA-Yvp.js";import"./startOfToday-Dakg9Kzc.js";import"./constants-BKFt95HM.js";import"./avatar-oBOSifLN.js";import"./index-p2DxCSsL.js";import"./index-DmaU4p-o.js";import"./index-BIJodELy.js";import"./index-DloWbRVd.js";import"./utils-CytzSlOG.js";import"./tooltip-DFfoxvAF.js";import"./index-DmpKZt4E.js";import"./index-B7srb2QZ.js";import"./index-CLai1W86.js";import"./index-BZgm3BCW.js";import"./index-BZxTbISK.js";import"./index-CeuhGnKJ.js";import"./GetModalidadIcon-BUgIPR97.js";import"./LucideIcon-CEqEhMjI.js";import"./createLucideIcon-DoJ0Kelj.js";import"./calendar-days-Dti00tYQ.js";import"./calendar-k1x2vwx8.js";import"./check-5DjPwM22.js";import"./chevron-up-OjKdrhzc.js";import"./chevron-right-B1iws4WK.js";import"./user-plus-zM6CnMXf.js";import"./user-CNwXqt1W.js";import"./octagon-alert-BRAzZNeG.js";import"./x-2mzC_aTV.js";import"./FichajePills-kGTtBN3A.js";import"./getRoundingMethod-D0I6Z7xl.js";import"./DataTableContext-BYrqyX0i.js";import"./index-Z1g0u-qm.js";import"./popover-DaRbHQOK.js";import"./index-CyKk8pQ_.js";import"./tslib.es6-BUas5LQb.js";import"./button-Blwr-A5N.js";import"./index-BwobEAja.js";import"./input-CqlBlYgU.js";import"./separator-BWKairMX.js";import"./command-PoUoScut.js";import"./index-DVo7DTeW.js";import"./dialog-iaZkf6Xy.js";import"./badge-BgloL8Ae.js";import"./Button-CQuYVLGu.js";import"./select-B5O0TxCl.js";import"./index-C_F9oucK.js";import"./index-4A9uUPu1.js";import"./DatePicker-YJSItPq7.js";import"./calendar-DctTJhwg.js";import"./addDays-B9Fzl-_R.js";import"./parseISO-Efi0RkWR.js";import"./multi-select-BSyp-qjs.js";import"./index-BxSEkZvI.js";import"./RangeZone-hbn3uf5i.js";function v(a,n){const e=b(a.start),t=b(a.end);let r=+e>+t;const m=r?+e:+t,s=r?t:e;s.setHours(0,0,0,0);let l=1;const o=[];for(;+s<=m;)o.push(b(s)),s.setDate(s.getDate()+l),s.setHours(0,0,0,0);return r?o.reverse():o}function A(a){return b(a).getDay()}function et(){const{selectedRange:a}=N();return k.useMemo(()=>L([T,{id:"empleado",title:"Empleado",enableHiding:!1,enableSorting:!0,sortUndefined:"last",enableFiltering:!0,header:({column:e})=>i.jsx(M,{column:e,className:"max-w-[250px]"}),cell:({row:e})=>i.jsx(E,{empleado:e.original.empleado}),accessorFn:e=>`${e.empleado.primerApellido} ${e.empleado.segundoApellido}, ${e.empleado.nombre}`,filterFn:(e,t,r)=>{if(!r.length)return!0;const m=e.getValue(t);return r.some(s=>m.toLowerCase().includes(s.toLowerCase()))}},{id:"empleado.empresas",title:"Empresas",enableHiding:!1,enableSorting:!1,sortUndefined:"last",enableFiltering:!0,hideColumn:!0,header:({column:e})=>i.jsx(D,{column:e,labelFn:t=>`${t.nombre}`,valueFn:t=>t.nombre,className:"min-w-[150px] max-w-[250px]"},`filter${e.id}`),accessorFn:e=>e.empleado.empresas?e.empleado.empresas.map(t=>t.nombre.toLowerCase()):[],filterFn:(e,t,r)=>{if(!r.length)return!0;const m=e.getValue(t);return r.some(s=>m.some(l=>l.includes(s.toLowerCase())))}},{id:"empleado.departamentos",title:"Departamentos",enableHiding:!1,enableSorting:!1,sortUndefined:"last",enableFiltering:!0,hideColumn:!0,header:({column:e})=>i.jsx(D,{column:e,labelFn:t=>`${t.nombre}`,valueFn:t=>t.nombre,className:"min-w-[150px] max-w-[250px]"},`filter${e.id}`),accessorFn:e=>e.empleado.departamentos?e.empleado.departamentos.map(t=>t.nombre.toLowerCase()):[],filterFn:(e,t,r)=>{if(!r.length)return!0;const m=e.getValue(t);return r.some(s=>m.some(l=>l.includes(s.toLowerCase())))}}],a),[a])}const L=(a,n)=>{const e=v({start:n.from,end:n.to}),t=e.length;return e.forEach((r,m)=>{const s=j(r,"yyyy-MM-dd"),l={accessorKey:s,enableSorting:!0,enableHiding:!0,header:()=>i.jsx("span",{className:"capitalize block w-full text-center",children:j(r,"EEE. dd MMMM",{locale:I})}),cell:({row:o})=>{var c,h;const{horarios:p}=o.original,d=p[s];return d?i.jsx(y,{children:d.map(u=>{var f,x;return i.jsx(F,{value:{key:u.id,horarioId:u.id,empleado:{id:o.original.empleado.id,profile_photo_url:(x=(f=o.original.empleado)==null?void 0:f.user)==null?void 0:x.profile_photo_url,nombre:o.original.empleado.nombreCompleto},date:s},children:i.jsx(S,{horario:u},u.id)},u.id)})}):i.jsx(y,{children:i.jsx(F,{value:{key:`${o.original.empleado.id}-${s}`,horarioId:null,empleado:{id:o.original.empleado.id,profile_photo_url:(h=(c=o.original.empleado)==null?void 0:c.user)==null?void 0:h.profile_photo_url,nombre:o.original.empleado.nombreCompleto},date:s},children:i.jsx("div",{className:"grid grid-cols-1 gap-y-1",children:i.jsx("div",{className:"flex w-full h-28 rounded-xl"})})})})}};a.push(l),(A(r)===0||m===t-1)&&a.push(O(r))}),a},O=a=>{const n=j(a,"yyyy-MM-dd"),e=v({start:$(a,{weekStartsOn:1}),end:w(a,{weekStartsOn:1})});return{accessorKey:`${n}-horarios-stadistics`,enableSorting:!0,enableHiding:!0,header:()=>i.jsx("span",{className:"capitalize block w-full text-center",children:"Horas"}),cell:({row:r})=>{const{horarios:m}=r.original,s=e.reduce((o,p)=>{const d=j(p,"yyyy-MM-dd"),c=m[d];return c&&o.push(...c),o},[]),l=Object.values(s.reduce((o,p)=>{const{id:d}=p.contrato;return o[d]||(o[d]={...p,horariosContrato:[]}),o[d].horariosContrato.push(p),o},{}));return i.jsx(y,{className:"totalHorasSemanales",children:l.map(o=>i.jsx(R,{horariosPorContrato:o},`${n}_totalSemanal_${o.contrato.id}`))})}}};function R({horariosPorContrato:a}){const{contrato:n,horariosContrato:e}=a,{fichajeReal:t,totalHoras:r}=U(e);return i.jsxs("div",{className:"flex flex-col items-center justify-start gap-1",children:[i.jsxs("span",{className:"font-semibold text-custom-blackLight dark:text-custom-white",children:[t," horas"]}),i.jsxs("span",{className:"text-xs font-semibold text-custom-gray-semiDark dark:text-custom-gray-dark",children:["de ",r," horas"]}),i.jsx("span",{className:"text-xs font-semibold text-custom-gray-semiDark dark:text-custom-gray-darker",children:n.asignacion.nombre||"Desarrollador Web"})]})}const U=a=>{const n={msFichajeTotal:0,msTeoricoTotal:0},e=a.reduce((t,r)=>{const{horario_inicio:m,horario_fin:s,descanso_inicio:l,descanso_fin:o,fichaje_entrada:p,fichaje_salida:d,descansosAdicionales:c}=r,h=l?g(o,l):0,u=g(s,m),f=p&&d?g(d,p):0,x=f&&c?c.reduce((H,C)=>H+g(C.descanso_fin,C.descanso_inicio),0):0;return t.msFichajeTotal+=Number(f)-Number(x),t.msTeoricoTotal+=Number(u)-Number(h),t},n);return{fichajeReal:_(e.msFichajeTotal),totalHoras:_(e.msTeoricoTotal)}};function _(a){let n=parseInt(a/6e4%60),e=Math.floor(a/(1e3*60*60));return e=e<10?"0"+e:e,n=n<10?"0"+n:n,e+":"+n}export{et as useColumns};
